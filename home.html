<!DOCTYPE html>
<html lang = fi>
<head>
<meta charset="UTF-8">
<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Crimson+Text&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans+Condensed:500&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:700&display=swap" rel="stylesheet">
<link rel = "stylesheet" href = "style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.js"></script>

</head>

<body>
<div class=upperbar style = "display: none;">
<h1>Street Masters - Endless Story Mode</h1>
</div>

<div class = "boxtitle"><span><h2>Number of Global Gladiators?</b></h2></span>
    <input type="button" class="button" value="The Kingdom must fall!" onclick="createStory()">
    <select type="select" class="input" id="players" name="players">
    <option value="4">4</option>
    <option value="3">3</option>
    <option value="2" selected>2</option>
    <option value="1">1</option>
    </select><br><br>
</div><br>

<div class=backbar>
<div class = "refcard">
<div class = "storycardfront">
    <div class = "storycardfront-title" id="storycardfront-title${cardnumber}">
        <div class = "circleicon" style="float: left">
            <span class="circle-outer"><span class="circle-middle"><span class="circle-inner"></span></span></span>
        </div>
        <div class="titletext"></div>
    </div>
    <div class = "storycard-divider"></div>
    <div class = "refcard-subtitle"></div>
    <div class = "storycard-divider"></div>
    <div class = "storycardfront-prologue"><div class = "refcardfront-prologuetext"></div></div>
    <div class = "storycard-divider"></div>
    <div class = "storycardfront-setup">
        <div class = "refcardsetuptext"></div>
        <div class = "expansionicon">
            <span class="infinity-before"></span><span class="infinity-after"></span>
        </div>
    </div>
    </div>
</div>
<div class = "refcard">
    <div class = "refcardback">
        <div class = "storycardfront-title" id="storycardfront-title${cardnumber}">
            <div class = "circleicon" style="float: left">
                <span class="circle-outer"><span class="circle-middle"><span class="circle-inner"></span></span></span>
            </div>
            <div class="titletext"></div>
        </div>
        <div class = "storycard-divider"></div>
        <div class = "refcard-subtitle"></div>
        <div class = "storycard-divider"></div>
        <div class = "storycardfront-prologue"><div class = "refcardfront-prologuetext"></div></div>
        <div class = "storycard-divider"></div>
        <div class = "storycardfront-setup">
            <div class = "refcardsetuptext"></div>
            <div class = "expansionicon">
                <span class="infinity-before"></span><span class="infinity-after"></span>
            </div>
        </div>
        </div>
    </div>
<div class = "card"></div>
<div class = "card"></div>
<div class = "card"></div>
<div class = "card"></div>
<div class = "card"></div>
<div class = "card"></div>
<div class = "card"></div>
<div class = "card"></div>
<div class = "card"></div>
</div>
</div>
<script type="text/javascript">

let enemiescopy

$(document).on('keypress',function(e) {
    if(e.which == 13) {
        createStory();
    }
});
    
$( document ).ready(function() {
    
    let cardnumber = 0;
    $(".card").each(function() {
        cardnumber++;
    $(this).attr("id","card"+cardnumber);    
    $(this).html(`
<div class = "storycardfront">
<div class = "storycardfront-title" id="storycardfront-title${cardnumber}">
    <div class = "circleicon" style="float: left">
        <span class="circle-outer"><span class="circle-middle"><span class="circle-inner"></span></span></span>
    </div>
    <div class="titletext"></div>
</div>
<div class = "storycard-divider"></div>
<div class = "storycardfront-subtitle" id="storycardfront-subtitle${cardnumber}"></div>
<div class = "storycard-divider"></div>
<div class = "storycardfront-prologue"><div class = "storycardfront-prologuetext"></div></div>
<div class = "storycard-divider"></div>
<div class = "storycardfront-setup">
    <div class = "setuptext" id = "setuptext${cardnumber}"></div>
    <div class = "expansionicon">
        <span class="infinity-before"></span><span class="infinity-after"></span>
    </div>
</div>
</div>

<div class = "storycardback">
<div class = "storycardback-bar-top"></div>
<div class = "storycard-divider" style = "height: 0.4px"></div>
<div class = "storycardback-epilogue-top" id = "storycardback-epilogue-top${cardnumber}">
    <div class = "storycardback-titlebar">
    <div class = "storycardback-epiloguetitle">If the fighers win:</div>
    </div>
        <div class = "storycardback-colorbar-back"><div class = "storycardback-colorbar-green"></div></div>
        <div class = "storycardback-winepiloguetext"></div>

</div>
<div class = "storycardback-epilogue-bottom" id = "storycardback-epilogue-bottom${cardnumber}">
<div class = "storycardback-titlebar">
    <div class = "storycardback-epiloguetitle">If the fighters lose:</div>
    </div>
        <div class = "storycardback-colorbar-back"><div class = "storycardback-colorbar-red"></div></div>
        <div class = "storycardback-loseepiloguetext"></div>
</div>
<div class = "storycard-divider"></div>
<div class = "storycardback-bar-bottom">
        <div class = "storycardback-bottomtitle" id = "storycardback-bottomtitle${cardnumber}"></div>
</div>
</div>
`);
  });
    
});

function randFrom(array) {
    return array[Math.floor(Math.random()*array.length)]
}

function filterArray(array, key, filter, exclusion = false) {
    if (exclusion == false) {
        array = _.filter(array, function(o) {return o[key] == filter})
        } else array = _.filter(array, function(o) {return o[key] != filter});
    return array
}

function globalGladiators(enemies, stages) {

    let gladiators = [
        {name: "Ah Long", enemy: [filterArray(enemies,"boss","Ah Long")[0],randFrom(filterArray(enemies,"name","Kingdom"))], ally: ["Wan Bo"], rival: ["Shadow", "Jackal", "Wan Bo"], stage: "Steel Memories",
        get instructions() {return `If you choose to use ${this.name}, choose ${this.enemy[1].boss} as the boss in part 2B of your personal story.`}},
        {name: "Axel", enemy: filterArray(enemies,"boss","Mack")[0], ally: ["Mary Ann"], rival: ["Mary Ann"], stage: "Under Destruction"},
        {name: "Brandon", enemy: filterArray(enemies,"boss","Ah Long")[0], ally: ["Isabella"], rival: ["Isabella"], stage: ["Cashed Out", "Steel Memories"]},
        {name: "Clint", enemy: randFrom(filterArray(enemies,"name","Kingdom")), ally: [""], rival: [""]/*random rival*//*random rival*/, stage: [randFrom(stages).name],
        get instructions() {return `If you choose to use ${this.name}, choose ${this.enemy.boss} as the boss and ${this.stage} as the stage in part 3 of your personal story.`}},
        {name: "Dmitri", enemy: randFrom(enemies), ally: [""], rival: ["Anastasia"], stage: "Right to Remain Silent",
        get instructions() {return `If you choose to use ${this.name}, choose ${this.enemy.name == "Kingdom" ? `${this.enemy.boss} from the ${this.enemy.name} as the boss` : `${this.enemy.name} as the enemy`} in part 1 of your personal story.`}},
        {name: "Gabriel", enemy: filterArray(enemies,"boss","Jackal")[0], ally: ["Drago"], rival: ["Drago"], stage: "Original Copy",
        get instructions() {return `If you choose to use ${this.name}, ${getRandomMinions(this.enemy.name)} in part 3 of your personal story.`}},
        {name: "Ikuchi", enemy: filterArray(enemies,"boss","Jackal")[0], ally: ["Megan"], rival: [""], stage: "Original Copy",
        get instructions() {return `If you choose to use ${this.name}, ${getRandomMinions(this.enemy.name)} in part 2 of your personal story.`}},
        {name: "Jackal", enemy: filterArray(enemies,"boss","Shadow")[0], ally: ["Project X"], rival: ["Kemono", "Project X"], stage: "Steel Memories"},
        {name: "Juan", enemy: randFrom(enemies), ally: ["Tiger Azules"], rival: ["Tiger Azules"], stage: "Compromised",
        get instructions() {return `If you choose to use ${this.name}, choose ${this.enemy.name == "Kingdom" ? `${this.enemy.boss} from the ${this.enemy.name} as the boss` : `${this.enemy.name} as the enemy`} in part 1 of your personal story.`}},
        {name: "Kemono", enemy: randFrom(filterArray(enemies,"boss","Shadow", true)), ally: ["Darius"], rival: ["Shadow", "Darius"], stage: "Sudden Death",
        get instructions() {return `If you choose to use ${this.name}, choose ${this.enemy.boss} as the boss in part 2 of your personal story.`}},
        {name: "Kenshin", enemy: filterArray(enemies,"boss","Ah Long")[0], ally: ["Brandon"], rival: ["Shadow","Jackal","Kemono"], stage: "Cashed Out"},
        {name: "Kyoryu", enemy: randFrom(enemies), ally: ["Hanzo"], rival: ["Hanzo"], stage: "Sudden Death",
        get instructions() {return `If you choose to use ${this.name}, choose ${this.enemy.boss} as the boss in part 2A of your personal story.`}},
        {name: "Mack", enemy: filterArray(enemies,"boss","Juan")[0], ally: ["Leeta"], rival: ["Shadow"], stage: "Sudden Death"},
        {name: "Max", enemy: randFrom(enemies), ally: [""]/*random ally*/, rival: [""]/*random rival*/, stage: "Compromised",
        get instructions() {return `If you choose to use ${this.name}, choose ${this.enemy.name == "Kingdom" ? `${this.enemy.boss} from the ${this.enemy.name} as the boss` : `${this.enemy.name} as the enemy`} in part 2A of your personal story.`}},
        {name: "Megan", enemy: filterArray(enemies,"boss","Dmitri")[0], ally: ["Sera O'Quinn"], rival: ["Sera O'Quinn"], stage: ["Gone Ballistic", "Compromised"]}, 
        {name: "Miss Matrix", enemy: filterArray(enemies,"boss","Ah Long")[0], ally: ["Ying Hua"], rival: ["Ah Long","Kemono"], stage: "Cashed Out"},
        {name: "Natalia", enemy: filterArray(enemies,"boss","Dmitri")[0], ally: ["Zane"], rival: ["Zane"], stage: ["Gone Ballistic", "Original Copy"],
        get instructions() {return `If you choose to use ${this.name}, ${getRandomMinions(this.enemy.name)} in part 2B of your personal story.`}},
        {name: "Project X", enemy: randFrom(filterArray(enemies,"name","Kingdom")), ally: ["Natalia"], rival: ["Natalia","Jackal"], stage: "Original Copy", 
        get instructions() {return `If you choose to use ${this.name}, choose ${this.enemy.boss} as the boss and ${getRandomMinions(this.enemy.name)} in part 3 of your personal story.`}},
        {name: "Rhys", enemy: filterArray(enemies,"boss","Mack")[0], ally: ["Leeta"], rival: ["Leeta"], stage: "Poison the Well"},
        {name: "Shadow", enemy: filterArray(enemies,"boss","Juan")[0], ally: ["Shin Yokai"], rival: ["Ah Long", "Dmitri", "Shin Yokai", "Kemono"], stage: [randFrom(stages).name],
        get instructions() {return `If you choose to use ${this.name}, choose ${this.stage} as the stage in part 2A of your personal story.`}},
        {name: "Selene", enemy: filterArray(enemies,"boss","Dmitri")[0], ally: [""], rival: ["Genesis"], stage: "Estate of Decay"},
        {name: "The Don", enemy: filterArray(enemies,"boss","Juan")[0], ally: ["Gabriel"], rival: ["Juan", "Gabriel"], stage: "Gone Ballistic"},
        {name: "The Proxy", enemy: filterArray(enemies,"boss","Juan")[0], ally: ["Power Soldier"], rival: ["Power Soldier"], stage: "Compromised"},
        {name: "Tiger Azules", enemy: randFrom(enemies), ally: [""]/*random ally*/, rival: [""], stage: "Supply and Demand",
        get instructions() {return `If you choose to use ${this.name}, choose ${this.enemy.name == "Kingdom" ? `${this.enemy.boss} from the ${this.enemy.name} as the boss` : `${this.enemy.name} as the enemy`} in part 2 of your personal story.`}},
        {name: "Tlazolteotl", enemy: filterArray(enemies,"boss","Jackal")[0], ally: ["Kemono"], rival: ["Kemono","Tlazolteotl"], stage: "Original Copy",
        get instructions() {return `If you choose to use ${this.name}, ${getRandomMinions(this.enemy.name)} in part 3 of your personal story.`}},
        {name: "Ying Hua", enemy: filterArray(enemies,"boss","Ah Long")[0], ally: ["Jin"], rival: ["Jin"], stage: ["Cashed Out"]},
        {name: "Yokai", enemy: filterArray(enemies,"boss","Shadow")[0], ally: ["Marionette Doll"], rival: ["Marionette Doll"], stage: "Steel Memories"}
        ]        
        
    let globalgladiators = []

    while (globalgladiators.length < $("#players").val()) {
        let random = Math.floor(Math.random()*gladiators.length)
        let newgladiator = gladiators[random]
        globalgladiators.push(newgladiator)
        gladiators.splice(random,1)
    } 
    return globalgladiators;
}

function bossDescription(enemy) {
    let bossynonym = randFrom(["boss","boss","boss","leader","leader","head","chief","kingpin"])
    let fame = randFrom(["notorious","infamous","ill-famed"])

    let description = [
        `${enemy.expression}`,
        `the ${bossynonym} of the ${enemy.name}`,
        `the ${bossynonym} of the ${enemy.name}, ${enemy.expression}`,
        `the ${enemy.bosstitle}`,
        `the ${enemy.bosstitle} of the ${enemy.name}`,
        `the ${enemy.bosstitle}, ${enemy.expression}`,
        `the ${enemy.bosstitle} ${bossynonym} of the ${enemy.name}`,
        `the ${enemy.bosstitle} of the ${enemy.name}, ${enemy.expression}`,
        `the ${fame} ${bossynonym} of the ${enemy.name}`,
        `the ${fame} ${enemy.bosstitle}`,
        `the ${fame} ${enemy.bosstitle} of the ${enemy.name}`,
        `the ${fame} ${enemy.bosstitle}, ${enemy.expression}`
    ]

    return `${enemy.boss}, ${randFrom(description)}`
}


function createStory() {

let enemies = [
        {name:"Brotherhood", boss: "Dmitri", bosstitle: "callous mercenary", gender: "male", desc: "the ruthless band of mercenaries", addressing: "comrades", minions: "mercenaries, soldiers and spies", threat: "unsheaths his knife, running it along his fingers", minionnames: ["Anastasia", "Boris", "Drago"], preparedboss: [["Trusty Kevlar","and put it into play"],["N-40 Punisher","and put it into play"]], gloat: [[`You will lose,`,`I must break you.`],[`It's better to have a gun and not need it,`,`Than to need a gun and not have it.`],[`This is my boomstick,`,`Good or bad, I'm the one with the gun.`],[`Okay, I'm reloaded! You think you're big time? You're gonna die big time!`,`You ready? Here comes the pain!`],[`You want to play rough?`,`Say hello to my little friend!`]],expression: `baring his teeth as he recognizes you`},
        
        {name:"Cartel", boss: "Juan", bosstitle: "ruthless gangster", gender: "male", desc: "the gang of vicious drug smugglers", addressing: "my boys", minions: "vicious gangers and hardened outcasts", threat: "levels his gun straight at you", minionnames: ["Tyrone", "Ignacio", "Lucille"], preparedboss: [["On Alert","and put it into play"]], gloat: [[`It's better to have a gun and not need it,`,`Than to need a gun and not have it.`],[`This is my boomstick,`,`Good or bad, I'm the one with the gun.`],[`Okay, I'm reloaded! You think you're big time? You're gonna die big time!`,`You ready? Here comes the pain!`],[`You wanna play rough?`,`Say hello to my little friend!`]], expression: `flicking a cigar in your direction`},
        
        {name:"Golden Dragons", boss: "Ah Long", bosstitle: "unrelenting martial arts master", gender: "male", desc: "the enterprise of martial artists, thugs, and businessmen", addressing: "weasels", minions: "ruthless triads and yakuza", threat: "lifts his hand, dark, malevolent energy flaring on his fist", minionnames: ["Jin", "Dao", "Wan Bo"], preparedboss: [["Merciless Clutch", "and put it into play"]], expression: `his keen eyes and sly smirk reeking of confidence and self-importance`},
        
        {name:"Kingdom", boss: "Kemono", bosstitle: "imposing green mutant", gender: "male", desc: "the mysterious criminal syndicate", addressing: "whelps", minions: "mysterious ninja and martial arts masters", threat: "lifts his mighty fist, lightning crackling", minionnames: ["Power Soldier", "Marionette Doll", "Mountain General"], preparedboss: [["Uncontrollable Surge","and put it into play"]], gloat: [[`You should not have come,`,`But you have forced my hand.`],[`You should not have come,`,`You have brought this upon yourselves.`]], expression: `his demonic eyes and grim expression delivering a promise of violence`},
        
        {name:"Kingdom", boss: "Jackal", bosstitle: "mad scientist", gender: "female", desc: "the mysterious criminal syndicate", addressing: "my subjects", minions: "soldiers and marionettes", threat: "smiles, as her eyes start to glow malevolently, and you feel pressure behind your eyes", minionnames: ["Power Soldier", "Marionette Doll", "Mountain General"], preparedboss: [["Neural Invasion","and play it"]], gloat: [[`You won't get out of here,`,`I never turn down new specimens!`],[`You have played your part well,`,`But who do you think you really are?`],[`You always are so predictable,`,`Who do think you are working for?`]], expression: `her mad eyes and demonic grin showing no humanity`},
        
        {name:"Kingdom", boss: "Shadow", bosstitle: "ominous mastermind", gender: "male", desc: "the mysterious criminal syndicate", addressing: "you fools", minions: "mysterious ninja and martial arts masters", threat: "lifts his hand, and dark blades materialize out of thin air", minionnames: ["Power Soldier", "Marionette Doll", "Mountain General"], preparedboss: [["Fan of Blades","and put it into play"]], gloat: [[`My, what a brave, handsome group,`,`Perhaps it would interest you to see what fate has in store for you.`],[`You have interfered for the last time,`,`Now, you shall die.`],[`My children, you have come to me. For who now is your father if it is not me?`,`When I am gone, you will have never been. What would your world be without me?`],[`On its own, humanity is a destructive force,`,`It needs a master.`]], expression: `his calculating eyes reflecting a cold, merciless intellect`},
        
        {name:"Nahualli", boss: "Tlazolteotl", bosstitle: "Aztec empress", gender: "female", desc: "the ancient force of restless warriors", addressing: "mortals", minions: "necromancers and walking dead", threat: "reaches for you, fingers spread wide, purple arcane energy crackling between them", minionnames: ["Pale Caller","Pale Caller"], preparedboss: [["Decaying Blast","and play it"]], gloat: [[`You must be taught what has been forgotten,`,`You must be taught the wrath of the old gods.`],[`I will have your soul!`,`I will taste its sins!`],[`You have strayed from the cycle of life and death,`,`I will make you my next sacrifice.`],[`I have conquered this world before,`,`I will not be stopped by the likes of you children!`],[`Enough of these games!`,`I will take what I am due!`],[`You will pay your goddess her due respect!`,`I will make you my next sacrifice!`],[`Even the strongest warriors will fall!`,`Fall to the power of death!`]], expression: `beautiful and terrible all at once`},
        
        {name:"Oni", boss: "Yokai", bosstitle: "cursed, powerful warrior", gender: "male", desc: "the group of cursed spirits", addressing: "you fools", minions: "ancient guardians and powerful spirits", threat: "lifts his mighty fist, suddenly engulfed in cursed flames", minionnames: ["Yurei Ninja", "Kitsune"], preparedboss: [["Eldritch Strike","and play it"]], gloat: [[`Are you prepared to face the wrath of Shin Yokai?`,`No, you’re not prepared!`],[`My hunger is insatiable!`,`And you are my food!`]], expression: `his fiery stare and gritted teeth sending a message of barely contained fury`},
        
        {name:"Onyx League", boss: "Mack", bosstitle: "black-hearted overlord", gender: "male", desc: "the league of street gangs", addressing: "pigs", minions: "vicious gangers and street criminals", threat: "levels his gun straight at you", minionnames: ["Abolo", "Felicia Salt", "Veronica Pepper"], preparedboss: [["Taking Aim","and put it into play"]], gloat: [[`Fists versus bullets?`,`I will use your butts as target practice!`],[`This is my boomstick,`,`Good or bad, I'm the one with the gun.`],[`You wanna play rough?`,`Say hello to my little friend!`],[`Greed is for amateurs,`,`I believe there should be no rules, only chaos.`],[`I have come here to create a new country,`,`A country called chaos!`],[`When the world turns upside down,`,`The best thing to do is turn right along with it.`],[`You think you're free,`,`But you don't understand what freedom is.`],[`Only after disaster,`,`Can we be resurrected.`],[`It's only after you've lost everything,`,`That you're free to do anything.`],[`Nothing is static, everything is evolving,`,`Everything is falling apart.`]], expression: `his keen eyes and predatory sneer reeking of confidence and ruthlessness`}
        ];
        // Yokai special setup?

let stages = [
    {name:"Ashes of the Eternal", instory: 0, location: "cursed", bystander: "acolyte", 
    stagebonus: [`Any fighter may put this card in their play area. <b>Feint:</b> Remove this card from the game to discard 1 fire token from the map.`,false,false,false],
    stagepenalty: [`One fighter places 1 fire token in the space nearest to them.`,false,false,false], 
    masterplan: randFrom(["actsofterror","personalpower"]), // rework acts of terror into decimating the countryside
    gloat: [[`You won’t stop the inevitable!`,`I’ll end you here, with or without the Oni!`],[`Power!`,`Unlimited power!`]],
    rivaltext: _.template(', but ${rival}<%=rivalboost ? `, possessed by the infernal force` : `, looking to gain some of the infernal force`%> moves in to intervene'),
    hottrail: _.template('You were not too late! ${enemy.boss} falls on the floor, barely able to stand up, and stares at ${gPron(enemy, "possessive")} hands with astonishment.  "This can\'t be," ${gPron(enemy, "subject")} says hoarsely.  "I have come so far..." ${ucInit(gPron(enemy, "subject"))} looks up to you with a look of shock.'),
    coldtrail:  _.template('${enemy.boss} falls on the floor, then pulls ${gPron(enemy,"reflexive")} off, standing up and staring at ${gPron(enemy, "possessive")} hands with astonishment.  "This can\'t be," ${gPron(enemy, "subject")} says calmly.  "I have come so far..." ${ucInit(gPron(enemy, "subject"))} looks up to you,  ${gPron(enemy, "possessive")} look of shock changing to one of pure rage.'),
    clueless: _.template('${enemy.boss} falls down to the floor of the temple, landing solidly on ${gPron(enemy, "possessive")} feet.  ${ucInit(gPron(enemy, "subject"))} flexes ${gPron(enemy, "possessive")} muscles slowly, staring at ${gPron(enemy, "possessive")} clenched fists, an evil grin on ${gPron(enemy, "possessive")} face. ${ucInit(gPron(enemy, "subject"))} then looks up to you, and laughs.'),
    prologue: _.template('${trail} you find ${bossDescription(enemy)} at a remote ${evilPlace()}. The ${mysticalSynonym()} powers float ${gPron(enemy, "object")} as ${gPron(enemy, "subject")} draws in a portion of the hellfire of the cursed Oni. You rush in to disrupt the ritual, scattering the unholy urns.<br><br>${stagevar} "${gloat[0]}" ${gPron(enemy, "subject")} says. "${gloat[1]}" ${laconicStatement(enemy)}<br><br>You stand ready to face ${gPron(enemy, "object")}, and suddenly wince as your hands begin burning with a searing hot pain. You look down to see bright red lines snaking their way along your hands. You must have disrupted some ancient power by scattering the urns - ${randFrom([`when will you`,`will you ever`,`would it hurt to some day`])} learn? Gritting your teeth, you pick up the urns and prepare to return them to their rightful place<%=rivalpresence ? `${rivaltext}` : ``%>.'),
    captured: _.template('You awaken to searing hot pain. You look down to see bright red lines snaking their way along your hands. ${bossDescription(enemy)} is floated by the ${mysticalSynonym()} powers as ${gPron(enemy, "subject")} draws in a portion of the hellfire of the cursed Oni. You see ${mysticalSynonym()} urns scattered neardy - ${gPron(enemy, "subject")} must have used you to activate their ${mysticalSynonym()} powers!<br><br>${stagevar} "${gloat[0]}" ${gPron(enemy, "subject")} says. "${gloat[1]}" ${laconicStatement(enemy)}<br><br>You rip your bonds, grit your teeth, and prepare to return the urns to their rightful place<%=rivalpresence ? `${rivaltext}` : ``%>.')},
    
    {name:"Cashed Out", instory: 0, location: "base", bystander: "gambler", 
    stagebonus: [`Each fighter may put a random defense token on a Frightened Gambler in their threat area.`,false,false,false], 
    stagepenalty: [`Search the stage deck for a Pit Boss card and choose one fighter to draw it. Shuffle the stage deck.`,false,false,false], 
    masterplan: randFrom(["actsofterror","illegalgains"]),
    gloat: [[`If you have a gun, you can rob a casino,`,`But if you have a casino, you can rob everyone!`],[`You think fighting me in some nightclub's gonna stop the downfall of Ransom?`,`I'm not your problem. I'm just doing business.`]],
    rivaltext: _.template(' But ${gPron(enemy,"subject")} is not alone. Alongside ${gPron(enemy,"object")} is ${rival}, <%=rivalboost ? `eyes glowing green of Vandal!` : `here to sell an encrypted ${gizmo} to ${enemy.boss}.`%>'),
    hottrail: _.template('You quickly find your way to a set of double doors. You step into the VIP room of the opulent casino. Seated before you is a surprised ${bossDescription(enemy)}'),
    coldtrail: _.template('You eventually find your way to a set of double doors. You hear a commotion inside and - fearing you have lost the element of surprise - you bust in.  Your hunch was right; ${bossDescription(enemy)}, knew you were coming. "Get the money," ${gPron(enemy,"subject")} commands ${gPron(enemy,"possessive")} goons. "I\'ll hold them off."'), 
    clueless: _.template('After going through many ${enemy.minions} of the ${enemy.name}, you reach the VIP room of the casino. Inside, ready to face you is ${bossDescription(enemy)}'),
    prologue: _.template('${trail}, you <%=knowledge == "clueless" ? `investigate the gambling den ${casino}` : `arrive at the ${casino}` %>, where you sneak in, and make your way through the halls of the casino. The surroundings speak volumes about the vast wealth channeled into the ${possessiveSuffix(enemy.name)} operations.<br><br>${stagevar}<%=!rivalpresence ? `.`:`${rivaltext}`%><br><br>${enemy.boss} looks at you and grins. "${gloat[0]}" ${gPron(enemy,"subject")} says. "${gloat[1]}" At that, ${enemy.boss} snaps ${gPron(enemy,"possessive")} fingers, and it becomes clear that the chat is over.'),
    captured: _.template('You are thrown to the floor of the VIP room in the ${casino} casino, beaten by the many ${enemy.minions}. Seated before you is ${bossDescription(enemy)}.<%=!rivalpresence ? `.`:`${rivaltext}`%><br><br>${enemy.boss} looks at you, grins and ${enemy.threat}. "${gloat[0]}" ${gPron(enemy,"subject")} says. "${gloat[1]}" At that, ${enemy.boss} snaps ${gPron(enemy,"possessive")} fingers, and it becomes clear that the chat is over.')
    },

    {name:"The Ceremony", instory: 0, location: "cursed", bystander: "acolyte", 
    stagebonus: [`Flip 2 objective tokens furthest from a fighter to their active side. Each fighter gains 1 random dedense token.`,false,false,false], 
    stagepenalty: [`Each fighter must either discard a card at random or place 1 power on "Oni's Vessel".`,false,false,false], 
    masterplan: randFrom(["kidnapping","personalpower"]),
    gloat: [[`You're too late!`,`You're efforts are futile!`],[`You won’t stop the inevitable!`,`I’ll end you here, with or without the Oni!`]],
    rivaltext: _.template(' To your dismay ${rival}<%=rivalboost ? `, arms engulfed with burning lines of power,`: ``%> has joined the ${enemy.minions} of the ${enemy.name} in the ritual.'),
    hottrail: _.template(' in the hopes of preventing ${enemy.boss} from realizing ${gPron(enemy,"possessive")} plans. "${gloat[0]}" calls ${bossDescription(enemy)}. "${gloat[1]}" ${ucInit(gPron(enemy,"subject"))} and ${gPron(enemy,"possessive")} forces have reached the entrance, and now stand ready to engage you!'),
    coldtrail: _.template('. ${enemy.boss} and ${gPron(enemy,"possessive")} forces are already starting the ritual. "${gloat[0]}" calls the confident ${bossDescription(enemy)}, ${gPron(enemy,"possessive")} voice echoing off the stone walls. "${gloat[1]}" ${ucInit(gPron(enemy,"subject"))} forces charge you while ${gPron(enemy,"subject")} continues the ritual.'),
    clueless: _.template('. ${enemy.boss} and ${gPron(enemy,"possessive")} forces have already started the ritual, and you feel the the air intensifying. "${gloat[0]}" calls the confident ${bossDescription(enemy)}, ${gPron(enemy,"possessive")} voice echoing off the stone walls. "${gloat[1]}" ${ucInit(gPron(enemy,"possessive"))} forces charge you while ${gPron(enemy,"subject")} finalizes the ritual.'),
    prologue: _.template('${trail}, you reach the hidden ${evilPlace()}. You see the main chamber of the ancient stone structure is encircled with multiple pedestals, each with a mysterious urn placed on top. The urns are etched with a series of images depicting powerful warriors defeating mighty foes.<br><br>Thinking that these may be part of the ritual, you decide you must quickly remove them from their pedestals${stagevar}${rivalpresence ? rivaltext : ``}<br><br>${laconicStatement(enemy)}'),
    captured: _.template('You are brought into some hidden, ${evilPlace()}, where the air is thick with intensifying heat, and thrown in front of ${bossDescription(enemy)}.${rivalpresence ? rivaltext : ``} "${gloat[0]}" ${enemy.boss} calls out. "${gloat[1]}"<br><br>You see the main chamber of the ancient stone structure is encircled with multiple pedestals, each with a mysterious urn placed on top. The urns are etched with a series of images depicting powerful warriors defeating mighty foes. Thinking that you must be the final part of some dark ritual with the urns, you suddenly fight your captors off, and move in to remove the urns from their pedestals.')},
    
    {name:"Compromised", instory: 0, location: "remote", bystander: "hostage", 
    stagebonus: [`Each fighter may search the stage deck for 1 copy of Calming Words and add it to their fighter play area. Shuffle the stage deck.`,false,false,false], 
    stagepenalty: [`Each fighter places 1 power on a different "Scared Staff" card.`,false,false,false],
    masterplan: randFrom(["actsofterror","kidnapping"]), // personalpower?? power from the scientists
    gloat: [["I have some bad news for you!","Nobody will leave this room alive!"],["You think you could be of use as a hostage?", "I have no use for you."]],
    rivaltext: _.template('<%=(knowledge == "clueless") ? ` Suddenly, a janitor takes off a cap and rips off a fake moustache${rivalboost ? `and snaps the neck of a nearby agent` : ``}! It is ${rival} in disguise, an agent for the ${enemy.name}!` : ` ${ucInit(gPron(enemy,"subject"))} is not working alone. Alongside ${gPron(enemy,"object")} is ${rival}, ${rivalboost ? `eyes glowing green, a telltale sign of Vandal use!` : `furthering some personal agenda.`}`%>'),
    hottrail: _.template('${trail}, you arrive at the offices just in the nick of time. The ${enemy.name} is ushering their people in, ready to take hostages. You manage to slip ahead of them.  "There\'s no escape," a ${gPron(enemy,"sex")} shouts out. "The ${finalboss.name} needs your operation, and you will abide by our demands. We speak for ${finalboss.boss}<%=finalboss.name != "Kingdom" ? `, and ${gPron(finalboss, "subject")} speaks for the Kingdom` : ``%>." As panic ensues around the offices, you manage to calm several employees, making sure they keep their heads. Then you made your move on the ${enemy.name}.'),
    coldtrail: _.template('${trail} you arrive at the offices, and know it is too late. Gunshots can be heard inside the building, followed by screams inside and out.  "Call the police!"  several fleeing employees shout, but you know it is futile.  The chances of any Ransom P.D. response is beyond unlikely. The police are as corrupt as the very criminals they are charged to protect the city against. You rush into the building, heedless of all the warnings shouted at you.'),
    clueless: randFrom([_.template('${trail}, you investigate a building you believe ${finalboss.name} have been operating out of. As you make your way into the darkened interior, you see a number of people through the windows, held at gunpoint. Hostages! While ${finalboss.boss} is your primary objective, you can\'t let ${enemy.boss} get away with this!'),
    _.template('<%=stageindex == 0 ? `You are preparing for a hard-earned vacation, but just as you are about to take your leave from Citadel HQ` : `${trail}, you are at the Citadel HQ, reviewing what you\'ve got.  "We\'ve had the intel for a week," Fletch says. "I need to show something to the top brass." "There\'s a lot of dead ends," the analyst says.  "It\'s like they expected us to get the data."  Fletch considers those words.  What if the ${finalboss.name} wanted the Citadel to get a hold of the intel? Just as he was about to call his superiors`%>, a klaxon starts blaring in the facility."Sir!" a technician says. "I\'m picking up multiple hostiles on the scanners!" "Scramble our defenses!" Fletch commands.  "And alert the Global Gladiators!"')]),
    prologue: _.template('${stagevar}<br><br>"${gloat[0]}" greets a familiar face that you thought you might have seen last of: ${bossDescription(enemy)}. "${gloat[1]}"<%=!rivalpresence ? ``:` ${rivaltext}`%>'),
    captured: _.template('Your hands bound, bags over your heads, you\'re finally dropped off on a cold concrete floor. "Not here!" you hear a ${gPron(enemy, "sex")} shout in anger.  "What can I do with them here?!"  There is a pause, and you hear footsteps receding until the door closes and your world is silent once more.<br><br>You quickly work yourself out of the bonds - the ${enemy.name} needs to invest in a stronger rope! - and make your way to the door you heard close a moment ago. Pushing slowly through it, you see an office on the other side. Standing in there is ${bossDescription(enemy)} and ${gPron(enemy,"possessive")} ${enemy.minions}, surrounding a group of scared-looking scientists. You know you have to stop ${gPron(enemy,"object")} and free the researchers at once!')},
    
    {name:"Gone Ballistic", instory: 0, location: "neutral", bystander: "warehouse worker", 
    stagebonus: [`One fighter may move 3 spaces toward the nearest objective token.`,false,false,false], 
    stagepenalty: [`Search the stage deck for an additional objective card and put it into play. Shuffle the stage deck.`,false,false,false], 
    masterplan: randFrom(["illegalgains","strengtheningforces"]), // actsofterror? chaos, armed strike.. megan's story
    rivaltext: _.template(' turns to you as ${rival}<%=rivalboost ? `, heavily armed and armored,`: ``%> stashes <%=(knowledge == "clueless" || knowledge == "captured") ? "a" : "the"%> ${gizmo}.'),
    gloat: [[`It's better to have a gun and not need it,`,`Than to need a gun and not have it.`],[`This is my boomstick,`,`Good or bad, I'm the one with the gun.`],[`Okay, I'm reloaded! You think you're big time? You're gonna die big time!`,`You ready? Here comes the pain!`],[`You wanna play rough? Ok,`,`Say hello to my little friend!`]],
    hottrail: _.template('hear voices nearby. Ducking behind cover, you listen intently to hear that ${enemy.name} is acting on behalf of the <%=finalboss.name == enemy.name ? finalboss.boss : finalboss.name%>.<br><br>They\'re in the middle of a trade giving away heavy artillery in order to get their hands on an encrypted ${gizmo}. The pair in the discussion start to move away, and their voices begin to fade. You creep low, listening carefully as the they spill all the plans. Once you\'ve heard enough, you jump the startled pair.'),
    coldtrail: _.template('hear voices nearby. Ducking behind cover, you listen intently to hear that ${enemy.name} is acting on behalf of the <%=finalboss.name == enemy.name ? finalboss.boss : finalboss.name%>.<br><br>They\'re in the middle of a trade giving away heavy artillery in order to get their hands on an encrypted ${gizmo}. The pair in the discussion start to move away, and their voices begin to fade. You move quickly to keep up and continue your eavesdropping. "Boss!" a guard calls out. You hadn\'t seen him behind the crates nearby, but when you moved to take cover behind them, you were spotted instantly.'),
    clueless: _.template('have to dive for cover behind nearby crates as you run into the ${enemy.minions} guarding the trade. "Get the guns!" you hear a voice call out. "And get those spies!"'),
    prologue: _.template('${trail}, you locate a suspicious warehouse. You enter, and almost immediately ${stagevar}<br><br>${bossDescription(enemy)}<%=rivalpresence ? rivaltext : `, standing next to the contact for the trade, shoots the ${randFrom(["man","woman"])} dead, taking ${knowledge == "clueless" ? "a" : "the"} ${gizmo} from the body.`%> "${gloat[0]}" ${gPron(enemy,"subject")} says. "${gloat[1]}" ${laconicStatement(enemy)}'),
    captured: _.template('You wake up on cold concrete floor, and hear a voice explaining: "Your revenge is at hand. Voilà!" There\'s a slight pause. "It\'s light, handle\'s adjustable for easy carrying, good for righties and lefties, breaks down into four parts, ideal for quick discreet interventions. A word on firepower.. oh, our practice targets seem to have come to their senses!"<br><br>The ${enemy.minions} of the ${enemy.name} remove your hoods, and you see ${bossDescription(enemy)}, nodding to ${gPron(enemy,"possessive")} companion. "You can pay afterward." ${ucInit(gPron(enemy, "subject"))} <%=rivalpresence ? rivaltext : `turns from the client who stashes a ${gizmo}.`%> "Let the presentation commence!"')},

    {name:"One Step Ahead", instory: 0, location: "remote", bystander: "mountain climber", 
    stagebonus: [`Each fighter may search the enemy deck for a Minion card to discard. Shuffle the enemy deck.`,false,false,false], 
    stagepenalty: [`Each fighter must put search the stage deck for a copy of Vertigo, and put in into play. Shuffle the stage deck.`,false,false,false], masterplan: randFrom(["personalpower","kidnapping"]),
    rivaltext: _.template('<%=rivalboost ? ` Leaping from the shadows in the trees, ${rival} ambushes you!` : ` and to your dismay you find that ${rival} has joined forces with ${enemy.boss}.` %>'),
    gloat: [[`It'll not be the fall that kills you,`,`It's the sudden stop at the end!`],[`It's a long way down, Gladiators,`,`You'll have a lot of time to reflect on your mistakes.`]],
    hottrail: _.template('Climbing the mountain is arduous, but you make good time and come to a point where your path crosses that of ${possessiveSuffix(enemy.boss)} band of goons: the ${enemy.name}! Knowing they are only a short distance behind, you hunker down to spring an ambush. As they rush around the bend, you leap out of your hiding spot taking out a number of ${gPron(enemy,"possessive")} forces before they can regroup and face you.'),
    coldtrail: _.template('The path is winding and overgrown, and difficult to traverse, but you refuse to slow down. You finally come to face ${possessiveSuffix(enemy.boss)} forces.'),
    clueless: _.template('The path is winding and overgrown, and difficult to traverse, and when you finally come to face ${possessiveSuffix(enemy.boss)} forces, you are completely exhausted.'),
    prologue: _.template('${trail}, you have affirmed that the ${randFrom(["minions",enemy.minions])} of ${enemy.boss} have been using <%=knowledge == "clueless" ? `a remote mountain path`: `the mountain path you suspected` %> to conceal their movements, so that\'s where you head to catch up with them.<br><br>${stagevar}<%=rivalpresence ? rivaltext : ``%><br><br>${bossDescription(enemy)} doesn\'t seem surprised by your efforts. "${gloat[0]}" ${gPron(enemy,"subject")} laughs. "${gloat[1]}" ${ucInit(gPron(enemy,"subject"))} readies to strike back! <br><br>${laconicStatement(enemy)}')},

    {name:"Original Copy", instory: 0, location: "base", bystander: "scientist", 
    stagebonus: [`Any fighter may put this card in their play area. <b>Feint:</b> Remove this card from the game to choose a copy of Vandal Serum attached to a card in the Cloning Area. Return the selected card to Serum Supply.`,false,false,false], 
    stagepenalty: [`Each fighter suffers 1 direct damage.  Then, if any fighter is on or adjacent to an objective space, remove this card from the game.`,true,true,false], masterplan: randFrom(["strengtheningforces","personalpower"]),
    gloat: [[`New subjects have arrived,`,`Contain them and proceed with the experiments.`]],
    rivaltext: _.template('<%=rivalboost ? ` Suddenly, one of the tubes crashes open, and a figure can be seen within the steam, kneeling, faced away. It stands, slowly, powerfully built, dripping with greel gel. It is the ultimate clone, ${rival.toUpperCase()}-EX!` : ` Apparently ${enemy.boss} is taking blood samples from ${rival}.`%>'),
    hottrail: _.template('${trail}, you locate the facility. You were surprised to find the laboratory not heavily guarded, so slipping in was not challenging.  You '),
    coldtrail: _.template('${trail}, you locate the facility. You defeat a few guards in your way and '),
    clueless: _.template('${trail}, you investigate a facility in the outskirts of the city that develops cutteng edge genetic enhancements and conducts non-sanctioned medical experiments. You fight your way in and '),
    prologue: _.template('${stagevar}<%=randFrom([`proceed down to `,`take an elevator down. You wait patiently while a lounge version of ${loungeMusic()} plays over the cheap speakers. You arrive `])%> to the large lab, a cavernous room filled with row upon row of glass containment tubes. Each tube has a motionless body in it; some of you recognize as opponents you\'ve faced before.<br><br>Standing at the far end of the room, you see ${bossDescription(enemy)}.<%=rivalpresence ? rivaltext : ``%> "Just get the serum," ${enemy.boss} commands ${gPron(enemy,"possessive")} ${enemy.minions}. "${finalboss.boss} has made it clear; ${gPron(finalboss,"subject")} needs as much of it as possible to make it work. And we all need it to work!" ${enemy.boss} lifts ${gPron(enemy,"possessive")} eyes to you. "${gloat[0]}" ${gPron(enemy,"subject")} calls out. "${gloat[1]}" ${laconicStatement(enemy)}'),
    captured: _.template('As you slowly regain consciousness, you notice an IV hooked up to your arm.  Your strength had been completely drained and you are unable to even stand up.  "Calm down there," an arrogant voice called. "${finalboss.boss} wants to run some tests to see if you\'re worth keeping alive”. As your vision clears, you see the voice belongs to ${bossDescription(enemy)}. You also see that you are surrounded by sterile lab equipment and ominous test tubes occupied by shadowy figures. You suddenly feel a surge of strength return and yank out the IV. "Fine, let\'s do it the hard way.”')},

    {name:"Out of Time", instory: 0, location: "cursed", bystander: "acolyte", 
    stagebonus: [`The fighters may choose to flip one objective to its inactive side.`,false,false,false], 
    stagepenalty: [`The boss gains 1 random defense token for each Remnant engaged with a fighter.`,false,false,false], 
    masterplan: randFrom(["strengtheningforces","personalpower"]),
    gloat: [[`Klaatu verata..`,`Nikto!`],[`Even the strongest warriors will fall,`,`To the power of death!`],[`Now I call upon my army of the dead,`,`Arise, my messengers of death! Our time has arrived!`],[`Magic, the darkest magic,`,`My soul swims in it..`]],
    rivaltext: _.template(' To your horror, you see <%=rivalboost ? `the rotting corpse of ${rival} dig itself out of the ground!`: `${rival} joining ${enemy.boss} in the atrocious rite!`%>'),
    hottrail: _.template('${ucInit(gPron(enemy, "subject"))} is just starting a ghastly ritual, and ominous clouds are gathering above you.<br><br>The wind is rising and the air feels heavy'),
    coldtrail: _.template('Animated corpses are digging their way out the ground all around you. A heavy mass of dark clouds has gathered above you.<br><br>An ominous wind is rising and the very air around you feels hot and heavy'),
    clueless: _.template('Animated corpses are digging their way out the ground all around you. The sky is a boiling, writhing mass of clouds, each black as coal but glowing with an intense, blood-red heat.<br><br>Dark winds sting your skin and the very air around you smolders your throat and lungs'),
    prologue: _.template('${trail}, you find ${bossDescription(enemy)} at a remote ${evilPlace()}. A large structure where ${gPron(enemy,"subject")} is standing dominates the scene. ${stagevar} as ${enemy.boss}<%=knowledge == "clueless" ? `, bristling with power,`: ``%> looks down at you. "${gloat[0]}" ${gPron(enemy,"subject")} continues ${gPron(enemy,"possessive")} magic. "${gloat[1]}"<%=rivalpresence ? rivaltext : ``%> All around ${gPron(enemy,"object")} the ground breaks apart as<%=knowledge == "hottrail" ? ``: ` more and more`%> undead climb to the surface. Death permeates everything here.<br><br>${laconicStatement(enemy)}'),
    captured: _.template('You come to your senses as undead hands are gripping you, guiding you upwards to an ominous altar on a large pedestal in front of you. What ${mysticalSynonym()} sorcery had kept you enthralled is weakening, and you put your captor down. Dark winds sting your skin and the very air around you smolders your throat and lungs as ${bossDescription(enemy)} looks down at you "${gloat[0]}" ${gPron(enemy,"subject")} works ${gPron(enemy,"possessive")} magic. "${gloat[1]}"<%=rivalpresence ? rivaltext : ``%><br><br>All around ${gPron(enemy,"object")} the ground breaks apart as more and more undead climb to the surface. Death permeates everything here. ${laconicStatement(enemy)}')},

    {name:"Poison the Well", instory: 0, location: "neutral", bystander: "hireling", stagebonus: [`Remove each copy of Vandal Addict from the stage deck and remove them from the game. Shuffle the stage deck.`,false,false,false], stagepenalty: [`Each fighter searches the stage deck for 1 copy of Infected Rats and adds it to their Threat area. Shuffle the stage deck.`,false,false,false], masterplan: randFrom(["actsofterror","strengtheningforces"]),
    // After setting up the stage, flip 1 objective token to its active side.
    gloat: [[`With this formula`,`The weak will die and the strong will join us as thralls!`],[`You will get a bath,`,`That will melt the skin off of you!`],[`How nice that you decided to show up,`,`Better to test the cocktail before deployment!`]],
    rivaltext: _.template(' along with ${rival}<%=rivalboost ? `, eyes glowing menacingly green` : ``%>'),
    hottrail: _.template('Your intel is surprisingly accurate, and you quickly find the ${possessiveSuffix(enemy.name)} lair.'),
    coldtrail: _.template('It takes you longer than you expected, but you find the ${possessiveSuffix(enemy.name)} lair.'),
    clueless: _.template('You wander the tunnels for what feels like hours, and mutated rats harry you at every turn. Finally you happen upon the ${possessiveSuffix(enemy.name)} operation.'),
    prologue: _.template('${trail}, you descend down to the sewers which are a labyrinth of filth and decay. The city\'s utilities are barely maintained, and since the criminal elements have all but taken over, only the bravest city workers brave these depths. ${stagevar} It appears to be abandoned water treatment facility, and the ${enemy.name} have fitted it with their own crude devices that pump some weird chemical into the water ducts.<br><br>"${gloat[0]}" a familiar voice calls. "${gloat[1]}" ${bossDescription(enemy)} steps out of the shadows<%=rivalpresence ? rivaltext : ``%>. ${laconicStatement(enemy)}'),
    captured: _.template('You wake up, and the first thing you notice is the intense stench attacking your nostrils. You open your eyes, and as you focus, you can see ${bossDescription(enemy)}<%=rivalpresence ? rivaltext : ``%> at a distance. You seem to be underground, in some kind of a crazy scientist setup, and ${enemy.minions} are moving canisters about big machinery.<br><br>"${gloat[0]}" ${enemy.boss} says. "${gloat[1]}".')},

    {name:"Right to Remain Silent", instory: 0, location: "base", bystander: "captive", 
    stagebonus: [`Each fighter searches the stage deck for a copy of Sneaking, and puts it in their play area.`,false,false,false], 
    stagepenalty: [`Add two power to Recoverd Intel.`,false,false,false], 
    masterplan: randFrom(["illegalgains","kidnapping"]),
    rivaltext: _.template(' ${rival} stands guard<%= rivalboost ? `, vigilant and keen-eyed.`: `.`%>'),
    hottrail: _.template('<br><br>You are yet unseen, and dart through the room like shadows to rescue the captured Citadel scouts before they break and ${enemy.boss} finds out what you know about the plans of the ${finalboss.name}.'),
    coldtrail: _.template('<br><br>You don\'t think you have time for subtlety, and make your move to rescue the captured Citadel scouts before they break, and ${enemy.boss} finds out what you know about the plans of the ${finalboss.name}.'),
    clueless: _.template('<br><br>The captured Citadel scout breaks, and tells what little ${randFrom([`he`,`she`])} knows of what you have on ${possessiveSuffix(finalboss.name)} plans. ${enemy.boss} swings the pipe one more time and starts to move toward the next captive.<br><br>You have to move fast before anything important is revealed.'),
    prologue: _.template('${trail}, you locate <%=knowledge == "clueless" ? `a`: `the`%> hidden site of the ${enemy.name}. You observe the bleak location from hiding. There are armed guards here and there, and you are certain there are hidden alarms everywhere.<br><br>The captives have their hands bound above their heads, bodies hanging inches from the floor of the dark and musty room. ${enemy.boss} says: "I\'ll give you this one chance to come clean before we start our procedures again."<%=rivalpresence ? ` Meanwhile,${rivaltext}` : ``%>${stagevar}'),
    captured: _.template('"Finally awake?" That\'s the first thing you hear after the splash of stale water jolts you awake. You have no idea how long you\'ve been a hostage of the ${enemy.name}, ${enemy.desc} — but you\'d guess it\'s been at least a few days.<br><br><%=stageindex == 0 ? `Your simple recon mission went south, and now y` : `Y`%>ou\'ve been enduring  their tortures as they\'ve tried to get everything they could out of you. You\'ve held out for now but don\'t know how long you\'ll be able to keep it up. ${bossDescription(enemy)} ${enemy.threat} as ${gPron(enemy, "subject")} stares at you down. "I\'ll give you this one chance to come clean before we start our procedures again." Your silence is deafening as you stare at the floor. "Very well," ${enemy.boss} sneers. "I won\'t be gone for too long, ${defineAddressing(enemy)}. Don\'t get comfortable."<br><br>${ucInit(gPron(enemy, "subject"))} exits,<%=rivalpresence ? `while ${rivaltext}` : ` and as soon as the door closes behind ${gPron(enemy, "object")}, you begin working at your bonds.`%>')},

    {name:"Rude Awakening", instory: 0, location: "cursed", bystander: "necromancer", 
    stagebonus: [`Flip all objectives to their inactive side.`,false,false,false], 
    stagepenalty: [`Each fighter places 1 damage on the Stage Rules card.`,false,false,false], 
    masterplan: randFrom(["actsofterror","strengtheningforces"]),
    gloat: [[`Klaatu verata..`,`Nikto!`],[`Even the strongest warriors will fall,`,`To the power of death!`],[`Now I call upon my army of the dead,`,`Arise, my messengers of death! Our time has arrived!`],[`Magic, the darkest magic,`,`My soul swims in it..`]],
    rivaltext: _.template(' To your horror, you see <%=rivalboost ? `the rotting corpse of ${rival} among the zombies that climb out of the ground at ${gPron(enemy, "possessive")} feet.`: `${rival} joining ${enemy.boss} in the atrocious rite! Even more zombies climb out of the ground at their feet.`%>'),
    hottrail: _.template('You notice in the distance ${bossDescription(enemy)}. A coven of dark ${randFrom(["sorcerers","wizards","acolytes","priests","necromancers"])} is gathering around ${gPron(enemy,"object")}, and broken and decayed bodies are rising from the ground. Maybe you can stop this before it has really begun.'),
    coldtrail: _.template('You see a veritable sea of ​​people, all of them shambling about, all of them appearing broken and decayed. As you look over the zombies around you, you notice in the distance ${bossDescription(enemy)}.'),
    clueless: _.template('You see a veritable sea of ​​people, all of them appearing broken and decayed. They are shambling in the general direction of Ransom City, like driven by a sinister purpose. As you look over the zombies around you, you notice in the distance ${bossDescription(enemy)}.'),
    prologue: _.template('${trail}, you find yourself at <%=knowledge == "clueless" ? `${whichPreposition(evilPlace())}`: `the ${evilPlace()}`%>. ${stagevar}<br><br>${ucInit(gPron(enemy,"subject"))} looks at you and raises ${gPron(enemy, "possessive")} hands. "${gloat[0]}" ${gPron(enemy, "subject")} shouts, and is surrounded by ${mysticalSynonym()} energy. "${gloat[1]}" <%=rivalpresence ? rivaltext : `You see even more zombies climb out of the ground at ${gPron(enemy, "possessive")} feet.`%><br><br>${laconicStatement(enemy)}')},

    {name:"Running Wild", instory: 0, location: "remote", bystander: "civilian", stagebonus: [`Any fighter may put this card in their play area. <b>Feint:</b> Roll 3 enemy dice; for each different result, remove 1 power from "The Final Key".`,false,false,false],stagepenalty: [`Each Hero places 3 random defense tokens on the copy of "Hunt for the Idols" in their fighter play area. Each time a Hero searches, these defense tokens block successes and are discarded as normal.`,false,false,false], masterplan: randFrom(["illegalgains","personalpower"]),
    hottrail: _.template('${trail}, you find the ${enemy.minions} of ${enemy.name} in the forest, near a ruined shrine. ${enemy.boss} shouts to ${gPron(enemy,"possessive")} goons: "Search, you fools, search! It cannot take this long!"<br><br>${ucInit(gPron(enemy,"subject"))} then notices your approach and further instructs ${gPron(enemy,"possessive")} goons: "Just find them! I can hold these troublemakers!"<br><br>You inform ${enemy.boss} that whatever they are after probably belongs in a museum.'),
    coldtrail: _.template('${trail}, you find the ${enemy.minions} of ${enemy.name} have been seen in the forest, near a ruined shrine.<br><br>With help from the locals you have no trouble finding the general area where the ${possessiveSuffix(enemy.name)} searches are happening, but turns out they have been scouring the woods for days already. When you reach them, you find ${enemy.boss} shouting to ${gPron(enemy,"possessive")} goons<%=rivalpresence ? ` and ${rival}`:``%>: "The idols are near, I can feel it my bones!" ${ucInit(gPron(enemy,"subject"))} then notices your approach and ${enemy.threat}. <%=rivalboost ? `<br><br>${rival} looks tougher and harder, and wilder than you\'ve seen before. Maybe ${rival} has spent more time in the wild than anyone could guess..` : ``%>'),
    clueless: _.template('${trail}, you find the ${enemy.minions} of ${enemy.name} have been seen in the forest, near a ruined shrine.<br><br>You have great deal of trouble finding the general area where the ${possessiveSuffix(enemy.name)} searches are happening, and it turns out they have been scouring the general area for weeks already, and are well prepared. When you reach them, you find ${enemy.boss} shouting to ${gPron(enemy,"possessive")} goons<%=rivalpresence ? ` and ${rival}`:``%>: "The idols are near, I can feel it my bones!" ${ucInit(gPron(enemy,"subject"))} then notices your approach and ${enemy.threat}. <%=rivalboost ? `<br><br>${rival} looks tougher and harder, and wilder than you\'ve seen before. Maybe ${rival} has spent more time in the wild than anyone could guess..` : ``%>')},
  
    {name:"Steel Memories", instory: 0, location: "base", bystander: "nameless goon", stagebonus: [`One fighter may move 3 spaces toward the nearest objective.`,false,false,false], stagepenalty: [`Each fighter must <b>Recruit</b>.`,false,false,false], masterplan: randFrom(["actsofterror","kidnapping"]),
    hottrail: _.template('${trail}, you accompany a squad of Citadel soldiers as they storm the ${possessiveSuffix(enemy.name)} secret base. ${enemy.name} soldiers fall before you, and you make your way through the maze-like halls until you finally reach an elevator.<br><br>You wait patiently while a lounge version of ${loungeMusic()} plays over the cheap speakers. When you arrive, ${enemy.boss} seems surprised. "I\'m not surprised to see you here," ${gPron(enemy, "subject")} claims, contrary to your suspicions of having the element of surprise. "I have a message for you from ${finalboss.boss}, ${defineAddressing(enemy)}: nobody will leave this room alive!" ${laconicStatement(enemy)}'),
    coldtrail: _.template('${trail}, you managed to track the <%=enemy.name == "Kingdom" ? "Kingdom in the middle of its previous practice" : (enemy.name) + " in their lair, in the same practices as the Kingdom"%>: testing out new recruits in a savage melee where only the strong survive.<br><br>You tried to go undercover, as is customary, posing as recruits for yourselves. But ${enemy.boss} - knowing your plan from the past - saw through your ploy and threw you into ${gPron(enemy,"possessive")} "pit". You suddenly became the final exam for ${gPron(enemy,"possessive")} would-be recruits...'),
    clueless: _.template('You wake up in a pitch black room and turn around, hoping to find some sort of reference to where exactly you are, but not fully recovered. All you see is the ever-encroaching blackness and the deafening silence surrounding you.<br><br>And then, the lights in the room snap on, almost blinding you with their intensity. You blink, and see standing before you the ${enemy.bosstitle} leader of the ${enemy.name}: ${enemy.boss}. "What better to practice on than the Citadel\'s finest?" ${gPron(enemy,"subject")} wonders, smirking.<%=rivalpresence ? ` "It is time you prove your worth, ${rival}!" ${enemy.boss} exclaims.`: ``%><%=rivalboost ? `<br><br>${rival} looks different than before, you see only void in those eyes. What have the ${enemy.name} done?` : ``%>')},
   
    {name:"Sudden Death", instory: 0, location: "neutral", bystander: "challenger", stagebonus: [`Put one random defense token on each copy of "A New Challenger".`,false,false,false], stagepenalty: [`The active objective token nearest to the boss advances 4 spaces toward the boss and attacks.`,false,false,false], masterplan: randFrom(["kidnapping","strengtheningforces"]),
    hottrail: _.template('${trail}, you found that <%=enemy.name == "Kingdom" ? "the Kingdom is indeed back to its previous practice: " : `the ${enemy.name} have indeed adopted the practices pioneered by the Kingdom: `%> testing out new recruits in a savage melee where only the strong survive.<br><br> You infiltrate yet another underground fight club focused on bringing the most ruthless fighters out in a fight to death. You couldn\'t let that happen, and are determined shut down the ${possessiveSuffix(enemy.name)} efforts first hand!'),
    coldtrail: _.template('${trail}, you have surmised that the ${enemy.bosstitle} ${enemy.boss} has been openly recruiting soldiers into the ${enemy.name}. As you pushed the matter further, you found that <%=enemy.name == "The Kingdom" ? "the Kingdom was back to its previous practice: " : (enemy.name) + " has adopted the same practices as the Kingdom: "%>testing out new recruits in a savage melee where only the strong survive.<br><br>You infiltrate yet another underground fight club focused on bringing the most ruthless fighters out in a fight to death. You couldn\'t let that happen, and are determined shut down the ${possessiveSuffix(enemy.name)} efforts first hand! <%=rivalboost ? `${rival} steps boldy forth. It seems not a single day has been missed at the gym!` : ``%>'),
    clueless: _.template('Hands tied behind your back, you are led by ${enemy.boss} and ${minion} into an oddly-placed urban clearing. The out-of-place streets are hosting several fighters, each of them sparring in deadly martial arts. "You\'re not worthy to walk on this ground," ${minion} growls, glaring at you with a deep-seated hatred."And so", ${enemy.boss} interjects. "We will allow you the chance to prove your worth. <%=finalboss.boss == enemy.boss? `I have developed a great interest in you. I would be pleased if you\'d demonstrate it to my doubting minion.` : `${finalboss.boss} has taken great interest in you. Show us why that is.`%>"<br><br>"This is unnecessary," ${minion} says quietly to ${enemy.boss}. "You play games with the trust of the <%=finalboss.name == enemy.name ? "Master" : finalboss.name%>." ${enemy.boss} loosens your bonds, ignoring ${possessiveSuffix(minion)} words. You grab your wrists as they are free, rubbing the pain away, and watch as the other fighters turn toward ${enemy.boss}, preparing for what you\'re assuming will be a fight to the death. The other fighters show no fear, their eyes looking only for glory. <%=rivalboost ? `${rival} steps out of the crowd, looking especially eager to beat you to a pulp.` : ``%>')},

    {name:"Supply & Demand", instory: 0, location: "neutral", bystander: "customer", stagebonus: [`Any fighter may put this card in their play area. <b>Feint:</b> Remove this card from the game to choose one enemy to drop an objective token it is carrying.`,false,false,false], stagepenalty: [`The boss gains 1 random defense token. Each fighter is dealt 1 direct damage.`,false,false,false], masterplan: randFrom(["actsofterror","illegalgains"]),
    hottrail: _.template('${trail}, you are on to a black market trade conducted by the ${enemy.name}.<br><br>You have approached the site stealthily, and observe the ongoing trade. Standing nearby, the ${enemy.bosstitle} ${enemy.boss} watches over the activity. During their work, one of the soldiers drops his crate, a large amount of illegal drugs spilling out onto the concrete loading dock. You hear ${enemy.boss} roar in rage at the soldier\'s clumsiness, and use the commotion as a cover for your attack!'),
    coldtrail: _.template('${trail}, you are on to a black market trade is conducted by the ${enemy.name}.<br><br>You have approached the site stealthily, and are preparing your attack. Standing nearby, the ${enemy.bosstitle} ${enemy.boss} watches over the activity. During their work, one of the soldiers drops his crate, a large amount of illegal drugs spilling out onto the concrete loading dock. You duck behind cover, and hear ${enemy.boss} roar in rage at the soldier\'s clumsiness. <%=rivalpresence ? `${rival} calms ${gPron(enemy,"object")}, saving the unlucky soldier: "Somebody\'s back there!"`: `Yet it only takes a few exchanged words before you are given up. "Show yourselves, ${defineAddressing(enemy)}!" ${enemy.boss} calls. "And face your opponent head-on!" The ensuing burst of gunfire convinces you otherwise.`%>'),
    clueless: _.template('${trail}, you happen upon a black market trade conducted by ${enemy.name}.<br><br>You have approached the site stealthily, and are just about to attack. Standing nearby, the ${enemy.bosstitle} ${enemy.boss} watches over the activity. <%=rivalpresence ? `During their work, one of the soldiers spots you and drops his crate, a large amount of illegal drugs spilling out onto the concrete loading dock. You duck behind cover, but ${rivalboost ? `out of nowhere ${rival} leaps from the shadows and delivers a powerful strike square to your face.` : `${rival} calms ${gPron(enemy,"object")}, saving the unlucky soldier: "Somebody\'s back there!"`}` : `Suddenly, the soldiers carrying the goods drop their crates where they stand, illegal drugs spilling out! "Show yourselves, ${defineAddressing(enemy)}!" ${enemy.boss} calls. You position is rained on by torrents of gunfire. "${gloat[0]}" ${gPron(enemy,"subject")} shouts. "${gloat[1]}"`%>')},

    {name:"Under Destruction", instory: 0, location: "neutral", bystander: "construction worker", stagebonus: [`<b>Exhaust:</b> Move 1 power from a Time Bomb card to this card. Then, if there's 5 power on this card, remove it from the game.`,true,false,false], stagepenalty: [`Each fighter chooses a different objective and places 1 power on the chosen objective.`,false,false,false], masterplan: randFrom(["actsofterror","illegalgains"]),
    hottrail: _.template('${trail}, you find out the site that ${enemy.name} has targeted. According to the intel, the building being constructed is owned by the ${competitor.name} through shell corporations. You don\'t really mind ${competitor.desc} taking such a loss, but why is the ${enemy.name} so interested in this place?<br><br>You arrive at the scene, where ${enemy.boss} and ${gPron(enemy,"possessive")} ${enemy.minions} are busy setting the explosives. "Faster, ${randFrom(enemy.minionnames)}," ${enemy.boss} shouts. "We need to be ready before those pesky Gladiators arrive." Then ${gPron(enemy,"subject")} sees you, and ${gPron(enemy,"possessive")} face darkens.'),
    coldtrail: _.template('${trail}, you find out that the ${enemy.name} has been very busy setting up explosives to bring a construction site down. Unfortunately, you may have arrived too late..<br><br>"Arm the bombs and let\'s get out of here," a voice commands from behind a plastic sheet. When the sheet is thrown aside, ${enemy.boss} <%=rivalpresence ? `and ${rival} step` : `steps`%> into view. ${possessiveSuffix(enemy.boss)} eyes immediately dart from the placed explosives. Without hesitation, ${gPron(enemy,"subject")} attacks!<%=rivalboost ? ` "Leave something for me!" ${rival} shouts.` : ``%>'),
    clueless: _.template('You open your eyes and find yourself in.. an unfinished construction site? Suddenly, ${enemy.boss} steps out from the shadows. "Welcome, ${enemy.addressing}! Nice of you to join us!" You note that ${enemy.minions} are suddenly blocking every exit, except for the one ${enemy.boss} is guarding. "The whole place is rigged with explosives, <%=rivalpresence ? `and some would even pay to watch you die!" At that, ${rival} steps into view. ${rivalboost ? `"But I\'m a hands-on kind of person," ${rival} adds, and moves at you.` : ``}` : `and I will gladly expend some foot soldiers to get to watch you being.. demolished!"`%><br><br>No matter if this sounds contrived, you have no choice but to fight your way out - and fast!')}
];
    
    enemiescopy = enemies.slice(0,enemies.length)
    
    let globalgladiators = globalGladiators(enemies,stages)
    
    let herostages = []
    let supportingcast = []
    let heronames = []
    let heroenemies = []

    $(globalgladiators).each(function () {
        herostages.push(this.stage)
        supportingcast = _.union(supportingcast, this.ally)
        supportingcast = _.union(supportingcast, this.rival)
        heronames.push(this.name)
        $(this.enemy).each(function(){heroenemies.push(this)})
        })
    
    herostages = _.flatten(herostages)

    herostages = (_.uniq(herostages)).filter(function(el) { return el; });
    supportingcast = (_.uniq(supportingcast)).filter(function(el) { return el; });
    heroenemies = (_.uniq(heroenemies)).filter(function(el) { return el; });

let alliesandrivals = [
        {name: "Ah Long", keywords: ["Boss", "Golden Dragons", "Organized Crime", "Martial Arts Master", "Chi", "Clone", "Ah Long"]},
        {name: "Ah Long of Brook City", keywords: ["Boss", "Brook City", "Golden Dragons", "Organized Crime","Past", "Clone", "Ah Long of Brook City"]},
        {name: "Anastasia", keywords: ["Brotherhood", "Black Ops", "Gunslinger", "Soldier", "Clone"]},
        {name: "Brandon", keywords: ["Celebrity", "Fraud", "Martial Arts Master", "Global Gladiator", "Wanderer", "Clone", "Brandon"]},
        {name: "Chan Chan", keywords: ["Beast", "Dark Matter", "Martial Arts Master", "Kingdom", "Insane", "Clone"]},
        {name: "Clinhyde Eight", keywords: ["Black Ops", "Indines", "Psychic","Toxic", "Clone"]},
        {name: "Darius", keywords: ["Past", "Kingdom", "Martial Arts Master", "Toxic", "Clone", "Kemono"]},
        {name: "Dmitri", keywords: ["Boss", "Black Ops", "Brotherhood", "Soldier", "Clone"]},
        {name: "Drago", keywords: ["Black Ops","Brotherhood","Competitor","Street", "Clone", "Gabriel"]},
        {name: "Gabriel", keywords: ["Global Gladiator","Martial Arts Master","Street","Wanderer", "Clone", "Gabriel"]},
        {name: "Genesis", keywords: ["Cifarelli","Organized Crime","Extraplanar","Street", "Clone", "Music"]},
        {name: "Hanzo", keywords: ["Past","Sensei","Wanderer","Blade","Global Gladiator","Kingdom", "Clone"]},
        {name: "Isabella", keywords: ["Celebrity","Martial Arts Master","Wanderer", "Clone", "Brandon", "Golden Dragons"]},
        {name: "Jackal", keywords: ["Dark Matter","Insane","Kingdom","Psychic","Science", "Clone", "Jackal"]},
        {name: "James Wong", keywords: ["Black Ops","Brook City","Law Enforcement","Kingdom","Past", "Clone"]},
        {name: "Jin", keywords: ["Golden Dragons", "Organized Crime", "Blade", "Law Enforcement", "Clone", "Ying Hua"]},
        {name: "Juan", keywords: ["Cartel","Organized Crime","Gunslinger","Street", "Clone", "Juan"]},
        {name: "Kemono", keywords: ["Beast", "Kingdom","Competitor", "Chi", "Clone", "Kemono", "Tlazolteotl", "Horseman", "Aztec"]},
        {name: "Khadath Ahemusei", keywords: ["Indines","Science","Extraplanar","Wanderer", "Clone"]},
        {name: "Leeta", keywords: ["Brook City","Street","Wanderer","Past", "Clone"]},
        {name: "Lotus", keywords: ["Brook City","Golden Dragons","Organized Crime","Past", "Clone", "Ah Long of Brook City"]},
        {name: "Marionette Doll", keywords: ["Dark Matter","Kingdom","Martial Arts Master","Psychic", "Clone", "Shin Yokai"]},
        {name: "Mary Ann", keywords: ["Street", "Clone", "Twin Tiger", "Onyx League","Youth"]},
        {name: "Megan", keywords: ["Celebrity","Chi","Fraud","Global Gladiator","Martial Arts Master","Wanderer", "Clone", "Megan", "Law Enforcement"]},
        {name: "Mr. Apple", keywords: ["Celebrity","Fraud","Sensei","Music", "Clone"]},
        {name: "Natalia", keywords: ["Black Ops","Global Gladiator","Martial Arts Master","Soldier","Wanderer", "Clone", "Natalia", "Project X", "Street"]},
        {name: "Power Soldier", keywords: ["Dark Matter","Beast","Black Ops","Kingdom","Martial Arts Master", "Clone"]},
        {name: "Project X", keywords: ["Dark Matter","Beast","Insane","Martial Arts Master", "Youth", "Clone", "Jackal", "Project X"]},
        {name: "Sera O'Quinn", keywords: ["Boss","Celebrity","Insane","Organized Crime", "Clone", "Megan"]},
        {name: "Shadow", keywords: ["Boss","Kingdom","Martial Arts Master","Chi", "Clone", "Shadow", "Horseman"]},
        {name: "Shin Yokai", keywords: ["Boss","Insane","Extraplanar","Chi", "Clone", "Shadow", "Shin Yokai", "Horseman"]},
        {name: "Star Knight Iri", keywords: ["Indines","Extraplanar","Blade","Soldier", "Clone"]},
        {name: "Tiger Azules", keywords: ["Aztec","Street","Cartel","Martial Arts Master", "Clone", "Juan", "Wanderer"]},
        {name: "Tlazolteotl", keywords: ["Past","Aztec","Boss","Extraplanar", "Clone", "Tlazolteotl"]},
        {name: "Wan Bo", keywords: ["Golden Dragons","Martial Arts Master","Chi","Monk", "Clone", "Ah Long"]},
        {name: "Ying Hua", keywords: ["Global Gladiator","Law Enforcement","Martial Arts Master","Science", "Clone", "Ying Hua"]},
        {name: "Ying Hua of Brook City", keywords: ["Brook City","Law Enforcement","Past","Science", "Clone"]},
        {name: "Zane", keywords: ["Competitor","Chi", "Youth", "Clone", "Natalia"]}
        ];

for (i = alliesandrivals.length-1; i > 0; i--) {
    if (supportingcast.includes(alliesandrivals[i].name)) {
        alliesandrivals.splice([i],1)
    
    }
    }
let allymotivation = getMotivation(alliesandrivals)

let allygroup = []

while (allygroup.length < $("#players").val()) {
        let random = Math.floor(Math.random()*alliesandrivals.length)
        let ally = alliesandrivals[random]
        if (ally.keywords.includes(allymotivation)) {
        allygroup.push(ally)
        alliesandrivals.splice(random,1)
        }
    }

let rivalmotivation = getMotivation(alliesandrivals)

let rivalgroup = []
while (rivalgroup.length < $("#players").val()) {
        let random = Math.floor(Math.random()*alliesandrivals.length)
        let rival = alliesandrivals[random]
        if (rival.keywords.includes(rivalmotivation)) {
        rivalgroup.push(rival)
        alliesandrivals.splice(random,1)
        }
    }
    
    
    for (i = 0; i < stages.length; i++) {
        for (y = 0; y < herostages.length; y++) {
            if (herostages[y] === stages[i].name) {
                stages[i].instory = stages[i].instory +1
            }
        }
    }

    stages = cleanStages(stages);

let storystages = storyStages(stages);

stages = storystages[1].splice(0)

storystages = storystages[0].splice(0)

let storyenemies = storyEnemies(storystages, enemies, heroenemies);

enemies = storyenemies[1].splice(0)

storyenemies = storyenemies[0].splice(0)

let story = compileStory(storystages, storyenemies)

$(story).each(function(i) {
    story[i].stage.knowledge = defineKnowledge(i, story)})

let finalboss = story[7].enemy

let stageindex = 0;

let storyname = String(storyNamer(finalboss,story[7].stage))

$(".titletext").each(function() {
    $(this).text(storyname);
})

$(function() {
    $(".titletext").each(function(i) {
        $(this).css({"bottom": "0px", "font-size": "21px"})
        var element = $(this)
                        .clone()
                        .css({display: 'inline', visibility: 'hidden'})
                        .appendTo('body');
        if (element.width() > ($(this).width()+1)) {$(this).css({"bottom": "+=13px", "font-size": "+-2px"})}
        //((element.width() > ($(this).width()+1)) ? $(this).css({fontSize: "19px", "bottom": "35%"}) : $(this).css({fontSize: "21px", "bottom": "0px"}))
    
        element.remove();
    });
});


stageindex = 0
$(".storycardfront-subtitle").each(function() {
    $(this).html((finalboss.name).toUpperCase() + ` STORY <span style="float:right">PART ${story[stageindex].chapter} PROLOGUE</span>`);
    stageindex++
})

$(".refcard-subtitle").each(function() {
    $(this).html((finalboss.name).toUpperCase() + ` STORY <span style="float:right">CHARACTER REFERENCE</span>`);
})

let referencetext = referenceText(globalgladiators,allygroup,allymotivation,rivalgroup,rivalmotivation, finalboss)

$(`.refcardfront-prologuetext`).each(function(index) {
    $(this).html(referencetext[0] + referencetext[index+1]);
})

$(`.refcardsetuptext`).each(function(index) {
    $(this).html(referencetext[index+3]);

})

let cardtexts = textMaker(story, alliesandrivals, heronames, enemies);

$(`.storycardfront-prologuetext`).each(function(index) {
    $(this).html(cardtexts[index].prologue);
})

$(function() {
    $(`.refcardfront-prologuetext`).each(function(i) {
        $(this).css({"font-size": "8px"})
        if ($(this).height() > 198) {$(this).css({"font-size": "7px"})}
    });
});

$(function() {
    $(`.storycardfront-prologuetext`).each(function(i) {
        $(this).css({"font-size": "8px"})
        if ($(this).height() > 198) {$(this).css({"font-size": "7px"})}
    });
});

$(`.setuptext`).each(function(index) {
    $(this).html(cardtexts[index].setup);

})

$(function() {
    $(".setuptext").each(function(i) {
        $(this).css({"bottom": "0px", "font-size": "8px"})
        if (($(this).height() > 51)) {$(this).css({"font-size": "+-2px", "bottom": "+=7px"})}
    });
});


$(`.storycardback-winepiloguetext`).each(function(index) {
    $(this).html(cardtexts[index].winepilogue);

})


$(`.storycardback-loseepiloguetext`).each(function(index) {
    $(this).html(cardtexts[index].loseepilogue);
})

stageindex = 0
$(".storycardback-bottomtitle").each(function() {
    $(this).text("PART " + story[stageindex].chapter + " EPILOGUE");
    stageindex++
})
    
}

function defineAddressing(enemy) {

let addressing = randFrom([enemy.addressing,"Global Gladiators","Gladiators"])

    return addressing
}

function gPron(character, form) {
let gPron

switch(character.gender) {
    case "male":
        switch(form) {
            case "subject": gPron = "he";
            break;
            case "object": gPron = "him";
            break;
            case "possessive": gPron = "his";
            break;
            case "reflexive": gPron = "himself";
            break;
            case "sex": gPron = "man";
            break;
            default: gPron = "UNDEFINED"
        }
    break;
    case "female":
        switch(form) {
            case "subject": gPron = "she";
            break;
            case "object": 
            case "possessive": gPron = "her";
            break;
            case "reflexive": gPron = "herself";
            break;
            case "sex": gPron = "woman";
            break;
            default: gPron = "UNDEFINED";
        }
    break;
    default: 
        gPron= "UNDEFINED"
    
}
    return gPron

}

function ucInit (word) {
    let result = word.charAt(0).toUpperCase() + word.substring(1);
    return result
}

function lowerCaseInitial (word) {
    let result = word.charAt(0).toLowerCase() + word.substring(1);
    return result
}

function whichPreposition (word) {
    if (/[aeiou]/.test(word.charAt(0))) {
        return "an " + word
    } else {
    return "a " + word}
}

function latestScheme() {
    let latestscheme = [
        `In Citadel's ongoing investigations, rumors have been uncovered that`,
        `In the wake of the Kingdom's latest scheme, the Citadel has learned a new threat on the rise: `,
        `Following the aftermath of the Kingdom's latest scheme,`,
        `The Citadel has learned the nefarious motives behind the latest criminal activities: `,
        `In a situation familiar to the Citadel and Global Gladiators, `,
        `In a street-level recon operation, Citadel has uncovered a job fit for Global Gladiators: `,
        `Thanks to Citadel's resourcefulness and your familiarity with the Kingdom's street-level activity, there's new intel that`, 
        ];
    latestscheme = randFrom(latestscheme);
    return latestscheme
}

function preGamePrologue(stage, enemy) {
    
    let latestscheme = latestScheme()
    
    let masterplan

    let vip = randFrom([["President", "White House"], ["Colonel", "Pentagon"], ["Mayor", "city hall"], ["Police Chief", "police station"], ["Citadel commander", "Citadel HQ"]])

    switch(stage.masterplan) {
    case "actsofterror": masterplan = `the vicious criminal syndicate ${enemy.name} believes they do not have to bow to the city government or even the
    police force. ${enemy.boss} is going to let everyone know that the city has become a center of violence and crime where no-one is safe. `
    break;
    case "illegalgains": masterplan = `the ${possessiveSuffix(enemy.name)} vast network of crime and 
        ${(enemy.desc).replace("the","")} require substantial financial pipelines, and ${enemy.boss} is organizing a big score to fund
        ${gPron(enemy, "possessive")} operations. `
    break;
    case "kidnapping": masterplan = `the ${vip[1]} is not the exception to the rampant crimes related to the Kingdom these days. The ${vip[0]} has been kidnapped by the
    ${enemy.minions} of ${enemy.boss}. Are you a bad enough dude to rescue the ${vip[0]}? `
    break;
    case "strengtheningforces": masterplan = `the ${enemy.bosstitle} ${enemy.boss} has been covertly making efforts to
            strengthen the forces of the ${enemy.name}. Their plans must be thwarted before their forces become unstoppable. `
    break;
    case "personalpower": masterplan = `the ${enemy.bosstitle} ${enemy.boss} has moved across the region with ${gPron(enemy, "possessive")}
        ${enemy.minions} in search for power. If ${gPron(enemy, "possessive")} power levels will near five figures, ${gPron(enemy, "subject")}
        just might become invincible. `
    }


    masterplan = {storytext: latestscheme + " " + masterplan, vip: vip}
    
    return masterplan
}

function mysticalSynonym(){
    
    
    let mystical = ["esoteric", "magical", "arcane", "ethereal", "mystical", "cabalistic", "mysterious", "occult", "obscure", "cryptic", "fabulous secret"];
    mystical = mystical[Math.floor(Math.random()*mystical.length)];
    
    return mystical;
    
}

function getMotivation(alliesandrivals) {

let supportmotivate = [] 
    $(alliesandrivals).each(function () {
        supportmotivate = supportmotivate.concat(this.keywords)
        })

let motivations = supportmotivate.reduce((r,k)=>{r[k]=1+r[k]||1;return r},{})

motivations = _.pickBy(motivations, function(o) {return o >= $("#players").val();
})

return(randFrom(Object.keys(motivations)))

}

function cleanStages(stages) {

    for (i = 0; i < stages.length; i++) {
        if (stages[i].instory >= 2) {
            stages.splice(i, 1);
            i = i - 1;
        }
    }

    return stages
}

function storyNamer(finalboss,finalstage, number = 16){
    
    let bossadjectives
    let bossnouns
    let stageadjectives
    let stagenouns
    let adjectives = ["Avenging","Deadly","Final","Mortal","Double","Twin","Fighting","Bad","Mysterious","Lost","Unleashed","New","Eternal","Forever","Ultimate","Evil"];
    let nouns = [["Revenge","Revenge"],["Fate","Fates"],["Destiny","Destiny"],["Redemption","Redemption"],["Aftershock","Aftershock"],["Warrior","Warriors"],["Combat","Kombat"],["Fighter","Fighters"],["Force","Forces"],["Thug","Thugs"],["Rage","Rage"],["City","City"],["Ransom","Ransom"],["Fight","Fights"],["Kingdom","Kingdoms"],["Street","Streets"],["Master","Masters"],["Rise","Rise"],["Legend","Legends"]];
    
    switch (finalboss.boss) {
        case "Ah Long":
            bossadjectives = ["Heavenly","Phasing","Golden","Black","Merciless","Invincible","Shadowy"]
            bossnouns = [["Dragon","Dragons"],["Businessman","Businessmen"],["Hook","Hooks"],["Karate","Karate"],["Kendo","Kendo"],["Jing Wu","Jing Wu"],["Punch","Punches"],["Triad","Triads"],["Yakuza","Yakuza"],["Monk","Monks"],["Typhoon","Typhoons"],["Kick","Kicks"],["Shadowson","Shadowsons"],["Clutch","Clutces"],["Katana","Katana"],["Staff","Staves"],["Knuckle-Duster","Knuckle-Dusters"]]
        break;
        case "Dmitri":
            bossadjectives = ["Punishing","Modified","Trusty","Steely","Loaded","Extra","Russian","Eastern","Military","Angry","Strong","Skilled","Loyal","Espionage","Undercover"]
            bossnouns = [["Knife","Knives"],["Brotherhood","Brotherhood"],["Knife","Knives"],["Rocket","Rockets"],["Rocket Launcher","Rocket Launchers"],["Kevlar","Kevlar"],["Defense","Defenses"],["Hold","Holds"],["Ammo","Ammo"],["Mercenary","Mercenaries"],["Soldier","Soldiers"],["Spy","Spies"],["Honor","Honor"],["Hit","Hits"],["Sabotage","Sabotage"],["General","Generals"]]
        break;
        case "Jackal":
            bossadjectives = ["Broken","Neural","Dark","Wild","Mad","Insane","Genius","Torturous","Unbelievable","Scientific","Experimental"]
            bossnouns = [["Kingdom","Kingdom"],["Scientist","Scientists"],["Jackal","Jackals"],["Experiment","Experiments"],["Matter","Matters"],["Sister","Sisters"],["Flesh","Flesh"],["Lances","Lances"],["Invasion","Invasion"],["Mold","Molds"],["Ninja","Ninja"],["Clone","Clones"],["General","Generals"],["Mountain","Mountains"],["Marionette","Marionettes"],["Soldier","Soldiers"],["Doll","Dolls"]]
        break;
        case "Juan":
            bossadjectives = ["Unloading","Getaway","Alert","Hard","Honorable","Ruthless","Avenging","One","Loyal","Devoted"]
            bossnouns = [["Getaway","Getaway"],["Revenge","Revenge"],["Cartel","Cartel"],["Flintlock","Flintlocks"],["Code","Code"],["Orphan","Orphans"],["Outcast","Outcasts"],["Gun","Guns"],["Gangster","Gangsters"],["Extortion","Extortion"],["Honor","Honor"],["Protection","Protection"],["Carbine","Carbines"],["Human Shield","Human Shields"],["Double Barrels","Double Barrels"],["Family","Families"],["Drug","Drugs"],["Gang","Gangs"],["Bat","Bats"],["Dealer","Dealers"],["Ganger","Gangers"]]
        break;
        case "Kemono": 
            bossadjectives = ["Apocalypse","Imposing","Green","Enraged","Hulking","Loyal","Uncontrollable","Crackling","Static","Quadruple","Electrical","Savage","Mountain"]
            bossnouns = [["Hulk","Hulk"],["Kingdom","Kingdom"],["Mutant","Mutants"],["Horseman","Horsemen"],["Beast","Beasts"],["Surge","Surges"],["Lash","Lashes"],["Grab","Grabs"],["Arms","Arms"],["Prowess","Prowess"],["Current","Currents"],["Brute","Brutes"],["Ninja","Ninja"],["Clone","Clones"],["General","Generals"],["Mountain","Mountains"],["Marionette","Marionettes"],["Soldier","Soldiers"],["Doll","Dolls"]]
        break;
        case "Mack": 
            bossadjectives = ["Hot", "Suppressing","Black-Hearted","Aimed","Ruthless","Reckless","Whipped","Anarchic"]
            bossnouns = [["Trigger","Triggers"],["Lead","Lead"],["Fire","Fire"],["Crosshair","Crosshairs"],["Salt","Salt"],["Pepper","Pepper"],["Blackheart","Blackheart"],["Mercy","Mercy"],["Overlord","Overlords"],["Protection","Protection"],["Gang","Gangs"],["Machine Gun","Machine Guns"],["Bullet","Bullets"]]
        break;
        case "Shadow": 
            bossadjectives = ["Hexed","Prescient","Mysterious","Ancient","Divine","Explosive","Hidden"]
            bossnouns = [["Kingdom","Kingdom"],["Blade","Blades"],["Jing Wu","Jing Wu"],["Dragon","Dragons"],["Illusion","Illusions"],["Sword","Swords"],["Shadow","Shadows"],["Spirit","Spirits"],["Clone","Clones"],["General","Generals"],["Mountain","Mountains"],["Marionette","Marionettes"],["Soldier","Soldiers"],["Doll","Dolls"]]
        break;
        case "Tlazolteotl":
            bossadjectives = ["Faithful","Aztec","Summoned","Otherworldly","Death","Pale","Avenging","Foul","Decaying","Enfeebling","Ageless","Beautiful","Restless","Pestilent","Below"]
            bossnouns = [["Time","Time"],["Undead","Undead"],["Faithful","Faithful"],["Sorcery","Sorceries"],["Portal","Portals"],["Pestilence","Pestilence"],["Dead","Dead"],["Nahualli","Nahualli"],["Faithful","Faithful"],["Necromancer","Necromancers"],["Zombie","Zombies"],["Caller","Callers"],["Essence","Essences"],["Prophecy","Prophecies"],["Blast","Blasts"],["Flesh","Flesh"],["Hex","Hexes"],["Burden","Burdens"]]
        break;
        case "Yokai":
            bossadjectives = ["Cursed","Deceptive","Eldritch","Raging","Unleashed","Dynasty","Enraged","Nine-Tailed"]
            bossnouns = [["47","47"],["Hellfire","Hellfire"],["Sorrow","Sorrows"],["Monster","Monsters"],["Oni","Oni"],["Demon","Demons"],["Yurei","Yurei"],["Ninja","Ninja"],["Shadow","Shadows"],["Strike","Strikes"],["Swarm","Swarms"],["Fox","Foxes"],["Rage","Rage"],["Aura","Auras"],["Oblivion","Oblivion"],["Shackle","Shackles"],["Fear","Fear"],["Devil","Devil"],]
        break;
        default:
            bossadjectives = adjectives
            bossnouns = nouns
    }
    
    switch (finalstage.name) {
        case "Ashes of the Eternal":
            stageadjectives = ["Unholy","Unclean","Rising","Blazing","Burnt"]
            stagenouns = [["Eternal","Eternals"],["Ash","Ashes"],["Inferno","Inferno"],["Urn","Urns"],["Demon","Demons"],["Apparition","Apparitions"],["Path","Paths"],["Flame","Flames"],["Fire","Fires"]]
        break;
        case "Cashed Out":
            stageadjectives = ["Winning","Cashed Out","Loose","Gambling","Risky","Loaded","Opulent"]
            stagenouns = [["Casino","Casinoes"],["Blackjack","Blackjack"],["Bet","Bets"],["Card","Cards"],["Cash","Cash"],["Chip","Chips"],["Damage","Damages"],["Dealer","Dealers"],["Die","Dice"],["Gambler","Gamblers"],["Hand","Hand"],["House","House"],["Money","Money"],["Odds","Odds"],["Poker","Poker"]]
        break;
        case "Compromised":
            stageadjectives = ["Compromised","Armed","Rising","Misguided","Calming","Scared","Panicking"]
            stagenouns = [["Downtown","Downtown"],["Panic","Panic"],["Hostage","Hostages"],["Intruder","Intruders"],["Bribe","Bribes"],["Offices","Offices"],["Threat","Threats"],["Fear","Fear"],["Heroic","Heroic"],["Word","Words"],["Staff","Staff"],["Security System","Security Systems"]]
        break;
        case "Gone Ballistic":
            stageadjectives = ["Concealed","Proximity","Stray","Illegal","Explosive","Stolen","Ballistic","Bulletproof"]
            stagenouns = [["Dealer","Dealers"],["Grenade","Grenades"],["Gun","Guns"],["Mine","Mines"],["Rocket","Rockets"],["Sidearm","Sidearms"],["Supply","Supplies"],["Trigger","Triggers"],["Truck","Trucks"],["Vest","Vests"],["Weapon","Weapons"]]
        break;
        case "One Step Ahead": 
            stageadjectives = ["High","Atop","Underground","Steep","Windy","Strong","Climbing"]
            stagenouns = [["Peak","Peaks"],["Cave","Caves"],["Mountain","Mountains"],["Step","Steps"],["Cliff","Cliffs"],["Grappling Hook","Grappling Hooks"],["Wind","Winds"],["Avalanche","Avalance"],["Vertigo","Vertigo"]]
        break;
        case "Original Copy": 
            stageadjectives = ["Duplicated","Mutated","Accelerated","Deadly","Regenerative","Experimental","Original","Dynasty"]
            stagenouns = [["Lab","Labs"],["Cell","Cells"],["Clone","Clones"],["Computer","Computers"],["Copy","Copies"],["Duplicate","Duplicates"],["Mutation","Mutations"],["Protocol","Protocols"],["Serum","Serums"],["Subject","Subjects"],["Test","Tests"],["Vandal","Vandal"],["Vat","Vats"]]
        break;
        case "Out of Time": 
            stageadjectives = ["Afflicted","Putrid","Fallen","Profane","Dead","Dimensional","Hellish","Extradimensional"]
            stagenouns = [["Pit","Pits"],["World","Worlds"],["Spike","Spikes"],["Time","Time"],["Zombie","Zombies"],["Remnant","Remnants"],["Altar","Altars"],["Refuge","Refuges"],["Below","Below"],["Offering","Offerings"],["Undead","Undead"]]
        break;
        case "Poison the Well": 
            stageadjectives = ["Poisoned","Infected","Addicted","Filthy","Stinking","Smelly","Insane","Subterranean","Underground"]
            stagenouns = [["Experiment","Experiment"],["Poison","Poison"],["Well","Wells"],["Sewer","Sewers"],["Vandal","Vandal"],["Vat","Vats"],["Addict","Addicts"],["Thrall","Thralls"],["City","City"],["Rat","Rats"],["Pursuit","Pursuit"]]
        break;
        case "Right to Remain Silent":
            stageadjectives = ["Blindfolded","Escaped","Silent","Recovered","Armed","Sneaking","Captured","Interrogated"]
            stagenouns = [["Right","Rights"],["Captive","Captives"],["Intel","Intel"],["Prisoner","Prisoners"],["Guard","Guards"],["Tripwire","Tripwires"],["Interrogation","Interrogation"]]
        break;
        case "Rude Awakening":
            stageadjectives = ["Rude","Afflicted","Decayed","Rotting","Summoned","Risen","Awakened","Rotten","Dark","Black"]
            stagenouns = [["Undead","Undead"],["Awakening","Awakening"],["Remnant","Remnants"],["Dead","Dead"],["Undead","Undead"],["Zombie","Zombies"],["Rot","Rots"],["Decay","Decay"],["Necromancer","Necromancers"],["Realm","Realms"],["Below","Below"]]
        break;
        case "Running Wild":
            stageadjectives = ["Unturned","Blessed","Wild","Lost","Hidden","Buried","Final"]
            stagenouns = [["Shrine","Shrines"],["Search","Search"],["Demon","Demons"],["Wild","Wilds"],["Key","Keys"],["Hunt","Hunt"],["Idol","Idols"],["Blessing","Blessings"],["Beyond","Beyond"],["Oni","Oni"],["Curse","Curses"],["Tree","Trees"],["Trail","Trail"],["Call","Call"]]
        break;
        case "Steel Memories":
            stageadjectives = ["New","Steel","Fresh","True","Demoralizing","Upcoming","Encircling","Dark","Brutal","Overwhelming"]
            stagenouns = [["Newcomer","Newcomers"],["Melee","Melee"],["Memory","Memories"],["Recruit","Recruits"],["Crowbar","Crowbars"],["Underdog","Underdogs"],["Edge","Edges"],["Defeat","Defeat"],["Finisher","Finisher"],["Challenger","Challengers"],["Contest","Contests"],["Challenge","Challenges"]]
        break;
        case "Sudden Death":
            stageadjectives = ["Boasting","Sudden","Culling","Personal","Mutual","New","Overconfident","Urban","Deadly","Ruthless","Underground","Brutal"]
            stagenouns = [["Death","Death"],["Vendetta","Vendetta"],["Assistance","Assistance"],["Cause","Causes"],["Challenger","Challengers"],["Competition","Competition"],["Tournament","Tournament"],["Contest","Contests"]]
        break;
        case "Supply & Demand":
            stageadjectives = ["Distribution","Pinned","Rising","Hooked","Addicted","Dealing","Pushing"]
            stagenouns = [["Supply","Supplies"],["Demand","Demand"],["Crossfire","Crossfire"],[`Island`,`Islands`],["Drug","Drugs"],["Smuggler","Smugglers"],["Network","Networks"],["Kingpin","Kingpin"],["Drive-By","Drive-By"],["Contraband","Contraband"],["Island","Islands"],["Beach","Beaches"],["Camp","Camps"]]
        break;
        case "The Ceremony":
            stageadjectives = ["Eldritch","Whispered","Unholy","Unclean","Ceremonial","Cursed","Lured","Promised"]
            stagenouns = [["Ceremony","Ceremony"],["Alignment","Alignment"],["Vessel","Vessels"],["Embrace","Embrace"],["Lure","Lures"],["Promise","Promises"],["Conduit","Conduits"],["Oni","Oni"],["Demon","Demons"],["Servant","Servants"]]
        break;
        case "Under Destruction":
            stageadjectives = ["Risky","Collateral","Timed","Remote","Armed","Explosive","Demolished"]
            stagenouns = [["Explosion","Explosions"],["Destruction","Destruction"],["Conveyor","Conveyor"],["Demolition","Demolitions"],["Buzzsaw","Buzzsaws"],["Bomb","Bombs"],["Construction","Construction"],["Trigger","Triggers"]]
        break;
        default:
            stageadjectives = adjectives
            stagenouns = nouns
    }
    
    adjectives = _.union(adjectives,bossadjectives,stageadjectives)
    nouns = _.union(nouns,bossnouns,stagenouns)
    
    let plural = randFrom([0,1])

    let storyname = ""
    switch (Math.floor((Math.random() * number) + 1)) {
        case 1: storyname = randFrom(adjectives) + " " + randFrom(nouns)[plural];
        break;
        case 2: storyname = randFrom(adjectives) + " " + randFrom(nouns)[0] + " " + randFrom(nouns)[plural]
        break;
        case 3: storyname = randFrom(adjectives) + " " + randFrom(adjectives) + " " + randFrom(nouns)[plural]
        break;
        case 4: storyname = randFrom(adjectives) + " " + randFrom(nouns)[plural] + ", " + randFrom(adjectives) + " " + randFrom(nouns)[plural]
        break;
        case 5: storyname = randFrom(nouns)[plural] + " of the " + randFrom(adjectives)
        break;
        case 6: storyname = randFrom(nouns)[0] + " " + randFrom(nouns)[plural]
        break;
        case 7: storyname = randFrom(nouns)[0] + " " + randFrom(nouns)[0]
        break;
        case 8: storyname = randFrom(nouns)[plural] + " of" + (plural == 0 ? " the " : " ") + randFrom(nouns)[(plural == 0 ? 0 : 1)]
        break;
        case 9: storyname = randFrom(nouns)[0] + " of the " + randFrom(nouns)[0] + " " + randFrom(nouns)[0]
        break;
        case 10: storyname = randFrom(nouns)[0] + " " + randFrom(nouns)[0] + " " + randFrom(nouns)[plural]
        break;
        case 11: storyname = randFrom(nouns)[plural] + " and " + randFrom(nouns)[plural]
        break;
        case 12: storyname = randFrom(nouns)[0] + ": " + storyNamer(finalboss,finalstage,15)
        break;
        case 13: storyname = randFrom(nouns)[0] + " for " + (plural == 0 ? " the " : "") + randFrom(nouns)[plural]
        break;
        case 14: storyname = "From the " + randFrom(adjectives) + " " + randFrom(nouns)[0]
        break;
        case 15: storyname = randFrom([`Another ${randFrom(nouns)[0]}`,`For ${randFrom(nouns)[plural]}`,`Enter the ${randFrom(nouns)[plural]}`,`The ${randFrom([randFrom(adjectives),randFrom(nouns)[plural]])}`])
        break;
        case 16: storyname = storyNamer(finalboss,finalstage, 15) + randFrom([": the Return"," - Part Two", " - Part One", ": the Final Chapter"])
        break;
        default: storyname = "New Rise of the Kingdom"
}

//käy läpi substantiivit
/*for (i = 0; i < nouns.length; i++) {
    console.log(nouns[i][0] + " - " + nouns[i][1])
}*/

storyname.length > 42 ? storyNamer(finalboss,finalstage, 15) : ``

return storyname.toUpperCase();

}

function compileStory(stages, enemies) {

    
    let story = []
    
    let chapters = ["1","2A","2B","3A","3B","4A","4B","5A","5B"];
    
    var chapter
    for (i = 0; i < chapters.length; i++) {
        chapter = {chapter: chapters[i], stage: _.cloneDeep(stages[i]), enemy: enemies[i]}
        story.push(chapter)
    }
    
    return story

}

function storyStages(stages) {



let storystages = []
let randomstage = Math.floor(Math.random()*stages.length);

let finalstage = stages[randomstage];
stages.splice(randomstage, 1);

randomstage = Math.floor(Math.random()*stages.length);

storystages.push(stages[randomstage]);
stages[randomstage].instory = stages[randomstage].instory + 1
stages = cleanStages(stages);


do {

(Math.random() <= 0.75 ? 
    (randomstage = Math.floor(Math.random()*stages.length),
    storystages.push(stages[randomstage]),
    stages[randomstage].instory = stages[randomstage].instory + 1,
    (stages[randomstage].instory < 2 ?
        (storystages.push(stages[randomstage]),
        stages[randomstage].instory = stages[randomstage].instory + 1,
        stages = cleanStages(stages)) :
        (stages = cleanStages(stages),
            randomstage = Math.floor(Math.random()*stages.length),
            storystages.push(stages[randomstage]),
            stages[randomstage].instory = stages[randomstage].instory + 1,
            stages = cleanStages(stages))
    )
                ) :
    (randomstage = Math.floor(Math.random()*stages.length),
    storystages.push(stages[randomstage]),
    stages[randomstage].instory = stages[randomstage].instory + 1,
    stages = cleanStages(stages),
    randomstage = Math.floor(Math.random()*stages.length),
    storystages.push(stages[randomstage]),
    stages[randomstage].instory = stages[randomstage].instory + 1,
    stages = cleanStages(stages))
)

} while (storystages.length < 7);

(Math.random() < 0.75 ? 
    
    (storystages.push(finalstage),
    storystages.push(finalstage)) :
    (storystages.push(finalstage),
    storystages.push(stages[Math.floor(Math.random()*stages.length)])))

return [storystages, stages]
    
}

function loungeMusic() {
    
    let music = randFrom(["Don't Stop Believing","Faithfully","Don't Stop Me Now","Open Arms","Wheel in the Sky","Separate Ways","Livin' on a Prayer","Any Way You Want It",
    "Eye of the Tiger","The Final Countdown","Burning Heart","Every Breath You Take","Another One Bites the Dust","Never Gonna Give You Up"])
    
    return music
}

function storyEnemies(storystages, enemies, heroenemies) {

    heroenemies = heroenemies.map(enemy => enemy.boss);

    let storyenemies = [], randomenemy;

    function pickAndSlice() {
        if (storyenemies.length <= 3) 
        {do {randomenemy = randFrom(enemies)} while (heroenemies.includes(randomenemy.boss))} else
        {randomenemy = randFrom(enemies)}
        enemies = filterArray(enemies,"boss",randomenemy.boss,true)
    }

    pickAndSlice()
    
    let finalboss = randomenemy

    let r = randFrom([1,2])
        switch (r) { 
        case 1: storyenemies.push(randomenemy); 
        break;
        case 2: pickAndSlice(), storyenemies.push(randomenemy);
    }

    for (i = 0; storyenemies.length < 7; i++) {
        
        let random = randFrom([1,2,3])
        switch (random) { 
        case 1: pickAndSlice(),storyenemies.push(randomenemy),storyenemies.push(randomenemy); 
        break;
        case 2: pickAndSlice(),storyenemies.push(randomenemy),storyenemies.push(randomenemy); 
        break;
        case 3: pickAndSlice(),storyenemies.push(randomenemy),pickAndSlice(),storyenemies.push(randomenemy)
    }
    }


    storyenemies.push(finalboss);

    if (storystages[7].name == storystages[8].name) {
        storyenemies.push(finalboss);
    } else {
        pickAndSlice(),storyenemies.push(randomenemy)
    }

    return [storyenemies, enemies]

}

function evilPlace() {
    
    let evilterm = ["ancient", "cursed", "damned", "eldritch", "evil", "unholy", "unclean", "vile"]
    let place = ["burial ground", "altar", "sanctum", "shrine", "temple"]
    
    let evilplace = //evilterm.splice(Math.floor(Math.random()*evilterm.length), 1) + " and " + 
    evilterm.splice(Math.floor(Math.random()*evilterm.length), 1) + " " + 
    place.splice(Math.floor(Math.random()*place.length), 1)
        
    return evilplace
}

function possessiveSuffix (name) {
    
    let suffix = ((name).charAt((name).length-1) != "s" ? "'s" : "'")
    
    return name+suffix
}

function allyNamer (alliesandrivals, enemy, heronames) {
    
    let ally = randFrom(alliesandrivals)
    
    while (ally.name === enemy.boss && heronames.includes(ally.name)) {
        ally = randFrom(alliesandrivals)
    }
    
    let allyname = String(ally.name)
    
    if (ally.name === enemy.boss) {allyname = "Mirror " + ally.name}
    else if (heronames.includes(ally.name)) {allyname = "Shadow " + ally.name}
    
    return allyname
}

function defineKnowledge(i, story) {
    let knowledge

    
    switch (i) {
    case 0: knowledge = randFrom(["coldtrail","clueless"])
    break;
    case 1: case 3: case 5: case 7:
        knowledge = "hottrail"
    break;
    case 2: case 4: case 6: case 8:
        if (story[i].stage.name === story[i-1].stage.name) {
            knowledge = "coldtrail"
        } else if (story[i].stage.hasOwnProperty(`captured`) && i > 3) {
            knowledge = randFrom(["clueless","captured"])
            } else knowledge = "clueless"
    break;
}
    return knowledge
}

function loseResult(stageindex, story, nextstage, gizmo) {
    
    let finalboss = story[7].enemy
    
    let enemy = story[stageindex].enemy
    
    let nextenemy = story[nextstage].enemy
    
    let nextmission = story[nextstage].stage
    
    let altstage = (nextstage - 1)
    
    let minion = randFrom(enemy.minionnames)
    
    let nextminion = randFrom(nextenemy.minionnames)
    
    let evilplace = evilPlace()
    
    let contact = Math.random() < 0.5 ? "He" : "She"
    
    let goal
    
    let captivity = ["Under Destruction", "Steel Memories", "Sudden Death"]
    
    
    //erottele tällä tarkemmin lopetukset
    switch (story[stageindex].stage.name) {
    case "Ashes of the Eternal": 
    case "Out of Time": 
    case "The Ceremony": goal = "ritual"
    break;
    case "Cashed Out":
    case "Compromised":
    case "Gone Ballistic":
    case "One Step Ahead":
    case "Original Copy":
    case "Right to Remain Silent":
    case "Running Wild":
    case "Supply & Demand": goal = "retrieval"
    break;
    case "Poison the Well": 
    case "Under Destruction":
    case "Rude Awakening":
    case "Steel Memories": 
    case "Sudden Death": goal = "terror"
    break;
    }
   
    let goingdown = [
        `${enemy.boss} kicks you while you're down, and then pushes you hard into the ground. You look up slowly to see two others join him — ${nextenemy.boss} and ${nextminion} of the ${nextenemy.name}.
        "Wholly unimpressive," ${nextenemy.boss} comments.  "Perhaps, with a little more work, they can become somehow... useful?" `,
        `${enemy.boss} looks down at you. "So this is the sad excuse for a fighter that has been harrying the ${finalboss.name}?" ${gPron(enemy,"subject")} says looking you over. "You've thrown a wrench
        in our plans, ${enemy.addressing}." And then ${gPron(enemy,"subject")} grins, and you feel your heart stop. "And so now you will go to ${nextenemy.boss}!" and then laughs at your fate.`,
        `"Just as I thought," ${enemy.boss} says with calm confidence as he paces around you. "Absolutely pathetic." "What should we do with them?" ${minion} asks. "They are worthless."<br><br>"Not entirely," 
        ${enemy.boss} says. "Bind them. Perhaps ${nextenemy.boss} will have a use for their inadequate talents."`,
        `"Your pitiful husks won't serve me," ${enemy.boss} says. "Perhaps you'll be worth something on the black market. ${ucInit(gPron(enemy,"possessive"))} ${enemy.minions} approach to apprehend you.`,
        `${enemy.boss} ${enemy.threat} before ${nextenemy.boss} gestures for ${gPron(enemy,"object")} to stop. "No," ${gPron(nextenemy,"subject")} says. We have a better use for the Gladiators. 
        After all, who better to think ${finalboss.boss} would want than the Citadel's best?" ${minion} and ${nextenemy.boss} share an amused glance as ${enemy.boss} opens a secret passage. The three of them lead you to the unknown.`,
        `Cackling maniacally the whole time, ${enemy.boss} and ${gPron(enemy,"possessive")} ${enemy.minions} surround you, overwhelming you. Their constant attacks became too much for you, and soon you blacked out,
        ${possessiveSuffix(enemy.boss)} haunting laughter echoing through your head all the while.`,
        `${enemy.boss} laughed quietly and sinisterly as he slowly licked a bleeding wound on ${gPron(enemy,"possessive")} hand. "${finalboss.boss == enemy.boss ? `I'm proud of you` : `${finalboss.boss} would be proud` }," ${gPron(enemy,"subject")} told as you were tied and
        your vision faded. You barely heard ${possessiveSuffix(enemy.boss)} final command: "Take them to the ${nextenemy.name}!"`,
        `You barely clear the site, and you find yourself immediately surrounded by ${possessiveSuffix(enemy.boss)} ${enemy.minions}. "You're due at the next stop," ${enemy.boss} said menacingly.
        "The ${nextenemy.name} still has some uses for you.`
        ]
    
    let deusexmachina = [
        `Suddenly, Citadel agents rappel down out of nowhere. ${enemy.boss} and ${gPron(enemy,"possessive")} ${enemy.minions} flee as the agents free you.
        "Gladiators," one of the Agents greets you. "I have a location of heavy ${nextenemy.name} activity that could use your particular brand of investigating."`,
        `You were unable to learn anything important before your retreat, and when you reconnect with Agent Fletch, he has a little time to debrief you.<br><br>While you were bumbling, the Citadel's efforts have paid off, and you have a little time to recover before you're
        sent off to your next target, where ${nextenemy.boss} has been seen.`,
        `You retreat and regroup nearby, having lost to ${enemy.boss} and ${gPron(enemy,"possessive")} forces. You overheard a lead, but it will be a struggle for you to catch up with the
        ${possessiveSuffix(finalboss.name)} plans now.`,
        `You slowly awoke in a helicopter, confused how you wound up here. Agent Fletch leans towards you, shouting over the roar of the vehicle. "No idea what you thought you were doing down there. Now we must hurry to ${nextenemy.name}
        if we're to fix this!"`,
        `As you were regrouping some distance away, you saw your first welcome sight; Agent Fletch approached with a tablet under his arm. "Don't get comfy," Fletch said, booting up the tablet. "After this fiasco, we might recover if we rapidly strike at key
        targets, and hopefully throw the ${finalboss.name} off-balance."`,
        `Overwhelmed by the might of the ${enemy.name}, you're forced to flee with no real leads to follow up. However, after returning to HQ, the news reported on a situation that guides you on where to go next.`,
        `After failing to contain the situation, you were forced to flee from ${possessiveSuffix(enemy.name)} forces. Ashamed and frustrated, you have no choice but to return to the city and hope
        someone at the police department would hear you out. You can't think of any other option at this point.`
        ]
        
    if (goal == "retrieval") {
        deusexmachina = deusexmachina.concat([
        `The ${enemy.name} was able to escape with their plan fulfilled. You call Agent Fletch and request a cleanup team at the site, and then you begin searching through the debris. You find a ${gizmo} placed almost intentionally
        where you would find it.`,
        `After an uphill battle against overwhelming odds, ${enemy.boss} apparently became bored with the uneven competition and suddenly assaulted with unprecedented fury, leaving you beaten. "Let's move out!" ${gPron(nextenemy,"subject")}
        commanded.  "This is not worth our time."<br><br>Left for dead, you had no chance of following, and had very little to proceed with.`,
        `The ${enemy.name} escaped with what they wanted, and a ${gizmo} you happened upon looks damaged. "Agent Fletch," you got into your communications device. "I've found a ${gizmo}, but it looks damaged." "At least we have it,"
        Agent Fletch replied in your ear. "Bring it back to Citadel HQ and we'll see what can we pull from it."`,
        `You ducked behind cover as ${enemy.minions} mounted a huge assault. To move would have been suicide, and you were forced to watch as the enemy retreated, retrieveing whatever they planned to. While you were avoiding being hit, a squad of Citadel soldiers rushed in
        and sent off the enemies focused on you.<br><br>The soldiers took a moment to patch up your wounds, getting you prepared to return to the Citadel and receive your next target.`,
            ])
    }
    
    if ([2,4,6].includes(stageindex) && captivity.includes(story[stageindex].stage.name)) {
        deusexmachina = [
        `Suddenly, Citadel agents rappel down out of nowhere. ${enemy.boss} and ${gPron(enemy,"possessive")} ${enemy.minions} flee as the agents free you.
        "Gladiators," one of the Agents greets you. "I have a location of heavy ${nextenemy.name} activity that could use your particular brand of investigating.`,
        `You espaced, but badly beaten, and were unable to learn anything important. When you reconnect with Agent Fletch, he has a little time to debrief you.<br><br>The Citadel's efforts have paid off, and you have a little time to recover before you're
        sent off to your next target, where ${nextenemy.boss} has been seen.`,
        `You slowly awoke in a helicopter, confused how you wound up here. Agent Fletch leans towards you, shouting over the roar of the vehicle. "No idea what you thought you were doing down there. Now we must hurry to the ${nextenemy.name}
        if we're to fix this!"`,
        `Overwhelmed by the might of the ${enemy.name}, you're manage to flee, clinging to your lives, and not a clue what to do next. After returning to HQ, the news reported on a situation that guides you on where to go next.`,
        `Severy beaten by ${possessiveSuffix(enemy.name)} forces, you barely espace. Ashamed and frustrated, you have no choice but to return to the city and hope
        someone at the police department would hear you out. You can't think of any other option at this point.`
            ]
    }
        
    let loseresult
    
    if ((story[altstage].stage.name != nextmission.name) && (captivity.includes(nextmission.name) || (nextmission.hasOwnProperty("captured") && nextmission.knowledge == "captured"))) {
        loseresult = randFrom(goingdown)
        } else {loseresult = randFrom(deusexmachina)}
    
    if (goal == "ritual") {loseresult = `You were not able to stop ${enemy.boss} completing the ritual!
    Standing in the middle of the temple, ${gPron(enemy,"subject")} rises up off the stone floor, the ${mysticalSynonym()} powers swirling around ${gPron(enemy,"object")}.
    You watch as ${gPron(enemy,"possessive")} eyes burn, and ${gPron(enemy,"possessive")} body pulses with the ${mysticalSynonym()} energies! 
    ${((story[altstage].stage.name != nextmission.name) && captivity.includes(nextmission.name) || (nextmission.hasOwnProperty("captured") && nextmission.knowledge == "captured")) ? `You lose consciousness in front of that ${mysticalSynonym()} power!` : `You have no choice but to flee for your lives!`}`}
    
    return loseresult
}

function victoryResult(stageindex, story, nextstage, gizmo) {
    
    let finalboss = story[7].enemy
    
    let enemy = story[stageindex].enemy
    
    let nextenemy = story[nextstage].enemy
    
    let nextmission = story[nextstage].stage
    
    let minion = randFrom(enemy.minionnames)
    
    let contact = randFrom(["He","She"])
    
    let location = story[stageindex].stage.location
    
    let bystanders = story[stageindex].stage.bystander
    
    let clue
    
    let evilplace = evilPlace()
    
    let wanting = randFrom(["you are after","you want","","you pursuit","the Citadel is after","behind all this","all to familiar"])
    let finalcahoots = finalboss.name == nextenemy.name ? randFrom([finalboss.boss, (finalboss.desc.replace("the", "a certain"), finalboss.desc)]) : randFrom([`the ${finalboss.name}`, `${finalboss.desc} ${wanting}`, `${finalboss.minions} ${wanting}`, `the ${finalboss.bosstitle} ${wanting}`, finalboss.boss])
    let thiscahoots = enemy.name == nextenemy.name ? randFrom([enemy.boss, (enemy.desc.replace("the", "this very")),`this ${enemy.bosstitle}`]) : randFrom([`the ${enemy.name}`, (enemy.desc.replace("the", "this")), `these ${enemy.minions}`, `the ${enemy.bosstitle}`, enemy.boss])
    let cahoots = randFrom([finalcahoots,thiscahoots])
    let supposition = randFrom(["","supposedly ","rumored to be ","who to your understanding are ","who according to Agent Fletch are ","apparently ","probably ","believed to be ","most likely ","in all likelihood ",
    "presumably ","surely ","assumably ","which you believe are ", "the Citadel analysts are saying is ", "apparently ", "in fact ","indeed ","as a matter of fact ","in truth "])
    cahoots = randFrom([``,` - ${supposition}in cahoots with ${cahoots}`, `, ${supposition}in league with ${cahoots}`,`, ${supposition}allied to ${cahoots}`, 
        `, ${supposition}working for ${cahoots} this time`,`, ${supposition}in alliance with ${cahoots}`,`, ${supposition}hired by ${cahoots}`, `, ${supposition}linked to ${cahoots}`, `, ${supposition}tied to ${cahoots}`,
        `, ${supposition}connected to ${cahoots}`],`, somehow connected to all of this`,``,` that ${supposition}is connected to this`,`, that the Citadel confirms warrants further investigation`,`, who doesn't serve the Kingdom, but instead someone known only as The Master`,`, and seems more important than you originally thought`)
    cahoots = (nextstage == 7 || nextstage == 8) ? `` : cahoots
    
    switch (nextmission.name) {
    case "Ashes of the Eternal": 
    case "The Ceremony": clue = `${nextenemy.boss}${cahoots}, has an interest on a certain ${evilplace}`
    break;
    case "Cashed Out": clue = `the location of a gambling den operated by the ${nextenemy.name}${cahoots}`
    break;
    case "Compromised": clue = `${nextenemy.boss} planning to take hostages in a downtown office building${cahoots}`
    break;
    case "Gone Ballistic": clue = `${nextenemy.name} - ${nextenemy.desc}${cahoots} - are conducting an arms deal at a nearby warehouse`
    break;
    case "One Step Ahead": clue = `the ${nextenemy.name} have been seen along a distant mountain path with their ${nextenemy.minions}${cahoots}`
    break;
    case "Original Copy": clue = `${nextenemy.boss} and ${gPron(nextenemy,"possessive")} ${nextenemy.minions}${cahoots}, have been spotted at a suspicious lab`
    break;
    case "Out of Time": 
    case "Rude Awakening": clue = `strange sorcery and walking corpses have been witnessed, along with ${nextenemy.boss} in ${whichPreposition(evilplace)}${cahoots}`
    break;
    case "Poison the Well": clue = `the ${nextenemy.name} has hauled some equipment to the sewers${cahoots}`
    break;
    case "Right to Remain Silent": clue = `the ${nextenemy.name} has imprisoned Citadel scouts${cahoots}`
    break;
    case "Supply & Demand": clue = `${nextenemy.name} - ${nextenemy.desc}${cahoots} - are conducting a drug deal at a nearby warehouse`
    break;
    case "Under Destruction": clue = `the ${nextenemy.name}${cahoots} - had been busy setting up an intricate series of explosives to bring a certain building down`
    break;
    case "Running Wild": clue = `${nextenemy.minions} of the ${nextenemy.name}${cahoots} are in a nearby labyrinthine forest, searching for something`
    break;
    case "Steel Memories": clue =`${nextenemy.boss} has a secret underground base${cahoots}`
    break;
    case "Sudden Death": clue = `the ${nextenemy.name == "Kingdom" ? nextenemy.boss  + ` was back to ${gPron(nextenemy,"possessive")} previous practice` : " the customary recruitment methods of the Kingdom been duplicated by " + nextenemy.name}${cahoots}`
    break;
    }
    
    let gatherclues = [
        `${enemy.boss} forces you to dodge ${gPron(enemy,"possessive")} attack, and when you return to your stance, ${gPron(enemy,"subject")} is gone! Rather than give chase, you interrogate ${minion} who reveals`,
        `After the skirmish, the ${enemy.name} scared away, you rush to one of the ${bystanders}s' side - an undercover Citadel scout, who holds ${whichPreposition(gizmo)} ${gizmo} in hand. ${contact}'s alive, bleeding out from an attack. "The ${gizmo}!" you ask. "What's in it?" ${contact} doesn't make it, but the intel you recovered tells`,
        `Before you can finish the job, ${enemy.boss} leaps through an opening, falling straight down quite a way but seemingly unharmed. You turn to the ${bystanders}s and one of them approaches you.  "Thank you!" ${lowerCaseInitial(contact)} says, and tells of overhearing that`,
        `As you tie up the unconscious members of the ${enemy.name}, left on their own devices by ${enemy.boss}, you're shocked when ${minion} approaches you calmly. ${minion} - a double agent - informs you that `,
        `"Sir, we've captured one of the ${enemy.minions} and are holding them for questioning."  The technician got to Agent Fletch, and then paused for a moment.  "Find out what they are up to!" Fletch told the technician.  "By any means necessary!" ${minion} revealed that`,
        `${enemy.boss} made a hasty retreat, but thanks to the information you got after the encounter, you have learned`,
        `"Thank you!" one of the ${bystanders}s said as ${lowerCaseInitial(contact)} approached, as the forces of ${enemy.boss} made their retreat. "I overheard what they're planning." ${contact} goes on to explain about `,
        `With the last of the ${enemy.minions} defeated, you turn to face ${enemy.boss} again. You're confident that if you could only get close to ${gPron(enemy,"object")}, you could end this game of cat and mouse. But ${gPron(enemy,"subject")} has disappeared into the thin air! You don't have the time to ponder this, as the intel from here tells`,
        `After your victory over ${possessiveSuffix(enemy.boss)} goons and a short call to Agent Fletch, Citadel forces secure the area and begin their investigation with you. ${enemy.boss} might have slipped away, but among the debris of the fight, you find out`
        ]
        
    if (location == "base") {
        gatherclues = gatherclues.concat([
        `With a hail of attacks, ${enemy.boss} and ${gPron(enemy,"possessive")} surviving cronies fled the encounter. Taking a moment to catch your breath, you managed to find the most conscious of the ${bystanders}s. "${ucInit(gPron(enemy,"subject"))} never told us the plan!" ${lowerCaseInitial(contact)} cried. ${contact} tells that`,
        `Accessing ${possessiveSuffix(enemy.boss)} ${gizmo}, you are able to determine that`,
        `"You think you have won?"  ${enemy.boss} says as you're closing in. "You have won nothing!" ${gPron(enemy,"subject")} produces a remote and presses a button. An explosion knocks you down, and the floor collapses beneath you as ${gPron(enemy,"subject")} escapes. You save who you can and ${minion} returns the favor by telling you that`,
        `With the Citadel on the way, you head deeper to find an array of computer screens. Sifting through files, you learn that`,
        `Accessing ${possessiveSuffix(enemy.boss)} files, you were able to determine that `,
        `You snatch up a ${gizmo} and press the communications device in your ear.  "I've got some intel."  "Excellent," Agent Fletch responds.  "We'll see what data we can pull from it." Turns out`,
        `After the fight, with no sight of ${enemy.boss}, you couldn't help but wonder what ${gPron(enemy,"subject")} was trying to cover up with this. Inside you found a ${gizmo} with intel that ${enemy.boss} definitely didn't want you to find:`,
        ])
    } else if (location == "neutral") {
        gatherclues = gatherclues.concat([
        `"You think you have won?"  ${enemy.boss} says you're closing in. "You have won nothing!" ${gPron(enemy,"subject")} produces a remote and presses a button. An explosion knocks you down, and the floor collapses beneath you as ${gPron(enemy,"subject")} escapes. You save who you can and ${minion} returns the favor by telling you`,
        `After the fight, with no sight of ${enemy.boss}, you couldn't help but wonder what ${gPron(enemy,"subject")} was trying to cover up with this. Inside you found a ${gizmo} with intel that ${enemy.boss} definitely didn't want you to find:`,
        ])
    } else if (location == "cursed") {
        gatherclues = gatherclues.concat([
        `You were strong and fast enough to prevent ${enemy.boss} from finishing the ritual, the ${mysticalSynonym()} powers dissipating into the temple like a voice on the wind. You search through the area, and find out that`,
        `With each blow to ${enemy.boss}, the very world around you shudders. ${ucInit(gPron(enemy,"object"))} screams of pain carry on the winds around you as ${gPron(enemy,"subject")} attempts to fight you off.  Suddenly there's blinding flash and ${gPron(enemy,"subject")}'s gone. You can only look throuh what's left, and you determine that`,
    ])}
    
    let planning = [`. You decide to pay them a visit.`, `. Agent Fletch suggests you continue your investigations there.`, `. A frightened ${bystanders} begs you to hurry up!`, `, and you think there really is no other option than to investigate.`, `. Perhaps it is time to visit ${nextenemy.boss}.`]

    let finalclue = randFrom([`where ${finalboss.boss} is waiting for you.`,`where your final showdown will go down!`, `the critical piece of information that leads you to the location of ${finalboss.boss}!`, `where ${finalboss.boss} is!`, `where the fight to end this will be.`, `the location where your ultimate destiny lies.`, `${nextenemy.boss} in fact is where all the clues were pointing at.`])
    let finality = randFrom([``,`You're going to stop this once and for all.`,`You prepare for a fight this one last time.`,`This is it!`,`This is the end, at last.`,`No escape for ${finalboss.boss} now!`,`You can almost taste the victory!`,`Everything has led to this moment.`,`It is in your hands now.`,`The time has come for your final confrontation!`,`You know this, the final confrontation, won't be easy!`])

    let victoryresult = (nextstage == 7) ? randFrom(gatherclues).replace(" that","").replace("continues","reveals") + " " + finalclue + "<br><br>" + finality : randFrom(gatherclues) + " " + clue + randFrom(planning)
    
    return victoryresult
}

function determineNextStage(stageindex, story, result) {
    
    let nextstage

    if (result == 1) {
    switch (stageindex) {
        case 0: nextstage = 1
        break;
        case 1: case 2: nextstage = 3
        break;
        case 3: case 4: nextstage = 5
        break;
        case 5: case 6: nextstage = 7
        break;
        default: nextstage = 0
    }
    } else if (result == 0) {
        switch (stageindex) {
        case 0: nextstage = 2
        break;
        case 1: case 2: nextstage = 4
        break;
        case 3: case 4: nextstage = 6
        break;
        case 5: case 6: nextstage = 8
        break;
        default: nextstage = 0
    }
    }
    
    
    return nextstage
}

function getRandomMinions(enemy) {


    let clones = randFrom(enemiescopy)

    while (clones.name === enemy) {clones = randFrom(enemiescopy)}
    
    return `choose ${randFrom([clones.minionnames[0],clones.minionnames[1]])} from the ${clones.name} deck as the minion`
    
}

function setUpInstructions(stageindex,enemy,rival,knowledge,stagebonus,stagemalus) {

    let addrival = knowledge == "hottrail" ? false : randFrom([true,false])
    
    let penalty = Math.max(0,Math.round(stageindex/3))
    
    if (knowledge == "clueless") {
        penalty = penalty + 1
    } else if (knowledge == "hottrail") {
        penalty = penalty - 1
    } else {penalty = penalty}

    //gladiator, stage and boss  difficulty, if implemented :
    
    //penalty = penalty + round(round(grating)+srating+brating)
    
    //add cards that add to story pool
    //gettin a positive card nets increased difficulty!
    
    penalty < 1 ? addrival = false : addrival = addrival
    
    let putthiscardintoplay = false
    let activate = false
    let rivalaggression = false
    
    let preparedboss = randFrom(enemy.preparedboss)
    
    let genericbonus = [[`Put ${rival} (ally) into play.`,false,false,false],["Each fighter may take a second mulligan.",false,false,false],["Each fighter gains 1 random defense token.",false,false,false],[`Search the enemy deck for ${preparedboss[0]} and discard it. Shuffle the enemy deck.`, false,false,false],["Each fighter may draw one loot card.",false,false,false]]
    
    let angryrival = [[`${rival} gains 1 of each type of defense token. Place ${rival} (rival) within 3 spaces of a fighter. Activate ${rival} (rival).`,false,false,true],[`${rival} (rival) gains 1 random defense token and advances 2 spaces toward the nearest fighter.<br>`,true,true,true],[`${rival} (rival) gains 2 random defese tokens.<br>`,true,true,true]]
    
    let instructions =  [[`If ${enemy.boss} is unengaged, ${gPron(enemy,"subject")} gains 1 defense token.`,true,true,false],[`Each fighter randomly discards 1 card.`,false,false,false],[`Each fighter suffers 1 direct damage.`,false,false,false],[`Search the enemy deck for ${preparedboss[0]}, ${preparedboss[1]}. Shuffle the enemy deck.`,false,false,false], [`${enemy.boss} gains 2 defense tokens of each type.`,false,false,false],[`${enemy.boss} gains +1 attack value.`,true,false,false]/*, [`Put ${rival2} (rival) into play.`,false,false,false]*/]
    
    addrival ? instructions = _.union(instructions, angryrival) : instructions = instructions
    
    let bonus = randFrom([stagebonus,randFrom(genericbonus)])
    
    if (penalty < 0) {
    (bonus[1] ? putthiscardintoplay = true : ``); (bonus[2] ? activate = true : ``)
    }
    
    let firstpenalty
    
    if (addrival && penalty > 0) {
        firstpenalty = [`Put ${rival} (rival) into play.`,false,false,false]
    } else if (penalty > 0) {
    let randpenalty = Math.floor(Math.random()*instructions.length)
    firstpenalty = instructions[randpenalty]
    instructions.splice(randpenalty,1)
    firstpenalty[1] ? putthiscardintoplay = true : ``; firstpenalty[2] ? activate = true : ``; firstpenalty[3] ? rivalaggression = true : ``; 
    }
    
    let secondpenalty
    
    if (penalty > 1) {
    secondpenalty = randFrom(instructions);
    secondpenalty[1] ? putthiscardintoplay = true : ``; secondpenalty[2] ? activate = true : ``; secondpenalty[3] ? rivalaggression = true : ``; 
    }
    
    if (penalty < 0) {
        instructions = `${putthiscardintoplay ? `Put this card into play in the enemy play area. ` : ``}${activate ? `<b>Activate:</b> ` : ``}${bonus[0]}`
    } else if (penalty == 0) {
        instructions = "No special setup."
    } else if (penalty == 1) {
        instructions = `${putthiscardintoplay ? `Put this card into play in the enemy play area. ` : ``}${activate ? `<b>Activate:</b> ` : ``}${firstpenalty[0]}`
    } else if (penalty > 1) {
        instructions = `${putthiscardintoplay ? `Put this card into play in the enemy play area. ` : ``}${firstpenalty[2] == false ? `${firstpenalty[0]} ` : ``}${secondpenalty[2] == false ? `${secondpenalty[0]} ` : ``}${activate ? `<b>Activate:</b> ` : ``}${firstpenalty[2] ? `${firstpenalty[0]}` : ``} ${secondpenalty[2] ? `${secondpenalty[0]}` : ``}`
    }
    
    instructions = `<b>Stage Setup:</b> ` + instructions
    
    instructionset = [instructions, addrival, rivalaggression]
    
    return(instructionset)
    
}

function createPrologue(stageindex, story, alliesandrivals, heronames, enemies, pregameprologue) {
    let finalboss = story[7].enemy
    let finalstage = story[7].stage
    let enemy = story[stageindex].enemy
    let stage = story[stageindex].stage
    let rival = allyNamer(alliesandrivals, enemy, heronames)
    let competitor = []; do {competitor = randFrom(enemiescopy)} while (finalboss.name == competitor.name || enemy.name == competitor.name)
    let knowledge = stage.knowledge
    let minion = randFrom(enemy.minionnames)
    let pregame = stageindex == 0 ? pregameprologue : "";
    ((enemy.boss != finalboss.boss) && stageindex == 0) ? pregame = pregame + `Without ${randFrom(["intel","knowledge","information","a clue","a word","lowdown"])} on the current ${randFrom(["locale","location","whereabouts","position","scene","station","bearings"])} of ${finalboss.boss}, ${randFrom(["Citadel analysts","you","Agent Flecth and you"])} ${randFrom(["believe","consider","conclude","suppose","think","regard","assume","postulate","deem","surmise"])} ${enemy.boss} is the best source for more information.<br><br>` : ``
    let trail = pregame + randFrom(["Based on current intel","Chasing the clues","Following your leads", "In pursuit of clues", "After a little more intel-gathering", "Following this lead", "As you investigated further", "After searching for more intel","Following the intel you had","After searching for more information","Reviewing what you got"]);
    let instructions = setUpInstructions(stageindex,enemy,rival,knowledge,stage.stagebonus,stage.stagepenalty)
    let rivalpresence = instructions[1]
    let rivalboost = instructions[2]
    let setup = `<b>${stage.name}: ${enemy.name} ${enemy.name == "Kingdom" ? `(${enemy.boss})` : "" }</b><br>` + ((stage.name == "Original Copy") ? ucInit(getRandomMinions(enemy.name)) + ".<br>" : ``) + instructions[0]
    let win = determineNextStage(stageindex, story, 1)
    let lose = determineNextStage(stageindex, story, 0)
    let gizmo = randFrom(["data disc","keycard","tape recorder","floppy disc","microchip","communicator","cell phone","diskette","data cartridge","tablet","magnetic tape","computer"])
    let winepilogue = (stageindex == 7 || stageindex == 8) ? `You have defeated the masterplan` : victoryResult(stageindex, story, win, gizmo)
    winepilogue = winepilogue + "<br><br>" + `${(stageindex == 7 || stageindex == 8) ? `The fighters win this story` : `Advance to part ${story[win].chapter}`}.`
    let loseepilogue = (stageindex == 7 || stageindex == 8) ? `You have failed to defeat the masterplan` : loseResult(stageindex, story, lose, gizmo)
    loseepilogue = loseepilogue + "<br><br>" + `${(stageindex == 7 || stageindex == 8) ? `The fighters lose this story` : `Advance to part ${story[lose].chapter}`}.`
    let gloat = gloatingList(enemy, stage)
    let prologue
    let casino = getCasino(enemy)

    if (stage.hasOwnProperty(`prologue`)) {

        let stagevar
        switch(knowledge) {
            case "hottrail": stagevar = stage.hottrail({"finalboss":finalboss,"enemy":enemy,"rival":rival,"competitor":competitor,"minion":minion,"trail":trail,"rivalpresence":rivalpresence,"gloat":gloat,"stageindex":stageindex,"rivaltext":stage.rivaltext,"knowledge":knowledge, "gizmo": gizmo});
            break;
            case "coldtrail": stagevar = stage.coldtrail({"finalboss":finalboss,"enemy":enemy,"rival":rival,"competitor":competitor,"minion":minion,"trail":trail,"rivalpresence":rivalpresence,"gloat":gloat,"stageindex":stageindex,"rivaltext":stage.rivaltext,"knowledge":knowledge, "gizmo": gizmo});
            break;
            case "clueless": stagevar = stage.clueless({"finalboss":finalboss,"enemy":enemy,"rival":rival,"competitor":competitor,"minion":minion,"trail":trail,"rivalpresence":rivalpresence,"gloat":gloat,"stageindex":stageindex,"rivaltext":stage.rivaltext, "knowledge":knowledge,"gizmo": gizmo});
        }

        let stageriv = stage.rivaltext({"finalboss":finalboss,"enemy":enemy,"rival":rival,"minion":minion,"rivalboost":rivalboost,"stageindex":stageindex, "knowledge":knowledge, "gizmo": gizmo})

        if (knowledge == "captured") {
            prologue = stage.captured({"finalboss":finalboss,"enemy":enemy,"rival":rival,"competitor":competitor,"minion":minion,"trail":trail,"rivalpresence":rivalpresence,"gloat":gloat,"stageindex":stageindex,"rivaltext":stageriv,"stagevar":stagevar,"casino":casino,"knowledge":knowledge, "gizmo": gizmo})
        } else {prologue = stage.prologue({"finalboss":finalboss,"enemy":enemy,"rival":rival,"competitor":competitor,"minion":minion,"trail":trail,"rivalpresence":rivalpresence,"gloat":gloat,"stageindex":stageindex,"rivaltext":stageriv,"stagevar":stagevar,"casino":casino,"knowledge":knowledge, "gizmo": gizmo})}

    } else {
        switch(knowledge) {
            case "hottrail": 
            prologue = stage.hottrail({"finalboss":finalboss,"enemy":enemy,"rival":rival,"competitor":competitor,"minion":minion,"trail":trail,"rivalpresence":rivalpresence,"rivalboost":rivalboost,"gloat":gloat,"stageindex":stageindex});
            break;
            case "coldtrail":
            prologue = stage.coldtrail({"finalboss":finalboss,"enemy":enemy,"rival":rival,"competitor":competitor,"minion":minion,"trail":trail,"rivalpresence":rivalpresence,"rivalboost":rivalboost,"gloat":gloat,"stageindex":stageindex});
            break;
            case "clueless": 
            prologue = stage.clueless({"finalboss":finalboss,"enemy":enemy,"rival":rival,"competitor":competitor,"minion":minion,"trail":trail,"rivalpresence":rivalpresence,"rivalboost":rivalboost,"gloat":gloat,"stageindex":stageindex});
            break;
            default: prologue = "NO PROLOGUE WAS DETERMINED"
        }
    }
    
    return {prologue: prologue, setup: setup, winepilogue: winepilogue, loseepilogue: loseepilogue}
}

function textMaker(story, alliesandrivals, heronames, enemies) {

let cardtext
let cardtexts = []
let winepilogue = "Victory text"
let loseepilogue = "Defeat text"
let pregameprologue = preGamePrologue(story[7].stage,story[7].enemy)

for (i = 0; i < story.length-2; i++) {
    cardtext = createPrologue(i, story, alliesandrivals, heronames, enemies, pregameprologue.storytext);
    cardtexts.push(cardtext)
}

for (i = 7; i < story.length; i++) {
    cardtext = createFinale(i, story, alliesandrivals, heronames, enemies, pregameprologue.vip);
    cardtexts.push(cardtext)
}


return cardtexts
    
}

function createFinale(stageindex, story, alliesandrivals, heronames, enemies, vip) {
    let finalboss = story[7].enemy
    let finalstage = story[7].stage
    let enemy = story[stageindex].enemy
    let stage = story[stageindex].stage
    let rival = allyNamer(alliesandrivals, enemy, heronames)
    let rival2 = allyNamer(alliesandrivals, enemy, heronames)
    let competitor = []; do {competitor = randFrom(enemiescopy)} while (finalboss.name == competitor.name || enemy.name == competitor.name)
    let knowledge = stage.knowledge
    let masterplan = stage.masterplan
    let minion = randFrom(enemy.minionnames)
    let trail = randFrom(["Based on current intel","Chasing the clues","Following your leads", "In pursuit of clues", "After a little more intel-gathering", "Following this lead", "As you investigated further", "After searching for more intel","Following the intel you had","After searching for more information"]);
    let instructions = setUpInstructions(stageindex,enemy,rival,knowledge,stage.stagebonus,stage.stagepenalty)
    let rivalpresence = instructions[1]
    let rivalboost = instructions[2]
    let setup = `<b>${stage.name}: ${enemy.name} ${enemy.name == "Kingdom" ? `(${enemy.boss})` : "" }</b><br>` + ((stage.name == "Original Copy") ? ucInit(getRandomMinions(enemy.name)) + ".<br>" : ``) + instructions[0]
    let win = determineNextStage(stageindex, story, 1)
    let lose = determineNextStage(stageindex, story, 0)
    let winepilogue = finalResult(stage,enemy,rival,vip,1) + "<br><br>" + `${finalboss.boss != enemy.boss ? `You could not stop the ${finalboss.boss}, but your efforts were not in vain, as a threat as serious was neutralized. ` : ``}The fighters win this story.`
    let loseepilogue = finalResult(stage,enemy,rival,vip,0) + "<br><br>" + `The fighters lose this story.`
    let gloat = gloatingList(enemy, stage)

    switch (stage.name) {
    case "Ashes of the Eternal":
        if (knowledge != "clueless" && masterplan == "actsofterror") {
        prologue = `${trail}, you have learned that ${enemy.boss}, just to show that Citadel is powerless before the ${enemy.name}, has trapped the ${possessiveSuffix(vip[0])} ${randFrom([`daughter`,`son`])} and all of their wedding guests inside the locale of the festivities - and unleashed a supernatural fire on them!<br><br>
        "${gloat[0]}" ${enemy.boss} says${(rivalpresence && rivalboost == false) ? `, with ${rival} at ${gPron(enemy,"object")} side,` : ``}. "${gloat[1]}" You have to put out the fires and save the people inside - or the city will see the ${enemy.name} are in total control, and the Citadel cannot save them! And if you cannot, who can?
        ${rivalboost ? ` ${rival}, eyes burning with the unnatural fire, rushes to intercept you!` :``}`}
        else if (knowledge != "clueless" && masterplan == "personalpower") {
        prologue = `${trail}, it is clear ${enemy.desc} of ${enemy.name} are invoking an evil entity at a remote ${evilPlace()} to imbue ${enemy.boss} with unfathomable power. You have decided to head there.<br><br>
        Almost too late! When you arrive, ritual fires have been set, and the flames are getting higher! ${possessiveSuffix(enemy.boss)} minions${(rivalpresence  && rivalboost == false) ? ` and ${rival}` : ``} are working the ritual, while the 
        ${enemy.bosstitle} ${gPron(enemy,"reflexive")} draws in the ${mysticalSynonym()} power. You call out to ${gPron(enemy,"object")}: "Stop it now!" ${ucInit(gPron(enemy,"subject"))} looks at you. "${gloat[0]}" ${enemy.boss} answers. "${gloat[1]}"<br><br>
        You take that as a no, and begin to undo the ritual!${rivalboost ? ` ${rival}, as if possessed by the fiery demon force, rushes to intercept you!` :``}`}
        else {prologue = `${changeOfPlans(trail,finalboss,enemy,stage)}<br><br>
        You arrive at your destination. You immediately notice ${enemy.boss} in the distance, ${rivalpresence ? `with ${rival} at ${gPron(enemy,"possessive")} side,` : ``} watching the
        angry flames rising. ${rivalboost ? `${possessiveSuffix(rival)} eyes burn with hateful fire!` : `You are in a dire hurry.`} "${gloat[0]}" ${enemy.boss} shouts, seeing you rush toward the flames. 
        "${gloat[1]}"`}
    break;
    
    case "Cashed Out":
        if (knowledge != "clueless" && masterplan == "illegalgains") {
        prologue = `${trail}, you finally figure out the plan ${enemy.boss} has. ${ucInit(gPron(enemy,"subject"))} operates an extremely lucrative network casinoes and nightclubs that the ${enemy.name}
        uses as a front for criminal activities of all types, and funnels money to the organization's plans of world domination. It is completely shielded for any investigations by the traditional authorities, but
        as Citadel agents, you are not as restrained.<br><br>
        You arrive at the headquarters, where your surroundings speak volumes about the vast wealth channeled into the ${possessiveSuffix(enemy.name)} operations. ${enemy.boss} ${gPron(enemy,"reflexive")}
        comes to greet you. "Give it up, ${enemy.boss}!" you challenge ${gPron(enemy,"object")}. "${gloat[0]} the ${enemy.bosstitle} answers, and continues: "${gloat[1]}"`}
        else if (knowledge != "clueless" && masterplan == "actsofterror") {
        prologue = `${trail}, you finally figure out the plan ${enemy.boss} has. ${ucInit(gPron(enemy,"subject"))} operates an extremely lucrative network casinoes and nightclubs that the ${enemy.name}
        uses as a front for criminal activities of all types, and this wretched hive of scum and villainy is on its way to corrupt the city to its core. You don't believe for a second the city officials would make a move against the ${enemy.name} now.<br><br>
        You arrive at the hearquarters, where your surroundings speak volumes about the vast wealth channeled into the ${possessiveSuffix(enemy.name)} operations. ${enemy.boss} ${gPron(enemy,"reflexive")}
        comes to greet you. "Give it up, ${enemy.boss}!" you challenge ${gPron(enemy,"object")}. "And why would I? If you have a gun, you can rob a casino. But if you have a casino, you can rob everyone," 
        ${enemy.boss} answers, beaming.`}
        else {
        prologue = `${changeOfPlans(trail,finalboss,enemy,stage)}<br><br>
        You manage to locate a gambling den that is owned and operated by members of the ${enemy.name}. When you arrived at the casino, something seemed off.
        Your hunch was right; ${enemy.boss} had been tipped. "Everybody, keep on playing!" ${gPron(enemy, "subject")} commanded, "${rivalpresence ? `Me and ${rival} will`: `I'll`} escort them out!"  `}
    break;
    
    case "Compromised":
        if (knowledge != "clueless" && masterplan == "actsofterror") {
        prologue = `${trail}, you have determined that the ${enemy.name} will take hostage the whole ${vip[1]} in a show of power. 
        You have arrived at the location. Sounds of violence can be heard inside the building, followed by screams inside and out.
        "Call the police!" several fleeing employees shout, but you know it's futile. The chances of police having the gear or training to handle this properly is beyond unlikely.<br><br>
        You get past the ${enemy.minions} on guard, and face ${enemy.boss} ${gPron(enemy,"reflexive")}. "This ends here, ${enemy.boss}! I am not here to negotiate!" you call out. "${gloat[0]}" 
        ${gPron(enemy,"subject")} answers, "${gloat[1]}"`}
        else if (knowledge != "clueless" && masterplan == "kidnapping") {
        prologue = `${trail}, turns out the ${enemy.name} have hidden ${vip[0]} in plain sight, a public office building. 
        The chances of police having the gear or training to handle this properly is beyond unlikely. So you move in on your own.<br><br>
        You get past the ${enemy.minions} on guard, and face ${enemy.boss} ${gPron(enemy,"reflexive")}. "This ends here, ${enemy.boss}! I am not here to negotiate!" you call out. "${gloat[0]}" 
        ${gPron(enemy,"subject")} answers, "${gloat[1]}"`}
        else {
        prologue = `${changeOfPlans(trail,finalboss,enemy,stage)}<br><br>
        You make your way to the location, but when you arrive, you knew it's too late. Sounds of violence can be heard inside the building, followed by screams inside and out.
        "Call the police!" several fleeing employees shout, but you know it's futile. The chances of police having the gear or training to handle this properly is beyond unlikely.<br><br>You rush into the
        building, heedless of all the warnings shouted at you. "${gloat[0]}" You're greeted by ${rivalpresence ? `familiar faces` : `a familiar face` } that you hoped you might have seen last of. ${enemy.boss}, leader of the ${enemy.name} ${rivalpresence ? `is there with ${rival}` : enemy.threat}.
        "${gloat[1]}"`};
    break;
    
    case "Gone Ballistic":
        if (knowledge != "clueless" && masterplan == "strengtheningforces") {
        prologue = `${trail}, you have found out that ${enemy.boss} is planning on buying enough firepower for ${enemy.name} goons to completely take over the city by force of might. The location is known, but Agent Fletch does
        not think the police is fast enough - or well enough trained - to take part in an operation against an opponent this dangerous.<br><br>
        You arrive at the warehouse and find ${enemy.boss} along with ${gPron(enemy,"possessive")} ${enemy.minions}. "${gloat[0]}" ${gPron(enemy,"subject")} says to you. "${gloat[1]}"
        ${enemy.boss} ends ${gPron(enemy,"possessive")} gloating. ${rivalpresence ? `${rival}, party to the arms deal, moves in to get you.`:``}<br><br>
        You have to stop the ${enemy.name} here and now, or the city will not survive.`
        }
        else if (knowledge != "clueless" && masterplan == "illegalgains") {
        prologue = `${trail}, you have found out that the ${enemy.name} is funding their operation by conducting an immense international arms deal in an abandoned warehouse. Agent Fletch does not think the police is fast
        enough - or well enough trained - to take part in an operation against an opponent this dangerous.<br><br>
        You arrive at the warehouse and find ${enemy.boss} surrounded by ${gPron(enemy,"possessive")} goons preparing for the deal. "${gloat[0]}" ${gPron(enemy,"subject")} says. "${gloat[1]}
        Grab a gun, ${rivalpresence ? rival : randFrom(enemy.minionnames)}! Let's give them hell!"
        You have to stop the ${enemy.boss} here and now, or their reach and power will grow exponentially.`
        }
        else {prologue = `${changeOfPlans(trail,finalboss,enemy,stage)}<br><br>
        You believe that ${enemy.boss} may have been spotted at an abandoned warehouse ${rivalpresence ? `that's currently used as a base by ${rival},` : `which is as good lead as any at this point,`}
        so you decide your investigation continues there.<br><br>
        Agent Fletch does not think the police is fast enough - or well enough trained - to take part in an operation against an opponent this dangerous, so you move in on your own.`}; 
    break;
    
    case "One Step Ahead":
        if (knowledge != "clueless" && masterplan == "kidnapping") {
        prologue = `${trail}, you have confirmed that the minions of ${enemy.boss} have the ${vip[0]} holed up in a remote mountain cave. Going by helicopter would surely
        alert the ${enemy.name}, so you must approach by foot. You start the arduous climb, and after a while you find ${enemy.boss} blocking your way.<br><br>
        "I didn't believe you had it in you to get this far! ${gloat[0]}" shouts ${enemy.boss}, and turns slightly. "${randFrom(enemy.minionnames)}! Just get to the cave and kill ${randFrom(["him","her"])}!" ${ucInit(gPron(enemy,"subject"))} turns back to you
        and continues: "${gloat[1]}"`}
        else if (knowledge != "clueless" && masterplan == "personalpower") {
        prologue = `${trail}, you have confirmed that the minions of ${enemy.boss} have located a mountain cave that, under specific star conjunction, will bless a person of proper disposition and correct rites with ${mysticalSynonym()} powers. Going by helicopter would surely
        alert the ${enemy.name}, so you must approach by foot. You start the arduous climb, and after a while you find ${enemy.boss} blocking your way.<br><br>
        "${randFrom(enemy.minionnames)}! Take the rest of the ${enemy.minions} and prepare the cave! I will come there when the stars are right!" ${ucInit(gPron(enemy,"subject"))} turns to you. "${gloat[0]}" ${gPron(enemy,"subject")} says eyeing you. "${gloat[1]}"`}
        else {prologue = `${changeOfPlans(trail,finalboss,enemy,stage)}<br><br>
        You have confirmed that the minions of ${enemy.boss} are operating near a certain mountain cave. Going by helicopter would surely
        alert the ${enemy.name}, so you must approach by foot. You start the arduous climb, and after a while you find ${enemy.boss} blocking your way.<br><br>
        "${randFrom(enemy.minionnames)}! Take the rest of the ${enemy.minions} and retreat to the cave!" ${ucInit(gPron(enemy,"subject"))} turns to you. "I can
        handle you as it is, ${defineAddressing(enemy)}."`}
    break;
    
    case "Original Copy":
        if (knowledge != "clueless" && masterplan == "strengtheningforces")
        {prologue = `${trail}, you eventually find the exact location of the secret laboratory where ${enemy.boss} is growing ${gPron(enemy,"possessive")} army, and make your way to the hidden facility.
        You fight with the guards until you find your way to an elevator, and proceed down to the large lab. You patiently wait while a lounge version of
        ${loungeMusic()} plays over the cheap speakers.<br><br>
        You finally reach a cavernous room filled with rows upon rows of glass containment tubes. Each tube has a motionless body in it; some of you recognized as opponents you'd faced before. There must be hundreds of clones in here! ${rivalpresence ? `Suddenly, one of
        the tubes crashes open, and a figure can be seen within the steam, kneeling, faced away. It looks exactly like ${rival}! ` : ``}Standing at the far end of the room,
        you see ${enemy.boss} ${gPron(enemy,"reflexive")}. ${ucInit(gPron(enemy,"subject"))} looks at you and grins. If you cannot stop ${enemy.boss} right here, ${gPron(enemy,"possessive")} army will be big enough to completely take over the city!`}
        else if (knowledge != "clueless" && masterplan == "personalpower") 
        {prologue = `${trail}, you eventually find the secret laboratory where ${enemy.boss} is is about to be reborn with unprecedented power imbued by a modified strain of ${randFrom(["Dynasty Cells","Vandal Serum","Dark Matter"])}. You make your way to the hidden facility.
        You fight with the guards until you find your way to an elevator, and proceed down to the large lab. You patiently wait while a lounge version of
        ${loungeMusic()} plays over the cheap speakers.<br><br>
        You finally reach a cavernous room filled with glass containment tubes. You see ${randFrom(enemy.minionnames)}, who stands near ${rivalpresence ? `two large incubation tubes` : `a large incubation tube`}. "I'm sure our ${enemy.bosstitle}
        grows tired of the confinement," the goon says, and presses a few buttons on the side of ${rivalpresence ? `one` : `the`} tube, and you watch as ${rivalpresence ? `they slide` : `it slides`} open. Out steps ${enemy.boss}, surrounded by an aura as dark and ominous
        as ${gPron(enemy,"possessive")} very reputation. ${ucInit(gPron(enemy,"possessive"))} eyes glow with a deep red energy, and ${gPron(enemy,"subject")} turns those burning orbs on you as ${gPron(enemy,"subject")} clenches ${gPron(enemy,"possessive")} fists.
        ${rivalpresence ? `Within the other tube, a figure can be seen within the steam, kneeling. ${rivalboost ? `It stands, slowly, powerfully built, moving with graceful precision. It is the ultimate clone, ${rival.toUpperCase()}-EX!` : `It looks exactly like ${rival}!`}` : ``}<br><br>
        You know this, the final confrontation, won't be easy!`}
        else 
        {prologue = `As you slowly regain consciousness, you notice an IV hooked up to your arm. Your strength has been completely drained and you are unable to even stand up.
        "${gloat[0]}" a voice called. "${gloat[1]}"<br><br>
        You have no idea how long you have been the hostage to your captors. As your vision clears, you see the voice belongs to ${enemy.boss}, the
        notorious boss of ${enemy.name}, ${enemy.desc}. You also see that you are surrounded by sterile lab equipment and ominous test tubes occupied by shadowy figures${rivalpresence && rivalboost == false ? `, with ${rival} observing your vitals from a screen` : `` }. You
        suddenly feel a surge of strength return and yank out the IV. "Fine, let's do it the hard way!" ${rivalpresence && rivalboost ? `Suddenly, one of the tubes crashes open, and a figure can be seen within the steam, kneeling, faced away.
        It stands, slowly, powerfully built, moving with graceful precision. It is the ultimate clone, ${rival.toUpperCase()}-EX!` : ``}`};
    break;
    
    case "Out of Time":
        if (knowledge != "clueless" && masterplan == "strengtheningforces") {
        prologue = `${trail}, you have located the ${evilPlace()} where ${enemy.boss} will enact ${gPron(enemy,"possessive")} masterplan. Citadel agents escort you to the remote location. The
        world around you is nothing like the one you have lived in all of your life. ${enemy.boss} has apparently shifted the place to another dimension, one where the dark winds sting your skin and the
        very air around you smolders your throat and lungs.  The sky is a boiling, writhing mass of clouds, each black as coal but glowing with an intense, blood-red heat. If there is a hell, this may as well be it.<br><br>
        You see ${enemy.boss}, not far away, continuing ${gPron(enemy,"possessive")} magic. All around ${gPron(enemy,"possessive")}, the ground breaks apart as more and more undead climb to the surface.
        Death permeates everything here. You cannot let the army of the dead move back home, or the forces of the ${enemy.name} grow unstoppable. You stand ready, and know this is where it will all end.`}
        else if (knowledge != "clueless" && masterplan == "personalpower") {
        prologue = `${trail}, you have located the ${evilPlace() } where ${enemy.boss} will enact ${gPron(enemy,"possessive")} masterplan. Citadel agents escort you to the remote location. The
        world around you is nothing like the one you have lived in all of your life. ${enemy.boss} has apparently shifted the place to another dimension, one where the dark winds sting your skin and the
        very air around you smolders your throat and lungs.  The sky is a boiling, writhing mass of clouds, each black as coal but glowing with an intense, blood-red heat. If there is a hell, this may as well be it.<br><br>
        You see ${enemy.boss}, not far away, continuing ${gPron(enemy,"possessive")} magic. "${gloat[0]}" ${enemy.boss} tells you. "${gloat[1]}" You stand ready, and know this is where it will all end.`}
        else {prologue = `You come to your senses as undead hands are gripping you and guiding you upwards to an ominous altar on a large pedestal in front of you. What ${mysticalSynonym()} sorcery had kept you
        enthralled is weakening, and you put the zombie down. "${gloat[0]}" ${enemy.boss} looks down at you and shouts, as dark winds sting your skin and the very air around you smolders your throat and lungs.
        "${gloat[1]}${rivalpresence ? (rivalboost ? `" ${rival}, standing there, turns and faces you unnaturally black eyes. "Get the gladiators, a` : ` Get them up here, ${rival}! A`) : ` Get up here and die, a` }nd this all will be over sooner!"<br><br>
        You still feel dizzy and uneasy and don't quite have your bearings at this ${evilPlace()}, but one thing you're certain of: you will not let ${enemy.boss} get away with this.`};
    break;
    
    case "Poison the Well":
        if (knowledge != "clueless" && masterplan == "actsofterror") {
        prologue = `${trail}, you were able to find your way to ${possessiveSuffix(enemy.boss)} secret sewer lair. As you enter a large chamber, you find what used to be a water treatment facility that is now being
        used as some sort of insane science experiment. "${gloat[0]}" came a voice, echoing from somewhere else in the chamber.<br><br>
        The ${enemy.bosstitle} of the ${enemy.name} enters your view from the shadows and ${gPron(enemy,"subject")} continues: "${gloat[1]}
        Once we get these pumps working, all the water in the city will be tainted with our serum, and everyone will be addicted. But you won't be here to see it!"`}
        else if (knowledge != "clueless" && masterplan == "strengtheningforces") {
        prologue = `${trail}, you were able to find your way to ${possessiveSuffix(enemy.boss)} secret sewer lair. As you enter a large chamber, you find what used to be a water treatment facility that is now being
        used as some sort of insane science experiment. "${gloat[0]}" came a voice, echoing from somewhere else in the chamber.<br><br>
        The ${enemy.bosstitle} of the ${enemy.name} enters your view from the shadows and ${gPron(enemy,"subject")} continues: "${gloat[1]}
        Once we get these pumps working, all the water in the city will be blessed by our new serum. The weak will die, and the surviving strong will join our ranks as thralls. So now you have a choice: join us, or die!"`}
        else {prologue = `You wake up, and the first thing you notice is the intense stench attacking your nostrils. You open your eyes, and as you focus, you can see ${enemy.boss} at a distance. You seem
        to be underground, in some kind of a crazy scientist setup, and ${enemy.minions} are moving canisters about big machinery.<br><br>"Oh, you're awake?!" ${enemy.boss} says, annoyed. "I was hoping you would
        not come to your senses before our bath would be ready for you!" You don't think this would be good for your skin, so you diplomatically refuse. The ${possessiveSuffix(enemy.name)}
        goons don't seem to respond to kind words alone${rivalpresence ? `,nor does their foreman ${rival}` : ``}${rivalboost ? `, who looks to be pumped up on Vandal` : ``}.`};
    break;
    
    case "Right to Remain Silent":
        if (knowledge != "clueless" && masterplan == "illegalgains") {
        prologue = `${trail}, you find out that ${enemy.boss} has several prominent members from a number of tech and finance companies hostage, and are leveraging their position to extort ludicrous sums of untracable cash. 
        From your intel, Citadel analysts have pieced together the location of these hostages, and you move in.<br><br>
        You have to rescue the captives - the power and reach of the ${enemy.name} will grow exponentially if the families cave in!`}
        else if (knowledge != "clueless" && masterplan == "kidnapping") {
        prologue = `${trail}, you find out the location of the ${vip[0]}, who has been kidnapped by ${enemy.boss} and ${gPron(enemy, "possessive")} ${enemy.minions}.
        "${enemy.boss} is interrogating ${randFrom(["him","her"])} as we speak," Agent Fletch says. "You have to move in quick, before ${gPron(enemy,"subject")} gets any sensitive information! Some of
        their intel could threaten even the Citadel!"<br><br>
        You arrive to the scene to see several captives, with their faces covered. ${rivalpresence ? `${rival} is standing guard over the captives,` : `The enemies are on alert,`} and you don't know which one
        is the ${vip[0]}. "${gloat[0]}" ${enemy.boss} greets you. "${gloat[1]}"<br><br>${laconicStatement(enemy)}`} 
        else {prologue = `"Finally awake?" That's the first thing you hear after the splash of stale water jolts you awake. 
        You have no idea how long you've been a hostage of the ${enemy.name}, ${enemy.desc} — but you'd guess it's been at least a few days.<br><br>
        You've been enduring their tortures as they've tried to get everything they could out of you. 
        You've held out for now but don't know how long you'll be able to keep it up. ${enemy.boss} ${enemy.threat} as ${gPron(enemy, "subject")} stares at you down. "${gloat[0]}" Your silence is deafening as you stare at the floor. "${gloat[1]}" ${enemy.boss} sneers. 
        "I won't be gone for too long, ${defineAddressing(enemy)}. Don't get comfortable."<br><br>
        ${ucInit(gPron(enemy, "subject"))} exits, and ${rivalpresence ? `${rival} stays to guard over you.` : `as soon as the door closes behind ${gPron(enemy, "object")}, you begin working at your bonds.`}`};
    
    break;
    case "Rude Awakening":
        if (knowledge != "clueless" && masterplan == "actsofterror") {
        prologue = `${trail}, you are on the way to the location of ${enemy.boss} with Agent Fletch. "According to Citadel analysts, the goal of the ${enemy.name} has all along been to sow fear and disarray to the city
        by using a ${mysticalSynonym()} ritual to swarm the city with the undead."
        He looks out the window and then nods to you. "See for yourself". Below you see a veritable sea of people, all of them shambling about, all of them appearing broken and decayed.<br><br>
        You slide down the climbing rope and watch as the helicopter flies away. As you look over the zombies around you, you notice in the distance the ${enemy.bosstitle} of ${enemy.name}.
        ${ucInit(gPron(enemy,"subject"))} looks at you and raises ${gPron(enemy,"possessive")} hands. "This is becoming a wonderful day for evil!"
        ${gPron(enemy,"subject")} shouts, and is surrounded by ${mysticalSynonym()} energy. You see even more zombies climb out of the ground at their feet.`}
        else if (knowledge != "clueless" && masterplan == "strengtheningforces") {
        prologue = `${trail}, you are on the way to the location of ${enemy.boss} with Agent Fletch. "According to Citadel analysts, the ${enemy.name} have uncovered a book of ${mysticalSynonym()} knowledge that
        instructs how to raise the dead, and ${enemy.boss} plans to use this to bolster the ranks of the ${enemy.name} until ${gPron(enemy,"subject")} has an unstoppable army!"
        He looks out the window and then nods to you. "See for yourself". Below you see a veritable sea of people, all of them shambling about, all of them appearing broken and decayed.<br><br>
        You slide down the climbing rope and watch as the helicopter flies away. As you look over the zombies around you, you notice in the distance the ${enemy.bosstitle} of ${enemy.name}.
        ${ucInit(gPron(enemy,"subject"))} looks at you and raises ${gPron(enemy,"possessive")} hands. "${gloat[0]}" ${gPron(enemy,"subject")} shouts, and is surrounded by ${mysticalSynonym()} energy. "${gloat[1]}" You see even more zombies climb out of the ground at their feet.`}
        else {prologue = `${changeOfPlans(trail,finalboss,enemy,stage)}<br><br>
        You find yourself at your destination. You see a veritable sea of people, all of them shambling about, all of them appearing broken and decayed.<br><br>
        As you look over the zombies around you, you notice in the distance ${enemy.boss}, ${rivalpresence ? `with ${rival} standing guard, ` : ``}directing a cabal of necromancers!
        ${rivalpresence ? `"Stop those Gladiators!" the leader of the ${enemy.name} spits.` : `"I was sure you would be busy with ${finalboss.boss}!" ${gPron(enemy, "subject")} shouts!`}
        ${rivalboost ? ` ${rival}, looking like a corpse, hisses and lunges at you!` : ``}`}
    break;
    
    case "Running Wild":
        if (knowledge != "clueless" && masterplan == "personalpower") {
        prologue = `${trail}, you have determined that ${enemy.boss} is in a distant forest, after a collection of ancient idols of a lost, ancient temple that ${mysticalSynonym()} texts claim will grant immeasurable power to their keeper.<br><br>
        "You have to hurry, Gladiators," Agent Fletch says, shouting over the roar of the helicopter as you are flown to the target. "Our Citadel scouts report that ${enemy.name} goons have been
        seen in the area for some time now, they must be close to getting what they came for!" He looks out the window and then nods to you. "This is your stop." You slide down the climbing rope and watch as the helicopter flies away. 
        Soon you find the ${enemy.minions} of ${enemy.name} in the forest."<br><br>
        ${enemy.boss} notices notices your approach. "${gloat[0]}" ${gPron(enemy,"subject")} shouts in anger. "${gloat[1]}"${rivalpresence ? `, as ${rival} steps in your way.`:``}`}
        else if (knowledge != "clueless" && masterplan == "illegalgains") {
        prologue = `${trail}, you have determined that ${enemy.boss} is in a distant forest near a forgotten temple ruin, after ancient idols that Citadel analysts state to be valuable beyond measure.<br><br>
        "You have to hurry, Gladiators," Agent Fletch says, shouting over the roar of the helicopter as you are flown to the target. "Our Citadel scouts report that ${enemy.name} goons have been
        seen in the area for some time now, and their power and reach will grow exponentally with the influx of cash from the black market after selling the artefacts!" He looks out the window and then nods to you. "This is your stop." You slide down the climbing rope and watch as the helicopter flies away. 
        Soon you find the ${enemy.minions} of ${enemy.name} in the forest."<br><br>
        ${enemy.boss} notices notices your approach. "${gloat[0]}" the boss shouts in anger: "${gloat[1]}" ${rivalpresence ? `, as ${rival} steps in your way.`:``}`}
        else {prologue = `${changeOfPlans(trail,finalboss,enemy,stage)}<br><br>
        With help from the locals you have no trouble finding the area with a ruined shrine where the ${possessiveSuffix(enemy.name)} searches are happening, but turns out they have been scouring the woods for 
        weeks already, and are quite prepared.<br><br>
        When you reach them, you find ${enemy.boss} ${rivalpresence ? ` and ${rival}`:``}. "${gloat[0]}"
        ${ucInit(gPron(enemy,"subject"))} says as you are noticed, and ${enemy.threat}.`}
    break;
    
     case "Steel Memories":
        if (knowledge != "clueless" && masterplan == "actsofterror") {prologue = `${trail}, you have found out that ${enemy.boss} has managed to organize a 12 hour marathon of crimes of every imaginable sort, including murder,
        for this very night. Agent Fletch explains to you: "The ${enemy.name} has provided the people release for all the hatred, and violence, and aggression that they keep up inside them. You need to contain their mob,
        before the mentality spreads any further and the city falls to anarchy!"<br><br>This has been ${possessiveSuffix(enemy.boss)} plan all along! You have no choice but to move in and subdue both the ${enemy.minions}, and treat any 
        victims to ${possessiveSuffix(enemy.boss)} manipulations collateral damage, or the city will never be the same again.`
        }
        else if (knowledge != "clueless" && masterplan == "kidnapping") {
        prologue = `${trail}, you have found out where the secret base of the ${enemy.name} is located and the ${vip[0]} is being held. You accompany a squad of Citadel soldiers as they storm the base.
        ${enemy.name} soldiers fall before you, and you make your way through the maze-like halls until you finally reach an elevator.
        You wait patiently, while a lounge version of ${loungeMusic()} plays over the cheap speakers.<br><br>
        When you arrive, ${enemy.boss} is waiting for you, standing ready. "${gloat[0]}" ${gPron(enemy, "subject")} says. "${gloat[1]}" ${laconicStatement(enemy)}`
        }
        else {prologue = `You wake up in a pitch black room and turn around, hoping to find some sort of reference to where exactly you are, but not fully recovered. All you see is the ever-encroaching blackness and
        the deafening silence surrounding you.<br><br>
        And then, the lights in the room snap on, almost blinding you with their intensity. You blink, and see standing before you the ${enemy.bosstitle} leader of the ${enemy.name}:
        ${enemy.boss}. "${gloat[0]}" ${gPron(enemy,"subject")} says, smirking.${rivalpresence ? ` "It is time you prove your worth, ${rival}!" ${enemy.boss} exclaims.`: `"${gloat[1]}"`}`
        };
    break;
    
    case "Sudden Death":
        if (knowledge != "clueless" && masterplan == "kidnapping") {
        prologue = `${trail}, you found that ${enemy.boss} has kidnapped, along with the ${vip[0]}, a whole lot of people from all walks of life, and intends to make them fight to death
        for ${gPron(enemy,"possessive")} own entertainment! Agent Fletch informs you that you have the location of the ${possessiveSuffix(enemy.name)} secret base. You head there with
        Citadel soldiers, who clear the upper levels while you find your way to an elevator, and proceed down to the heart of the complex. You patiently wait while a lounge version of
        ${loungeMusic()} plays over the cheap speakers.<br><br>
        There you find ${enemy.boss} in the middle of the captives. "So today's lesson is," ${gPron(enemy,"subject")} says. "You kill each other off till there's only one left.
        Nothing's against the rules." You must put an end to this to rescue the ${vip[0]}! "All are welcome to participate!" says ${enemy.boss} as ${gPron(enemy,"subject")} turns to you.`
        }
        else if (knowledge != "clueless" && masterplan == "strengtheningforces") {
        prologue = `${trail}, you have found out that ${enemy.bosstitle} ${enemy.boss} has been covertly organizing a new underground tournament under a mainstream event's shadow,
        recruiting soldiers into the ${enemy.name}. Citadel analysts say that this has the most extensive recruiting potential of any of the similar plots in the recent past.<br><br>
        The ${enemy.name} is operating behind a legitimate event to hundreds of fighters from all over the globe. The winners are again offered prestigious positions as officers in the ${possessiveSuffix(enemy.name)} armed forces. The winners who refuse this
        offer are naturally captured and killed. You can't let this happen. You once more infiltrate a network of underground street fights focused on bringing the most ruthless fighters out of the woodwork, and
        once more have no choice but to enter the fight and shut down the ${enemy.name} efforts first hand.`
        }
        else {
        prologue = `Hands tied behind your back, you are led by ${enemy.boss} and ${minion} into an oddly-placed urban clearing. The out-of-place streets are
        hosting several fighters, each of them sparring in deadly martial arts. "You're not worthy to walk on this ground," ${minion} growls, glaring at you with a deep-seated hatred.
        "And so", ${enemy.boss} interjects. "We will allow you the chance to prove your worth. ${finalboss.boss == enemy.boss? `I have developed a great interest in you.
        I would be pleased if you'd demonstrate it to my doubting minion.` : `${finalboss.boss} has taken great interest in you. Show us why that is.`}"<br><br>"This is unnecessary," ${minion} says quietly to ${enemy.boss}. "You play games with the trust of the ${finalboss.name == enemy.name ? "Master" : finalboss.name}."
        ${enemy.boss} loosens your bonds, ignoring ${possessiveSuffix(minion)} words. You grab your wrists as they are free, rubbing the pain away, and watch as the other fighters turn toward ${enemy.boss},
        preparing for what you're assuming will be a fight to the death. The other fighters show no fear, their eyes looking only for glory${rivalboost ? `, and ${rival} looking especially eager to beat you to a pulp` : ``}.`
        }
    break;
    
    case "Supply & Demand":
        if (knowledge != "clueless" && masterplan == "illegalgains") {
        prologue = `${trail}, you have found out that the ${enemy.name} is conducting an immense international drug deal with a Vandal-derivative drug load on a remote island.<br><br>
        Agent Fletch sits behind the pilot's seat of the Citadel plane takes you to your location. "We're coming up on the ${possessiveSuffix(enemy.name)} location," he says to you. 
        "I'll see if I can put her down over-" His words are interrupted as an explosion from an anti-air shell shakes the plane. "Nevermind, looks like you're jumping in!"
        Grabbing a parachute, you leap from the plane as it peels off and heads toward safety.<br><br>
        You land just outside the camp that was firing at the Citadel aircraft, and you hear gunfire in the distance. "We've reached the camp," you say to Fletch via your radio. 
        ${rivalpresence && rivalboost ? `You would have finished your sentence weren't for ${rival} who leaped from the shadows and delivered a powerful attack square to your face.` : `"We have found ${enemy.boss}."`}
        You have to stop the ${enemy.boss} here and now, or their reach and power will grow exponentially with the leverage and cash the deal will deliver them.`
        }
        else if (knowledge != "clueless" && masterplan == "actsofterror") {
        prologue = `${trail}, you find out that the ${enemy.desc} of the ${enemy.name} are planning to openly flood the streets of the city with free samples of a Vandal-derivative drug. Citadel analysts have determined the location and time of
        their plan, and you move in to intervene.<br><br>
        A Citadel chopper drops you at the remote beach where the ${possessiveSuffix(enemy.name)} distribution of product is taking place. "${gloat[0]}" ${enemy.boss} says. "${gloat[1]}" You have to stop the distribution here and now, or the city will fall into unimaginable social troubles - and the people will know no-one can stop the ${enemy.name}!`
        }
        else {
        prologue = `${changeOfPlans(trail,finalboss,enemy,stage)}<br><br>
        You have approached the site stealthily, and are just about to attack. Standing nearby, the ${enemy.bosstitle} ${enemy.boss} watches over the activity. ${rivalpresence ? `During their work,
        one of the soldiers spots you and drops his crate, a large amount of illegal drugs spilling out onto the concrete loading dock. You duck behind cover, but ${rivalboost ? `out of nowhere
        ${rival} leaps from the shadows and delivers a powerful strike square to your face.` : `${rival} calms ${gPron(enemy,"object")}, saving the unlucky soldier: "Somebody's back there!"`}` : `Suddenly,
        the soldiers carrying the goods drop their crates where they stand, illegal drugs spilling out! You must have been seen!`} "You can still stop this, ${enemy.boss}," you try to reason. "${gloat[0]} ${gPron(enemy,"subject")} 
        answers. "${gloat[1]}".<br>
        ${laconicStatement(enemy)}`
        };
    break;
    
    case "The Ceremony":
        let artefact = randomArtefact()
        if (knowledge != "clueless" && masterplan == "personalpower") {prologue = `${trail}, you've determined where ${enemy.boss} will enact ${gPron(enemy,"possessive")} plan of receiving the ultimate power. You reach the ${evilPlace()}
        nestled deep in in the wilds where the ritual is to take place - to find ${enemy.boss} and ${gPron(enemy,"possessive")} forces already starting the ritual.<br><br>"${gloat[0]}" ${enemy.boss} calls with confidence, ${gPron(enemy,"possessive")} voice echoing off the stone walls.
        You see the temple is surrounded by multiple pedestals, each with a mysterious ${artefact} placed on top. The ${artefact}s are etched with a series of ${mysticalSynonym()} images.
        Thinking that these may be part of the ritual, you must remove them from their pedestals. "${gloat[1]}" ${enemy.boss} calls out. ${ucInit(gPron(enemy,"possessive"))} forces ${rivalpresence ? `led by ${rival} `: ``}charge you while
        ${gPron(enemy,"subject")} continues the ritual.<br><br>The time has come for your final confrontation!`}
        else if (knowledge != "clueless" && masterplan == "kidnapping") {prologue = `${trail}, you've determined that ${enemy.boss} plans to sacrifice ${gPron(enemy,"possessive")} captive to appease a dark power ${gPron(enemy,"subject")} is indebted to at a certain ${evilPlace()}. You reach the location
        to find ${enemy.boss} and ${gPron(enemy,"possessive")} forces already starting the ritual. You see the captive chained, too tightly for you to free ${randFrom(["him","her"])} without defeating the ${enemy.name} first.<br><br>
        "${gloat[0]}" ${enemy.boss} calls with confidence, ${gPron(enemy,"possessive")} voice echoing off the stone walls.
        You see the temple is surrounded by multiple pedestals, each with a mysterious ${artefact} placed on top. The ${artefact}s are etched with a series of ${mysticalSynonym()} images.
        Thinking that these may be part of the ritual, you must remove them from their pedestals. "${gloat[1]}" ${enemy.boss} finishes. ${ucInit(gPron(enemy,"possessive"))} forces ${rivalpresence ? ` led by ${rival} `: ``}charge you while
        ${gPron(enemy,"subject")} continues the ritual.<br><br>The time has come for your final confrontation!`}
        else {prologue = `${changeOfPlans(trail,finalboss,enemy,stage)}<br><br>
        ${trail}, you reach the ${evilPlace()} nestled deep in in the wilds - to find ${enemy.boss} and ${gPron(enemy,"possessive")} forces already starting the ritual.<br><br>"${gloat[0]}" ${enemy.boss} calls with confidence, ${gPron(enemy,"possessive")} voice echoing off the stone walls.
        You see the temple is surrounded by multiple pedestals, each with a mysterious ${artefact} placed on top. The ${artefact}s are etched with a series of ${mysticalSynonym()} images.
        Thinking that these may be part of the ritual, you must remove them from their pedestals. ${rivalpresence ? `${rivalboost ? `${rival}, possessed by a supernatural force, moves in to intercept you. ` : `${rival} eyes you from ${possessiveSuffix(enemy.boss)} side. `}` : ``}"Your efforts are futile!" ${enemy.boss} calls out. ${ucInit(gPron(enemy,"possessive"))} forces charge you while
        ${gPron(enemy,"subject")} continues the ritual.`}
    break;
    
    case "Under Destruction":
        if (knowledge != "clueless" && masterplan == "actsofterror") {
        prologue = `${trail}, you find out that ${enemy.boss} is going to bring the ${randFrom(["White House","Pentagon","police headquarters","Citadel HQ","city hall"])} down! ${ucInit(gPron(enemy,"subject"))} has set enough explosives inside a part of the building closed for renovation to bring down the whole
        building and much of the surrounding area, and it is happening right now. There is no-one but the Global Gladiators who can react with enough speed and
        precision!<br><br>
        You rush to the location, past a few confused security with the assistance of Citadel agents. In the constuction area, you find ${enemy.boss} ${rivalpresence ? `and ${rival} ` : ``}along with the ${enemy.minions} of the ${enemy.name}. "Too late, ${defineAddressing(enemy)}!"
        ${gPron(enemy,"subject")} shouts. "The whole building will go down, and you will go down with it!"`}
        else if (knowledge != "clueless" && masterplan == "illegalgains") {
        prologue = `${trail}, you find out that the ${enemy.name} has gone through a lot of trouble to aquire a large building complex with very little investments, and is planning to level the place, having
        planted enough evidence that the ${competitor.name} will take the blame, and you know you cannot disprove it. The value of this scheme is unbelievable, and or their reach and power will grow exponentially should they succeed. You move quickly to the location.<br><br>
        You arrive, and find ${enemy.boss} ${rivalpresence ? `and ${rival} ` : ``}setting up the last of the explosives, along with ${enemy.minions} of the ${enemy.name}. "Too late, ${defineAddressing(enemy)}!"
        ${gPron(enemy,"subject")} shouts. "The whole building will go down, and you will go down with it!"`}
        else {
        prologue = `You open your eyes and find yourself in.. an unfinished construction site? Suddenly, ${enemy.boss} steps out from the shadows. "${gloat[0]}" ${enemy.boss} shouts. 
        "${gloat[1]}" You note that ${enemy.minions} are suddenly blocking every exit, except for the one ${enemy.boss} is guarding. "The whole place is rigged with
        explosives, ${rivalpresence ? `and some would even pay to watch you die!" At that, ${rival} steps into view. ${rivalboost ? `"But I'm a hands-on kind of person," ${rival} adds,
        and moves at you.` : ``}` : `and I will gladly expend some foot soldiers to get to watch you being.. demolished!"`}<br><br>
        No matter if this sounds contrived, you have no choice but to fight your way out - and fast!`};
    break;
    default: 
    prologue = "The stage has no stage intro defined.<br>"
    }
    
    return {prologue: prologue, setup: setup, winepilogue: winepilogue, loseepilogue: loseepilogue}
}

function changeOfPlans(trail,finalboss,enemy,stage) {
    
    
    let newintel = randFrom([
        `There is no time for regrets, and you need to leave the failure of stopping ${finalboss.boss} behind. ${preGamePrologue(stage,enemy).storytext}`,
        `Citadel analysts have gone over every bit of intel you have gathered on ${finalboss.boss}, but have nothing to go on. But there are more pressing concers. ${preGamePrologue(stage,enemy).storytext}`,
        `While you may have lost the fight, the battle is far from over. ${preGamePrologue(stage,enemy).storytext}`,
        `Focusing on ${finalboss.boss} has let other, just as devious issues grow. ${preGamePrologue(stage,enemy).storytext}`
        ])
    
    let conclusion = randFrom([
        `, you slowly come to the conclusion that you have failed to locate ${finalboss.boss}. But suddenly, Agent Fletch contacts you and says: "${newintel}"`,
        `, you decide you need to contact Agent Fletch for assistance, as you don't have a clue where to proceed. "${newintel}"`,
        `, you conclude that ${finalboss.boss} has won this time. ${newintel}`,
        `, you accept your defeat and retreat to Citadel HQ. ${newintel}`,
        `, you realize you will not be able to catch ${finalboss.boss}. Meeting up with Agent Fletch, he says: "${newintel}"`
        ])
    
    conclusion = trail+conclusion
    
    return conclusion
}

function finalResult(stage, enemy, rival, vip = null, result) {
    
    let masterplan = stage.masterplan
    let neutralize
    
    switch (masterplan) {
        case "kidnapping": neutralize = `${vip[0]} has been aquired from the ${enemy.name}`
        break;
        case "personalpower": neutralize = `power levels of the ${enemy.bosstitle} remain in check`
        break;
        case "strengtheningforces": neutralize = `army of the ${enemy.name} has been neutralized`
        break;
        case "actsofterror": neutralize = "plan to destablize the city has been countered"
        break;
        case "illegalgains": neutralize = `plan to fund ${enemy.name} operations has been countered`
        break;
        default: "is stopped."
    }
    
    let winresult = [
        `You have finally beaten the last of the minions of ${enemy.desc}, and try find their defeated boss. But ${gPron(enemy,"subject")} has disappeared! At least the ${neutralize}.`,
        `"The ${neutralize}," you report to Agent Flecth. "But ${enemy.boss} is nowhere to be found."`,
        `"Gladiator?" Agent Fletch's voice sounds in your ear, small and tinny from your damaged communicator. "What's the status?" You press your finger to the comm button. "The ${neutralize}," you respond, breathing heavily. "${enemy.boss} has been defeated but is nowhere to be found. `,
        `"You may have me," ${enemy.boss} says as the Citadel agents surround them. "But I am only one." Agent Fletch approaches. "Say goodbye to your precious ${enemy.name}," he says. ${randFrom([rival,randFrom(enemy.minionnames)])} laughs. "Who do you think you're working for?"`,
        `"You may think you have me," ${enemy.boss} says as the Citadel agents surround them. Suddenly, ${gPron(enemy,"subject")} starts to deteoriorate, and in mere seconds, there's nothing but dust left. Agent Fletch approaches. "It must have been a clone! At least the ${neutralize}, that's a victory in my books."`,
        `In a blinding flash, ${enemy.boss} disappears just as Agent Fletch approaches. "The ${neutralize}," you report. "We may have won the battle, but the war is not over," Agent Fletch says.`,
        `You ensured that the ${neutralize}. As ${possessiveSuffix(enemy.boss)} minions flee, ${gPron(enemy,"subject")} wipes blood from ${gPron(enemy,"possessive")} mouth. "We're not done. This is MY city. The ${enemy.name} never forgets! So you better never show your face here again!" With that, they quickly fled in the darkness.`,
        `With each blow to ${enemy.boss}, ${gPron(enemy,"subject")} attempts to fight you off. Finally, ready to end it all, you swing with what will be your final attack, but suddenly there's blinding flash and  ${gPron(enemy,"subject")}'s gone.`,
        `With ${enemy.boss} defeated, Citadel soldiers secure the area and you return home. Now that the ${neutralize}, the Mayor arranges a parade for the heroes of the city, and most of you get a medal!`,
        `Suddenly, there's a blinding flash and ${possessiveSuffix(enemy.boss)} gone! It's all gone. Shockingly, you're back at Citadel HQ, surrounded by agents all going about their business. Did all that even happen?`,
        `You are lying in the corner, exhausted, all enemies defeated - but their master is nowhere to be found. "You've done a hero's job, Gladiators. I guess you're through, huh?" Agent Fletch asks as he approaches you. "Finished," you answer wearily. "It's too bad we couldn't catch ${enemy.boss}. But then again, do we really ever?"`,
        `Your intense fight takes you to the edge of an unfathomably deep pit. Just as you're about to strike ${enemy.boss} down, ${gPron(enemy,"subject")} dives in, and that's the last you see of ${gPron(enemy,"object")}. For now!`,
        `You are sure you have cornered ${enemy.boss} with no route of escape, when all of a sudden a sleek ${enemy.name} helicopter descends and ${gPron(enemy,"subject")} leaves, dangling from a ladder. "The ${neutralize}, but ${enemy.boss} slipped away," you report to Agent Fletch with your communicator.`,
        `Your body spasms, fighting against the green gel. Unable to breathe, you claw wildly at the hard, translucent surface encasing you. Shadowy figures move about on the other side of the barrier, and suddenly the lid slides open, and you fall to the ground. The lights are blindingly bright to your aching eyes, and you draw air in your lungs. "Welcome, child!" you hear a voice calling. What is happening? Was that a dream?`
        ]
    
    let finisher = randFrom(["Finish them","Show no mercy","End them","Put an end to this","Kill them, and send what remains to Agent Fletch","Wipe them out, all of them","Put a stop to this"])
        
    let gloat = gloatingList(enemy, stage)
    let submission = lastWords(enemy)
    let defiance = defiantEnd(enemy)
    let lastwords = randFrom([submission,defiance])
    let lastthoughts = lastThoughts(enemy)
    
    let loseresult = [
        `"${gloat[0]}" ${enemy.boss} says, arms crossed confidently in front of ${gPron(enemy,"object")}. "${gloat[1]}" ${ucInit(gPron(enemy,"subject"))} turns to face ${rival + " and " + randFrom(enemy.minionnames)}, ${gPron(enemy,"possessive")} final command echoing powerfully off the walls with a sudden finality. "${finisher}!"`,
        `"${gloat[0]}" ${enemy.boss} says as your body is strapped into a large metal apparatus in ${enemy.boss == "Jackal" ? "her" : "Jackal's"} laboratory. "${gloat[1]}"`,
        `"Gladiator?" Agent Fletch's voice sounds in your ear, small and tinny from your damaged communicator." What's the status?" You watch from your place on the floor, unable to respond as ${enemy.boss} returns to ${gPron(enemy,"possessive")} plan.`,
        `"${lastwords[0]}" ${heroSpeech()}. "${lastwords[1]}" ${enemy.boss} laughs wickedly. "${gloat[0]}" ${gPron(enemy,"subject")} gloats. "${gloat[1]}"`,
        `${lastthoughts} ${enemy.boss} laughs wickedly. "${gloat[0]}" ${gPron(enemy,"subject")} gloats. "${gloat[1]}"`,
        `${enemy.boss} pushes you down, forcing you into submission. You try to fight ${gPron(enemy,"object")} off but can't, and instead watch in horror as ${gPron(enemy,"subject")} ${enemy.threat}. Your scream is lost on the winds as ${gPron(enemy,"subject")} extinguishes your life!`,
        `Last of the Gladiators have fallen to ${enemy.boss} and ${gPron(enemy,"possessive")} ${enemy.minions}. "${gloat[0]}" ${gPron(enemy,"subject")} says. "${gloat[1]}" ${ucInit(gPron(enemy,"subject"))} ${enemy.threat}.`,
        `"${gloat[0]}" says ${enemy.boss} as ${gPron(enemy,"subject")} ${enemy.threat}. ${randFrom([`You can only watch, horrified.<br>"${gloat[1]}"`,`"${gloat[1]}"<br><br>${lastthoughts}`])}`,
        `"${gloat[0]}" ${enemy.boss} says, and ${enemy.threat}. Those are the last words you ever hear.`,
        `"Maybe The Master would have a better use for the Gladiators?" ${randFrom(enemy.minionnames)} asks. "No," ${enemy.boss} answers${randFrom([` as ${gPron(enemy,"subject")} ${enemy.threat}`,`, and orders: "${finisher}"`])}.`,
        `You gave all you've got, but it was not enough. Not even close. "${finisher}!" ${enemy.boss} orders ${randFrom(enemy.minionnames)}.`,
        `${enemy.boss} stands over your limp body. "${gloat[0]}" ${gPron(enemy,"subject")} says, as ${gPron(enemy,"possessive")} ${enemy.minions} draw nearer. "${gloat[1]} ${finisher}!" The minions follow the order.`,
        `As you're lying on the ground, bleeding out,${randFrom([``,` ${heroSpeech()}: "${lastwords[0]}", but the ${enemy.bosstitle} cuts you off.`,`${lowerCaseInitial(lastthoughts)}`])} "${gloat[0]}" ${enemy.boss} says. "${gloat[1]}"`,
        `"${gloat[0]}" the ${enemy.bosstitle} says. You don't answer anything. ${lastthoughts} ${enemy.boss} goes on: "${gloat[1]}" ${ucInit(gPron(enemy,"subject"))} ${enemy.threat}.`,
        `"${gloat[0]}" ${enemy.boss} shouts. ${ucInit(gPron(enemy,"subject"))} ${enemy.threat}. "${gloat[1]}"`,
        `"${gloat[0]}" ${enemy.boss} says, hellfire twinkling visibly in ${gPron(enemy,"possessive")} eyes. "${gloat[1]}"`,
        `You are lying on the ground, defeated. "${finisher}!" ${enemy.boss} orders${randFrom([` ${gPron(enemy,"possessive")} goons.`,`. ${lastthoughts}`])}`,
        `You try to stagger away from your defeat. "${gloat[0]}" ${enemy.boss} growls, while ${gPron(enemy,"subject")} comes at you, unrelenting. "${gloat[1]}"`,
        `With ${gPron(enemy,"possessive")} right hand, ${enemy.boss} grabs your face and pushes your aching body, sapped of all strength, slowly backward toward a bottomless chasm. "${gloat[0]}" ${gPron(enemy,"subject")} says. "${gloat[1]}"` ,
        `Agent Fletch and Citadel soldiers have arrived just a few moments too late. "${submission[0]}" ${heroSpeech()}, and fall forever silent. Fletch lets out a scream of despairing anguish, knowing you were senselessly lost because of miscommunications and bad timing.`,
        `Agent Fletch finds you broken and battered where ${enemy.boss} left you. "${submission[0]}" ${heroSpeech()}. "${submission[1]}"<br><br>You close your eyes slowly and your head goes limp.`,
        `"${finisher}!" ${enemy.boss} orders. The ${enemy.minions} remorselessly beat you until you feel nothing.`,
        `${enemy.boss} looks at you, lying at ${gPron(enemy,"possessive")} feet. "${gloat[0]}" ${gPron(enemy,"subject")} says, looking disappointedly at you. "${gloat[1]}${randFrom([` ${finisher}." ${randFrom(enemy.minionnames)} steps closer.`,`" ${ucInit(gPron(enemy,"subject"))} ${enemy.threat}.`])}`,
        `"${lastwords[0]}" ${heroSpeech()}. "${lastwords[1]}"<br><br>"${gloat[0]}" ${enemy.boss} answers. "${gloat[1]}"`,
        `Citadel aircraft speeds you to medical care, but you know it is too late. "${submission[0]}" ${heroSpeech()} to Agent Fletch, at your side.<br><br>"${submission[1]}"`,
        `"Gladiator?" Agent Fletch's voice penetrates your fading mind. "${submission[0]}" ${heroSpeech()}, before the darkness overcomes you.`,
        `You are lying on your back, the pain preventing you from moving. ${randFrom([`${lastthoughts}. and this is the last thought you will ever have.`,`"${submission[0]}" ${heroSpeech()} to no-one in particular as you draw your last breath. "${submission[1]}"`])}`,
        `Citadel soldiers are clearing the area from the aftermath of your fight, long after victorious ${enemy.boss} has left. "${submission[0]}" ${heroSpeech()} to Agent Fletch. "Don't try to speak," he answers, but you know it will not make any difference. ${ucInit(heroSpeech())} your last words: "${submission[1]}"`,
        `"Finish them off, ${enemy.boss}! Do it now!" shouts ${randFrom(enemy.minionnames)}. "${gloat[0]}" ${enemy.boss} says, and ${enemy.threat}. "${gloat[1]}"`,
        `"${randFrom([`No more, ${enemy.boss}! Grant me mercy!" you shout.`,`${lastwords[0]}" ${heroSpeech()}, "${lastwords[1]}"`])} ${enemy.boss} ${enemy.threat}${randFrom([`. "I thought you were made of sterner stuff," ${gPron(enemy,"subject")} responds.`,`, and orders ${gPron(enemy,"possessive")} minions: "${finisher}!"`])}`,
        `${enemy.boss} has you pinned. Without a word, ${gPron(enemy,"subject")} ${enemy.threat}. With grim determination in ${gPron(enemy,"possessive")} eyes ${gPron(enemy,"subject")} ends your life.`,
        `"${defiance[0]} ${enemy.boss}," you spit defiantly in the face of the victorious ${enemy.bosstitle}. "${defiance[1]}"<br><br>"${gloat[0]}" ${gPron(enemy,"subject")} answers. "${gloat[1]}"`,
        `"${lastwords[0]}" ${heroSpeech()}, but ${enemy.boss} cuts you off by grabbing your throat. "${gloat[0]}" ${gPron(enemy,"subject")} says and starts to squeeze the life out of you. "${gloat[1]}"`,
        `Suddenly, there's a blinding flash and ${possessiveSuffix(enemy.boss)} gone! It's all gone. Shockingly, you're back at Citadel HQ, surrounded by agents all going about their business. Did all that even happen?`,
        `Your body spasms, fighting against the green gel. Unable to breathe, you claw wildly at the hard, translucent surface encasing you. Shadowy figures move about on the other side of the barrier, and suddenly the lid slides open, and you fall to the ground. The lights are blindingly bright to your aching eyes, and you draw air in your lungs. "Welcome, my children!" you hear a woman calling. What is happening? Was that a dream?`,
        ]

    let finalresult
    
    result == 1 ? finalresult = randFrom(winresult) : finalresult = randFrom(loseresult)
    
    return finalresult
    
}

function heroSpeech () {
    let effort = [` `,` manage to `,]
    let speak = [`cough out`,`wheeze`,`utter`,`gasp`,`say`,`hiss`,`groan`]
    let descriptive = [`with your last bit of strength`,`with a smile`,`through bloodied lips`]

    return "you" + randFrom(effort) + randFrom(speak)
}

function defiantEnd (enemy) {
    let defiance = [
        [`You're sick,`,`Where do people like you come from?`],
        [`You won't get away with this!`,`Citadel will make sure of it!`],
        [`No matter where you or what you do,`,`You're going down.`],
        [`When beasts like you have devoured each other,`,`The world will belong again to the little people.`],
        [`Come on down. You haven't got a chance,`,`Come on!`],
        [`Come on, I love it. Bring on some more!`,`Come on, ${enemy.boss}!`],
        [`Just finish this,`,`What are you waiting for?`],
        [`Was that all you got?`,`I excpected more of you.`],
        [`One day another Gladiator will rise`,`and you shall fall.`],
        [`It is better to burn out,`,`Than to fade away.`]
    ]

    return randFrom(defiance)
}

function lastWords(enemy) {
    let lastwords = [
        [`Tomorrow, at sunrise..`,`I shall no longer be here.`],
        [`I was not supposed to die, not here..`,`Not like this.`],
        [`Do not grieve,`,`One day another Gladiator will rise and uses the power of ${randFrom(["Street Masters","the Tiger"])} to light the darkest hour.`],
        [`It's over,`,`Goodbye.`],
        [`One never knows the ending,`,`One has to die to know exactly what happens after.`],
        [`If I'll close my eyes now,`,`I'm not going to wake up.`],
        [`I must go in..`,`The fog is rising.`],
        [`Tired..`,`So.. tired.`],
        [`I was supposed to die in France..`,`I never even saw France.`],
        [`Goodbye..`,`Farewell.`],
        [`You always were a pain in the rear,`,`It was nice knowing you.`],
        [`I'm afraid,`,`And I'm glad to be afraid.`],
        [`I'm a leaf on the wind,`,`Watch how I..`],
        [`It's been a funny sort of day,`,`Isn't it?`],
        [`It's..`,`Beautiful.`],
        [`I'll see you in another life,`,`When we are both Tigers.`],
        [`Death smiles at us all,`,`All you can do is to smile back.`],
        [`I got what everyone gets,`,`I got a lifetime`],
        [`Time..`,`To die.`],
        [`My only hope,`,`Is that the next team will do what I could not.`],
        [`My only regret is that I failed to stop the ${possessiveSuffix(enemy.name)} scheme,`,`And my failure has doomed the city.`],
        [`I can only think of all the innocent lives that will perish,`,`Because of this insane scheme I failed to thwart.`],
        [`I gave everything,`,`I have no regrets.`],
        [`When death comes,`,`It will come as an old friend.`],
        [`To dream, perchance to sleep,`,`Aye, there's the rub.`]
    ]

    return randFrom(lastwords)
}

function lastThoughts(enemy) {
    let lastthoughts = [
        `You can only think of all the innocent lives that will perish because of this insane scheme you failed to thwart.`,
        `Your only regret is that you failed to stop the ${possessiveSuffix(enemy.name)} scheme, and your failure has doomed the city.`,
        `From out of nowhere a thought crosses your mind: one day another Gladiator will rise and uses the power of ${randFrom(["Street Masters","the Tiger"])} to light the darkest hour.`,
        `You can only think that if you'll close your eyes now, you're not going to wake up.`,
        `You think to yourself it's been a funny sort of day in a way.`,
        `Your only hope is that the next team Agent Fletch will send will do what you could not.`,
        `If only, you think, you had a few more coins to insert.`,
        `You think that even with a lifetime of preparation, you could never have been ready.`,
        `You have a fleeting moment where you think this is not really happening - these are someone else's memories.`
    ]

    return randFrom(lastthoughts)
}

function gloatingList(enemy, stage) {
    let gloating = [
        ["You fought well,","There will be no-one to mourn your death."],
        [`${enemy.boss == "Jackal" ? "I" : "Jackal"} couldn't have asked for better specimens,`,`It's time you provide your skills and abilities to the ${enemy.name}.`],
        ["I'm not even going to kill you myself!","I'll let my minions take care of that."],
        [`Everything comes to ${gPron(enemy,"object")} who waits,`,"And I have waited for so very long for this moment."],
        [`Where are they now? Where are your friends now?`, `Tell me about the loneliness of good. Is it equal to the loneliness of evil?`],
        [`This is finally turning into my kind of day,`,`The monument to my humble genius is now complete!`],
        [`Mwahahaha!`,`I'm so powerful I even impress myself!`],
        [`Please meet your end with dignity,`,`I hate whiners.`],
        [`Only you were brave - or stupid enough to oppose the ${enemy.name}.`,`The city is now under martial law.. and I am the marshal.`],
        [`This is almost too easy,`,`Such heroic nonsense.`],
        [`${ucInit(defineAddressing(enemy))}!`,`Why throw away your lives so recklessly?`],
        [`I would've waited an eternity for this,`,`It's over, ${defineAddressing(enemy)}.`],
        [`It's a pity you Gladiators die so easily,`,`Or I might have a sense of satisfaction now.`],
        [`Come now, ${defineAddressing(enemy)},`,`We all must die sometime.`],
        [`You don't have to do this," you say. "People always say the same thing,`, `They say: 'You don't have to do this'.`],
        [`Have you ever seen blood in the moonlight, ${defineAddressing(enemy)}?`,`It appears quite black.`],
        [`Do you like life?" ${enemy.boss} asks. "Yes," you answer. "That's good,`,`Because I take no pleasure in taking a life if it’s from a person who doesn’t care about it.`],
        [`You should've moved to a Brook City, or somewhere the rule of law still exists,`,`You will not survive here. You are not a ${enemy.name == "Golden Dragons" ? `dragon`:`tiger`}, and this is a land of ${enemy.name == "Golden Dragons" ? `dragons`:`tigers`} now.`],
        [`It looks like you have run out of luck,`,`How dare you challenge us?!`],
        [`Proud of yourself, ${randFrom([defineAddressing(enemy),"little Gladiator"])}?`,`Time to die!`],
        [`You must make a friend of horror,`,`Horror and moral terror are your friends. If they are not, then they are enemies to be feared.`],
        [`I don't blame myself,`,`You see, ${defineAddressing(enemy)}, most people never have to face the fact that, at the right time and the right place, they're capable of anything.`],
        [`There are times when I...`,`I look at people and I see nothing worth liking.`],
        [`Don't you think of your victims?" you ask. "You think there are victims? Don't be melodramatic,`,`Look, people are of no consequence. Would you really feel any pity if any of them would be lost?`],
        [`Everything I touch becomes food for my hunger,`,`My hunger for power!`],
        [`I will win by any means!`,`By any cost!`],
        [`Power flows to the one who knows how,`,`Desire is not enough.`],
        [`This is becoming a wonderful day for evil,`,`Soon I shall have all in my power!`],
        [`You were always too late,`,`All your efforts were futile.`],
        [`Won't you please think of the children, ${enemy.boss}?" you plead the ${enemy.bosstitle} of the ${enemy.name}. "What did the children ever do for me?`,`Nothing that I should mind their welfare for.`],
        [`Why are you doing this? What is there to gain?" you ask the ${enemy.bosstitle} of the ${enemy.name}. "You don't always need a plan,`,`Sometimes you just need to breathe, trust, let go, and see what happens..`],
        [`You've come to the wrong place, ${defineAddressing(enemy)},`,`You will not leave here alive.`],
        [`I had heard you were sticking your nose in my business,`,`Fortunately, your efforts have been wasted.`],
        [`I was counting on you to come to try your pitiful mission, but I have news for you,`,`None of you will leave this place alive!`],
        [`I must possess all,`,`Or I possess nothing!`],
        [`I ache to smash you out of existence!`,`To drive your cursed face from my memories forever!`],
        [`You can't win," you tell ${enemy.boss} wearily. "I've already won this this the old-fashioned way, the tried and true way,`,`I cheated!`],
        [`I am the Alpha and the Omega. Death and Rebirth,`,`And, as you die, so will I be reborn!`],
        [`Welcome to your doom, ${defineAddressing(enemy)},`,`I would have waited an eternity for this!`],
        [`This is how it begins!`,`The ${enemy.name} triumphant at last!`],
        [`How I loathe heroes!`,`Always getting in the way and acting so.. heroic!`],
        [`I cannot be defeated,`,`I defeat all.`],
        [`I fight to win, for me!`,`For me!`],
        [`I defeat all,`,`Until the end.`],
        [`To survive a war,`,`You must become war.`],
        [`You lived for something!`,`But you will die for nothing.`],
        [`Game over, Gladiators! Game over!`,`What are you going to do now?`],
        [`Gladiators! You know, I.. I expected more from you,`,`I thought you'd be tougher than this.`],
        [`Wait!" you shout.<br><br>"Wait? Are you kidding me? Did you just say "Wait"?`,`You know what? I expected more from you. Wait for what? Wait for me to change my mind?`],
        [`Any last words?", ${enemy.boss} asks. You deprive ${gPron(enemy,"object")} of an answer. "Any?`,`Thought as much.`],
        [`Have you any last words?`,`Before I dispatch you?`],
        [`You're quite the piece of work, ${defineAddressing(enemy)},`,`But I am superior!`],
        [`You think you can take on me?`,`You need an army to take on me! You hear?! Who do you think you're dealing with?!`],
        [`When you have a chance to kill someone,`,`Don't hesitate.`],
        [`You've gotta ask yourself one question: Do I feel lucky?`,`Well, do you, ${defineAddressing(enemy)}?`],
        [`I feel no pity, or remorse, or fear,`,`And I absolutely will not stop - ever - until ${enemy.name} rules over everything!`],
        [`Did you believe I would let you on my trail by mistake?`,`Now face your death!`],
        [`Death smiles at us all,`,`All you can do is to smile back.`],
        [`${ucInit(defineAddressing(enemy))},`,`I thought you were made of sterner stuff.`],
        [`Why, ${defineAddressing(enemy)}? Why do you do it? Why keep fighting?`,`Do you believe you're fighting for something? Can you tell me what it is? Do you even know?`],
        [`You must be able to see it. You must know it by now,`,`You can't win. It's pointless to keep fighting. Why do you persist?`],
        [`You won't get away with this," you tell ${enemy.boss} "I won't get away with this?`,`I already have!`],
        [`You have no idea how much I've wanted to do this.`,`You have no idea.`],
        [`You'll die for your efforts,`,`While I'm dying for some lunch.`],
        [`You Gladiators are always rushing,`,`Rushing to your death!`],
        [`You've dug your own grave,`,`You're dead!`],
        [`I am your death,`,`Are you prepared?`],
        [`Death is the greatest kick,`,`That's why I saved it for last!`],
        [`I've never been beat. A lot of Gladiators have have tried.`,`Seems to me there's more Gladiators lately than ever.`],
        [`Frankly, I must tell you how I find a Gladiator that lives,`,`Offensive.`],
        [`Remember, I AM the ${enemy.name},`,`I AM ${enemy.boss.toUpperCase()}!`],
        [`You cannot win, you devil", you grunt. "You're wrong,`,`I cannot lose.`],
        [`Come to me, ${defineAddressing(enemy)}.`,`Kneel before ${randFrom([enemy.boss,`the ${enemy.name}`])}!`],
        [`Yes!`,`Let this be our final battle!`],
        [`It is not too late to undo this madness," you tell ${enemy.boss}. "Madness! I demand of destitution, shame and loneliness of scorn!`, `It is my destiny! It is my right!`],
        [`Who crave for power look back over the mistakes of their lives, pile them all together and call it destiny," you say. "Thank you for that bit of philosophy, ${defineAddressing(enemy)},`,`Yes, this is my destiny! Now and forever!`],
        [`How unpleasant it is to see you,`,`You sniveling cowards!`],
        [`I don't like to feel good,`,`I like to feel evil!`],
        [`If you die,`,`You die.`],
        [`I'm judging you,`,`I'm judging you, and I find you.. wanting.`],
        [`They say violence is never the answer,`,`They are wrong.`],
        [`You want to kill me, don't you ${defineAddressing(enemy)}?`,`Get a number and get in line.`],
        ]
        
        let gloat = randFrom(gloating) 
        
        return randFrom([gloat,(stage.hasOwnProperty("gloat") ? randFrom(stage.gloat) : gloat),(enemy.hasOwnProperty("gloat") ? randFrom(enemy.gloat) : gloat)])

}

function laconicStatement(enemy) {
    laconicstatements = [
        `${ucInit(gPron(enemy, "subject"))} might be right, but you have to try and stop ${gPron(enemy, "object")}.`,
        "You agree to disagree.",
        `You don't know if this a fight you can win, but you have to try to stop ${gPron(enemy, "object")}.`,
        "While there is life, there is hope, you remind yourself.",
        "You've heard that line before.",
        "This isn't going to be easy.",
        "You shrug. It doesn't need to be this way, but it always is.",
        `You have a feeling ${gPron(enemy, "subject")} might be right.`,
        `${ucInit(gPron(enemy, "subject"))} won't get away with that - not this time, that's for sure.`,
        "That's not a completely bad point, you think to yourself.",
        "You will never give up!",
        "You don't plan to let these criminals get away.",
        "You know the dark can embrace the light, but never eclipse it.",
        "You begin to wonder if you're in over your head..",
        `${ucInit(gPron(enemy,"possessive"))} plan ends here!`,
        `"Your plan ends here, ${enemy.boss}!" you say, and drop in your ready stance.`
    ]

    return randFrom([randFrom(laconicstatements), ``])
}

function randomArtefact() {
    return randFrom(["urn", "artefact", "relic", "vestige", "sculpture", "statue", "orb"])
}

function referenceText(gladiators, allygroup, allymotivation, rivalgroup, rivalmotivation, finalboss) {

    let ourheroes = "This story is best experienced with "
    for (i = 0; i < gladiators.length; i++) {
        ourheroes = ourheroes + "<b>" + gladiators[i].name + "</b>" + (i == gladiators.length-2 ? " and " : ", ")
    }

    gladiators.length > 0 ? ourheroes = ourheroes.substring(0, ourheroes.length - 2) + 
    ". You can pick any Global Gladiators for this story, but some might make more sense than others." : 
    ourheroes = `You can pick any Global Gladiators for this story, but some might make more sense than others.<br>`


    let personalsetup = ""
    for (i = 0; i < gladiators.length; i++) {
        if (gladiators[i].hasOwnProperty('instructions'))
        personalsetup = personalsetup + " " + gladiators[i].instructions + " "
    }

    ourheroes = ourheroes + personalsetup + "<br>"

    let allytext = motivationText(allymotivation, allygroup, "Ally", finalboss, gladiators)

    let rivaltext = motivationText(rivalmotivation, rivalgroup, "Rival", finalboss, gladiators)

    let allysetup = "Put"
    
    for (i = 0; i < allygroup.length; i++) {
        allysetup = allysetup + " " + allygroup[i].name + " (Ally)" + (i == allygroup.length-2 ? " and " : ", ")
    }

    allygroup.length > 0 ? allysetup = allysetup.substring(0, allysetup.length - 2) + " in the Story Pool." : allysetup = `You can pick any Allies for this story, but some might make more sense than others.`

    let rivalsetup = "Put"
    
    for (i = 0; i < rivalgroup.length; i++) {
        rivalsetup = rivalsetup + " " + rivalgroup[i].name + " (Rival)" + (i == rivalgroup.length-2 ? " and " : ", ")
    }

    rivalgroup.length > 0 ? rivalsetup = rivalsetup.substring(0, rivalsetup.length - 2) + " in the Story Pool." : rivalsetup = `You can pick any Allies for this story, but some might make more sense than others.`

    let text = []

    text.push(ourheroes)
    text.push(allytext)
    text.push(rivaltext)
    text.push(allysetup)
    text.push(rivalsetup)

    return text
}

function numberAsString(number) {
    switch (number) {
        case 1: number = "one";
        break;
        case 2: number = "two";
        break;
        case 3: number = "three";
        break;
        case 4: number = "four"
        break;
        default: number
    }
    return number
}

function motivationText(motivation, group, stance, finalboss, gladiators) {

gladiators = _.map(gladiators, 'name')

let bossclone = _.map(group, 'name').includes(finalboss.boss)

let redemption = ["Kemono", "Shadow", "Jackal", "Juan", "Yokai", "Tlazolteotl", "Mack", "Ah Long", "Dmitri"]

let personalstory_ally = `${possessiveSuffix(motivation)} personal goals have taken the same path as your mission. ${_.map(group, 'name').includes(motivation) ? `${motivation}${group.length == 2 ? `, along with ${(_.map(group, 'name')).filter(character => character != motivation)}` : ""} will accompany you on your mission.`: `${possessiveSuffix(motivation)} closest ally accompanies you on your mission.`} `

let personalstory_enemy = `${possessiveSuffix(motivation)} personal goals and your mission have opposing paths. ${_.map(group, 'name').includes(motivation) ? `${motivation}${group.length == 2 ? `, along with ${(_.map(group, 'name')).filter(character => character != motivation)}` : ""} will be facing you wherever you mission will take you.`: `${possessiveSuffix(motivation)} closest ally will be facing you wherever your mission will take you.`} `

let text
    switch(motivation) {
            case "Ah Long":
            if (stance == "Ally" && finalboss.boss == "Ah Long" && !gladiators.includes("Ah Long")) {
                text = `The Kingdom has put a clone in Ah Long's place to rule over the Golden Dragons. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "Wan Bo has already shared so much with Ah Long, and together they will fight alongside you for the lost honor of the Dragons." : "He knows there is only one way to convince who is the real Head of the Dragon and regain their lost strength and independence.") : "Wan Bo, who has already shared so much with Ah Long, stands with you to regain the lost honor of the Dragons."}`
            } else if (stance == "Ally" && finalboss.name == "Kingdom" && !gladiators.includes("Ah Long")) {
                text = `The Kingdom is disappointed in Ah Long's performance, and have told they will take over the Golden Dragons from him. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "Ah Long and his closest friend Wan Bo stand together with you to regain the lost strength and independence of the Dragons." : "He knows he will need your help against the Kingdom to regain the lost strength and independence of the Dragons.") : "Wan Bo, who has shared so much with Ah Long, stands with you to regain the lost strength and independence of the Dragons."}` 
            } else if (stance == "Ally") {text = personalstory_ally
            } else if (stance == "Rival" && gladiators.includes("Ah Long")) {
                text = `The Jackal has cloned you multiple times over and one of the clones firmly believes he is the real Ah Long. He thinks there is only one way to convince who is the real Head of the Dragon and regain the favor of the Kingdom.`
            } else if (stance == "Rival" && (gladiators.includes("Jackal"))) {
                text = `Ah Long has disappointed the Kingdom, he is now attempting to regain his lost "strength" and "independence". ${_.map(group, 'name').includes(motivation) ? `` : `He has sent his whelp Wan Bo to fight his battles with you. Such a shame Shadow once thought so highly of them!` }${group.length == 2 ? `His closest ally, Wan Bo, showed some potential, but it seems all of the Dragons are marred with treason. Such a shame!` : ``}`
            } else {text = personalstory_enemy};
            break;
            case "Ah Long of Brook City":
            if (stance == "Ally" && finalboss.boss == "Ah Long" && !gladiators.includes("Ah Long")) {
                text = `The younger Ah Long from the past of Brook City wants to rise as the Head of the Dragon in place of the older Ah Long. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `He, along with Lotus has joined you to face` : `He has joined you to face`) : `He has sent Lotus with you to find`} the Ah Long he believes to be old and tired.`
            } else if (stance == "Ally") {text = personalstory_ally} else if (stance == "Rival" && gladiators.includes("Ah Long")) {
                text = `The younger Ah Long from the past of Brook City wants to rise as the Head of the Dragon in your place. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `He and Lotus will confront you wherever you will go.` : `He will confront you wherever you will go.`}` : `Lotus is following you wherever you will go in order to young Ah Long to learn of your weaknesses.`}`
            } else if (stance == "Rival" && gladiators.includes("Ying Hua")) {
                text = `The younger Ah Long from the past of Brook City knows only of the younger Ying Hua, but understands you are even the greater threat now that you are older and wiser. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `He and Lotus will confront you` : `He has taken as his personal mission`} to take you out before you can take him in.` : `Lotus is following you wherever you go to inform the young Ah Long of your plans.`}`
            } else {text = personalstory_enemy};
            break;
            case "Aztec": text = (stance == "Ally" ? 
            `${group.length == 1 ? "A single warrior" : "A group of warriors"} with the might of the bygone Aztec empire has received a prophecy of the future from ${randFrom(["Mictecacihuatl","Xolotl",])}. The soul of ${finalboss.boss} belongs in Mictlan and ${group.length == 1 ? "this warrior" : "these warriors"} will deliver ${gPron(finalboss, "object")} there!` : 
            `${group.length == 1 ? "A single warrior" : "A group of warriors"} with the might of the bygone Aztec empire has received a prophecy of the future from ${randFrom(["Mictecacihuatl","Xolotl",])}. Your souls belong in Mictlan and ${group.length == 1 ? "this warrior" : "these warriors"} will deliver you there!`);
            break;
            case "Beast": text = (stance == "Ally" ? 
            `${group.length == 1 ? "This individual is" : "These individuals are"} little more than savage beasts, but ${group.length == 1 ? "this one" : "these"} seem to have been tamed - for now.
            The strength of the ${group.length == 1 ? "beast" : "beasts"} is welcome if unnerving addition to your mission to end ${possessiveSuffix(finalboss.boss)} plans.` : 
            `${group.length == 1 ? "This individual is" : "These individuals are"} little more than savage beasts, and ${group.length == 1 ? "this beast is" : "these are"} in the tight leash of ${finalboss.boss}, who has sent them to hunt you. 
            ${group.length == 1 ? "It" : "They"} won't stop hunting their quarry.`);
            break;
            case "Blade": text = (stance == "Ally" ? 
            `A wandering ${group.length == 1 ? "blademaster" : "host of blademasters"} sees ${finalboss.boss} as an opportunity to test their mettle, and has decided to walk with you.` : 
            `A wandering ${group.length == 1 ? "blademaster" : "host of blademasters"} sees you as an opportunity to test their mettle. They seem to show up wherever you go.`);
            break;
            case "Black Ops": text = (stance == "Ally" ? `Citadel has many spies and assassins in their contacts, and a ${group.length == 1 ? "single operative" : "team of specialists"} 
            has been assigned with you to eliminate the threat ${finalboss.boss} poses.` : 
            `The world is full of shadowy organizations with spies and assassins everywhere. A mysterious malefactor has sent a 
            ${group.length == 1 ? "single operative" : "team of specialists"} to eliminate the Citadel's finest. They will not stop until you are dead.`);
            break;
            case "Boss": text = (stance == "Ally" ? 
            `A secret cabal of powerful and influential individuals have decided that ${possessiveSuffix(finalboss.boss)} plans are a threat to the long game, and fixing it is far too hazardous for them to leave it to the 
            rank and file of their organizations - or to you. 
            ${group.length == 1 ? `${bossclone ? `The have created a clone of ${finalboss.boss} who has` : `${group[0].name} has`}` : `${bossclone ? `They have created a clone of ${finalboss.boss} and have` : `Several of them have`}`} 
            joined you in your mission whether you wish it or not.` : 
            `Whatever ${possessiveSuffix(finalboss.boss)} endgame is, it will serve the powerful men and women of different shadowy organizations well. You are considered such a threat that this cabal
            has ${bossclone ? `created a clone of ${finalboss.boss}` : `decided no mere mooks are enough`} to stop you.`);
            break;
            case "Brandon":
            if (stance == "Ally" && finalboss.boss == "Ah Long" && !gladiators.includes("Ah Long") && !gladiators.includes("Brandon")) {
                text = `The movie star Brandon does not care about his career or public anymore. He is on a mission of revenge against Ah Long, and for everything he has done against Brandon's family. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "Isabella, a fan of his, has joined to help him find his true potential." : "") : "Isabella, Brandon's fan has joined you, as she wants to help Brandon find Ah Long."}`
            } else if (stance == "Ally" && finalboss.boss != "Ah Long" && !gladiators.includes("Brandon")) {
                text = `The tabloids speculate the movie star Brandon is a fraud and his martial arts are just for show, and he is set to prove himself and make a comeback. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "Isabella, a fan of his, has joined to help him regain the favor of the studios." : "The test footage he will get with you must convince the studio executives of his talent!") : "Isabella, Brandon's fan tries to convince you to help him get some test footage."}`
            } else if (stance == "Ally") {text = personalstory_ally} else if (stance == "Rival" && gladiators.includes("Ah Long") && !gladiators.includes("Brandon")) {
                text = `The movie star Brandon does not care about his career or public anymore. He is on a mission of revenge against you, and for everything you have done against his family. ${_.map(group, 'name').includes(motivation) ? `` : `His fan Isabella tries to help by getting you first!`}${group.length == 2 ? "Isabella, a fan of his, has joined to help him find his true potential." : ``}`
            } else if (stance == "Rival" && !gladiators.includes("Brandon")) {
                text = `The tabloids speculate the movie star Brandon is a fraud and his martial arts are just for show, and he is set to prove himself and make a comeback. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "Isabella, a fan of his, has joined to help him to get test footage out of you to regain the favor of the studios." : "The test footage he will get out of you must convince the studio executives of his talent!") : "Isabella, Brandon's fan risks everything trying get some suitably impressive test footage out of you to be his co-star."}`
            } else {text = personalstory_enemy};
            break;            
            case "Brook City": text = (stance == "Ally" ? 
            `${group.length == 1 ? "A citizen" : "A group of citizens"} from Brook City's past have arrived to the future, and they are not happy with what they see. Their only hope of getting back seems to lie in stopping ${finalboss.boss}.` : 
            `${group.length == 1 ? "A citizen" : "A group of citizens"} from Brook City's past have arrived to the future, and they are not happy with what they see. Their only hope of getting back seems to lie in stopping you.`);
            break;
            case "Brotherhood": text = (stance == "Ally" ? 
            `${bossclone ? `"An impostor has taken over my organization, and he must go down," Dmitri tells you. You're wary of the Brotherhood, 
            but you think you can count on them this one time. But which one is the clone?`: `"The enemy of my enemy is my friend, and a friend with money is a friend indeed," ${group[0].name} tells you. You're wary of the Brotherhood, 
            but there is no job they wouldn't handle for the right price, and you can't deny their effectiveness.`}` : 
            `Your intel tells you that the mercenaries of the Brotherhood have been paid to make sure you will not interfere with ${possessiveSuffix(finalboss.boss)} plans, 
            and you can be certain they will not stop until you have been eliminated.`);
            break;
            case "Cartel": text = (stance == "Ally" ?
            `${bossclone ? `"An impostor has taken over my family, and he must go down," Juan tells you. Juan and his Cartel might be criminals, 
            but you think you can count on them this one time. But which one is the clone?`: `"${finalboss.boss} puts the family at risk, and we will not allow that," ${group[0].name} says, and continues: "The enemy of our enemy is our friend." 
            Juan and his Cartel might be criminals, but at least you know they are honorable and willing to even die for their "family".`}` : 
            `You have been a thorn in the side of the Cartel for a long time. While you are busy with your mission to get ${finalboss.boss}, they have sent a 
            ${group.length == 1 ? "single enforcer" : "group of enforcers"} to remove that thorn.`);
            break;
            case "Celebrity": text = (stance == "Ally" ? 
            `Some celebrities, socialites and influencers want all the attention, and ${group.length == 1 ? "this one is" : `these ${numberAsString(group.lenth)} are`} the worst. With  
            ${group.length == 1 ? "this fool" : "these fools"} appearing everywhere for cheap publicity, you just hope nobody gets hurt.` : 
            `Some celebrities, socialites and influencers want all the attention, and ${group.length == 1 ? "this one is" : `these ${numberAsString(group.lenth)} are`} the worst. With  
            ${group.length == 1 ? "this fool" : "these fools"} appearing everywhere for cheap publicity, you're afraid someone will get hurt.. not that it would deter them.`);
            break;
            case "Chi": text = (stance == "Ally" ?
            `${group.length == 1 ? "This warriors is" : "These warriors are"} privy to ${mysticalSynonym()} Chi powers. Their deep understanding of the flow of 
            ${mysticalSynonym()} energies that flow through all life has revealed to them that ${finalboss.boss} is a great disturbance in this force. For the balance to be regained ${gPron(finalboss,"subject")} must be stopped.` : 
            `${group.length == 1 ? "This warrior is" : "These warriors are"} privy to ${mysticalSynonym()} Chi powers. Their deep understanding of the flow of 
            ${mysticalSynonym()} energies that flow through all life has revealed to them that you are a great disturbance in this force. For the balance to be regained you must be stopped.`);
            break;
            case "Cifarelli": text = (stance == "Ally" ?
            `The ongoing plans of ${finalboss.boss} risks the stability that the operation of the Cifarelli family requires, and a ${group.length == 1 ? "single enforcer" : "group of enforcers"} 
            has been sent to crush the opposition. You're lucky to have them on your side!` : 
            `The Cifarelli family sees the ongoing plans of ${finalboss.boss} a perfect time to hit law enforcement everywhere, and Citadel is no exception to their plans. A 
            ${group.length == 1 ? "single enforcer" : "group of enforcers"} has been sent to take you out.`);
            break;
            case "Clone": text = (stance == "Ally" ?
            `With the multitude of clones unleashed upon the world from Jackal's secret experiments, you are bound to run into some from time to time that 
            ${finalboss.boss == "Jackal" ? `seek their creator and want more life` : `would ally themselves to your cause`}.` : 
            `With the multitude of clones unleashed upon the world from Jackal's secret experiments, sometimes you find surprising parties of people working together, 
            furthering the goals of the Kingdom.`);
            break;
            case "Competitor": text = (stance == "Ally" ? 
            `${group.length == 1 ? "This gladiator is not a Global Gladiator, but a seasoned fighter" : "These gladiators are not Global Gladiators, but seasoned fighters"} 
            of competetive - and deadly - events. Now they pursue the victory of the ultimate challenge: ${finalboss.boss}!` :
            `${group.length == 1 ? "This gladiator is not a Global Gladiator, but a seasoned fighter" : "These gladiators are not Global Gladiators, but seasoned fighters"} 
            of competetive - and deadly - events. Now they pursue the victory of the ultimate challenge: you!`);
            break;
            case "Dark Matter": text = (stance == "Ally" ? 
            `${bossclone ? `"My mother is insane, and evil to an extent you cannot begin to understand," an exact replica of Jackal tells you. You're extremely wary of the Kingdom, but you think you can count on Jackal this one time. But which one is really the clone?`: `The Jackal feels ${finalboss.boss} interferes with her research, and 
            ${_.map(group, 'name').includes("Jackal") ? `${group.length == 1 ? "has joined you" : "leads her creations alongside you"}` : `has sent a ${group.length == 1 ? "creation of hers" : "force of her creations"} alongside you`} 
            to remove the interference.`}` : 
            `${bossclone ? `The Jackal knows the Citadel will move against her, and has created a clone of herself${group.length == 1 ? "" : " to lead her creations"} 
            to eliminate the threat.`: `The Jackal feels you interfere with her research, and 
            ${_.map(group, 'name').includes("Jackal") ? `${group.length == 1 ? "has left her fortress" : "leads her creations"}` : `has sent a persistent ${group.length == 1 ? "creation of hers" : "force of her creations"}`} 
            to remove the interference.`}`);
            break;
            case "Dmitri":
            if (stance == "Ally" && finalboss.boss == "Dmitri" && !gladiators.includes("Dmitri")) {
                text = `Dmitri, the true leader of the Brotherhood has realized that following Kingdom is not true to Brotherhood's mission. He believes they are better than mere soldiers of fortune, and is determined to take down whatever puppet the Kingdom has put in his place.`
            } else if (stance == "Ally") {text = personalstory_ally} else {text = personalstory_enemy};
            break;            
            case "Extraplanar": text = (stance == "Ally" ? 
            `${group.length == 1 ? "This individual is" : "These individuals are"} privy to the secrets of planes of existence beyond yours. For whatever ${mysticalSynonym()} 
            reason, the stars are right for them to stop ${finalboss.boss}, no matter the cost.` : 
            `${group.length == 1 ? "This individual is" : "These individuals are"} privy to the secrets of planes of existence beyond yours. For whatever ${mysticalSynonym()} 
            reason, the stars are right for them to stop you, no matter the cost.`);
            break;
            case "Fraud": text = (stance == "Ally" ? 
            `The lost reputation and ridicule of some unlucky or incapable fighters has driven them to desperation, and now they believe the only way to restore their name 
            is to defeat ${finalboss.boss}. You just hope nobody gets too badly hurt.` : 
            `The lost reputation and ridicule of some unlucky or incapable fighters has driven them to desperation, and ${finalboss.boss} has manipulated them
            think that the only way to restore their name is to defeat you. Sadly the fools absolutely will not stop hounding you no matter what you do.`);
            break;
            case "Gabriel":
            if (stance == "Ally" && finalboss.boss == "Jackal" && !gladiators.includes("Jackal") && !gladiators.includes("Gabriel")) {
                text = `Gabriel has received a letter from his sister Regina that informed him she is been held by the Jackal. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "He has joined you with his friend Drago to find his sister." : "He hopes you can help him locate his sister.") : "His mute friend Drago has joined you to help Gabriel's sister."}`
            } else if (stance == "Ally" && !gladiators.includes(finalboss.boss)) {
                text = `Gabriel has received a letter from his sister Regina that informed him she is been held by ${finalboss.boss}. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "He has joined you with his friend Drago to find his sister." : "He hopes you can help him locate his sister.") : "His mute friend Drago has joined you to help Gabriel's sister."}`
            } else if (stance == "Ally") {
                text = `Gabriel has received a letter from his sister Regina that informed him she is been held, but by whom? ${_.map(group, 'name').includes(motivation) ? `${motivation}${group.length == 2 ? `, along with Drago` : ""} will accompany you on your mission in order to find any clues.`: `${possessiveSuffix(motivation)} closest ally Drago accompanies you on your mission to find any clues on her whereabouts.`} `
            } else if (stance == "Rival" && gladiators.includes("Jackal") && !gladiators.includes("Gabriel")) {
                text = `You have apparently captured Gabriel's sister Regina at one point, but you cannot remember this - you have not been yourself. ${_.map(group, 'name').includes(motivation) ? `Now Gabriel is determined to confront you to locate his sister.${group.length == 2 ? ` His mute friend Drago follows him like a dog.` : `` }` : `His mute friend Drago hounds you to find the location of Gabriel's missing sister.`} They won't be hearing that you just don't know about Regina.`
            } else {text = 
                `Gabriel has received a letter from his sister Regina that informed him she is been held, but by whom? ${_.map(group, 'name').includes(motivation) ? `${motivation}${group.length == 2 ? `, along with Drago` : ""} believes you have information on her whereabouts and will not take no for an answer.`: `${possessiveSuffix(motivation)} believes you have information on her whereabouts and will not take no for an answer.`} `
            };
            break;
            case "Global Gladiator": text = (stance == "Ally" ? 
            `Citadel has determined this mission to be of topmost priority. Agent Fletch has pulled all Global Gladiators available from less important tasks to aid you here.` : 
            `Miscommunication, misunderstanding and misdirection has led Citadel to deploy a ${group.length == 1 ? "single Global Gladiator" : "group of Global Gladiators"} 
            against you, and nothing you say can sway them from their mission.`);
            break;
            case "Golden Dragons": text = (stance == "Ally" ? 
            `${bossclone ? `"An impostor has taken over my business, and he must go down," Ah Long tells you. You are not sure the Golden Dragons is the sort of ally you'd want to have, 
            but you think you can count on them this one time. But which one is the clone?`: `"What ${finalboss.boss} is attempting is a risk to our businesses. The enemy of our enemy is our friend," ${group[0].name} says. 
            You are not sure the Golden Dragons are the sort of friends you'd want to have, but they might be the ones you need.`}` : 
            `You have been a thorn in the side of the Golden Dragons for a long time. While you are busy with your mission to get ${finalboss.boss}, they have sent a 
            ${group.length == 1 ? "single enforcer" : "group of enforcers"} to remove that thorn.`);
            break;
            case "Gunslinger": text = (stance == "Ally" ? 
            `A wandering ${group.length == 1 ? "gunslinger" : "band of gunslingers"} sees ${finalboss.boss} as an opportunity to test their mettle, and has decided to walk with you.` : 
            `A wandering ${group.length == 1 ? "gunslinger" : "band of gunslingers"} sees you as an opportunity to test their mettle. They seem to show up wherever you go.`);
            break;
            case "Horseman": text = (stance == "Ally" ? 
            `The mysterious Master must believe ${finalboss.boss} is truly a lost cause to his secretive goals, as ${group.length == 1 ? "a horseman has" : `not one, but ${numberAsString(group.length)} horsemen have`} been sent after ${gPron(finalboss, "object")}.` : 
            `The mysterious Master must believe you is truly are an immense threat to his secretive goals, as ${group.length == 1 ? "a horseman has" : `not one, but ${numberAsString(group.length)} horsemen have`} been sent to take you down.`);
            break;
            case "Indines": text = (stance == "Ally" ? 
            `${group.length == 1 ? "This warrior" : "These warriors"} have been sent through from another world, a world of conflict and adventure. To stop Dragon King 
            Greyheart being freed and save their world they have to save yours!` :
            `${group.length == 1 ? "This warrior" : "These warriors"} have been sent through from another world, a world of conflict and adventure. To stop Dragon King 
            Greyheart being freed and save their world they have to doom yours!`);
            break;
            case "Insane": text = (stance == "Ally" ? 
            `${group.length == 1 ? "This individual is" : "These individuals are"} not sound of mind, but unpredicable and dangerous. For whatever irresponsible reason, 
            they are following you around, dead set on taking on ${finalboss.boss}. You just have to hope they will not change their mind.` : 
            `${group.length == 1 ? "This individual is" : "These individuals are"} quite deranged, unpredicable and dangerous. For whatever psychotic reason, 
            they are following you around, dead set on taking you out.`);
            break;
            case "Jackal":
            if (stance == "Ally" && finalboss.boss == "Shadow" && !gladiators.includes("Shadow") && !gladiators.includes("Jackal")) {
                text = `The Jackal has been doubting herself. Has Dark Matter changed her? Is she really herself anymore? Shadow is to blame. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "She has joined you in hopes of confronting the Kingdom's mastermind, and taken her greatest creation with her." : "She has joined you in hopes of confronting the Kingdom's mastermind.") : "Her greatest creation, a snarling beast, stalks after you to get Shadow."}`
            } else if (stance == "Ally") {text = personalstory_ally} else if (stance == "Rival" && gladiators.includes("Shadow") && !gladiators.includes("Jackal")) {
                text = `The Jackal thinks you have changed her with Dark Matter, but you have only unleashed her true self. ${_.map(group, 'name').includes(motivation) ? `Now she is determined to confront you with this ridiculousness.${group.length == 2 ? ` She even has one of her genetic mutants following her around!` : `` }` : `She has sent one of her genetic mutants to find you!`} You really wouldn't have time for this nonsense.`
            } else {text = personalstory_enemy};
            break;
            case "Juan":
            if (stance == "Ally" && !gladiators.includes("Shadow") && !gladiators.includes("Juan")) {
                text = `Juan thinks the Kingdom has made the Cartel something it is not, and he needs to take the gang back. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `He has joined forces with Tiger Azules to help the communities by confronting people like ${finalboss.boss} with you.` : `He will start by helping the communities by confronting people like ${finalboss.boss} with you.`) : "Tiger Azules has protected the people while the Cartel was a lost cause, and now tries to help Juan get them back on the right path by setting an example."}`
            } else if (stance == "Ally") {text = personalstory_ally} else if (stance == "Rival" && (redemption.some(v=> gladiators.indexOf(v) !== -1) == true) && !gladiators.includes("Juan")) {
                text = `Juan thinks the Kingdom has made the Cartel something it is not. ${_.map(group, 'name').includes(motivation) ? `Now he is determined to show the communities that people like you can be stopped.${group.length == 2 ? ` Tiger Azules, defender of the streets has joined forces with him.` : `` }` : "Tiger Azules has protected the people while the Cartel was a lost cause, and now tries to help Juan get them back on the right path by setting an example." }`
            } else {text = personalstory_enemy};
            break;
            case "Kemono":
            if (stance == "Ally" && !gladiators.includes("Kemono") && !gladiators.includes("Shadow")) {
                text = `Kemono feels lost, questioning his actions for the Kingdom, struck by the cruelty of it. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `The ancient warrior Darius is guiding him to end the malicious work of any enemy, no matter their loyalties.` : `The words of the ancient warrior Darius guide him to end the malicious work of any enemy, no matter their loyalties.`) : "The ancient warrior Darius walks with you to show Kemono the path to end the malicious work of any enemy, no matter their loyalties."}`
            } else if (stance == "Ally") {text = personalstory_ally} else if (stance == "Rival" && (redemption.some(v=> gladiators.indexOf(v) !== -1) == true) && !gladiators.includes("Kemono")) {
                text = `Kemono feels lost, questioning his actions for the Kingdom, struck by the cruelty of it. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `The ancient warrior Darius is guiding him to salvation by ending the malicious work of any enemy, no matter their loyalties.` : `The words of the ancient warrior Darius guide him to salvation by ending the malicious work of any enemy, no matter their loyalties.` }` : "The ancient warrior Darius does everything he can you to stop you to show Kemono the path to salvation by ending the malicious work of any enemy, no matter their loyalties."}`
            } else {text = personalstory_enemy};
            break;
            case "Kingdom": text = (stance == "Ally" ? 
            `${bossclone ? `"An impostor has taken over my place in the Kingdom, and must go down," ${finalboss.boss} tells you. You're extremely wary of the Kingdom, 
            but you think you can count on ${finalboss.boss} this one time. But which one is the clone?`: `The Kingdom knows you are their most dangerous enemy, but all their plans are smoke and mirrors. For some devious reason ${group.length == 1 ? "this warrior has" : "these warriors have"} 
            joined you to stop ${finalboss.boss}. You are quite sure this alliance is tenuous and temporary at best, but you know you will need the help.`}` : 
            `The Kingdom knows you are the only credible threat to their long-term plans, and ${group.length == 1 ? "this warrior has" : "these warriors have"} been
            sent to make sure the threat you pose will be neutralized.`);
            break;
            case "Law Enforcement": text = (stance == "Ally" ? 
            `The law enforcement agencies around the world do not really understand the threat the Kingdom poses and are not equipped to properly fight it, but 
            sometimes their operations align with your efforts.` : 
            `The law enforcement agencies and their contacts and informants around the world are not immune to the reach of the Kingdom, and ${group.length == 1 ? "this corrupt individual" : "these corrupt officers or informants"}
            are determined to take you in - or take you out!`);
            break;
            case "Martial Arts Master": text = (stance == "Ally" ?
            `A wandering ${group.length == 1 ? "martial arts master" : "band of martial artists"} sees ${finalboss.boss} as an opportunity to test their mettle, and has decided to walk with you.` : 
            `A wandering ${group.length == 1 ? "martial arts master" : "band of martial artists"} sees you as an opportunity to test their mettle. They seem to show up wherever you go.`);
            break;
            case "Megan":
                let megansenemy = finalboss.name == "Kingdom" ? finalboss.boss : finalboss.name
            if (stance == "Ally" && !gladiators.includes(finalboss.boss) && !gladiators.includes("Megan")) {
                text = `The ${megansenemy} is behind the theft of tens of thousands of dollars from Megan's family's company. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `She has joined forces with the unhinged criminal Sera O'Quinn, who believes they are responsible for her father's corruption, and they will help you take the ${megansenemy} down.` : `She has joined forces with you to help you take the ${megansenemy} down.`) : `The unhinged criminal Sera O'Quinn believes this is somehow related to her family, and has joined you to take the ${megansenemy} down.`}`
            } else if (stance == "Ally") {text = personalstory_ally} else if (stance == "Rival" && (redemption.some(v=> gladiators.indexOf(v) !== -1) == true) && !gladiators.includes("Megan")) {
                text = `Under the influence of the Kingdom, you has been involved in many things that you regret. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? ` Megan and Sera both accuse you of ruining their family businesses, and now they do everything they can to bring you down.` : `Megan accuses you of an extensive theft from her company, which was techincally the doings of the O'Quinn family.` }` : `Sera O'Quinn accuses you of corrupting her father, and tries to bring you down.`} You admit you are responsible, but your hands would be full as they are!`
            } else {text = personalstory_enemy};
            break;
            case "Monk": text = (stance == "Ally" ? 
            `${group.length == 1 ? `A lone warrior monk has`: `A group of warrior monks have`} left their distant monastery to deliver ${finalboss.boss} the wisdom to leave the corrupt way. 
            Wisdom often comes with pain.` :
            `${group.length == 1 ? `A lone warrior monk has`: `A group of warrior monks have`} left their distant monastery to bring down the oppressor. 
            You certainly didn't see Citadel that way.`);
            break;
            case "Music": text = (stance == "Ally" ? 
            `${group.length == 1 ? "This talent is" : "These talents are"} true royalty of rhythm, while they find ${finalboss.boss} clearly is not. 
            To show ${finalboss.boss} who should be crowned the Majesty of Music, the ${group.length == 1 ? "artist has" : "artists have"} unfortunately decided to follow you to face ${gPron(finalboss, "object")} in a dance-off.` : 
            `Wherever you go, ${group.length == 1 ? "this talent" : "these talents are"} there, ready for a dance-off. For what purpose, you cannot fathom, but you're afraid they will get hurt.`);
            break;
            case "Natalia":
                let badguys = ["Jackal","Shadow","Kemono","Dmitri"]
            if (stance == "Ally" && (finalboss.name == "Brotherhood" || finalboss.name == "Kingdom") && !gladiators.includes(finalboss.name) && !gladiators.includes("Dmitri") && !gladiators.includes("Natalia")) {
                text = `${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `Natalia and her young protege Zane join your mission, as they are going to avenge the ${finalboss.name} strike that killed the boy's parents.` : `Natalia joins your mission, as she is going to avenge the ${finalboss.name} strike that killed Zane's parents.`) : `The orphaned boy Zane is trying to track down the murderous ${finalboss.name} who are responsible for the death of his parents, and has asked for your help.`}`
            } else if (stance == "Ally") {text = personalstory_ally} else if (stance == "Rival" && (badguys.some(v=> gladiators.indexOf(v) !== -1) == true) && !gladiators.includes("Natalia")) {
                text = `The Kingdom orchestrated the strike that left Zane's parents dead${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `, and Natalia is helping the boy confront those responsible.` : `, and Natalia will confront those responsible for the boy.` }` : ", and the orphaned boy is determined to confront those responsible."}`
            } else {text = personalstory_enemy};
            break;
            case "Onyx League": text = (stance == "Ally" ?
            `The ongoing plans of ${finalboss.boss} will lead only to mindless destruction, not anarcy and freedom the Onyx League is after. 
            A ${group.length == 1 ? "single enforcer" : "group of enforcers"} has been sent to crush the opposition. You're lucky to have them on your side!` : 
            `You have been a thorn in the side of the Onyx League for a long time. While you are busy with your mission to get ${finalboss.boss}, they have sent a 
            ${group.length == 1 ? "single enforcer" : "group of enforcers"} to remove that thorn.`);
            break;
            case "Organized Crime": text = (stance == "Ally" ? 
            `The ongoing plans of ${finalboss.boss} risks the stability that organized crime requires, and a ${group.length == 1 ? "single enforcer" : "group of enforcers"} 
            has been sent to crush the opposition. You're lucky to have them on your side!` : 
            `Organized crime sees the ongoing plans of ${finalboss.boss} a perfect time to hit law enforcement everywhere, and Citadel is no exception to their plans. A 
            ${group.length == 1 ? "single enforcer" : "group of enforcers"} has been sent to take you out.`);
            break;
            case "Past": text = (stance == "Ally" ? 
            `${group.length == 1 ? "A single warrior" : "A group of warriors"} from the past holds archaic knowledge that they will use to determine the future. 
            Fortunately for you, you seem to be a part of that future.` : 
            `${group.length == 1 ? "A single warrior" : "A group of warriors"} from the past holds archaic knowledge that they will use to determine the future. 
            Unfortunately for you, you need to be erased from that future.`);
            break;
            case "Project X":
            if (stance == "Ally" && finalboss.boss == "Jackal" && !gladiators.includes("Jackal") && !gladiators.includes("Project X")) {
                text = `The eerie, fightening creature known as Project X is searching for her "mother",  ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "and it seems like this will not be a social call. Natalia vouches for her good heart, but you have your suspicions." : "and it seems like this will not be a social call. You feel you have no choice but to let her stalk with you.") : "and Natalia has joined you to help her locate her."}`
            } else if (stance == "Ally") {text = personalstory_ally} else {text = personalstory_enemy};
            break;
            case "Psychic": text = (stance == "Ally" ? 
            `${group.length == 1 ? "This mysterious figure" : "This mysterious group"} has mastered the ${mysticalSynonym()} powers of the mind, and has foreseen the future. 
            They have determined ${possessiveSuffix(finalboss.boss)} plans will have to change.` : 
            `${group.length == 1 ? "This mysterious figure" : "This mysterious group"} has mastered the ${mysticalSynonym()} powers of the mind, and has foreseen the future. 
            They have determined ${possessiveSuffix(finalboss.boss)} plans must come to fruition. They seem to know your every move, and appear wherever you go!`);
            break;
            case "Science": text = (stance == "Ally" ? 
            `What ${finalboss.boss} is planning has a scientific angle that an inquiring mind cannot bypass. This ${group.length == 1 ? "analyst" : "group of analysts"} 
            will follow you for research purposes.` : 
            `What ${finalboss.boss} is planning has a scientific angle that an inquiring mind cannot bypass. This ${group.length == 1 ? "analyst" : "group of analysts"} 
            is trying to stop you so they can observe this interesting event first hand!`);
            break;
            case "Sensei": text = (stance == "Ally" ? 
            `${group.length == 1 ? "A wandering sensei has" : "Wandering sensei have"} decided your training is not quite complete, and they oversee your journey to 
            ensure your discipline will reach its potential.` : 
            `${group.length == 1 ? "A wandering sensei has" : "Wandering sensei have"} decided your training is not quite complete, and they follow you on your path to teach you a lesson in 
            discipline and skill.`);
            break;
            case "Shadow":
            let alliesofthekingdom = ["Juan", "Tlazolteotl", "Mack", "Ah Long", "Dmitri"]
            if (stance == "Ally" && finalboss.boss.includes(alliesofthekingdom) && !gladiators.includes("Shadow")) {
                text = `The mysterious figure behind the Kingdom has suspicion that Shadow is losing his grip on the allies of the Kingdom. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `As if this accusation was not enough, Shin Yokai has been sent to "assist" Shadow in ensuring ${possessiveSuffix(finalboss.boss)} loyalty.` : `Shadow has decided to personally ensure ${finalboss.boss} will remain loyal.`) : `Shin Yokai has been sent to ensure ${possessiveSuffix(finalboss.boss)} loyalty.`}`
            } else if (stance == "Ally" && !gladiators.includes(finalboss.boss) && !gladiators.includes("Shadow")) {
                text = `Shadow feels ${finalboss.boss} needs a reminder of who is ${gPron(finalboss,"possessive")} true master. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `Shin Yokai has been ordered to assist him if ${finalboss.boss} seems to have forgotten ${gPron(finalboss,"possessive")} true loyalties.` : `He has decided to remind ${gPron(finalboss,"object")} personally.`}` : `Shin Yokai has been sent to remind ${gPron(finalboss,"object")} of ${gPron(finalboss,"possessive")} loyalty.`}`
            } else if (stance == "Ally") {text = personalstory_ally} else if (stance == "Rival" && (alliesofthekingdom.some(v=> gladiators.indexOf(v) !== -1) == true) && !gladiators.includes("Shadow")) {
                text = `The mysterious figure behind the Kingdom has suspicion that Shadow is losing his grip on the allies of the Kingdom. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `As if this accusation was not enough, Shin Yokai has been sent to "assist" Shadow in ensuring your loyalty.` : `Shadow has decided to show his loyalty by personally confronting you.`}` : `Shin Yokai has been sent to ensure your loyalty.`}`
            } else if (stance == "Rival" && (gladiators.includes("Jackal") || gladiators.includes("Kemono")) && !gladiators.includes("Shadow")) {
                text = `Shadow feels you need a reminder of who is your true master. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `Shin Yokai has been ordered to assist him if you seem to have forgotten your true loyalties.` : `He has decided to remind you personally.`}` : `Shin Yokai has been sent to remind you of your loyalty.`}`
            } else {text = personalstory_enemy};
            break;
            case "Shin Yokai":
            if (stance == "Ally" && finalboss.boss == "Shadow" && !gladiators.includes("Yokai")) {
                text = `The furious master of the Oni, Shin Yokai believes he has been betrayed by his Master, and wants to find Shadow just as much as you do, to find out what he knows. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `He has taken pity on one Marionette Doll called June, and protects her on their travels.` : `He looks like he is unable to control the demonic force, and is no longer in touch with his human side.`) : `A Marionette Doll called June he once helped tries to repay this by helping you find Shadow for him.`}`
            } else if (stance == "Ally") {text = personalstory_ally} else if (stance == "Rival" && gladiators.includes("Shadow") && !gladiators.includes("Yokai")) {
                text = `The furious master of the Oni, Shin Yokai believes he has been betrayed by his Master, and wants to find out what you know about him. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `A Marionette Doll called June he once helped tries to repay this by helping him interrogate you.` : `He looks like he is unable to control the demonic force, and is no longer in touch with his human side.`}` : `A Marionette Doll called June he once helped tries to repay this by fishing the information out of you.`} You know nothing but this matters not. You have to deal with this yourself.`
            } else {text = personalstory_enemy};
            break;
            case "Soldier": text = (stance == "Ally" ? 
            `Citadel has many soldiers and mercenaries in their contacts, and a ${group.length == 1 ? "single soldier" : "team of soldiers"} 
            has been assigned with you to eliminate the threat ${finalboss.boss} poses.` : 
            `The world is full of rogue nations and terrorist organizations with soldiers for hire and private armies everywhere. A mysterious malefactor has sent a 
            ${group.length == 1 ? "a formidable mercernary" : "team of mercenaries"} to eliminate the Citadel's finest. They will not stop until you are dead.`);
            break;
            case "Street": text = (stance == "Ally" ? 
            `The streets have had enought of the constant threat the evil machinations of ${finalboss.boss} and ${gPron(finalboss,"possessive")} ilk pose to the common people. 
            ${group.length == 1 ? "A defender of the streets has" : "Defenders of the streets have"} decided to aid you in taking ${finalboss.boss} out!` : 
            `Your perpetual fights with ${finalboss.boss} and ${gPron(finalboss,"possessive")} ilk pose a constant threat to the common people. 
            ${group.length == 1 ? "A defender of the streets has" : "Defenders of the streets have"} decided you are the worse of two evils!`);
            break;
            case "Tlazolteotl":
            if (stance == "Ally" && finalboss.name == "Kingdom" && !gladiators.includes("Tlatzoleotl")) {
                text = `The supposed Aztec god of renewal Tlazolteotl has seen that there is a new power that is worshiped above the powers of the old. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `The creature Kemono has submitted to his true master's will, and travels with the empress` : `The empress will travel with you`) : `The creature Kemono has submitted to his true master's will and comes with you`} to teach the Kingdom of the wrath of the old gods.`
            } else if (stance == "Ally") {text = personalstory_ally} else if (stance == "Rival" && (["Shadow","Kemono","Jackal"].some(v=> gladiators.indexOf(v) !== -1) == true) && !gladiators.includes("Tlazolteotl")) {
                text = `The supposed Aztec god of renewal Tlazolteotl sees you represent a new power that is worshiped above the powers of the old. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `The creature Kemono has submitted to his true master's will, and travels with the empress` : `The empress will hunts you`}` : `The creature Kemono has submitted to his true master's will and hunts you`} to teach you of the wrath of the old gods.`
            } else {text = personalstory_enemy};
            break;
            case "Toxic": text = (stance == "Ally" ? 
            `${group.length == 1 ? "This warrior has" : "These warriors have"} expertise on toxins, and have received a vision of the future 
            in a psychedelic chemical dream. They have determined ${finalboss.boss} cannot be allowed to continue on this path. They have joined you in your mission.` : 
            `${group.length == 1 ? "This warrior has" : "These warriors have"} expertise of toxins, and have received a vision of the future 
            in a psychedelic chemical dream. They have determined ${finalboss.boss} must be allowed to continue on this path. They attempt to stop you at every turn.`);
            break;
            case "Twin Tiger": text = (stance == "Ally" ? 
            `Twin Tiger dojo has decided your skills are lacking, and ${group.length == 1 ? `${group[0].name}` : "these fighters"} oversee your journey to 
            ensure your discipline will reach its potential.` :
            `Twin Tiger dojo has decided your recklessness is not a good example to the community, and ${group.length == 1 ? `${group[0].name} follows` : "these fighters follow"} you on your path to teach you a lesson in discipline and skill.`);
            break;
            case "Wanderer": text = (stance == "Ally" ? 
            `Some wander the world on their personal quests, and now your goals seem to have aligned. 
            They will travel with you, and if defeating ${finalboss.boss} is what is needed to accomplish their goals, they would die trying.` :
            `Some wander the world on their personal quests, and now you seem to be in the way of ${group.length == 1 ? `the goal of this individual`: `the mutual purpose of these fighters`}. 
            They will go wherever it takes, and if your defeat is what is needed to accomplish their goals, then so be it.`);
            break;
            case "Ying Hua":
            if (stance == "Ally" && finalboss.boss == "Ah Long" && !gladiators.includes("Ying Hua")) {
                text = `Officer Ying Hua has reveived a mysterious invitation lodged in the skull of an infamous Triad leader and is looking to find the highest ranks of the Golden Dragons and confront whoever is pulling the strings. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "She has enlisted an ambitious enforcer of the Dragons to help her and you." : "She has decided she cannot play this one by the book, and has joined forces with you.") : "She has sent an ambitious enforcer of the Dragons she recruited as an informant to assist in locating the mysterious leader."}`
            } else if (stance == "Ally") {text = personalstory_ally} else if (stance == "Rival" && gladiators.includes("Ah Long") && !gladiators.includes("Ying Hua")) {
                text = `The mysterious invitation you had sent to officer Ying Hua was supposed to keep her occupied and give the Golden Dragons room to operate, but she has learned who is behind he invite, and wants an explanation. Now the original plan is unnecessary, and you have to deal with her himself. ${(!(_.map(group, 'name').includes(motivation)) || group.length == 2) ? `Jin has even been assisting the officer. You are ashamed he recovered his honor before you did.` : ``}`
            } else {text = personalstory_enemy};
            break;
            case "Youth": text = (stance == "Ally" ? 
            `${group.length == 1 ? "This youth" : "These youths"} hold more power than anyone of their age should have. With recklessness of their age, they are trying to 
            stop the evil of ${finalboss.boss}. You don't think you can restrain them, so the only way you can look after them is to let them accompany you.` : 
            `${group.length == 1 ? "This exceptionally powerful youth" : "These exceptionally powerful youths"} are trying to find their place in the world. 
            ${finalboss.boss} has manipulated them to follow the path of darkness. They seem to be wherever you go, and you have no choice but to fight them.`);
            break;
            default: text = (stance == "Ally" ? "For whatever reason, these people stand with you againt the schemes of the Kingdom." : "For whatever reason, these people stand with the Kingdom against you.");
}

text = `<br>If you prefer not to use extra ${stance == "Ally" ? "Allies" : "Rivals"} for this story, flip this card if you did not do that already, otherwise put it in the Story Pool for reference. If do prefer to, this card will add another layer to your story: <br>——————————————————————————————————<br>` 
    + text + "<br>——————————————————————————————————<br>If you haven't yet flipped this card, flip it. Otherwise, keep it in in the Story Pool for reference."
return text

}

function getCasino(enemy) {

    let animal, prefix

    switch(enemy.name) {
        case "Brotherhood": 
        animal = randFrom(["Bear","Wolf","Domovoy","Rusalka","Fox","Rooster","Wolf","Dragon"]);
        prefix = randFrom(["Red","Black","Yellow","Comrade","Working","Industrial"]);
        break;
        case "Nahualli": 
        animal = randFrom(["Jaguar","Rabbit","Frog","Monkey","Butterfly","Eagle","Wolf","Crocodile","Hummingbird"]);
        prefix = randFrom(["Sky","Jade","Sun","Turquoise","Comet","Blue","Leaf"]);
        break;
        case "Cartel": 
        animal = randFrom(["Lamb","Phoenix","Dove","Peacock","Phoenix","Lion","Ox","Eagle","Pelican","Siren","Ram","Fish"]);
        prefix = randFrom(["White","Golden","Brazen","Red","Brown","Green","Fire","Light"]);
        break;
        default:
        animal = randFrom(["Dragon","Tiger","Serpent","Phoenix","Tortoise","Lion","Crane","Oyster", "Fox", "Snake","Panda","Mantis","Snake"])
        prefix = randFrom(["Cloud","Black","Terracotta","Jade","Azure","Vermilion","White","Yellow","Wood","Fire","Metal","Water","Earth","Void","Sky","Blue"]);
}

    let suffix = randFrom(["Den","Nest","Sanctuary","Cloister","Retreat"])

    let casino = randFrom([`${possessiveSuffix(animal)} ${suffix}`,`${prefix} ${animal}`])

    return casino
}

</script>

</body>
</html> 

