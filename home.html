<!DOCTYPE html>
<html lang=fi>

<head>
    <meta name="viewport" content="width = device-width, initial-scale = 1" charset="UTF-8">
    <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Crimson+Text&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans+Condensed:500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
</head>

<body style="display: hidden">

    <div data-role="page" id="intro">

        <div data-role="header" data-id="head" data-theme="b" data-position="fixed">
            <div class="ui-grid-solo" style="display: flex;align-items: center;justify-content: center"><img
                    src="Street Masters logo.png" alt="Street Masters Logo" /></div>
            <h2>Endless Stories</h2>
        </div>


        <div data-role="main" class="ui-content">
            <div class="ui-grid-solo">
                <label class="ui-btn ui-btn-b ui-disabled" style="opacity: 100%" for="players">Number of
                    players:</label>
                <select name="players" id="players" data-native-menu="false" data-iconpos="left">
                    <option value="4">4</option>
                    <option value="3">3</option>
                    <option value="2" selected>2</option>
                    <option value="1">1</option>
                </select>
            </div>

            <div class="ui-grid-solo">
                <label class="ui-btn ui-btn-b ui-disabled" style="opacity: 100%" for="players">Number of stages:</label>
                <select name="storylength" id="storylength" data-native-menu="false" data-iconpos="left">
                    <option value="5" selected>5</option>
                    <option value="4">4</option>
                    <option value="3">3</option>
                    <option value="2">2</option>
                    <option value="1">1</option>
                </select>
            </div>

            <div class="ui-grid-solo">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#page_0" data-transition="pop" data-theme="b" onclick="createStory()">
                                <h2>GENERATE A STORY</h2>
                            </a></li>
                    </ul>
                </div>
            </div>

            <div class="ui-grid-solo">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#loadpopup" data-rel="popup" data-transition="pop" data-theme="b">
                                <h2>LOAD A STORY</h2>
                            </a></li>
                    </ul>
                </div>
            </div>

            <div class="ui-grid-solo" id="expansion_picker">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#expansion_popup" data-rel="popup" data-transition="pop" data-theme="b">
                                <h2>SELECT EXPANSIONS</h2>
                            </a></li>
                    </ul>
                </div>
            </div>

            <div class="ui-grid-solo" id="to_first_page" style="display: hidden">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#page_0" data-transition="pop" data-theme="b">
                                <h2>GO TO PART 1</h2>
                            </a></li>
                    </ul>
                </div>
            </div>

            <div data-role="popup" id="loadpopup">
                <a href="#" data-rel="back" data-role="button" data-theme="b" data-icon="delete" data-iconpos="notext"
                    class="ui-btn-right"></a>
                <ol data-role="listview" data-inset="true">
                    <li data-role="list-divider" data-theme="b">
                        <h2>SELECT SAVED STORY</h2>
                    </li>
                    <li><a href="#page_0" id="loadgame_1"
                            onclick="createPageContent(JSON.parse(localStorage.getItem('save_game_content_1')))"
                            class="cardadvance" style="white-space:normal"></a></li>
                    <li><a href="#page_0" id="loadgame_2"
                            onclick="createPageContent(JSON.parse(localStorage.getItem('save_game_content_2')))"
                            class="cardadvance" style="white-space:normal"></a></li>
                    <li><a href="#page_0" id="loadgame_3"
                            onclick="createPageContent(JSON.parse(localStorage.getItem('save_game_content_3')))"
                            class="cardadvance" style="white-space:normal"></a></li>
                </ol>
                <button class="ui-btn-b cardadvance"><a href="#" onclick="clearSaves()"
                        style="color: black; white-space:normal"><i>CLEAR ALL SAVE DATA</i> </a></button>
            </div>

            <div data-role="popup" id="expansion_popup" data-theme="b">
                <a href="#" data-rel="back" data-role="button" data-theme="b" data-icon="delete" data-iconpos="notext"
                    class="ui-btn-right"></a>
                <ul data-role="listview" data-inset="true">
                    <li data-role="list-divider" data-theme="b">
                        <h2>EXPANSION SELECTION</h2>
                    </li>
                    <!--                     rise of the kingdom unselectable so the generator has enought material-->
                    <li><a href="#" class="exp_selector ui-icon-check ui-icon-right ui-disabled" name="riseofthekingdom"
                            selected="select" style="opacity: 1">Rise of the Kingdom</a></li>
                    <li><a href="#" class="exp_selector ui-icon-check ui-icon-right" name="stretchgoals17">Rise of the
                            Kingdom Stretch Goals</a></li>
                    <li><a href="#" class="exp_selector ui-icon-check ui-icon-right" name="legendofoni">Legend of
                            Oni</a></li>
                    <li><a href="#" class="exp_selector ui-icon-check ui-icon-right" name="twintiger">Twin Tiger</a>
                    </li>
                    <li><a href="#" class="exp_selector ui-icon-check ui-icon-right" name="redemption">Redemption</a>
                    </li>
                    <li><a href="#" class="exp_selector ui-icon-check ui-icon-right" name="battlecon">Street Masters X
                            BattleCON</a></li>
                    <li><a href="#" class="exp_selector ui-icon-check ui-icon-right" name="keystothekingdom">Brook City:
                            Keys to the Kingdom</a></li>
                    <li><a href="#" class="exp_selector ui-icon-minus ui-icon-right ui-disabled"
                            name="aftershock">Aftershock</a></li>
                    <li><a href="#" class="exp_selector ui-icon-minus ui-icon-right ui-disabled"
                            name="essenceofevil">Essence of Evil</a></li>
                    <li><a href="#" class="exp_selector ui-icon-minus ui-icon-right ui-disabled"
                            name="stretchgoals18">Aftershock Stretch Goals</a></li>
                    <li><a href="#" class="exp_selector ui-icon-check ui-icon-right" name="redemption2">Redemption 2</a>
                    </li>
                    <li><a href="#" class="exp_selector ui-icon-minus ui-icon-right ui-disabled"
                            name="tideofthedragon">Tide of the Dragon</a></li>
                    <li><a href="#" class="exp_selector ui-icon-minus ui-icon-right ui-disabled"
                            name="newchallengers">New Challengers</a></li>
                    <li><a href="#" class="exp_selector ui-icon-minus ui-icon-right ui-disabled"
                            name="rumblepack">Rumble Pack</a></li>
                </ul>
            </div>


        </div>


        <div data-role="footer" data-theme="b" data-position="fixed">
            Created by Antti JÃ¤ppinen. Street Masters and all associated artwork is created and owned by Blacklist
            Games.
        </div>

    </div>

    <div data-role="page" data-dialog="true" id="refpanel" data-theme="b">

        <div data-role="header" data-theme="b">
            <h2>Character<br>Reference</h2>
        </div>

        <div data-role="main" class="ui-content">
            <ul data-role="listview" data-inset="true">
                <li data-role="list-divider" data-theme="b">Recommended Global Gladiators</li>
                <li class="refcard" id="charactersetup"></li>
            </ul>

            <ul data-role="listview" data-inset="true">
                <li data-role="list-divider" data-theme="b">Recommended Allies</li>
                <li class="refcard" id="allyintro" data-theme="b"></li>
                <li data-role="list-divider" data-theme="b" id="allysetup" style="white-space:normal"></li>
            </ul>

            <ul data-role="listview" data-inset="true">
                <li data-role="list-divider" data-theme="b">Recommended Rivals</li>
                <li class="refcard" id="rivalintro" data-theme="b"></li>
                <li data-role="list-divider" data-theme="b" id="rivalsetup" style="white-space:normal"></li>
            </ul>
        </div>

    </div>

    <script type="text/javascript">

        $('.exp_selector').on('tap', function (e) {

            if ($(this).hasClass("ui-icon-minus")) {
                $(this).removeClass("ui-icon-minus")
                $(this).addClass("ui-icon-check")
            } else {
                $(this).removeClass("ui-icon-check")
                $(this).addClass("ui-icon-minus")
            }


        });

        function createPageContent(pagecontent) {

            let referencetext = pagecontent.reference
            let cardtexts = pagecontent.text
            let storyname = pagecontent.storyname
            let finalboss = pagecontent.finalboss

            $(`#charactersetup`).html(referencetext[0])
            $(`#allyintro`).html(referencetext[1])
            $(`#allysetup`).html(referencetext[3])
            $(`#rivalintro`).html(referencetext[2])
            $(`#rivalsetup`).html(referencetext[4])

            savegamecontent = pagecontent

            $(cardtexts).each(function (index) {

                cardFront = $(`
                <div data-role = "page" id = "page_${index}">
        <div data-role = "header" data-id="head" data-position = "fixed" data-theme="b">
            <div "ui-grid-solo" style = "display: flex;align-items: center;justify-content: center; font-family: 'Yanone Kaffeesatz', sans-serif"><h2>${storyname}</h2></div>
        </div>

        
        <div data-role = "main" class = "ui-content">
                <ul data-role="listview" data-inset="true">
                    <li data-role = "list-divider" data-theme="b"><i>${finalboss.toUpperCase()} STORY - PART ${this.chapter}</i></li>
                    <li class = "cardbg" style = "white-space:normal">${this.prologue}</li>
                    <li data-role = "list-divider" data-theme="b">SETUP</li>
                    <li style = "white-space:normal" data-theme="b">${this.setup}</li>
                </ul>
                <a href="#winpop_${index}" data-rel="popup" class="ui-btn ui-corner-all ui-btn-b" data-transition = "flip" style = "white-space:normal; background: #0a612b">${this.wincondition[0]}</a>
                <a href="#losepop_${index}" data-rel="popup" class="ui-btn ui-corner-all ui-btn-b" data-transition = "flip" style = "white-space:normal; background: #c4331a">${this.wincondition[1]}</a>  
        </div>

        <div data-role="popup" id="winpop_${index}">
            <a href="#" data-rel="back" data-role="button" data-theme="b" data-icon="delete" data-iconpos="notext" class="ui-btn-right"></a>
            <ul data-role="listview" data-inset="true">
                <li data-role = "list-divider" data-theme="b"><h2>VICTORY!</h2></li>
                <li style = "white-space:normal" class = "cardbg">${this.winepilogue}</li>
                ${index == cardtexts.length - 1 || index == cardtexts.length - 2 ? `<li><a href="#intro" data-transition = "pop" class = "cardadvance">End Story</a></li>` : `<li><a href="#page_${Math.ceil(index / 2) * 2 + 1}" data-transition = "slide" class = "cardadvance">Advance to part ${cardtexts[Math.ceil(index / 2) * 2 + 1].chapter}</a></li>`}
            </ul>
        </div>

        <div data-role="popup" id="losepop_${index}">
            <a href="#" data-rel="back" data-role="button" data-theme="b" data-icon="delete" data-iconpos="notext" class="ui-btn-right"></a>
            <ul data-role="listview" data-inset="true">
                <li data-role = "list-divider" data-theme="b"><h2>DEFEAT!</h2></li>
                <li class = "cardbg" style = "white-space:normal">${this.loseepilogue}</li>
                ${index == cardtexts.length - 1 || index == cardtexts.length - 2 ? `<li><a href="#intro" data-transition = "pop" class = "cardadvance">End Story</a></li>` : `<li data-theme="b"><a href="#page_${Math.ceil(index / 2) * 2 + 2}" data-transition = "slide" class = "cardadvance">Advance to part ${cardtexts[Math.ceil(index / 2) * 2 + 2].chapter}</a></li>`}
            </ul>
        </div>

        <div data-role="popup" id="savepop_${index}">
            <a href="#" data-rel="back" data-role="button" data-theme="b" data-icon="delete" data-iconpos="notext" class="ui-btn-right"></a>
            <ol data-role="listview" data-inset="true">
                <li data-role = "list-divider" data-theme="b"><h2>SAVE AND EXIT?</h2></li>
                <li><a href="#" id = "savegame" onclick = "saveGame_1()" class = "cardadvance" style = "white-space:normal"><i>${localStorage.getItem("save_game_content_1") != null ? `${JSON.parse(localStorage.getItem("save_game_content_1")).storyname} - ${whichPreposition(JSON.parse(localStorage.getItem("save_game_content_1")).finalboss).toUpperCase()} STORY` : `EMPTY SLOT`}</i></a></li>
                <li><a href="#" id = "savegame" onclick = "saveGame_2()" class = "cardadvance" style = "white-space:normal"><i>${localStorage.getItem("save_game_content_2") != null ? `${JSON.parse(localStorage.getItem("save_game_content_2")).storyname} - ${whichPreposition(JSON.parse(localStorage.getItem("save_game_content_2")).finalboss).toUpperCase()} STORY` : `EMPTY SLOT`}</i></a></li>
                <li><a href="#" id = "savegame" onclick = "saveGame_3()" class = "cardadvance" style = "white-space:normal"><i>${localStorage.getItem("save_game_content_3") != null ? `${JSON.parse(localStorage.getItem("save_game_content_3")).storyname} - ${whichPreposition(JSON.parse(localStorage.getItem("save_game_content_3")).finalboss).toUpperCase()} STORY` : `EMPTY SLOT`}</i></a></li>
            </ol>
        </div>

        <div data-role="footer" data-id="foo1" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a class = "ui-icon-arrow-l ui-btn-icon-top" href="#" data-rel="back" data-direction="reverse" data-theme = "b"></a></li>
                    <li><a class = "ui-icon-back ui-btn-icon-top" href="#intro" data-transition="fade" data-theme = "b"></a></li>
                    <li><a class = "ui-icon-user ui-btn-icon-top" href="#refpanel" data-transition = "slidedown" data-theme = "b"></a></li>
                    <li><a class = "ui-icon-arrow-d ui-btn-icon-top" href="#savepop_${index}" data-rel="popup" data-transition = "pop" data-theme = "b"></a></li>
                </ul>
            </div>
        </div>
     </div>
                `)

                cardFront.appendTo($.mobile.pageContainer);

            })

        }

        let savegamecontent

        function saveGame_1(save_position = 1, save_game_content = savegamecontent) {
            localStorage.setItem(`save_game_content_${save_position}`, JSON.stringify(save_game_content));
            location.reload();
        }

        function saveGame_2(save_position = 2, save_game_content = savegamecontent) {
            localStorage.setItem(`save_game_content_${save_position}`, JSON.stringify(save_game_content));
            location.reload();
        }

        function saveGame_3(save_position = 3, save_game_content = savegamecontent) {
            localStorage.setItem(`save_game_content_${save_position}`, JSON.stringify(save_game_content));
            location.reload();
        }

        function clearSaves() {
            localStorage.removeItem("save_game_content_1")
            localStorage.removeItem("save_game_content_2")
            localStorage.removeItem("save_game_content_3")
            location.reload();
        }

        let enemiescopy


        $(window).on('load', function () {
            $(this).trigger('resize');
            $("#loadgame_1").html(`<i>${localStorage.getItem("save_game_content_1") != null ? `${JSON.parse(localStorage.getItem("save_game_content_1")).storyname} - ${whichPreposition(JSON.parse(localStorage.getItem("save_game_content_1")).finalboss).toUpperCase()} STORY` : `EMPTY SLOT`}</i>`)
            $("#loadgame_2").html(`<i>${localStorage.getItem("save_game_content_2") != null ? `${JSON.parse(localStorage.getItem("save_game_content_2")).storyname} - ${whichPreposition(JSON.parse(localStorage.getItem("save_game_content_2")).finalboss).toUpperCase()} STORY` : `EMPTY SLOT`}</i>`)
            $("#loadgame_3").html(`<i>${localStorage.getItem("save_game_content_3") != null ? `${JSON.parse(localStorage.getItem("save_game_content_3")).storyname} - ${whichPreposition(JSON.parse(localStorage.getItem("save_game_content_3")).finalboss).toUpperCase()} STORY` : `EMPTY SLOT`}</i>`)

        });

/* 		$(document).on("keypress", 13, function() {
            createStory();
            $.mobile.navigate( "#page_0" );}) */

        $(document).one("pageinit", function () { //Ennen minkÃ¤ tahansa sivun luomista, tehdÃ¤Ã¤n kerran (.one)	
            $("body").show();
        });

        $(document).on("pagecontainerbeforeshow", function (event, ui) {
            let toPage = ui.toPage[0].id;
            toPage == "intro" ? showForwardButton() : () => { }
        })

        function randFrom(array) {
            return array[Math.floor(Math.random() * array.length)]
        }

        function filterArray(array, key, filter, exclusion = false) {
            if (exclusion == false) {
                array = _.filter(array, function (o) { return o[key] == filter })
            } else array = _.filter(array, function (o) { return o[key] != filter });
            return array
        }

        function globalGladiators(enemies, stages) {

            let gladiators = [
                {
                    name: "Ah Long", expansion: "redemption", enemy: [filterArray(enemies, "boss", "Ah Long")[0], randFrom(filterArray(enemies, "name", "Kingdom"))], ally: ["Wan Bo"], rival: ["Shadow", "Jackal", "Wan Bo"], stage: "Steel Memories",
                    get instructions() { return `If you choose to use ${this.name}, choose ${this.enemy[1].boss} as the boss in part 2B of your personal story.` }
                },
                { name: "Axel", expansion: "twintiger", enemy: filterArray(enemies, "boss", "Mack")[0], ally: ["Mary Ann"], rival: ["Mary Ann"], stage: "Under Destruction" },
                { name: "Brandon", enemy: filterArray(enemies, "boss", "Ah Long")[0], ally: ["Isabella"], rival: ["Isabella"], stage: ["Cashed Out", "Steel Memories"] },
                {
                    name: "Clint", expansion: "stretchgoals17", enemy: randFrom(filterArray(enemies, "name", "Kingdom")), ally: [""], rival: [""]/*random rival*//*random rival*/, stage: [randFrom(stages).name],
                    get instructions() { return `If you choose to use ${this.name}, choose ${this.enemy.boss} as the boss and ${this.stage} as the stage in part 3 of your personal story.` }
                },
                {
                    name: "Dmitri", expansion: "redemption", enemy: randFrom(enemies), ally: [""], rival: ["Anastasia"], stage: "Right to Remain Silent",
                    get instructions() { return `If you choose to use ${this.name}, choose ${this.enemy.name == "Kingdom" ? `${this.enemy.boss} from the ${this.enemy.name} as the boss` : `${this.enemy.name} as the enemy`} in part 1 of your personal story.` }
                },
                {
                    name: "Gabriel", expansion: "riseofthekingdom", enemy: filterArray(enemies, "boss", "Jackal")[0], ally: ["Drago"], rival: ["Drago"], stage: "Original Copy",
                    get instructions() { return `If you choose to use ${this.name}, ${getRandomMinions(this.enemy.name)} in part 3 of your personal story.` }
                },
                {
                    name: "Ikuchi", expansion: "redemption2", enemy: filterArray(enemies, "boss", "Jackal")[0], ally: ["Megan"], rival: [""], stage: "Original Copy",
                    get instructions() { return `If you choose to use ${this.name}, ${getRandomMinions(this.enemy.name)} in part 2 of your personal story.` }
                },
                { name: "Jackal", expansion: "redemption", enemy: filterArray(enemies, "boss", "Shadow")[0], ally: ["Project X"], rival: ["Kemono", "Project X"], stage: "Steel Memories" },
                {
                    name: "Juan", expansion: "redemption", enemy: randFrom(enemies), ally: ["Tiger Azules"], rival: ["Tiger Azules"], stage: "Compromised",
                    get instructions() { return `If you choose to use ${this.name}, choose ${this.enemy.name == "Kingdom" ? `${this.enemy.boss} from the ${this.enemy.name} as the boss` : `${this.enemy.name} as the enemy`} in part 1 of your personal story.` }
                },
                {
                    name: "Kemono", expansion: "redemption", enemy: randFrom(filterArray(enemies, "boss", "Shadow", true)), ally: ["Darius"], rival: ["Shadow", "Darius"], stage: "Sudden Death",
                    get instructions() { return `If you choose to use ${this.name}, choose ${this.enemy.boss} as the boss in part 2 of your personal story.` }
                },
                { name: "Kenshin", expansion: "redemption2", enemy: filterArray(enemies, "boss", "Ah Long")[0], ally: ["Brandon"], rival: ["Shadow", "Jackal", "Kemono"], stage: "Cashed Out" },
                {
                    name: "Kyoryu", expansion: "riseofthekingdom", enemy: randFrom(enemies), ally: ["Hanzo"], rival: ["Hanzo"], stage: ["Steel Memories", "Sudden Death"],
                    get instructions() { return `If you choose to use ${this.name}, choose ${this.enemy.boss} as the boss in part 2A of your personal story.` }
                },
                { name: "Mack", expansion: "twintiger", enemy: filterArray(enemies, "boss", "Juan")[0], ally: ["Leeta"], rival: ["Shadow"], stage: "Sudden Death" },
                {
                    name: "Max", expansion: "stretchgoals17", enemy: randFrom(enemies), ally: [""]/*random ally*/, rival: [""]/*random rival*/, stage: "Compromised",
                    get instructions() { return `If you choose to use ${this.name}, choose ${this.enemy.name == "Kingdom" ? `${this.enemy.boss} from the ${this.enemy.name} as the boss` : `${this.enemy.name} as the enemy`} in part 2A of your personal story.` }
                },
                { name: "Megan", expansion: "riseofthekingdom", enemy: filterArray(enemies, "boss", "Dmitri")[0], ally: ["Sera O'Quinn"], rival: ["Sera O'Quinn"], stage: ["Gone Ballistic", "Compromised"] },
                { name: "Miss Matrix", enemy: filterArray(enemies, "boss", "Ah Long")[0], ally: ["Ying Hua"], rival: ["Ah Long", "Kemono"], stage: "Cashed Out" },
                {
                    name: "Natalia", expansion: "riseofthekingdom", enemy: filterArray(enemies, "boss", "Dmitri")[0], ally: ["Zane"], rival: ["Zane"], stage: ["Gone Ballistic", "Original Copy"],
                    get instructions() { return `If you choose to use ${this.name}, ${getRandomMinions(this.enemy.name)} in part 2B of your personal story.` }
                },
                {
                    name: "Project X", expansion: "redemption2", enemy: randFrom(filterArray(enemies, "name", "Kingdom")), ally: ["Natalia"], rival: ["Natalia", "Jackal"], stage: "Original Copy",
                    get instructions() { return `If you choose to use ${this.name}, choose ${this.enemy.boss} as the boss and ${getRandomMinions(this.enemy.name)} in part 3 of your personal story.` }
                },
                { name: "Rhys", expansion: "twintiger", enemy: filterArray(enemies, "boss", "Mack")[0], ally: ["Leeta"], rival: ["Leeta"], stage: "Poison the Well" },
                {
                    name: "Shadow", expansion: "redemption", enemy: filterArray(enemies, "boss", "Juan")[0], ally: ["Shin Yokai"], rival: ["Ah Long", "Dmitri", "Shin Yokai", "Kemono"], stage: [randFrom(stages).name],
                    get instructions() { return `If you choose to use ${this.name}, choose ${this.stage} as the stage in part 2A of your personal story.` }
                },
                { name: "Selene", expansion: "redemption2", enemy: filterArray(enemies, "boss", "Dmitri")[0], ally: [""], rival: ["Genesis"], stage: "Estate of Decay" },
                { name: "The Don", expansion: "redemption2", enemy: filterArray(enemies, "boss", "Juan")[0], ally: ["Gabriel"], rival: ["Juan", "Gabriel"], stage: "Gone Ballistic" },
                { name: "The Proxy", expansion: "redemption2", enemy: filterArray(enemies, "boss", "Juan")[0], ally: ["Power Soldier"], rival: ["Power Soldier"], stage: "Compromised" },
                {
                    name: "Tiger Azules", expansion: "stretchgoals17", enemy: randFrom(enemies), ally: [""]/*random ally*/, rival: [""], stage: "Supply and Demand",
                    get instructions() { return `If you choose to use ${this.name}, choose ${this.enemy.name == "Kingdom" ? `${this.enemy.boss} from the ${this.enemy.name} as the boss` : `${this.enemy.name} as the enemy`} in part 2 of your personal story.` }
                },
                {
                    name: "Tlazolteotl", expansion: "stretchgoals17", enemy: filterArray(enemies, "boss", "Jackal")[0], ally: ["Kemono"], rival: ["Kemono", "Tlazolteotl"], stage: "Original Copy",
                    get instructions() { return `If you choose to use ${this.name}, ${getRandomMinions(this.enemy.name)} in part 3 of your personal story.` }
                },
                { name: "Ying Hua", expansion: "riseofthekingdom", enemy: filterArray(enemies, "boss", "Ah Long")[0], ally: ["Jin"], rival: ["Jin"], stage: ["Cashed Out"] },
                { name: "Yokai", expansion: "redemption2", enemy: filterArray(enemies, "boss", "Shadow")[0], ally: ["Marionette Doll"], rival: ["Marionette Doll"], stage: "Steel Memories" }
            ]

            let expansionfilter = $('.exp_selector').map((_, el) => $(el).hasClass("ui-icon-check") ? el.name : ``).get().filter(el => el != "")

            gladiators = gladiators.filter(gladiator => expansionfilter.includes(gladiator.expansion))

            let globalgladiators = []

            while (globalgladiators.length < $("#players").val()) {
                let random = Math.floor(Math.random() * gladiators.length)
                let newgladiator = gladiators[random]
                globalgladiators.push(newgladiator)
                gladiators.splice(random, 1)
            }
            return globalgladiators;
        }

        function bossDescription(enemy) {
            let bossynonym = randFrom(["boss", "boss", "boss", "leader", "leader", "head", "chief", "kingpin"])
            let fame = randFrom(["notorious", "infamous", "ill-famed"])

            let boss_part = `the ${randFrom([``,``,` ${fame}`])} ${randFrom([bossynonym,enemy.bosstitle()])}`

            let of_whom = [` of the ${enemy.name}`, ` of ${enemy.desc}`, ` of the ${enemy.minions}`]
            if (boss_part.includes(`${enemy.bosstitle()}`)) {of_whom.push(``)}
            of_whom = randFrom(of_whom)

            let description = [``,``,`, ${enemy.expression()}`]
            if (of_whom.includes(enemy.desc)) {
                description.push(`, the ${enemy.name}`)
            } else if (of_whom.includes(enemy.minions)) {
                description.push(` of the ${enemy.name}`)
            } else if (of_whom.includes(enemy.name)) {
                description.push(` of ${enemy.desc}`)
            }
            description = randFrom(description)

            return `${enemy.boss}, ${boss_part}${of_whom}${description}`
        }

        function deletePages() {

            pages = document.querySelectorAll('[id^="page"]')

            $(pages).each(function () {
                $(`#${this.id}`).remove();
            })

        }

        function showForwardButton() {

            document.querySelectorAll('[id^="page"]').length > 0 ? $("#to_first_page").css("display", "block") : $("#to_first_page").css("display", "none")


        }


        function createStory() {

            deletePages()

            $(document).on('pageinit')

            let expansionfilter = $('.exp_selector').map((_, el) => $(el).hasClass("ui-icon-check") ? el.name : ``).get().filter(el => el != "")

            let enemies = [
                { name: "Brotherhood", expansion: "riseofthekingdom", boss: "Dmitri", bosstitle: _.template('callous mercenary'), gender: "male", desc: "the ruthless band of mercenaries", addressing: "comrades", minions: "mercenaries, soldiers and spies", threat: "unsheaths his knife, running it along his fingers", minionnames: ["Anastasia", "Boris", "Drago"], preparedboss: [["Trusty Kevlar", "and put it into play"], ["N-40 Punisher", "and put it into play"]], gloat: [[`You will lose,`, `I must break you.`], [`It's better to have a gun and not need it,`, `Than to need a gun and not have it.`], [`This is my boomstick,`, `Good or bad, I'm the one with the gun.`], [`You want to play rough?`, `Say hello to my little friend!`]], expression: _.template(`baring his teeth as he recognizes you`), attacks: { antiair: "a rocket-propelled grenade" } },

                { name: "Cartel", expansion: "riseofthekingdom", boss: "Juan", bosstitle: _.template("ruthless gangster"), gender: "male", desc: "the gang of vicious drug smugglers", addressing: "my boys", minions: "vicious gangers and hardened outcasts", threat: "levels his shotgun straight at you", minionnames: ["Tyrone", "Ignacio", "Lucille"], preparedboss: [["On Alert", "and put it into play"]], gloat: [[`It's better to have a gun and not need it,`, `Than to need a gun and not have it.`], [`This is my boomstick,`, `Good or bad, I'm the one with the gun.`], [`Okay, I'm reloaded!`, `You ready? Here comes the pain!`], [`You wanna play rough?`, `Say hello to my little friend!`]], expression: _.template(`flicking a cigar in your direction`) },

                { name: "Golden Dragons", expansion: "riseofthekingdom", boss: "Ah Long", bosstitle: _.template("unrelenting martial arts master"), gender: "male", desc: "the enterprise of martial artists, thugs and businessmen", addressing: "weasels", minions: "ruthless triads and yakuza", threat: "lifts his hand, dark, malevolent energy flaring on his fist", minionnames: ["Jin", "Dao", "Wan Bo"], preparedboss: [["Merciless Clutch", "and put it into play"]], expression: _.template(`his keen eyes and sly smirk reeking of confidence and self-importance`) },

                { name: "Kingdom", expansion: "riseofthekingdom", boss: "Kemono", bosstitle: _.template('${randFrom(["imposing ","four-armed ",""])}green ${randFrom(["mutant","monster"])}'), gender: "male", desc: "the mysterious criminal syndicate", addressing: "whelps", minions: "mysterious ninja and martial arts masters", threat: "lifts his mighty fists, lightning crackling", minionnames: ["Power Soldier", "Marionette Doll", "Mountain General"], preparedboss: [["Uncontrollable Surge", "and put it into play"]], gloat: [[`You should not have come,`, `Now you have forced my hand.`], [`You should not have come,`, `What soon will happen, you have brought upon yourselves.`]], expression: _.template(`his demonic eyes and grim expression delivering a promise of violence`), attacks: { antiair: "a brilliant shock of burning white lightning", detonation: `Suddenly, you feel your hair stand up, and in an instant Kemono explodes with electricity` } },

                { name: "Kingdom", expansion: "riseofthekingdom", boss: "Jackal", bosstitle: _.template("mad scientist"), gender: "female", desc: "the mysterious criminal syndicate", addressing: "my test subjects", minions: "soldiers and marionettes", threat: "smiles, her eyes start to glow malevolently, and you feel pressure behind your eyes", minionnames: ["Power Soldier", "Marionette Doll", "Mountain General"], preparedboss: [["Neural Invasion", "and play it"]], gloat: [[`How noble of you,`, `To donate your bodies for science.`], [`You won't get out of here,`, `I never turn down new specimens!`], [`You have played your part well,`, `But who do you think you really are?`], [`You always are so predictable,`, `Who do think you are working for?`], [`Children,`, `You should not have risen against your mother.`], [`Seems there is no shortage of new specimens these days,`, `But that is a positive problem.`], [`I couldn't have asked for better specimens,`, `It's time you provide your skills and abilities to the Kingdom.`],], expression: _.template(`her constricted pupils and demonic grin showing no humanity`), attacks: { antiair: "an iridescent lance of psychic energy" } },

                { name: "Kingdom", expansion: "riseofthekingdom", boss: "Shadow", bosstitle: _.template("ominous mastermind"), gender: "male", desc: "the mysterious criminal syndicate", addressing: "you fools", minions: "mysterious ninja and martial arts masters", threat: "lifts his hand, and dark blades materialize out of thin air", minionnames: ["Power Soldier", "Marionette Doll", "Mountain General"], preparedboss: [["Fan of Blades", "and put it into play"]], gloat: [[`My, what a brave, handsome group,`, `Perhaps it would interest you to see what fate has in store for you.`], [`You have interfered for the last time,`, `Now, you shall die.`], [`My children, you have come to me. For who now is your father if it is not me?`, `When I am gone, you will have never been. What would your world be without me?`], [`On its own, humanity is a destructive force,`, `It needs a master.`], [`Your meddling grows weary,`, `The time has come for us to end this, and it is my pleasure to grant you release from this foolish errand.`]], expression: _.template(`his calculating eyes reflecting a cold, merciless intellect`) },

                { name: "Nahualli", expansion: "stretchgoals17", boss: "Tlazolteotl", bosstitle: _.template('Aztec ${randFrom(["goddess of death", "empress"])}'), gender: "female", desc: "the ancient force of restless warriors", addressing: "mortals", minions: "necromancers and walking dead", threat: "reaches for you, fingers spread wide, purple arcane energy crackling between them", minionnames: ["Pale Caller", "Pale Caller"], preparedboss: [["Decaying Blast", "and play it"]], gloat: [[`You must be taught what has been forgotten,`, `You must be taught the wrath of the old gods.`], [`I will have your soul!`, `I will taste its sins!`], [`You have strayed from the cycle of life and death,`, `I will make you my next sacrifice.`], [`I have conquered this world before,`, `I will not be stopped by the likes of you children!`], [`Enough of these games!`, `I will take what I am due!`], [`You will pay your goddess her due respect!`, `I will make you my next sacrifice!`], [`Even the strongest warriors will fall!`, `Fall to the power of death!`]], expression: _.template(`beautiful and terrible all at once`), attacks: { antiair: `hurled magical spells`, detonation: `She touches the amulet around her neck. The world around you seems to blow away in a deafening explosion of arcane energy` } },

                { name: "Oni", expansion: "legendofoni", boss: "Yokai", bosstitle: _.template('${randFrom(["cursed, powerful warrior","warrior born of mystery and fire"])}'), gender: "male", desc: "the group of cursed spirits", addressing: "you fools", minions: "ancient guardians and powerful spirits", threat: "lifts his mighty fist, suddenly engulfed in eldritch flames", minionnames: ["Yurei Ninja", "Kitsune"], preparedboss: [["Eldritch Strike", "and play it"]], gloat: [[`Are you prepared to face the wrath of Shin Yokai?`, `No, youâre not prepared!`], [`The hunger of the Oni is insatiable!`, `And you will be the food!`]], expression: _.template(`his fiery stare and gritted teeth sending a message of barely contained fury`), attacks: { antiair: `hurled bolts of eldritch energy`, detonation: `With one enraged scream, he explodes with a tremendous flash of energy from within, causing a blazing ring of fire to spread outwards` } },

                { name: "Onyx League", expansion: "twintiger", boss: "Mack", bosstitle: _.template('${randFrom(["black-hearted","mysterious"])} overlord'), gender: "male", desc: "the league of street gangs", addressing: "pigs", minions: "vicious gangers and street criminals", threat: "levels his gun straight at you", minionnames: ["Abolo", "Felicia Salt", "Veronica Pepper"], preparedboss: [["Taking Aim", "and put it into play"]], gloat: [[`Fists versus bullets?`, `I will use your butts as target practice!`], [`This is my boomstick,`, `Good or bad, I'm the one with the gun.`], [`You wanna play rough?`, `Say hello to my little friend!`], [`Greed is for amateurs,`, `I believe there should be no rules, only chaos.`], [`I have come here to create a new country,`, `A country called chaos!`], [`When the world turns upside down,`, `The best thing to do is turn right along with it.`], [`You think you're free,`, `But you don't understand what freedom is.`], [`Only after disaster,`, `Can we be resurrected.`], [`It's only after you've lost everything,`, `That you're free to do anything.`], [`Nothing is static, everything is evolving,`, `Everything is falling apart.`]], expression: _.template(`his keen eyes and predatory sneer reeking of confidence and ruthlessness`), attacks: { antiair: `hail of machine-gun fire` } }
            ];

            enemies = enemies.filter(enemy => expansionfilter.includes(enemy.expansion))
            // Yokai special setup?

            let stages = [
                {
                    name: "Ashes of the Eternal", expansion: "legendofoni", instory: 0, location: "cursed", bystander: "acolyte", pit: "a bottomless well",
                    stagebonus: { setup: `Any fighter may put this card in their play area. <b>Feint:</b> Remove this card from the game to discard 1 fire token from the map.` },
                    stagepenalty: { setup: `One fighter places 1 fire token in the space nearest to them.` },
                    masterplan: randFrom(["actsofterror", "personalpower", "kidnapping"]),
                    gloat: [[`You wonât stop the inevitable!`, `Iâll end you here, with or without the Oni!`], [`Power!`, `Unlimited power!`], [`Fire is a living thing, Gladiators,`, `It breaths, it eats. And it hates.`], [`It is better to burn out,`, `Than to fade away!`], [`You should be glad to go out like this,`, `You will have a funeral pyre of a true warrior!`], [`I am the Alpha and the Omega. Death and rebirth,`, `And, as you die, so will I be reborn!`],],
                    rivaltext: _.template(', but ${rival.name}<%=rivalboost ? `, possessed by the infernal force` : `, looking to gain some of the infernal force`%> moves in to intervene'),
                    hottrail: _.template('<br><br>You were not too late! ${enemy.boss} falls on the floor, barely able to stand up, and stares at ${gPron(enemy, "possessive")} hands with astonishment.  "This can\'t be," ${gPron(enemy, "subject")} says hoarsely.  "I have come so far..." ${ucInit(gPron(enemy, "subject"))} looks up to you with a look of shock.'),
                    coldtrail: _.template('<br><br>${enemy.boss} falls on the floor, then pulls ${gPron(enemy,"reflexive")} off, standing up and staring at ${gPron(enemy, "possessive")} hands with astonishment.  "This can\'t be," ${gPron(enemy, "subject")} says calmly.  "I have come so far..." ${ucInit(gPron(enemy, "subject"))} looks up to you,  ${gPron(enemy, "possessive")} look of shock changing to one of pure rage.'),
                    clueless: _.template('<br><br>${enemy.boss} falls down to the floor of the temple, landing solidly on ${gPron(enemy, "possessive")} feet.  ${ucInit(gPron(enemy, "subject"))} flexes ${gPron(enemy, "possessive")} muscles slowly, staring at ${gPron(enemy, "possessive")} clenched fists, an evil grin on ${gPron(enemy, "possessive")} face. ${ucInit(gPron(enemy, "subject"))} then looks up to you, and laughs.'),
                    prologue: _.template('${trail} you find ${bossDescription(enemy)} in the middle of a ritual at a remote ${evilPlace()}. The ${mysticalSynonym()} powers float ${gPron(enemy, "object")} as ${gPron(enemy, "subject")} draws in a portion of the hellfire of the cursed Oni. You rush in to disrupt the ritual, scattering the unholy urns positioned around the temple.${stagevar} "${gloat[0]}" ${gPron(enemy, "subject")} says. "${gloat[1]}" ${laconicStatement(enemy)}<br><br>You stand ready to face ${gPron(enemy, "object")}, and suddenly wince as your hands begin burning with a searing hot pain. You look down to see bright red lines snaking their way along your hands. You must have disrupted some ancient power by scattering the urns. Gritting your teeth, you pick up the urns and prepare to return them to their rightful place<%=rivalpresence ? `${rivaltext}` : ``%>.'),
                    captured: _.template('You awaken to searing hot pain, and look down to see bright red lines snaking their way along your hands. ${bossDescription(enemy)} is floated by some ${mysticalSynonym()} powers as ${gPron(enemy, "subject")} draws in a portion of the igniting hellfire. You see ${mysticalSynonym()} urns scattered nearby - ${gPron(enemy, "subject")} must have used you to activate the ${mysticalSynonym()} powers of the cursed Oni!${stagevar} "${gloat[0]}" ${gPron(enemy, "subject")} says. "${gloat[1]}" ${laconicStatement(enemy)}<br><br>You rip your bonds, grit your teeth, and prepare to return the urns to their rightful place<%=rivalpresence ? `${rivaltext}` : ``%>.'),
                    finalvar: _.template('You rush in to disrupt the ritual, scattering the unholy urns positioned around the temple.<br><br>${enemy.boss} falls down to the floor of the temple, landing solidly on ${gPron(enemy, "possessive")} feet.  ${ucInit(gPron(enemy, "subject"))} flexes ${gPron(enemy, "possessive")} muscles slowly, staring at ${gPron(enemy, "possessive")} clenched fists, an evil grin on ${gPron(enemy, "possessive")} face. ${ucInit(gPron(enemy, "subject"))} then looks up to you, and laughs. "${gloat[0]}" ${gPron(enemy, "subject")} says. "${gloat[1]}" ${laconicStatement(enemy)}<br><br>You stand ready to face ${gPron(enemy, "object")}, and suddenly wince as your hands begin burning with a searing hot pain. You look down to see bright red lines snaking their way along your hands. You must have disrupted some ancient power by scattering the urns. Gritting your teeth, you pick up the urns and prepare to return them to their rightful place<%=rivalpresence ? `${rivaltext}` : ``%>.'),
                    actsofterror: _.template('${trail}, you find out that the ${getMasterPlan()} of ${enemy.boss} is to unleash the full power of the demonic force Oni, and incinerate everything within miles. You arrive at the remote ${evilPlace()}. The ${mysticalSynonym()} powers float ${gPron(enemy, "object")} as ${gPron(enemy, "subject")} undoes the ${mysticalSynonym()} bindings of the cursed Oni. ${finalvar}'),
                    personalpower: _.template('${trail}, you finally find out that the ${getMasterPlan()} of ${enemy.boss} is to completely bind the cursed Oni spirit with ${gPron(enemy, "reflexive")}, losing the last of ${gPron(enemy, "possessive")} humanity, but gaining power of unimaginable scale.<br><br>You arrive at the remote ${evilPlace()}. The ${mysticalSynonym()} powers float ${bossDescription(enemy)} as ${gPron(enemy, "subject")} undoes the ${mysticalSynonym()} bindings of the cursed Oni.  ${finalvar}'),
                    kidnapping: _.template('${trail}, you find out where ${enemy.boss} holds the ${vip[0]} - ${whichPreposition(evilPlace())} sacred to the demonic Oni, and the ${getMasterPlan()} is to sacrifice ${randFrom(["him","her"])} to that diabolical spirit.<br><br>You arrive at the remote ${evilPlace()}. The ${mysticalSynonym()} powers float ${bossDescription(enemy)} as the ${mysticalSynonym()} flames are peaking. ${finalvar}')
                },

                {
                    name: "Cashed Out", expansion: "riseofthekingdom", instory: 0, location: "base", bystander: "gambler", pit: 'a broken window with a 13-story drop',
                    stagebonus: [{ setup: `Each fighter may put a random defense token on a Frightened Gambler in their threat area.` },
                    { persistent: `<b>Interact</b>: If a fighter is in a space with an active objective token, place 1 damage on this card. If 1P damage is on this card, you have acquired the evidence.`, wincondition: [`If you acquired the evidence:`, `If you did not acquire the evidence:`], prologue: "intel" }],
                    stagepenalty: [{ setup: `Search the stage deck for a Pit Boss and put it into play. Shuffle the stage deck.` },
                    { persistent: `<b>Interact</b>: If a fighter is in a space with an active objective token, place 1 damage on this card. If 1P damage is on this card, you have acquired the evidence.`, wincondition: [`If you won and acquired the evidence:`, `If you did not acquire the evidence:`] }],
                    masterplan: randFrom(["actsofterror", "illegalgains"]),
                    gloat: [[`If you have a gun, you can rob a casino,`, `But if you have a casino, you can rob everyone!`], [`You think fighting me in some nightclub is going to stop the downfall of Ransom?`, `I'm not your problem. I'm just doing business.`]],
                    rivaltext: _.template(' But ${gPron(enemy,"subject")} is not alone. Alongside ${gPron(enemy,"object")} is ${rival.name}, <%=rivalboost ? `eyes glowing green of Vandal!` : `here to sell an encrypted ${gizmo} to ${enemy.boss}.`%>'),
                    hottrail: _.template('You quickly find your way to a set of double doors. You step into the VIP room of the opulent casino. Seated before you, surprised, is ${bossDescription(enemy)}.'),
                    coldtrail: _.template('You eventually find your way to a set of double doors. You hear a commotion inside and - fearing you have lost the element of surprise - you bust in.  Your hunch was right; ${bossDescription(enemy)}, knew you were coming. "Get the money," ${gPron(enemy,"subject")} commands ${gPron(enemy,"possessive")} goons. "I\'ll hold them off."'),
                    clueless: _.template('After going through many ${enemy.minions} of the ${enemy.name}, you reach the VIP room of the casino. Inside, ready to face you is ${bossDescription(enemy)}.'),
                    prologue: _.template('${trail}, you <%=knowledge != "hottrail" ? `investigate the gambling den ${casino}` : `arrive at the ${casino}` %>, where you sneak in, and make your way through the halls of the casino. The surroundings speak volumes about the vast wealth channeled into the ${possessiveSuffix(enemy.name)} operations.<%=randFrom([``,` You take an elevator, and wait patiently while a lounge version of ${loungeMusic()} plays over the speakers.`])%><br><br>${stagevar}<%=!rivalpresence ? ``:`${rivaltext}`%><br><br>${enemy.boss} looks at you and grins. "${gloat[0]}" ${gPron(enemy,"subject")} says. "${gloat[1]}" At that, ${enemy.boss} snaps ${gPron(enemy,"possessive")} fingers, and it becomes clear that the chat is over.'),
                    captured: _.template('You are thrown to the floor of the VIP room in the ${casino} casino, beaten by the many ${enemy.minions}. Seated before you is ${bossDescription(enemy)}<%=!rivalpresence ? `.`:`${rivaltext}`%><br><br>${enemy.boss} looks at you, grins and ${enemy.threat}. "${gloat[0]}" ${gPron(enemy,"subject")} says. "${gloat[1]}" At that, ${enemy.boss} snaps ${gPron(enemy,"possessive")} fingers, and it becomes clear that the chat is over.'),
                    actsofterror: _.template('${trail}, you have uncovered ${possessiveSuffix(enemy.name)} ${getMasterPlan()}: to take over Ransom not by force, but by guile. The glamorous nightclub ${casino} hosts nightly parties full of vice and wickedness for the cream of society, including the ${vip[0]}! If ${enemy.boss} is not stopped, ${gPron(enemy,"subject")} will extend ${gPron(enemy,"possessive")} grip of corruption to control the city, and then the country!<br><br>You make your way to the nightclub, where the surroundings speak volumes about the vast wealth channeled into the ${possessiveSuffix(enemy.name)} operations. You eventually find ${bossDescription(enemy)}. <%=!rivalpresence ? ``:`But ${gPron(enemy,"subject")} is not alone - ${rival.name} has joined ${gPron(enemy, "object")} in a private party!`%><br><br>${enemy.boss} looks at you and grins. "${gloat[0]}" ${gPron(enemy,"subject")} says. "${gloat[1]}"<br><br>${laconicStatement(enemy)}'),
                    illegalgains: _.template('${trail}, you have uncovered ${possessiveSuffix(enemy.name)} ${getMasterPlan()}: to take over Ransom not by force, but by guile. Turns out the premier casino ${casino}, owned by the ${enemy.name}, brings in money from everyone! If the criminally lucrative casino is not shut down, the ${enemy.name} will be able to extend their criminal activities to be too much to handle for a handful of Gladiators such as yourselves.<br><br>You make your way to the casino, where the surroundings speak volumes about the vast wealth channeled into the ${possessiveSuffix(enemy.name)} operations. You eventually find ${bossDescription(enemy)}. <%=!rivalpresence ? ``:`${rivaltext}`%><br><br>${enemy.boss} looks at you and grins. "${gloat[0]}" ${gPron(enemy,"subject")} says. "${gloat[1]}"<br><br>${laconicStatement(enemy)}')
                },

                {
                    name: "The Ceremony", expansion: "legendofoni", instory: 0, location: "cursed", bystander: "acolyte",
                    stagebonus: { setup: `Flip 2 objective tokens furthest from a fighter to their active side. Each fighter gains 1 random dedense token.` },
                    stagepenalty: { setup: `Each fighter must either discard a card at random or place 1 power on "Oni's Vessel".` },
                    masterplan: randFrom(["kidnapping", "personalpower","actsofterror"]),
                    gloat: [[`You're too late!`, `You're efforts are futile!`], [`You wonât stop the inevitable!`, `Iâll end you here, with or without the Oni!`], [`I am the Alpha and the Omega. Death and rebirth,`, `And, as you die, so will I be reborn!`],],
                    rivaltext: _.template(' To your dismay ${rival.name}<%=rivalboost ? `, arms engulfed with burning lines of power`: ``%> has joined the ${enemy.minions} of the ${enemy.name} in the ritual.'),
                    hottrail: _.template(' in the hopes of preventing ${enemy.boss} from realizing ${gPron(enemy,"possessive")} plans. "${gloat[0]}" calls ${bossDescription(enemy)}. "${gloat[1]}" ${ucInit(gPron(enemy,"subject"))} and ${gPron(enemy,"possessive")} forces have reached the entrance, and now stand ready to engage you!'),
                    coldtrail: _.template('. ${enemy.boss} and ${gPron(enemy,"possessive")} forces are already starting the ritual. "${gloat[0]}" calls the confident ${bossDescription(enemy)}, ${gPron(enemy,"possessive")} voice echoing off the stone walls. "${gloat[1]}" ${ucInit(gPron(enemy,"possessive"))} forces charge you while ${gPron(enemy,"subject")} continues the ritual.'),
                    clueless: _.template('. ${enemy.boss} and ${gPron(enemy,"possessive")} forces have already started the ritual, and you feel the the air intensifying. "${gloat[0]}" calls the confident ${bossDescription(enemy)}, ${gPron(enemy,"possessive")} voice echoing off the stone walls. "${gloat[1]}" ${ucInit(gPron(enemy,"possessive"))} forces charge you while ${gPron(enemy,"subject")} finalizes the ritual.'),
                    prologue: _.template('${trail}, <%=knowledge != "hottrail" ? `you find out about a sighting of the ${enemy.name} near a hidden ${evilPlace()}, and move to investigate` : `you reach the hidden ${evilPlace()}`%>. You see the main chamber of the ancient stone structure is encircled with multiple pedestals, each with a mysterious urn placed on top. The urns are etched with a series of images depicting powerful warriors defeating mighty foes.<br><br>Thinking that these may be part of <%=knowledge == "hottrail" ? `the` : `a`%> ritual, you decide you must quickly remove them from their pedestals${stagevar}<%=rivalpresence ? rivaltext : ``%><br><br>${laconicStatement(enemy)}'),
                    captured: _.template('Your captors have brought you into a hidden, ${evilPlace()}, where the air is thick with intensifying heat, and thrown in front of ${bossDescription(enemy)}.<%=rivalpresence ? rivaltext : ``%> "${gloat[0]}" ${enemy.boss} calls out. "${gloat[1]}"<br><br>You see the main chamber of the ancient stone structure is encircled with multiple pedestals, each with a mysterious urn placed on top. The urns are etched with a series of images depicting powerful warriors defeating mighty foes. Thinking that you must be the final part of some dark ritual with the urns, you suddenly fight your captors off, and move in to remove the urns from their pedestals.'),
                    finalvar: _.template('<br><br>You arrive at the remote ${evilPlace()}. You see the main chamber of the ancient stone structure is encircled with multiple pedestals, each with a mysterious urn placed on top, with ${bossDescription(enemy)} in the center of it all. "${gloat[0]}" ${gPron(enemy,"subject")} greets you. "${gloat[1]}"<br><br>Thinking the urns must be part of the ritual, you decide you must quickly remove them from their pedestals. "You won\'t stop the inevitable!"<%=rivalpresence ? rivaltext : ``%><br><br>${laconicStatement(enemy)}'),
                    kidnapping: _.template('${trail}, you find out where ${enemy.boss} holds the ${vip[0]} -  ${whichPreposition(evilPlace())} sacred to the demonic Oni, and the ${getMasterPlan()} is to sacrifice ${randFrom(["him","her"])} to gain the favor of that cursed spirit.${finalvar}'),
                    personalpower: _.template('${trail}, you finally find out that the ${getMasterPlan()} of ${enemy.boss} is to completely bind the cursed Oni spirit with ${gPron(enemy, "reflexive")}, losing the last of ${gPron(enemy, "possessive")} humanity, but gaining power of unimaginable scale.${finalvar}'),
                    actsofterror: _.template('${trail}, you finally find out that the ${getMasterPlan()} of ${enemy.boss} is to unleash the full power of the demonic force Oni, and incinerate everything within miles.${finalvar}')
                },

                {
                    name: "Compromised", expansion: "riseofthekingdom", instory: 0, location: "remote", bystander: "hostage", pit: 'a broken window with a 13-story drop',
                    stagebonus: { setup: `Each fighter may search the stage deck for 1 copy of Calming Words and add it to their fighter play area. Shuffle the stage deck.` },
                    stagepenalty: { setup: `Each fighter places 1 power on a different "Scared Staff" card.` },
                    masterplan: randFrom(["actsofterror", "personalpower","illegalgains"]),
                    gloat: [["I have some bad news for you!", "Nobody will leave this building alive!"], ["You think you could be of use as a hostage?", "I have no use for you."], [`Let the hostages go," you demand. "And we can work something out?`, `I don't negotiate with Global Gladiators.`]],
                    rivaltext: _.template('<%=(knowledge == "clueless") ? ` Suddenly, a janitor takes off a cap and rips off a fake moustache${rivalboost ? `and snaps the neck of a nearby agent` : ``}! It is ${rival.name} in disguise, an agent for the ${enemy.name}!` : ` ${ucInit(gPron(enemy,"subject"))} is not working alone. Alongside ${gPron(enemy,"object")} is ${rival.name}, ${rivalboost ? `eyes glowing green, a telltale sign of Vandal use!` : `furthering some personal agenda.`}`%>'),
                    hottrail: _.template('${trail}, you arrive at the offices just in the nick of time. <%=randFrom([`The ${enemy.name}`,ucInit(enemy.desc)])%> is ushering their people in, ready to take hostages. You manage to slip ahead of them.  "There\'s no escape," a ${gPron(enemy,"sex")} shouts out. "The ${finalboss.name} needs your operation, and you will abide by our demands. We speak for <%=finalboss.boss == enemy.boss ? `the ${finalboss.name}` : finalboss.boss%> and  ${gPron(finalboss, "subject")} speaks for the <%=finalboss.name != "Kingdom" && enemy.name != "Kingdom" ? `Kingdom` : `Master`%>." As panic ensues around the offices, you manage to calm several employees, making sure they keep their heads. Then you make your move on the ${enemy.name}.'),
                    coldtrail: _.template('${trail} you conclude the next target of the ${enemy.name}. You arrive at an office building, and know it is too late. Gunshots can be heard inside the building, followed by screams inside and out.  "Call the police!"  several fleeing employees shout, but you know it is futile.  The chances of any Ransom P.D. response is beyond unlikely. The police are as corrupt as the very criminals they are charged to protect the city against. You rush into the building, heedless of all the warnings shouted at you.'),
                    clueless: randFrom([_.template('${trail}, you investigate a building you believe ${finalboss.name} have been operating out of. As you make your way into the darkened interior, you see a number of people through the windows, held at gunpoint. Hostages! While ${finalboss.boss} is your primary objective, you can\'t let ${enemy.boss} get away with this!'),
                    _.template('<%=stageindex == 0 ? `You are preparing for a hard-earned vacation, but just as you are about to take your leave from Citadel HQ` : `${trail}, you are at the Citadel HQ, reviewing what you\'ve got.  "We\'ve had the intel for a week," Fletch says. "I need to show something to the top brass." "There\'s a lot of dead ends," the analyst says.  "It\'s like they expected us to get the data."  Fletch considers those words.  What if the ${finalboss.name} wanted the Citadel to get a hold of the intel? Just as he was about to call his superiors`%>, a klaxon starts blaring in the facility."Sir!" a technician says. "I\'m picking up multiple hostiles on the scanners!" "Scramble our defenses!" Fletch commands.  "And alert the Global Gladiators!"')]),
                    prologue: _.template('${stagevar}<br><br>"${gloat[0]}" greets a familiar face that you thought you might have seen last of: ${bossDescription(enemy)}. "${gloat[1]}"<%=!rivalpresence ? ``:` ${rivaltext}`%>'),
                    captured: _.template('Your hands bound, bags over your heads, you\'re finally dropped off on a cold concrete floor. "Not here!" you hear a ${gPron(enemy, "sex")} shout in anger.  "What can I do with them here?!"  There is a pause, and you hear footsteps receding until the door closes and your world is silent once more.<br><br>You quickly work yourself out of the bonds - the ${enemy.name} needs to invest in a stronger rope! - and make your way to the door you heard close a moment ago. Pushing slowly through it, you see an office on the other side. Standing in there is ${bossDescription(enemy)} and ${gPron(enemy,"possessive")} ${enemy.minions}, surrounding a group of scared-looking scientists.<%=rivalpresence ? rivaltext : ``%> You know you have to stop ${gPron(enemy,"object")} and free the researchers at once!'),
                    actsofterror: _.template('${trail}, you learn that the ${getMasterPlan()} of ${enemy.name} is to execute everyone in ${vip[1]} in a show of power. Agent Fletch sits behind the pilot\'s seat of the plane as you lean in from the back. "We\'re coming up on the ${possessiveSuffix(enemy.name)} location," he says to you. "I\'ll see if I can put her down over-" His words are interrupted as an explosion from ${getEnemyAttack(enemy, "antiair", "an anti-air shell")} shakes the plane. "Nevermind, looks like you\'re jumping in!"  Grabbing a parachute, you leap from the plane as it peels off and heads toward safety, and crash right into the building.<br><br>"${gloat[0]}" greets ${bossDescription(enemy)}. "${gloat[1]}"<%=!rivalpresence ? ``:` ${rivaltext}`%>'),
                    personalpower: _.template('${trail}, you learn that ${possessiveSuffix(enemy.boss)} ${getMasterPlan()} is to force the scientist of a ${randFrom([`cutting edge medical company`,`cybernetics research company`])} to upgrade ${gPron(enemy,"object")} into an enhanced version of ${gPron(enemy,"reflexive")} with their state-of-the art technology. The imbued powers might turn the ${enemy.bosstitle()} truly unstoppable!<br><br>You arrive at the ${randFrom([`research facility`,`headquarters`,`manufacturing facility`])} of the corporation. "There\'s no escape," ${enemy.boss} shouts out. "You can rebuild me. You have the technology. Better than I was before. Stronger. Faster. Better!" As panic ensues around the offices, you manage to calm several employees, making sure they keep their heads. Then you make your move on the ${enemy.name}. "${gloat[0]}" greets ${bossDescription(enemy)}. "${gloat[1]}"<%=!rivalpresence ? ``:` ${rival.name} is here, too, ${rivalboost ? `and looks like ${gPron(rival,"subject")} has already gained`: `looking to gain`} some modifications of ${gPron(rival,"possessive")} own!`%>'),
                    illegalgains: _.template('${trail}, you learn that the ${getMasterPlan()} of ${enemy.name} to fund the ${enemy.name} operations is to hold the whole ${vip[1]} hostage for ransom! Agent Fletch sits behind the pilot\'s seat of the plane as you lean in from the back. "We\'re coming up on the ${possessiveSuffix(enemy.name)} location," he says to you. "I\'ll see if I can put her down over-" His words are interrupted as an explosion from ${getEnemyAttack(enemy, "antiair", "an anti-air shell")} shakes the plane. "Nevermind, looks like you\'re jumping in!"  Grabbing a parachute, you leap from the plane as it peels off and heads toward safety, and crash right into the building.<br><br>"${gloat[0]}" greets ${bossDescription(enemy)}. "${gloat[1]}"<%=!rivalpresence ? ``:` ${rivaltext}`%>')
                },

                {
                    name: "Gone Ballistic", expansion: "riseofthekingdom", instory: 0, location: "neutral", bystander: "warehouse worker",
                    stagebonus: { setup: `One fighter may move 3 spaces toward the nearest objective token.` },
                    stagepenalty: { setup: `Search the stage deck for an additional objective card and put it into play. Shuffle the stage deck.` },
                    masterplan: randFrom(["illegalgains", "strengtheningforces","actsofterror"]),
                    rivaltext: _.template(' turns to you as ${gPron(enemy, "possessive")} partner in trade, ${rival.name},<%=rivalboost ? ` heavily armed and armored,`: ``%> stashes <%=(knowledge == "clueless" || knowledge == "captured") ? "a" : "the"%> ${gizmo}.'),
                    gloat: [[`It's better to have a gun and not need it,`, `Than to need a gun and not have it.`], [`This is my boomstick,`, `Good or bad, I'm the one with the gun.`], [`Okay, I'm reloaded!`, `You ready? Here comes the pain!`], [`You wanna play rough? Ok,`, `Say hello to my little friend!`]],
                    hottrail: _.template('hear voices nearby. Ducking behind cover, you listen intently to hear that the ${enemy.name} is acting on behalf of the <%=finalboss.name == enemy.name ? finalboss.boss : finalboss.name%>.<br><br>They\'re in the middle of a trade giving away heavy artillery in order to get their hands on an encrypted ${gizmo}. The pair in the discussion start to move away, and their voices begin to fade. You creep low, listening carefully as the they spill all the plans. Once you\'ve heard enough, you jump the startled pair.'),
                    coldtrail: _.template('hear voices nearby. Ducking behind cover, you listen intently to hear that the ${enemy.name} is acting on behalf of the <%=finalboss.name == enemy.name ? finalboss.boss : finalboss.name%>.<br><br>They\'re in the middle of a trade giving away heavy artillery in order to get their hands on an encrypted ${gizmo}. The pair in the discussion start to move away, and their voices begin to fade. You move quickly to keep up and continue your eavesdropping. "Boss!" a guard calls out. You hadn\'t seen him behind the crates nearby, but when you moved to take cover behind them, you were spotted instantly.'),
                    clueless: _.template('have to dive for cover behind nearby crates as you run into the ${enemy.minions} guarding the trade. "Get the guns!" you hear a voice call out. "And get those spies!"'),
                    prologue: _.template('${trail}, you locate <%=knowledge == "hottrail" ? `the` : `a suspicious` %> warehouse. You enter, and almost immediately ${stagevar}<br><br>${bossDescription(enemy)}<%=rivalpresence ? rivaltext : `, standing next to the contact for the trade, shoots the ${randFrom(["man","woman"])} dead, taking ${knowledge == "clueless" ? "a" : "the"} ${gizmo} from the body.`%> "${gloat[0]}" ${gPron(enemy,"subject")} says. "${gloat[1]}" ${laconicStatement(enemy)}'),
                    captured: _.template('You wake up on cold concrete floor, and hear a voice explaining: "Your revenge is at hand. VoilÃ !" There\'s a slight pause. "It\'s light, handle\'s adjustable for easy carrying, good for righties and lefties, breaks down into four parts, ideal for quick discreet interventions. A word on firepower.. oh, our practice targets seem to have come to their senses!"<br><br>The ${enemy.minions} of the ${enemy.name} remove your hoods, and you see ${bossDescription(enemy)} nodding to ${gPron(enemy,"possessive")} companion. "I can take that later." ${ucInit(gPron(enemy, "subject"))} <%=rivalpresence ? rivaltext : `turns from the client who stashes a ${gizmo}.`%> "Let the presentation commence!"'),
                    illegalgains: _.template('${trail}, you learn that the ${getMasterPlan()} of ${enemy.boss} to fund the operations of ${enemy.desc} of ${gPron(enemy,"possessive")} by selling experimental arms to the highest bidder among many rogue nations and shadowy organizations.<br><br>You enter the warehouse where the major deal is happening, and ${bossDescription(enemy)}<%=rivalpresence ? rivaltext : `, standing next to the contact for the trade, shoots the ${randFrom(["man","woman"])} dead, taking ${whichPreposition(gizmo)} from the body.`%> "${gloat[0]}" ${gPron(enemy,"subject")} says. "${gloat[1]}" ${laconicStatement(enemy)}'),
                    strengtheningforces: _.template('${trail}, you learn that the ${getMasterPlan()} of ${enemy.boss} is to arm ${enemy.desc} of the ${enemy.name} with enough firepower to take over a small country. Not even the military could stop them - it is up to the Global Gladiators to stop ${gPron(enemy, "object")} before it is too late!<br><br>You arrive at the warehouse where the ${enemy.name} is arming themselves. ${ucInit(bossDescription(enemy))} watches your approach rashly. "${gloat[0]}" ${gPron(enemy,"subject")} says to you while ${gPron(enemy, "subject")} hands a gun to <%=rivalpresence ? rival.name : randFrom(enemy.minionnames)%>. "${gloat[1]}"<br><br>${laconicStatement(enemy)}'),
                    actsofterror: _.template('${trail}, you find yourself outside a weapons facility operated by <%=rivalpresence ? rival.name : `${enemy.name}`%>. You have learned from your investigations that the ${getMasterPlan()} of ${enemy.boss} is to arm the ${enemy.minions} with heavy artillery for a targeted, brutal strike on Ransom with maximum civilian casualties. You have no clue what the ${enemy.name} would gain from such orchestrated chaos, but that does not matter now. You will end this here and now.<br><br>"${gloat[0]}" ${bossDescription(enemy)} says to you, while ${gPron(enemy, "subject")} examines a gun handed by <%=rivalpresence ? rival.name : randFrom(enemy.minionnames)%>. "${gloat[1]}"<br><br>${laconicStatement(enemy)}')
                },

                {
                    name: "One Step Ahead", expansion: "legendofoni", instory: 0, location: "remote", bystander: "mountain climber", pit: "the edge of the cliff",
                    stagebonus: { setup: `Each fighter may search the enemy deck for a Minion card to discard. Shuffle the enemy deck.` },
                    stagepenalty: { setup: `Each fighter must put search the stage deck for a copy of Vertigo, and put in into play. Shuffle the stage deck.` },
                    masterplan: randFrom(["personalpower", "kidnapping"]),
                    rivaltext: _.template('<%=rivalboost ? `. Leaping from the shadows in the trees, ${rival.name} ambushes you!` : ` and to your dismay you find that ${rival.name} has joined forces with ${enemy.boss}.` %>'),
                    gloat: [[`Even the strongest warriors cannot take this fall,`, `And you are not the strongest.`], [`It'll not be the fall that kills you,`, `It's the sudden stop at the end!`], [`It's a long way down, Gladiators,`, `You'll have a lot of time to reflect on your mistakes.`], [`Only one way down for you,`, `The quickest possible.`]],
                    hottrail: _.template('Climbing the mountain is arduous, but you make good time and come to a point where your path crosses that of ${possessiveSuffix(enemy.boss)} band of goons: the ${enemy.name}! Knowing they are only a short distance behind, you hunker down to spring an ambush. As they rush around the bend, you leap out of your hiding spot taking out a number of ${gPron(enemy,"possessive")} forces before they can regroup and face you.'),
                    coldtrail: _.template('The path is winding and overgrown and difficult to traverse, but you refuse to slow down. You finally come to face ${possessiveSuffix(enemy.boss)} forces.'),
                    clueless: _.template('The path is winding and overgrown and difficult to traverse, and when you finally come to face ${possessiveSuffix(enemy.boss)} forces, you are completely exhausted.'),
                    prologue: _.template('${trail}, you have affirmed that the ${randFrom(["minions",enemy.minions])} of ${enemy.boss} have been using <%=knowledge != "hottrail" ? `a remote mountain path`: `the mountain path you suspected` %>, so that\'s where you head to catch up with them.<br><br>${stagevar}<%=rivalpresence ? rivaltext : ``%><br><br>${bossDescription(enemy)} doesn\'t seem surprised by your efforts. "${gloat[0]}" ${gPron(enemy,"subject")} laughs. "${gloat[1]}" ${ucInit(gPron(enemy,"subject"))} readies to strike back! <br><br>${laconicStatement(enemy)}'),
                    finalvar: _.template('<br><br>A Citadel aircraft speeds you to the mountain, but ${getEnemyAttack(enemy,"antiair","an ominous aura")} drives the plane away. You parachute to the mountainside, and have to finish this with your fists.'),
                    personalpower: _.template('${trail}, you have affirmed that the ${possessiveSuffix(enemy.bosstitle())} ${getMasterPlan()} has led ${gPron(enemy,"object")} to the ${mysticalSynonym()} energy that rests at the top of the Cursed Mountain of Oni. Having trekked through the Forest of Sorrow, ${enemy.boss} and ${gPron(enemy,"possessive")} minions have begun their ascent.${finalvar} "${gloat[0]}" ${bossDescription(enemy)} laughs<%=rivalpresence ? `, with ${rival.name} at ${gPron(enemy,"possessive")} side, looking for ${gPron(rival,"possessive")} part of the ${mysticalSynonym()} power` : ``%>. "${gloat[1]}"'),
                    kidnapping: _.template('${trail}, you have affirmed that the ${possessiveSuffix(enemy.bosstitle())} has ${vip[0]} holed up in a remote mountain cave. ${finalvar} "Get to the cave and finish ${randFrom(["him","her"])}, <%=rivalpresence ? rival.name : randFrom(enemy.minionnames) %>! I can handle the ${defineAddressing(enemy)}." ${bossDescription(enemy)} shouts. "${gloat[0]}" ${gPron(enemy, "subject")} laughs. "${gloat[1]}"')
                },

                {
                    name: "Original Copy", expansion: "riseofthekingdom", instory: 0, location: "base", bystander: "scientist", pit: "a pitch-black elevator shaft",
                    stagebonus: { setup: `Any fighter may put this card in their play area. <b>Feint:</b> Remove this card from the game to choose a copy of Vandal Serum attached to a card in the Cloning Area. Return the selected card to Serum Supply.` },
                    stagepenalty: { setup: `Put 1 damage on this card.`, activate: `Each fighter suffers 1 direct damage for each damage on this card. Then, if any fighter is on or adjacent to an objective space, remove 1 damage from this card.` },
                    masterplan: randFrom(["strengtheningforces", "personalpower"]), //kidnap masterplan? clone
                    gloat: [[`New subjects have arrived,`, `Contain them and proceed with the experiments.`], [`You have played your part well,`, `But do you think you were born and not made?`], [`You always are so predictable,`, `Where do you think you were made in?`], [`We couldn't have asked for better specimens,`, `It's time you provide your skills and abilities to the Kingdom.`]],
                    rivaltext: _.template('<%=rivalboost ? ` Suddenly, one of the tubes crashes open, and a figure can be seen within the steam, kneeling, faced away. It stands, slowly, powerfully built, dripping with greel gel. It is the ultimate clone, ${rival.name.toUpperCase()}-EX!<br><br>` : ` Apparently ${enemy.boss} is taking blood samples from ${rival.name}.`%>'),
                    hottrail: _.template('${trail}, you locate the facility. You are surprised to find the laboratory not heavily guarded, and slipping in is not challenging.  You '),
                    coldtrail: _.template('${trail}, you investigate a facility where ${enemy.name} has reportedly been seen. You defeat a few guards in your way and '),
                    clueless: _.template('${trail}, you investigate a facility in the outskirts of the city that develops cutting edge genetic enhancements and conducts non-sanctioned medical experiments. You fight your way in and '),
                    prologue: _.template('${stagevar}<%=randFrom([`proceed down to `,`take an elevator down. You wait patiently while a lounge version of ${loungeMusic()} plays over the cheap speakers. You arrive at`])%> the large lab, a cavernous room filled with row upon row of glass containment tubes. Each tube has a motionless body in it; some of you recognize as opponents you\'ve faced before.<br><br>Standing at the far end of the room, you see ${bossDescription(enemy)}, overseeing the activity.<%=rivalpresence ? rivaltext : ``%> "Just get the serum," ${enemy.boss} commands ${gPron(enemy,"possessive")} ${enemy.minions}. "<%=finalboss.boss == enemy.boss ? `Let me be clear; we need as much of it as possible to make it work. And I need it to work!`: `${finalboss.boss} has made it clear; ${gPron(finalboss,"subject")} needs as much of it as possible to make it work. And we all need it to work!`%>"<br><br>${enemy.boss} lifts ${gPron(enemy,"possessive")} eyes to you. "${gloat[0]}" ${gPron(enemy,"subject")} calls out. "${gloat[1]}" ${laconicStatement(enemy)}'),
                    captured: _.template('As you slowly regain consciousness, you notice an IV hooked up to your arm.  Your strength had been completely drained and you are unable to even stand up.  "Calm down there," an arrogant voice called. "<%=enemy.boss == finalboss.boss ? `I want`: `${finalboss.boss} wants`%> to run some tests to see if you\'re worth keeping alive.â<br><br>As your vision clears, you see the voice belongs to ${bossDescription(enemy)}.<%=rivalpresence ? rivaltext : ``%> You also see that you are surrounded by sterile lab equipment and ominous test tubes occupied by shadowy figures. You suddenly feel a surge of strength return and yank out the IV. "Fine, let\'s do it the hard way.â'),
                    finalvar: _.template('You <%=randFrom([`proceed down to `,`take an elevator down. You wait patiently while a lounge version of ${loungeMusic()} plays over the cheap speakers. You arrive at`])%> the large lab, a cavernous room filled with hundreds of glass containment tubes. Each tube has a motionless body in it; some of you recognize as opponents you\'ve faced before.<br><br>'),
                    strengtheningforces: _.template('${trail}, you zero on the location of the secret cloning facility where the ${getMasterPlan()} of the ${enemy.name} to grow an army of clones will be enacted. ${finalvar}Standing at the far end of the room, you see ${enemy.boss} ${gPron(enemy,"reflexive")}.<%=rivalpresence ? rivaltext : ``%> "${gloat[0]}" ${gPron(enemy,"subject")} calls out. "${gloat[1]}" ${ucInit(gPron(enemy,"subject"))} looks at you and grins, as a dozen of ${gPron(enemy,"possessive")} ${enemy.minions} descend on you, emerging from the shadows.'),
                    personalpower: _.template('${trail}, you piece together the ${getMasterPlan()} of the ${enemy.boss}: ${gPron(enemy,"subject")} is is about to be reborn with power from a modified strain of ${randFrom(["Dynasty Cells", "Vandal Serum", "Dark Matter"])}! ${finalvar}You see <%=rivalpresence ? rival.name : randFrom(enemy.minionnames) %>, standing near a large incubation tube and pressing a few buttons on the side of the tube, and you watch as it slides open. Out steps ${bossDescription(enemy)}, surrounded by an aura as dark and ominous as ${gPron(enemy, "possessive")} very reputation. ${ucInit(gPron(enemy, "possessive"))} eyes glow with a deep red energy, and ${gPron(enemy, "subject")} turns those burning orbs on you. "${gloat[0]}" ${gPron(enemy, "subject")} says as ${gPron(enemy, "subject")} clenches ${gPron(enemy, "possessive")} fists. "${gloat[1]}"<br><br>${laconicStatement(enemy)}'),
                    kidnapping: _.template('${trail}, finally piece together the ${getMasterPlan()} of the ${enemy.name}! They will clone ${vip[0]} and take control of the ${vio[1]}.${finalvar}Standing at the far end of the room, you see ${enemy.boss} ${gPron(enemy,"reflexive")}.<%=rivalpresence ? rivaltext : ``%> "${gloat[0]}" ${gPron(enemy,"subject")} calls out. "${gloat[1]}" ${ucInit(gPron(enemy,"subject"))} looks at you and grins, as a dozen of ${gPron(enemy,"possessive")} ${enemy.minions} descend on you, emerging from the shadows.')
                },

                {
                    name: "Out of Time", expansion: "stretchgoals17", instory: 0, location: "cursed", bystander: "acolyte", pit: "a glowing portal",
                    stagebonus: { setup: `The fighters may choose to flip one objective to its inactive side.` },
                    stagepenalty: { activate: `The boss gains 1 random defense token for each Remnant engaged with a fighter.` },
                    masterplan: randFrom(["strengtheningforces", "personalpower"]),
                    gloat: [[`Klaatu verata..`, `Nikto!`], [`Even the strongest warriors will fall,`, `In the face of the power of death!`], [`Now I call upon my army of the dead,`, `Arise, my messengers of death! Our time has arrived!`], [`Magic, the darkest magic,`, `My soul swims in it..`], [`I am the Alpha and the Omega. Death and rebirth,`, `And, as you die, so will I be reborn!`],],
                    rivaltext: _.template(' To your horror, you see <%=rivalboost ? `the rotting corpse of ${rival.name} dig itself out of the ground!`: `${rival.name} joining ${enemy.boss} in the atrocious rite!`%>'),
                    hottrail: _.template('${ucInit(gPron(enemy, "subject"))} is just starting a ghastly ritual, and ominous clouds are gathering above you.<br><br>The wind is rising and the air feels heavy'),
                    coldtrail: _.template('Animated corpses are digging their way out the ground all around you. A heavy mass of dark clouds has gathered above you.<br><br>An ominous wind is rising and the very air around you feels hot and heavy'),
                    clueless: _.template('Animated corpses are digging their way out the ground all around you. The sky is a boiling, writhing mass of clouds, each black as coal but glowing with an intense, blood-red heat.<br><br>Dark winds sting your skin and the very air around you smolders your throat and lungs'),
                    prologue: _.template('${trail}, you find ${bossDescription(enemy)} at a remote ${evilPlace()}. A large structure where ${gPron(enemy,"subject")} is standing on dominates the scene. ${stagevar} as ${enemy.boss}<%=knowledge == "clueless" ? `, bristling with power,`: ``%> looks down at you. "${gloat[0]}" ${gPron(enemy,"subject")} continues ${gPron(enemy,"possessive")} magic. "${gloat[1]}"<%=rivalpresence ? rivaltext : ``%> All around ${gPron(enemy,"object")} the ground breaks apart as<%=knowledge == "hottrail" ? ``: ` more and more`%> undead climb to the surface. Death permeates everything here.<br><br>${laconicStatement(enemy)}'),
                    captured: _.template('You come to your senses as undead hands are gripping you, guiding you upwards to an ominous altar on a large pedestal in front of you. What ${mysticalSynonym()} sorcery had kept you enthralled is weakening, and you put your captor down. Dark winds sting your skin and the very air around you smolders your throat and lungs as ${bossDescription(enemy)} looks down at you "${gloat[0]}" ${gPron(enemy,"subject")} works ${gPron(enemy,"possessive")} magic. "${gloat[1]}"<%=rivalpresence ? rivaltext : ``%><br><br>All around ${gPron(enemy,"object")} the ground breaks apart as more and more undead climb to the surface. Death permeates everything here. ${laconicStatement(enemy)}'),
                    finalvar: _.template('${trail}, you accompany Citadel agents to the base of ${enemy.name}. Suddenly, everything disappears in a flash of brilliant purple!<br><br>The world around you is nothing like the one you have lived in all of your life. ${enemy.boss} has apparently transported you to another dimension, one where the dark winds sting your skin and the very air around you smolders your throat and lungs. The sky is a boiling, writhing mass of clouds, each black as coal but glowing with an intense, blood-red heat. If there is a hell, this may as well be it.<br><br>You see ${bossDescription(enemy)}, not far away, continuing ${gPron(enemy,"possessive")} magic. "${gloat[0]}" ${gPron(enemy,"subject")} laughs over the rising winds. "${gloat[1]}"<%=rivalpresence ? rivaltext : ``%>'), 
                    strengtheningforces: _.template('${finalvar} A swirling, ${mysticalSynonym()} portal appears! ${ucInit(gPron(enemy,"possessive"))} ${getMasterPlan()} is to bolster the ranks of the ${enemy.name} with the dead and send them back to Ransom!'),
                    personalpower: _.template('${finalvar} A boom rolls across the area, and a blood-red, ${mysticalSynonym()} funnel starts to gather onto ${enemy.boss}. ${ucInit(gPron(enemy,"possessive"))} ${getMasterPlan()} is to gather the necromantic energy of this dark dimension and become a true God of Death!')
                },

                {
                    name: "Poison the Well", expansion: "twintiger", instory: 0, location: "neutral", bystander: "hireling", pit: "an outflow shaft",
                    stagebonus: { setup: `Remove each copy of Vandal Addict from the stage deck and remove them from the game. Shuffle the stage deck.` },
                    stagepenalty: { setup: `Each fighter searches the stage deck for 1 copy of Infected Rats and adds it to their Threat area. Shuffle the stage deck.` },
                    masterplan: randFrom(["actsofterror", "strengtheningforces"]),
                    // After setting up the stage, flip 1 objective token to its active side.
                    gloat: [[`You will get a bath,`, `A bath that will melt the skin off of you!`], [`How nice that you decided to show up,`, `Better to test the cocktail before deployment!`], [`You will have a proper burial for a Gladiator,`, `Within the sewage!`]],
                    rivaltext: _.template(' along with ${rival.name}<%=rivalboost ? `, eyes glowing menacingly green` : ``%>'),
                    hottrail: _.template('By the information you\'ve gathered, you are able to find your way quickly through the city sewers to ${possessiveSuffix(enemy.boss)} secret lair.'),
                    coldtrail: _.template('By the information you\'ve gathered, you are eventually able to find your way through the city sewers to ${possessiveSuffix(enemy.boss)} secret lair.'),
                    clueless: _.template(' Unfortunately, it is a labyrinth and you lose a lot of time going in circles. By the time you find the ${possessiveSuffix(enemy.name)} operation, you are already swarmed by mutated rats.'),
                    prologue: _.template('${trail}, you descend down to the sewers which are a labyrinth of filth and decay. The city\'s utilities are barely maintained, and since the criminal elements have all but taken over, only the bravest city workers brave these depths. ${stagevar} It appears to be abandoned water treatment facility, and the ${enemy.name} have fitted it with their own crude devices that pump some weird chemical into the water ducts.<br><br>"${gloat[0]}" a familiar voice calls. "${gloat[1]}" ${bossDescription(enemy)} steps out of the shadows<%=rivalpresence ? rivaltext : ``%>. ${laconicStatement(enemy)}'),
                    captured: _.template('You wake up, and the first thing you notice is the intense stench attacking your nostrils. You open your eyes, and as you focus, you can see ${bossDescription(enemy)}<%=rivalpresence ? rivaltext : ``%> standing at a distance. You seem to be underground, in some kind of a crazy scientist setup, and ${enemy.minions} are moving canisters about big machinery.<br><br>"${gloat[0]}" ${enemy.boss} says. "${gloat[1]}"'),
                    finalvar: _.template('${trail}, you find out that ${possessiveSuffix(enemy.boss)} ${getMasterPlan()} is to pump something dangerous in the city waters. By the information you\'ve gathered, you are eventually able to find your way through the Ransom City sewers to ${possessiveSuffix(enemy.name)} secret lair.<br><br>As you enter a large chamber, you find what used to be a water treatment facility that is now being used as some sort of insane science experiment "${gloat[0]}"  comes a voice, echoing from somewhere else in the chamber. "${gloat[1]}" ${bossDescription(enemy)} steps ouf of the shadows<%=rivalpresence ? rivaltext : ``%>. "Once we get these pumps working, all the water in Ransom City will be'),
                    actsofterror: _.template('${finalvar} poisoned by our new toxic cocktail. Many will die, but the surviving will be all the stronger for it. So now you have a choice: join us, or die!" ${ucInit(getEnemyAttack(enemy,"antiair","The approaching enemy minions"))} eliminated one option.'),
                    strengtheningforces: _.template('${finalvar} blessed by our new ${randFrom(["Dynasty", "Vandal", "Dark Matter"])} serum. The weak will die, and the surviving strong will join our ranks as thralls! So now you have a choice: join us, or die!" ${ucInit(getEnemyAttack(enemy,"antiair","The approaching enemy minions"))} eliminated one option.')
                },

                {
                    name: "Right to Remain Silent", expansion: "riseofthekingdom", instory: 0, location: "base", bystander: "captive",
                    stagebonus: { setup: `Each fighter searches the stage deck for a copy of Sneaking, and puts it in their play area.` },
                    stagepenalty: { setup: `Add two power to Recoverd Intel.` },
                    masterplan: randFrom(["illegalgains", "kidnapping"]),
                    rivaltext: _.template(' ${rival.name} stands guard<%= rivalboost ? `, vigilant and keen-eyed.`: `.`%>'),
                    hottrail: _.template('<br><br>You are yet unseen, and dart through the room like shadows to rescue the captured Citadel scouts before they break and ${enemy.boss} finds out what you know about the plans of the ${finalboss.name}.'),
                    coldtrail: _.template('<br><br>You don\'t think you have time for subtlety, and make your move to rescue the captured Citadel scouts before they break and ${enemy.boss} finds out what you know about the plans of the ${finalboss.name}.'),
                    clueless: _.template('<br><br>A captured Citadel scout breaks, and tells what little ${randFrom([`he`,`she`])} knows of what you have on ${possessiveSuffix(finalboss.name)} plans. ${enemy.boss} swings the pipe one more time and starts to move toward the next captive.<br><br>You have to move fast before anything important is revealed.'),
                    prologue: _.template('${trail}, you locate <%=knowledge != "hottrail" ? `a`: `the`%> black site of the ${enemy.name}. You observe the bleak location from hiding. There are armed guards here and there, and you are certain there are hidden alarms everywhere.<br><br>The captives have their hands bound above their heads, bodies hanging inches from the floor of the dark and musty room. ${enemy.boss} says: "I\'ll give you this one chance to come clean before we start our procedures again."<%=rivalpresence ? ` Meanwhile,${rivaltext}` : ``%>${stagevar}'),
                    captured: _.template('"Finally awake?" That\'s the first thing you hear after the splash of stale water jolts you awake. You have no idea how long you\'ve been a hostage of the ${enemy.name}, ${enemy.desc} â but you\'d guess it\'s been at least a few days.<br><br><%=stageindex == 0 ? `Your simple recon mission went south, and now y` : `Y`%>ou\'ve been enduring  their tortures as they\'ve tried to get everything they could out of you. You\'ve held out for now but don\'t know how long you\'ll be able to keep it up. ${bossDescription(enemy)} ${enemy.threat} as ${gPron(enemy, "subject")} stares at you down. "I\'ll give you this one chance to come clean before we start our procedures again." Your silence is deafening as you stare at the floor. "Very well," ${enemy.boss} sneers. "I won\'t be gone for too long, ${defineAddressing(enemy)}. Don\'t get comfortable."<br><br>${ucInit(gPron(enemy, "subject"))} exits,<%=rivalpresence ? `while ${rivaltext}` : ` and as soon as the door closes behind ${gPron(enemy, "object")}, you begin working at your bonds.`%>'),
                    finalvar: _.template('You have found out the location of their black site, and observe the bleak setting from hiding. There are armed guards here and there, and you are certain there are hidden alarms everywhere.<br><br>The captives have their hands bound above their heads, bodies hanging inches from the floor of the dark and musty room. ${enemy.boss} says:'),
                    illegalgains: _.template('${trail}, you find out the ${getMasterPlan()} of the ${enemy.name}. They have covertly abducted some very influential individuals in government, finance and industry, and are blackmailing their families for funds to expand their own criminal operations. ${finalvar} "Hope that your family will cough the money up soon. I\'m at the very end of my patience."<%=rivalpresence ? ` Meanwhile,${rivaltext}` : ``%><br><br>Their captives will not hold much longer.'),
                    kidnapping: _.template('${trail}, you find out where the ${enemy.name} is holding the ${vip[0]}. Their ${getMasterPlan()} is to squeeze out all pertinent intel about ${vip[1]}, and make their final move to control Ransom. ${finalvar} "I\'ll give you this one chance to come clean before we start our procedures again."<%=rivalpresence ? ` Meanwhile,${rivaltext}` : ``%><br><br>You have to move fast before anything important is revealed.')
                },

                {
                    name: "Rude Awakening", expansion: "stretchgoals17", instory: 0, location: "cursed", bystander: "necromancer", pit: "a bottomless fissure",
                    stagebonus: { setup: `Flip all objectives to their inactive side.` },
                    stagepenalty: { setup: `Each fighter places 1 damage on the Stage Rules card.` },
                    masterplan: randFrom(["actsofterror", "strengtheningforces"]),
                    gloat: [[`Klaatu verata..`, `Nikto!`], [`Even the strongest warriors will fall,`, `In the face of the power of death!`], [`Now I call upon my army of the dead,`, `Arise, my messengers of death! Our time has arrived!`], [`Magic, the darkest magic,`, `My soul swims in it..`]],
                    rivaltext: _.template(' To your horror, you see <%=rivalboost ? `the rotting corpse of ${rival.name} among the zombies that climb out of the ground at ${gPron(enemy, "possessive")} feet.`: `${rival.name} joining ${enemy.boss} in the atrocious rite! Even more zombies climb out of the ground at their feet.`%>'),
                    hottrail: _.template('You notice in the distance ${bossDescription(enemy)}. A coven of dark ${randFrom(["sorcerers","wizards","acolytes","priests","necromancers"])} is gathering around ${gPron(enemy,"object")}, and broken and decayed bodies are rising from the ground. Maybe you can stop this before it has really begun.'),
                    coldtrail: _.template('You see a veritable sea of ââpeople, all of them shambling about, all of them appearing broken and decayed. As you look over the zombies around you, you notice in the distance ${bossDescription(enemy)}.'),
                    clueless: _.template('You see a veritable sea of ââpeople, all of them appearing broken and decayed. They are shambling in the general direction of Ransom City, like driven by a sinister purpose. As you look over the zombies around you, you notice in the distance ${bossDescription(enemy)}.'),
                    prologue: _.template('${trail}, you find yourself at <%=knowledge != "hottrail" ? `${whichPreposition(evilPlace())}`: `the ${evilPlace()}`%>. ${stagevar}<br><br>${ucInit(gPron(enemy,"subject"))} looks at you and raises ${gPron(enemy, "possessive")} hands. "${gloat[0]}" ${gPron(enemy, "subject")} shouts, and is surrounded by ${mysticalSynonym()} energy. "${gloat[1]}" <%=rivalpresence ? rivaltext : `You see even more zombies climb out of the ground at ${gPron(enemy, "possessive")} feet.`%><br><br>${laconicStatement(enemy)}'),
                    finalvar: _.template(' He looks out the window and then nods to you. "See for yourself." Below you see a veritable sea of ââpeople, all of them shambling about, all of them appearing broken and decayed.<br><br>You slide down the climbing rope and watch as the helicopter flies away. As you look over the zombies around you, you notice in the distance ${bossDescription(enemy)}. ${ucInit(gPron(enemy,"subject"))} looks at you and raises ${gPron(enemy,"possessive")} hands. "${gloat[0]}" ${gPron(enemy, "subject")} shouts, and is surrounded by ${mysticalSynonym()} energy. "${gloat[1]}" <%=rivalpresence ? rivaltext : `You see even more zombies climb out of the ground at ${gPron(enemy, "possessive")} feet.`%><br><br>${laconicStatement(enemy)}'),
                    actsofterror: _.template('${trail}, you are flown to your newest target. "We have uncovererd the ${getMasterPlan()} of the ${enemy.name}, Gladiators," Agent Fletch says, shouting over the roar of the helicopter. "${enemy.boss} is using ${mysticalSynonym()} sorcery to raise the dead to ravage the unsuspecting population of Ransom City."${finalvar}'),
                    strengtheningforces: _.template('${trail}, you are flown to your newest target. "We have uncovererd the ${getMasterPlan()} of the ${enemy.name}, Gladiators," Agent Fletch says, shouting over the roar of the helicopter. "${enemy.boss} is using ${mysticalSynonym()} sorcery to raise the dead to add to the ranks of the ${enemy.minions}."${finalvar}')
                },

                {
                    name: "Running Wild", expansion: "legendofoni", instory: 0, location: "remote", bystander: "civilian", pit: "an incredibly deep dig",
                    stagebonus: { setup: `Any fighter may put this card in their play area. <b>Feint:</b> Roll 3 enemy dice; for each different result, remove 1 power from "The Final Key".` },
                    stagepenalty: { setup: `Each fighter places 3 random defense tokens on their copy of "Hunt for the Idols".`, persistent: `The defense tokens on "Hunt for the Idol" block search successes and are discarded as normal.` },
                    masterplan: randFrom(["illegalgains", "personalpower","actsofterror"]),
                    gloat: [[`You wonât stop the inevitable!`, `Iâll end you here, with or without the Oni!`], [`With the idols in my hands,`, `You and the Citadel will burn.`]],
                    rivaltext: _.template(', guided to the location by <%=rivalboost ? `the spirit of Oni possessing`: ``%> ${rival.name}.'),
                    hottrail: _.template('Fortunately, it seems the goons of the ${enemy.name} don\'t have too much of a headway.'),
                    coldtrail: _.template('If you hope to be the first to find them, there\'s no time to waste.'),
                    clueless: _.template('You are late to the party..'),
                    prologue: _.template('${trail}, it seems there are a number of enchanted idols in the forest, according to legend used in a ritual to channel the Oni\'s power. The <%=finalboss.name == enemy.name ? `${enemy.name} is here`: `${finalboss.name} has sent some mercenaries`%> to recover the idols.<br><br>You make your way to this forest and soon find yourself lost in its natural labyrinth. Finding these idols won\'t be easy. To make matters worse, ${bossDescription(enemy)} is there<%=rivalpresence ? `${rivaltext} They are` : ``%> overseeing the dig by the ${enemy.minions} to recover the idols near a crumbling ${evilPlace()}. ${stagevar}<br><br>"${gloat[0]}" ${enemy.boss} shouts at you as ${gPron(enemy, "subject")} watches your approach. "${gloat[1]}"'),
                    finalvar: _.template('You make your way to this forest and soon find yourself lost in its natural labyrinth.<br><br>You eventually find ${bossDescription(enemy)}. "${gloat[0]}" ${gPron(enemy,"subject")} greets you. "${gloat[1]}" If you hope to be the first to find the idols, there\'s no time to waste.'),
                    personalpower: _.template('${trail}, you have learned the ${getMasterPlan()} of ${enemy.boss}. The ${enemy.name} intend to conduct a ritual with enchanted idols hidden deep in the Forest of Sorrow. If they succeed, they will draw the full power of the mystical Oni to ${enemy.boss} ${gPron(enemy,"reflexive")}, and become a force so relentless that the Citadel and the Global Gladiators will not be able to keep them in check. ${finalvar}'),
                    illegalgains: _.template('${trail}, you have learned the ${getMasterPlan()} of ${enemy.boss}. ${enemy.name} intend to retrieve the idols deep within the Forest of Sorrows that according to legend are used to in the ritual to channel Oni\'s power. They will sell them to the highest bidder among a multitude of rogue nations and shadowy organizations. With the funding they will be able to expand their criminal operations in Ransom so that Global Gladiators can to contain them no more. ${finalvar}'),
                    actsofterror: _.template('${trail}, you have learned the ${getMasterPlan()} of ${enemy.boss}. ${enemy.name} intend to conduct a ritual with enchanted idols hidden deep in the Forest of Sorrow. If they succeed, they will use the idols to release the full power of the mystical Oni in Ransom, wiping out most of the city in a calamitous firestorm. ${finalvar}'),
                },

                {
                    name: "Steel Memories", expansion: "riseofthekingdom", instory: 0, location: "base", bystander: "nameless goon", pit: "a pitch-black elevator shaft",
                    stagebonus: { setup: `One fighter may move 3 spaces toward the nearest objective.` },
                    stagepenalty: { setup: `Each fighter must <b>Recruit</b>.` }, 
                    masterplan: randFrom(["actsofterror", "kidnapping"]),
                    gloat: [["Believe me when I say this, Global Gladiators,", "Nobody will leave this room alive!"], ["I'm not even going to kill you myself!", "I'll let my minions take care of that."]],
                    rivaltext: _.template(' accompanied by ${rival.name}<%=rivalboost ? `, eyes green from Vandal dosage, both`: `, both`%>'),
                    hottrail: _.template('surprised by the rapid assault on ${gPron(enemy, "possessive")} fortress. "${gloat[0]}" ${enemy.boss} says as ${gPron(enemy, "subject")} ${enemy.threat}. "${gloat[1]}"'),
                    coldtrail: _.template('standing ready. "I\'m not surprised to see you here," ${enemy.boss} says. "${gloat[0]}" ${gPron(enemy, "subject")} says as ${gPron(enemy, "subject")} ${enemy.threat}. "${gloat[1]}"'),
                    clueless: randFrom([_.template('${trail}, you find out rumors that the ${enemy.bosstitle()} ${enemy.boss} has been openly recruiting soldiers into the ${enemy.name}. As you investigate the matter further, you find out that the ${enemy.name} <%=enemy.name == "Kingdom" ? `is back to its previous practices`: `has adopted the same practices as the Kingdom` %>: testing out new recruits in a savage melee where only the strong survive.<br><br>You try to go undercover, posing as recruits for yourselves. But ${enemy.name} - familiar with your ploy from the past - sees through your plot and throws you into ${gPron(enemy, "possessive")} "pit." You suddenly become the final exam for ${gPron(enemy, "possessive")} would-be recruits... "${gloat[0]}" says ${bossDescription(enemy)}<rivalpresence ? rivaltext : ``> standing there as ${gPron(enemy,"possessive")} minions pour in from the shadows. "${gloat[1]}"'), _.template('${trail}, you investigate a site reported to have acitivy of the ${enemy.name}. You find an elevator an descend down.<%=randFrom([` You wait patiently while a lounge version of ${loungeMusic()} plays over the cheap speakers.`,``])%><br><br>Standing in a pitch black room, you turn around, hoping to find some sort of reference to where exactly you are, but there is none. All you see is the ever-encroaching blackness and the deafening silence surrounding you. And then, cutting through the shadows is a laugh, rolling through the large room to meet you. It is a diabolical sound, smug and evil. It rings through your ears for a moment or two before the lights in the room snap on, almost blinding you with their intensity.<br><br>You blink, and see standing before you ${bossDescription(enemy)}<%=rivalpresence ? rivaltext : ``%> ready to finish it. "${gloat[0]}" ${enemy.boss} says as ${gPron(enemy,"subject")} stalks the darkness. "${gloat[1]}"')]),
                    prologue: _.template('<%=knowledge == "clueless" ? ``: `${trail}, you accompany a large squad of Citadel agents as they storm the ${possessiveSuffix(enemy.name)} base. ${ucInit(enemy.minions)} of the ${enemy.name} fall before you as you make your way through the maze-like halls until you finally reach an elevator, indicated as your goal on your map. As you call it, you hear the sounds of more approaching soldiers. The Citadel agents engage these reinforcements as you head up to face ${enemy.boss}.${randFrom([` You wait patiently while a lounge version of ${loungeMusic()} plays over the cheap speakers.`,``])}<br><br>The elevator doors open to reveal ${bossDescription(enemy)} ${rivalpresence ? rivaltext : ``} ` %>${stagevar} ${laconicStatement(enemy)}'),
                    captured: randFrom([_.template('Hands tied behind your back, you are led by <%=rivalpresence ? rival.name : minion%> and ${bossDescription(enemy)} into an an underground training facility. The room is hosting several fighters, each of them sparring in deadly martial arts. "You\'re not worthy to walk on this ground," <%=rivalpresence ? rival : minion%> growls, glaring at you with a deep-seated hatred. "And so," ${enemy.boss} interjects. "We will allow you the chance to prove your worth. <%=finalboss.boss == enemy.boss? `I have developed a great interest in you. I would be pleased if you\'d demonstrate it to ${rivalpresence ? rival.name : minion}.` : `${finalboss.boss} has taken great interest in you. Show us why that is.`%>"<br><br>"This is unnecessary," <%=rivalpresence ? rival.name : minion%> says quietly to ${enemy.boss}. "You play games with the trust of the <%=finalboss.name == enemy.name ? "Master" : finalboss.name%>." ${enemy.boss} loosens your bonds, ignoring <%=rivalpresence ? possessiveSuffix(rival.name) : possessiveSuffix(minion)%> words. You grab your wrists as they are free, rubbing the pain away, and watch as the other fighters turn toward you.<%=rivalpresence ? `${rivalboost ? ` ${rival.name} moves to end you. "This is ridiculous!"` : ``}` : ``%>'), _.template('Waking up in a pitch black room, you turn around, hoping to find some sort of reference to where exactly you are but you\'re not fully recovered. All you see is the ever-encroaching blackness and the deafening silence surrounding you. And then, cutting through the shadows is a laugh, rolling through the large room to meet you. It is a diabolical sound, smug and evil. It rings through your ears for a moment or two before the lights in the room snap on, almost blinding you with their intensity. <br><br>You blink, and see standing before you ${bossDescription(enemy)}<%=rivalpresence ? rivaltext : ``%> ready to finish it. "${gloat[0]}" ${enemy.boss} says as ${gPron(enemy,"subject")} stalks the darkness. "${gloat[1]}" ${laconicStatement(enemy)}')]),
                    actsofterror: _.template('${trail}, Agent Fletch explains to you the ${getMasterPlan()} of the ${enemy.name}: "${enemy.boss} has provided the citizens of Ransom City a release for all the hatred, violence, and aggression that they keep up inside them." He leans over the satellite image of the city and continues. "With the people whipped up to a frenzy, a 12 hour marathon of crimes of every imaginable sort - including murder - will start right here," he points at the map. "Unless you can stop the spread of the mob mentality, I don\'t think Ransom will survive the night."<br><br>You move in to confront the mob and the perturbing ${enemy.minions} of the ${enemy.name}.'),
                    kidnapping: _.template('${trail}, you accompany a large squad of Citadel agents as they storm the ${possessiveSuffix(enemy.name)} base where the ${vip[0]} is being held. ${ucInit(enemy.minions)} of the ${enemy.name} fall before you as you make your way through the maze-like halls until you finally reach an elevator, indicated as your goal on your map. As you call it, you hear the sounds of more approaching soldiers. The Citadel agents engage these reinforcements as you head up to face ${enemy.boss}.<%=randFrom([` You wait patiently while a lounge version of ${loungeMusic()} plays over the cheap speakers.`,``])%><br><br>The elevator doors open to reveal ${bossDescription(enemy)}<%=rivalpresence ? rivaltext : ``%> standing ready. "${gloat[0]}" ${enemy.boss} says. "${gloat[1]}"<br><br>${laconicStatement(enemy)}')
                },

                {
                    name: "Sudden Death", expansion: "riseofthekingdom", instory: 0, location: "neutral", bystander: "challenger", pit: "a collapsed portion of the floor",
                    stagebonus: { setup: `Put one random defense token on each copy of "A New Challenger".` },
                    stagepenalty: { setup: `All the objective tokens advance 2 spaces toward the boss.` },
                    masterplan: randFrom(["kidnapping", "strengtheningforces"]),
                    gloat: [[`This is a private affair, Gladiators,`, `You should not have intervened.`], [`In the end,`, `There can be only one!`]],
                    rivaltext: _.template(' To your surprise you see ${rival.name} is among the fighters,<%=rivalboost ? ` quite jacked up,`: ``%> eyes on you.'),
                    hottrail: _.template('You walk calmly into the underground tournament. "I\'m here to compete in this fine affair!" you announce. "I assume you still have room, no?" Taken aback by your sudden, bold appearance, ${bossDescription(enemy)} ${enemy.threat}.<%=rivalpresence ? rivaltext : ``%> "${gloat[0]}" ${gPron(enemy,"subject")} growls. "${gloat[1]}"'),
                    coldtrail: _.template('You infiltrate the underground tournament, and arrive just in time.<%=rivalpresence ? rivaltext : ``%> ${bossDescription(enemy)}, ${enemy.threat}. You see that none of the competitors are a match for a killer like ${gPron(enemy,"object")}. "${gloat[0]}" ${gPron(enemy,"subject")} laughs. "${gloat[1]}"'),
                    clueless: _.template('You have to fight your way through the ${enemy.minions} securing the underground tournament. When you arrive, you are exhausted, and the see that none of the competitors are a match for a killer like ${gPron(enemy,"object")}.<%=rivalpresence ? rivaltext : ``%> ${bossDescription(enemy)} ${enemy.threat}. "${gloat[0]}" ${gPron(enemy,"subject")} laughs. "${gloat[1]}"'),
                    prologue: _.template('${trail}, you enter a competition that is modeled after <%=enemy.name == "Kingdom" && knowledge == "hottrail" ? `their`: `the Kingdom\'s`%> now infamous trials: the winners will be offered prestigious positions as officers in the ${possessiveSuffix(enemy.name)} armed forces, and those who refuse will be captured and killed. You couldn\'t let this happen.<br><br>${stagevar}<br><br>${laconicStatement(enemy)}'),
                    captured: _.template('Hands tied behind your back, you are led by <%=rivalpresence ? rival.name : minion%> and ${bossDescription(enemy)} into an an oddly-placed urban clearing. The out-of-place streets are hosting several fighters, each of them sparring in deadly martial arts. "You\'re not worthy to walk on this ground," <%=rivalpresence ? rival.name : minion%> growls, glaring at you with a deep-seated hatred. "And so," ${enemy.boss} interjects. "We will allow you the chance to prove your worth. <%=finalboss.boss == enemy.boss? `I have developed a great interest in you. I would be pleased if you\'d demonstrate it to ${rivalpresence ? rival.name : minion}.` : `${finalboss.boss} has taken great interest in you. Show us why that is.`%>"<br><br>"This is unnecessary," <%=rivalpresence ? rival.name : minion%> says quietly to ${enemy.boss}. "You play games with the trust of the <%=finalboss.name == enemy.name ? "Master" : finalboss.name%>." ${enemy.boss} loosens your bonds, ignoring <%=rivalpresence ? possessiveSuffix(rival.name) : possessiveSuffix(minion)%> words. You grab your wrists as they are free, rubbing the pain away, and watch as the other fighters turn toward ${enemy.boss}, preparing for what you\'re assuming will be a fight to the death.  The other fighters show no fear; their eyes looking only for glory.<%=rivalpresence ? `${rivalboost ? ` ${rival.name} moves to end you. "This is ridiculous!"` : ``}` : ``%> '),
                    finalvar: _.template('${trail}, you learn the ${getMasterPlan()} of the ${enemy.name}. They have arranged a competition modeled after <%=enemy.name == "Kingdom" ? `their`: `the Kingdom\'s`%> original grand tournament where <%= enemy.name == "Kingdom" ? "they" : "the Kingdom"%> initially revealed their diabolical motives'),
                    kidnapping: _.template('${finalvar}, only this time they have the ${vip[0]} ${randFrom(["him","her"])}self participate in a fight to death for ${possessiveSuffix(enemy.name)} amusement.<br><br>You infiltrate the underground tournament, and hear ${enemy.boss} explaining: "So, today\'s mission is: You fight me until there\'s only one left. Nothing\'s against the rules. The last of you standing gets to leave". At that, you reveal yourselves. "${gloat[0]}" ${gPron(enemy, "subject")} addresses you. "${gloat[1]}"'),
                    strengtheningforces: _.template('${finalvar}. They<%= enemy.name == "Kingdom" ? " again" : `` %> play host to hundreds of fighters from all over the globe, and the media seems to have forgotten how the previous bout turned out. While the coverage of the tournament is again focused on the sold-out arenas that showcase the high profile fights, you learn of a network of underground street fights focused on bringing the most ruthless fighters and depraved killers out of the woodwork.<br><br>You once more enter the fight to shut down ${enemy.name} efforts first hand.')
                },

                {
                    name: "Supply & Demand", expansion: "riseofthekingdom", instory: 0, location: "neutral", bystander: "customer", pit: `a manhole`,
                    stagebonus: { setup: `Any fighter may put this card in their play area. <b>Feint:</b> Remove this card from the game to choose one enemy to drop an objective token it is carrying.` },
                    stagepenalty: { setup: `The boss gains 1 defense token of each type. Each fighter is dealt 1 direct damage.` },
                    masterplan: randFrom(["strengtheningforces", "illegalgains"]),
                    gloat: [[`You think fighting me in some landfill is going to stop the downfall of Ransom?`, `I'm not your problem. I'm just doing business.`],[`Just say no!" you tell it like it is. "Okay. 'No.'`, `Now what?`]],
                    rivaltext: _.template(', ${rival.name} at ${gPron(enemy,"possessive")} side<%=rivalboost ? `. ${rival.name} looks to have taken more than just a sample of the product`: ``%>'),
                    hottrail: _.template('you work your way to the property'),
                    coldtrail: _.template('you find out about an abandoned property where a drug deal is taking place. You work your way to the property'),
                    clueless: _.template('you stumble upon an abandoned lot'),
                    prologue: _.template('${trail}, ${stagevar} to find a group of ${enemy.minions} of the ${enemy.name} carrying large crates to their clients from the rear entrance. Standing nearby, ${enemy.boss} watches over the activity<%=rivalpresence ? rivaltext : ``%>.<br><br>During their work, one of the goons spots you and drops <%=randFrom(["his","her"])%> crate, a large amount of illegal drugs spilling out onto the concrete. You duck behind cover, and hear ${enemy.boss} roar in rage at the goon\'s clumsiness, yet it only takes a few exchanged words before you are given up. "${gloat[0]}" calls ${bossDescription(enemy)}. "${gloat[1]} Now face your opponent head-on!" The ensuing gunfire convinces you otherwise.'),
                    finalvar: _.template('"${gloat[0]}" calls ${bossDescription(enemy)}<%=rivalpresence ? rivaltext : ``%>. "${gloat[1]}"'),
                    strengtheningforces: _.template('${trail}, you have figured out the ${getMasterPlan()} of ${enemy.boss}. The ${enemy.name} will flood the black market with their modified strain of ${randFrom(["Dynasty", "Vandal", "Dark Matter"])}-enhanced drugs, and the users will join their ranks as thralls! You move in on their distribution center to find a group of ${enemy.minions} of the ${enemy.name} carrying large crates to their clients from the rear entrance. Standing nearby, ${enemy.boss} watches over the activity<%=rivalpresence ? rivaltext : ``%>.<br><br>During their work, one of the goons spots you and drops <%=randFrom(["his","her"])%> crate, a large amount of the drugs spilling out onto the concrete. You duck behind cover, and hear ${enemy.boss} roar in rage at the goon\'s clumsiness, yet it only takes a few exchanged words before you are given up. "${gloat[0]}" calls ${bossDescription(enemy)}. "${gloat[1]} Now face your opponent head-on!" The ensuing gunfire convinces you otherwise.'),
                    illegalgains: _.template('${trail}, you have figured out the ${getMasterPlan()} of ${enemy.boss}. The ${enemy.name} has a contant in international drug trade for their modified strain of ${randFrom(["Dynasty", "Vandal", "Dark Matter"])}. This will make them wealthy beyond measure, and they will be able to expand their criminal operations without limits.<br><br>Agent Fletch sits behind the pilot\'s seat of the plane to Delta Keys as you lean in from the back. "We\'re coming up on the ${possessiveSuffix(enemy.name)} location," he says to you.  "I\'ll see if I can put her down over-" His words are interrupted as an explosion from ${getEnemyAttack(enemy, "antiair", "an anti-air shell")} shakes the plane.  "Nevermind, looks like you\'re jumping in!"  Grabbing a parachute, you leap from the plane as it peels off and heads toward safety.  You land just outside the camp that was firing at the Citadel aircraft, and you hear gunfire in the distance.  "We\'ve reached the camp," you say to Fletch via your radio. ${finalvar}')
                },

                {
                    name: "Under Destruction", expansion: "twintiger", instory: 0, location: "neutral", bystander: "construction worker", pit: "an out-of-commission elevator shaft",
                    stagebonus: { persistent: `<b>Exhaust:</b> Move 1 power from a Time Bomb card to this card. Then, if there's 5 power on this card, remove it from the game.` },
                    stagepenalty: { setup: `Each fighter chooses an objective card and places 1 power on that objective.` },
                    masterplan: randFrom(["actsofterror"]),
                    gloat: [[`Cool guys don't look at explosions,`, `So gape all you want!`], [`Most problems with Gladiators can be solved,`, `By an appropriate charge of high explosives.`], [`Most problems can be solved with an appropriate charge of high explosives,`, `The trick is not to be around when they go off.`], [`It happens sometimes,`, `People just explode. Natural causes.`], [`Why do you have to nuke the whole building?" you ask. "Well, when you do something minor, you can just disappear,`, `When you do something like we will, they will find you unless they think you're dead.`], [`Enough bombs have been planted in this building so none survive,`, `You'll die with us," you answer. "Could be.`], [`Explosives, buzzsaws, a good old-fashioned beating.. There are so many alternatives,`, `How do you wish to die?`]],
                    rivaltext: _.template(', and ${rival.name} emerges from the shadows<%=rivalboost ? `, eyes glowing green` : ``%>.'),
                    hottrail: _.template('You arrive at the site, and inside you find surprised ${bossDescription(enemy)}. "Arm the bombs and let\'s get out of here," ${gPron(enemy,"subject")} commands ${gPron(enemy,"possessive")} goons<%=rivalpresence? rivaltext : `.`%> "${gloat[0]}" ${enemy.boss} says, eyeing you. "${gloat[1]}"'),
                    coldtrail: _.template('You arrive at the site, and beat the few ${enemy.minions} guarding the area. Inside, you find ${bossDescription(enemy)}. "Arm the bombs and let\'s get out of here," ${gPron(enemy,"subject")} commands ${gPron(enemy,"possessive")} goons<%=rivalpresence? rivaltext : ``%>. "${gloat[0]}" ${enemy.boss} says, eyeing you. "${gloat[1]}"'),
                    clueless: _.template('Unfortunately, you may have arrived too late.. "Arm the bombs and let\'s get out of here," a voice commands from behind a plastic sheet. When the sheet is thrown aside, ${bossDescription(enemy)} steps into view<%=rivalpresence? rivaltext : `.`%> ${possessiveSuffix(enemy.boss)} eyes immediately dart from the placed explosives. Without hesitation, ${gPron(enemy, "subject")} attacks.'),
                    prologue: _.template('${trail}, it didn\'t take long to find out ${enemy.name} had been busy setting up an intricate series of explosives at a construction site for a planned ${randFrom([`research facility`,`headquarters`,`manufacturing facility`])} of a ${randFrom([`cutting edge medical company`,`weapons manufacturer`,`chemical manufacturer`,`cybernetics research company`])}. How is the ${finalboss.name} connected? There is only one way to find out.<br><br>${stagevar}<br><br>${laconicStatement(enemy)}'),
                    captured: _.template('You wake up on cold concrete floor and try to get your bearings. Suddenly, ${enemy.boss} steps out from the shadows. "Welcome, ${enemy.addressing}! Nice of you to join us!"<br><br>You note that ${enemy.minions} are suddenly blocking every exit, except for the one ${enemy.boss} is guarding, and explosives are rigged everywhere<%=rivalpresence ? rivaltext : ``%>. ${ucInit(gPron(enemy,"subject"))} plans to bury you under tons of rubble!<%=rivalpresence ? rivaltext : ``%> "${gloat[0]}" ${enemy.boss} says as you pick yourselves up to face them. "${gloat[1]}"<br><br>${laconicStatement(enemy)}'),
                    actsofterror: _.template('${trail}, it didn\'t take long to find out the ${enemy.name} ${getMasterPlan()}: to set up bombs with enough force to level most of the city block, or possibly the whole city. You have no clue what the ${enemy.name} would gain from such orchestrated chaos, but you know they have been busy setting up an intricate series of explosives at a construction site for a planned ${randFrom([`research facility`,`headquarters`,`manufacturing facility`])} of a ${randFrom([`cutting edge medical company`,`weapons manufacturer`,`chemical manufacturer`,`cybernetics research company`])}.<br><br>Unfortunately, you may have arrived too late.. "Arm the bombs and let\'s get out of here," a voice commands from behind a plastic sheet. When the sheet is thrown aside, ${bossDescription(enemy)} steps into view<%=rivalpresence? rivaltext : `.`%> ${possessiveSuffix(enemy.boss)} eyes immediately dart from the placed explosives. Without hesitation, ${gPron(enemy, "subject")} attacks.${laconicStatement(enemy)}')
                }
            ];

            stages = stages.filter(stage => expansionfilter.includes(stage.expansion))

            enemiescopy = enemies.slice(0, enemies.length)

            let globalgladiators = globalGladiators(enemies, stages)

            let herostages = []
            let supportingcast = []
            let heronames = []
            let heroenemies = []

            $(globalgladiators).each(function () {
                herostages.push(this.stage)
                supportingcast = _.union(supportingcast, this.ally)
                supportingcast = _.union(supportingcast, this.rival)
                heronames.push(this.name)
                $(this.enemy).each(function () { heroenemies.push(this) })
            })

            herostages = _.flatten(herostages)

            herostages = (_.uniq(herostages)).filter(function (el) { return el; });
            supportingcast = (_.uniq(supportingcast)).filter(function (el) { return el; });
            heroenemies = (_.uniq(heroenemies)).filter(function (el) { return el; });

            let alliesandrivals = [
                { name: "Ah Long", expansion: "riseofthekingdom", gender: "male", keywords: ["Boss", "Golden Dragons", "Organized Crime", "Martial Arts Master", "Chi", "Clone", "Ah Long"] },
                { name: "Ah Long of Brook City", expansion: "keystothekingdom", gender: "male", keywords: ["Boss", "Brook City", "Golden Dragons", "Organized Crime", "Past", "Clone", "Ah Long of Brook City"] },
                { name: "Anastasia", expansion: "redemption", gender: "female", keywords: ["Brotherhood", "Black Ops", "Gunslinger", "Soldier", "Clone"] },
                { name: "Brandon", expansion: "redemption2", gender: "male", keywords: ["Celebrity", "Fraud", "Martial Arts Master", "Global Gladiator", "Wanderer", "Clone", "Brandon"] },
                { name: "Chan Chan", expansion: "stretchgoals17", gender: "female", keywords: ["Beast", "Dark Matter", "Martial Arts Master", "Kingdom", "Insane", "Clone"] },
                { name: "Clinhyde Eight", expansion: "battlecon", gender: "male", keywords: ["Black Ops", "Indines", "Psychic", "Toxic", "Clone"] },
                { name: "Darius", expansion: "redemption", gender: "male", keywords: ["Past", "Kingdom", "Martial Arts Master", "Toxic", "Clone", "Kemono"] },
                { name: "Dmitri", expansion: "riseofthekingdom", gender: "male", keywords: ["Boss", "Black Ops", "Brotherhood", "Soldier", "Clone"] },
                { name: "Drago", expansion: "riseofthekingdom", gender: "male", keywords: ["Black Ops", "Brotherhood", "Competitor", "Street", "Clone", "Gabriel"] },
                { name: "Gabriel", expansion: "redemption2", gender: "male", keywords: ["Global Gladiator", "Martial Arts Master", "Street", "Wanderer", "Clone", "Gabriel"] },
                { name: "Genesis", expansion: "redemption2", gender: "female", keywords: ["Cifarelli", "Organized Crime", "Extraplanar", "Street", "Clone", "Music"] },
                { name: "Hanzo", expansion: "riseofthekingdom", gender: "male", keywords: ["Past", "Sensei", "Wanderer", "Blade", "Global Gladiator", "Kingdom", "Clone"] },
                { name: "Isabella", expansion: "riseofthekingdom", gender: "female", keywords: ["Celebrity", "Martial Arts Master", "Wanderer", "Clone", "Brandon", "Golden Dragons"] },
                { name: "Jackal", expansion: "riseofthekingdom", gender: "female", keywords: ["Dark Matter", "Insane", "Kingdom", "Psychic", "Science", "Clone", "Jackal"] },
                { name: "James Wong", expansion: "keystothekingdom", gender: "male", keywords: ["Black Ops", "Brook City", "Law Enforcement", "Kingdom", "Past", "Clone"] },
                { name: "Jin", expansion: "riseofthekingdom", gender: "male", keywords: ["Golden Dragons", "Organized Crime", "Blade", "Law Enforcement", "Clone", "Ying Hua"] },
                { name: "Juan", expansion: "riseofthekingdom", gender: "male", keywords: ["Cartel", "Organized Crime", "Gunslinger", "Street", "Clone", "Juan"] },
                { name: "Kemono", expansion: "riseofthekingdom", gender: "male", keywords: ["Beast", "Kingdom", "Competitor", "Chi", "Clone", "Kemono", "Tlazolteotl", "Horseman", "Aztec"] },
                { name: "Khadath Ahemusei", expansion: "battlecon", gender: "male", keywords: ["Indines", "Science", "Extraplanar", "Wanderer", "Clone"] },
                /*                 leeta is in redemption too, fix */
                { name: "Leeta", expansion: "twintiger", gender: "female", keywords: ["Brook City", "Street", "Wanderer", "Past", "Clone"] },
                { name: "Lotus", expansion: "keystothekingdom", gender: "female", keywords: ["Brook City", "Golden Dragons", "Organized Crime", "Past", "Clone", "Ah Long of Brook City"] },
                { name: "Marionette Doll", expansion: "redemption2", gender: "female", keywords: ["Dark Matter", "Kingdom", "Martial Arts Master", "Psychic", "Clone", "Shin Yokai"] },
                { name: "Mary Ann", expansion: "twintiger", gender: "female", keywords: ["Street", "Clone", "Twin Tiger", "Onyx League", "Youth"] },
                { name: "Megan", expansion: "redemption2", gender: "female", keywords: ["Celebrity", "Chi", "Fraud", "Global Gladiator", "Martial Arts Master", "Wanderer", "Clone", "Megan", "Law Enforcement", "Mr. Apple"] },
                { name: "Mr. Apple", expansion: "stretchgoals17", gender: "male", keywords: ["Celebrity", "Fraud", "Sensei", "Music", "Clone", "Mr. Apple"] },
                { name: "Natalia", expansion: "redemption2", gender: "female", keywords: ["Black Ops", "Global Gladiator", "Martial Arts Master", "Soldier", "Wanderer", "Clone", "Natalia", "Project X", "Street"] },
                { name: "Power Soldier", expansion: "redemption2", gender: "male", keywords: ["Dark Matter", "Beast", "Black Ops", "Kingdom", "Martial Arts Master", "Clone"] },
                { name: "Project X", expansion: "redemption", gender: "female", keywords: ["Dark Matter", "Beast", "Insane", "Martial Arts Master", "Youth", "Clone", "Jackal", "Project X"] },
                { name: "Sera O'Quinn", expansion: "riseofthekingdom", gender: "female", keywords: ["Boss", "Celebrity", "Insane", "Organized Crime", "Clone", "Megan", "Sera O'Quinn"] },
                { name: "Shadow", expansion: "riseofthekingdom", gender: "male", keywords: ["Boss", "Kingdom", "Martial Arts Master", "Chi", "Clone", "Shadow", "Horseman", "Sensei"] },
                { name: "Shin Yokai", expansion: "redemption", gender: "male", keywords: ["Boss", "Insane", "Extraplanar", "Chi", "Clone", "Shadow", "Shin Yokai", "Horseman"] },
                { name: "Star Knight Iri", expansion: "battlecon", gender: "female", keywords: ["Indines", "Extraplanar", "Blade", "Soldier", "Clone"] },
                { name: "Tiger Azules", expansion: "redemption", gender: "male", keywords: ["Aztec", "Street", "Cartel", "Martial Arts Master", "Clone", "Juan", "Wanderer"] },
                { name: "Tlazolteotl", expansion: "redemption2", gender: "female", keywords: ["Past", "Aztec", "Boss", "Extraplanar", "Clone", "Tlazolteotl"] },
                { name: "Wan Bo", expansion: "redemption", gender: "male", keywords: ["Golden Dragons", "Martial Arts Master", "Chi", "Monk", "Clone", "Ah Long"] },
                { name: "Ying Hua", expansion: "redemption2", gender: "female", keywords: ["Global Gladiator", "Law Enforcement", "Martial Arts Master", "Science", "Clone", "Ying Hua"] },
                { name: "Ying Hua of Brook City", expansion: "keystothekingdom", gender: "female", keywords: ["Brook City", "Law Enforcement", "Past", "Science", "Clone"] },
                { name: "Zane", expansion: "riseofthekingdom", gender: "male", keywords: ["Competitor", "Chi", "Youth", "Clone", "Natalia"] }
            ];

            alliesandrivals = alliesandrivals.filter(character => expansionfilter.includes(character.expansion))

            for (i = alliesandrivals.length - 1; i > 0; i--) {
                if (supportingcast.includes(alliesandrivals[i].name)) {
                    alliesandrivals.splice([i], 1)

                }
            }
            let allymotivation = getMotivation(alliesandrivals)

            let allygroup = []

            while (allygroup.length < $("#players").val()) {
                let random = Math.floor(Math.random() * alliesandrivals.length)
                let ally = alliesandrivals[random]
                if (ally.keywords.includes(allymotivation)) {
                    allygroup.push(ally)
                    alliesandrivals.splice(random, 1)
                }
            }

            let rivalmotivation = getMotivation(alliesandrivals)

            let rivalgroup = []
            while (rivalgroup.length < $("#players").val()) {
                let random = Math.floor(Math.random() * alliesandrivals.length)
                let rival = alliesandrivals[random]
                if (rival.keywords.includes(rivalmotivation)) {
                    rivalgroup.push(rival)
                    alliesandrivals.splice(random, 1)
                }
            }


            for (i = 0; i < stages.length; i++) {
                for (y = 0; y < herostages.length; y++) {
                    if (herostages[y] === stages[i].name) {
                        stages[i].instory = stages[i].instory + 1
                    }
                }
            }

            stages = cleanStages(stages);

            let storystages = storyStages(stages);

            stages = storystages[1].splice(0)

            storystages = storystages[0].splice(0)

            let storyenemies = storyEnemies(storystages, enemies, heroenemies);

            enemies = storyenemies[1].splice(0)

            storyenemies = storyenemies[0].splice(0)

            let story = compileStory(storystages, storyenemies)

            $(story).each(function (i) {
                story[i].stage.knowledge = defineKnowledge(i, story)
            })

            let finalboss = story[Math.max($("#storylength").val()*2-3,0)].enemy

            let stageindex = 0;

            let storyname = String(storyNamer(finalboss, story[Math.max($("#storylength").val()*2-3,0)].stage))

            let referencetext = referenceText(globalgladiators, allygroup, allymotivation, rivalgroup, rivalmotivation, finalboss)

            let cardtexts = textMaker(story, alliesandrivals, heronames, enemies);

            let pagecontent = { reference: referencetext, text: cardtexts, storyname: storyname, finalboss: finalboss.name }

            createPageContent(pagecontent)


        }

        function defineAddressing(enemy) {

            let addressing = randFrom([enemy.addressing, "Global Gladiators", "Gladiators"])

            return addressing
        }

        function gPron(character, form) {
            let gPron

            switch (character.gender) {
                case "male":
                    switch (form) {
                        case "subject": gPron = "he";
                            break;
                        case "object": gPron = "him";
                            break;
                        case "possessive": gPron = "his";
                            break;
                        case "reflexive": gPron = "himself";
                            break;
                        case "sex": gPron = "man";
                            break;
                        default: gPron = "UNDEFINED"
                    }
                    break;
                case "female":
                    switch (form) {
                        case "subject": gPron = "she";
                            break;
                        case "object":
                        case "possessive": gPron = "her";
                            break;
                        case "reflexive": gPron = "herself";
                            break;
                        case "sex": gPron = "woman";
                            break;
                        default: gPron = "UNDEFINED";
                    }
                    break;
                default:
                    gPron = "UNDEFINED"

            }
            return gPron

        }

        function ucInit(word) {
            let result = word.charAt(0).toUpperCase() + word.substring(1);
            return result
        }

        function lowerCaseInitial(word) {
            let result = word.charAt(0).toLowerCase() + word.substring(1);
            return result
        }

        function whichPreposition(word) {
            if (/[aeiou]/.test(word.toLowerCase().charAt(0))) {
                return "an " + word
            } else {
                return "a " + word
            }
        }

        function latestScheme(enemy) {
            let latestscheme = [
                `In Citadel's ongoing investigations, rumors have been uncovered that`,
                `In the wake of the Kingdom's latest scheme, the Citadel has learned a new threat on the rise: `,
                `Following the aftermath of the Kingdom's latest scheme,`,
                `The Citadel has learned the nefarious motives behind the latest criminal activities: `,
                `In a situation familiar to the Citadel and Global Gladiators, `,
                `In a street-level recon operation, Citadel has uncovered a job fit for Global Gladiators: `,
                `Thanks to Citadel's resourcefulness and your familiarity with the Kingdom's street-level activity, there's new intel that`,
                `You have received a note signed by the ${enemy.name} boss that instructs you not to interfere or you'll be in for the fight of your lives, as `,
                `Responding to a crisis, the Global Gladiators are called into action. You come into play as `,
                `The previous team of Gladiators has not been heard of. Communications disruption can mean only one thing: `,
                `Thought defeated for good, your old nemesis has returned with vengenace: `,
                `For months, the citizens of Ransom City have struggled against the relentless criminal forces. Further resistance seems impossible, as `,
                `Ransom City had been breeding ground for crime and corruption long before the shadow of ${enemy.name == "Kingdom" ? "the Master" : "the Kingdom"} fell over, thanks to a large portion of the presence of the ${enemy.name}. Following the aftermath of the Kingdom's latest scheme,`
            ];
            latestscheme = randFrom(latestscheme);
            return latestscheme
        }

        function preGamePrologue(stage, enemy) {

            //more masterplans: complete desctruction; activate superweapon?

            let latestscheme = latestScheme(enemy)

            let masterplan

            let vip = randFrom([["President", "White House"], ["Colonel", "Pentagon"], ["Mayor", "city hall"], ["Police Chief", "Ransom P.D. headquarters"], ["Citadel commander", "Citadel HQ"]])

            switch (stage.masterplan) {
                case "actsofterror": masterplan = `the vicious criminal syndicate ${enemy.name} believes they do not have to bow to the government or even the
    police force of Ransom City. ${enemy.boss} is going to let everyone know that Ransom has become a center of violence and crime where no-one is safe. `
                    break;
                case "illegalgains": masterplan = `the ${possessiveSuffix(enemy.name)} vast network of crime and 
        ${(enemy.desc).replace("the", "")} require substantial financial pipelines, and ${enemy.boss} is organizing a big score to fund
        ${gPron(enemy, "possessive")} operations. `
                    break;
                case "kidnapping": masterplan = randFrom(
                    [`the ${vip[1]} is not the exception to the rampant crimes related to the Kingdom these days. The ${vip[0]} has been kidnapped by the ${enemy.minions} of ${enemy.boss}. Are you a bad enough dude to rescue the ${vip[0]}? `,
                    `${enemy.boss} is holding Ransom City captive and the ${vip[0]} hostage. With ${gPron(enemy, "possessive")} gang of ${enemy.minions}, nobody but you can stop ${gPron(enemy, "object")} now. `])
                    break;
                case "strengtheningforces": masterplan = `the ${enemy.bosstitle()} ${enemy.boss} has been covertly making efforts to
            strengthen the forces of the ${enemy.name}. Their plans must be thwarted before their forces become unstoppable. `
                    break;
                case "personalpower": masterplan = `the ${enemy.bosstitle()} ${enemy.boss} has moved across the region with ${gPron(enemy, "possessive")}
        ${enemy.minions} in search for power. If ${gPron(enemy, "possessive")} power levels will near five figures, ${gPron(enemy, "subject")}
        just might become invincible. `
            }


            masterplan = { storytext: latestscheme + " " + masterplan, vip: vip }

            return masterplan
        }

        function mysticalSynonym() {


            let mystical = ["esoteric", "magical", "arcane", "ethereal", "mystical", "cabalistic", "mysterious", "occult", "obscure", "cryptic", "fabulous secret", "strange"];
            mystical = mystical[Math.floor(Math.random() * mystical.length)];

            return mystical;

        }

        function getMotivation(alliesandrivals) {

            let supportmotivate = []
            $(alliesandrivals).each(function () {
                supportmotivate = supportmotivate.concat(this.keywords)
            })

            let motivations = supportmotivate.reduce((r, k) => { r[k] = 1 + r[k] || 1; return r }, {})

            motivations = _.pickBy(motivations, function (o) {
                return o >= $("#players").val();
            })

            return (randFrom(Object.keys(motivations)))

        }

        function cleanStages(stages) {

            for (i = 0; i < stages.length; i++) {
                if (stages[i].instory >= 2) {
                    stages.splice(i, 1);
                    i = i - 1;
                }
            }

            return stages
        }

        function storyNamer(finalboss, finalstage, number = 16) {

            let bossadjectives
            let bossnouns
            let stageadjectives
            let stagenouns
            let adjectives = ["Avenging", "Deadly", "Final", "Mortal", "Double", "Twin", "Fighting", "Bad", "Mysterious", "Lost", "Unleashed", "New", "Eternal", "Forever", "Ultimate", "Evil"];
            let nouns = [["Revenge", "Revenge"], ["Fate", "Fates"], ["Destiny", "Destiny"], ["Redemption", "Redemption"], ["Aftershock", "Aftershock"], ["Warrior", "Warriors"], ["Combat", "Kombat"], ["Fighter", "Fighters"], ["Force", "Forces"], ["Thug", "Thugs"], ["Rage", "Rage"], ["City", "City"], ["Ransom", "Ransom"], ["Fight", "Fights"], ["Kingdom", "Kingdoms"], ["Street", "Streets"], ["Master", "Masters"], ["Rise", "Rise"], ["Legend", "Legends"]];

            switch (finalboss.boss) {
                case "Ah Long":
                    bossadjectives = ["Heavenly", "Phasing", "Golden", "Black", "Merciless", "Invincible", "Shadowy"]
                    bossnouns = [["Dragon", "Dragons"], ["Businessman", "Businessmen"], ["Hook", "Hooks"], ["Karate", "Karate"], ["Kendo", "Kendo"], ["Jing Wu", "Jing Wu"], ["Punch", "Punches"], ["Triad", "Triads"], ["Yakuza", "Yakuza"], ["Monk", "Monks"], ["Typhoon", "Typhoons"], ["Kick", "Kicks"], ["Shadowson", "Shadowsons"], ["Clutch", "Clutces"], ["Katana", "Katana"], ["Staff", "Staves"], ["Knuckle-Duster", "Knuckle-Dusters"]]
                    break;
                case "Dmitri":
                    bossadjectives = ["Punishing", "Modified", "Trusty", "Steely", "Loaded", "Extra", "Russian", "Eastern", "Military", "Angry", "Strong", "Skilled", "Loyal", "Espionage", "Undercover"]
                    bossnouns = [["Knife", "Knives"], ["Brotherhood", "Brotherhood"], ["Knife", "Knives"], ["Rocket", "Rockets"], ["Rocket Launcher", "Rocket Launchers"], ["Kevlar", "Kevlar"], ["Defense", "Defenses"], ["Hold", "Holds"], ["Ammo", "Ammo"], ["Mercenary", "Mercenaries"], ["Soldier", "Soldiers"], ["Spy", "Spies"], ["Honor", "Honor"], ["Hit", "Hits"], ["Sabotage", "Sabotage"], ["General", "Generals"]]
                    break;
                case "Jackal":
                    bossadjectives = ["Broken", "Neural", "Dark", "Wild", "Mad", "Insane", "Genius", "Torturous", "Unbelievable", "Scientific", "Experimental"]
                    bossnouns = [["Kingdom", "Kingdom"], ["Scientist", "Scientists"], ["Jackal", "Jackals"], ["Experiment", "Experiments"], ["Matter", "Matters"], ["Sister", "Sisters"], ["Flesh", "Flesh"], ["Lances", "Lances"], ["Invasion", "Invasion"], ["Mold", "Molds"], ["Ninja", "Ninja"], ["Clone", "Clones"], ["General", "Generals"], ["Mountain", "Mountains"], ["Marionette", "Marionettes"], ["Soldier", "Soldiers"], ["Doll", "Dolls"]]
                    break;
                case "Juan":
                    bossadjectives = ["Unloading", "Getaway", "Alert", "Hard", "Honorable", "Ruthless", "Avenging", "One", "Loyal", "Devoted"]
                    bossnouns = [["Getaway", "Getaway"], ["Revenge", "Revenge"], ["Cartel", "Cartel"], ["Flintlock", "Flintlocks"], ["Code", "Code"], ["Orphan", "Orphans"], ["Outcast", "Outcasts"], ["Gun", "Guns"], ["Gangster", "Gangsters"], ["Extortion", "Extortion"], ["Honor", "Honor"], ["Protection", "Protection"], ["Carbine", "Carbines"], ["Human Shield", "Human Shields"], ["Double Barrels", "Double Barrels"], ["Family", "Families"], ["Drug", "Drugs"], ["Gang", "Gangs"], ["Bat", "Bats"], ["Dealer", "Dealers"], ["Ganger", "Gangers"]]
                    break;
                case "Kemono":
                    bossadjectives = ["Apocalypse", "Imposing", "Green", "Enraged", "Hulking", "Loyal", "Uncontrollable", "Crackling", "Static", "Quadruple", "Electrical", "Savage", "Mountain"]
                    bossnouns = [["Hulk", "Hulk"], ["Kingdom", "Kingdom"], ["Mutant", "Mutants"], ["Horseman", "Horsemen"], ["Beast", "Beasts"], ["Surge", "Surges"], ["Lash", "Lashes"], ["Grab", "Grabs"], ["Arms", "Arms"], ["Prowess", "Prowess"], ["Current", "Currents"], ["Brute", "Brutes"], ["Ninja", "Ninja"], ["Clone", "Clones"], ["General", "Generals"], ["Mountain", "Mountains"], ["Marionette", "Marionettes"], ["Soldier", "Soldiers"], ["Doll", "Dolls"]]
                    break;
                case "Mack":
                    bossadjectives = ["Hot", "Suppressing", "Black-Hearted", "Aimed", "Ruthless", "Reckless", "Whipped", "Anarchic"]
                    bossnouns = [["Trigger", "Triggers"], ["Lead", "Lead"], ["Fire", "Fire"], ["Crosshair", "Crosshairs"], ["Salt", "Salt"], ["Pepper", "Pepper"], ["Blackheart", "Blackheart"], ["Mercy", "Mercy"], ["Overlord", "Overlords"], ["Protection", "Protection"], ["Gang", "Gangs"], ["Machine Gun", "Machine Guns"], ["Bullet", "Bullets"]]
                    break;
                case "Shadow":
                    bossadjectives = ["Hexed", "Prescient", "Mysterious", "Ancient", "Divine", "Explosive", "Hidden"]
                    bossnouns = [["Kingdom", "Kingdom"], ["Blade", "Blades"], ["Jing Wu", "Jing Wu"], ["Dragon", "Dragons"], ["Illusion", "Illusions"], ["Sword", "Swords"], ["Shadow", "Shadows"], ["Spirit", "Spirits"], ["Clone", "Clones"], ["General", "Generals"], ["Mountain", "Mountains"], ["Marionette", "Marionettes"], ["Soldier", "Soldiers"], ["Doll", "Dolls"]]
                    break;
                case "Tlazolteotl":
                    bossadjectives = ["Faithful", "Aztec", "Summoned", "Otherworldly", "Death", "Pale", "Avenging", "Foul", "Decaying", "Enfeebling", "Ageless", "Beautiful", "Restless", "Pestilent", "Below"]
                    bossnouns = [["Time", "Time"], ["Undead", "Undead"], ["Faithful", "Faithful"], ["Sorcery", "Sorceries"], ["Portal", "Portals"], ["Pestilence", "Pestilence"], ["Dead", "Dead"], ["Nahualli", "Nahualli"], ["Faithful", "Faithful"], ["Necromancer", "Necromancers"], ["Zombie", "Zombies"], ["Caller", "Callers"], ["Essence", "Essences"], ["Prophecy", "Prophecies"], ["Blast", "Blasts"], ["Flesh", "Flesh"], ["Hex", "Hexes"], ["Burden", "Burdens"]]
                    break;
                case "Yokai":
                    bossadjectives = ["Cursed", "Deceptive", "Eldritch", "Raging", "Unleashed", "Dynasty", "Enraged", "Nine-Tailed"]
                    bossnouns = [["47", "47"], ["Hellfire", "Hellfire"], ["Sorrow", "Sorrows"], ["Monster", "Monsters"], ["Oni", "Oni"], ["Demon", "Demons"], ["Yurei", "Yurei"], ["Ninja", "Ninja"], ["Shadow", "Shadows"], ["Strike", "Strikes"], ["Swarm", "Swarms"], ["Fox", "Foxes"], ["Rage", "Rage"], ["Aura", "Auras"], ["Oblivion", "Oblivion"], ["Shackle", "Shackles"], ["Fear", "Fear"], ["Devil", "Devil"],]
                    break;
                default:
                    bossadjectives = adjectives
                    bossnouns = nouns
            }

            switch (finalstage.name) {
                case "Ashes of the Eternal":
                    stageadjectives = ["Unholy", "Unclean", "Rising", "Blazing", "Burnt"]
                    stagenouns = [["Eternal", "Eternals"], ["Ash", "Ashes"], ["Inferno", "Inferno"], ["Urn", "Urns"], ["Demon", "Demons"], ["Apparition", "Apparitions"], ["Path", "Paths"], ["Flame", "Flames"], ["Fire", "Fires"]]
                    break;
                case "Cashed Out":
                    stageadjectives = ["Winning", "Cashed Out", "Loose", "Gambling", "Risky", "Loaded", "Opulent"]
                    stagenouns = [["Casino", "Casinoes"], ["Blackjack", "Blackjack"], ["Bet", "Bets"], ["Card", "Cards"], ["Cash", "Cash"], ["Chip", "Chips"], ["Damage", "Damages"], ["Dealer", "Dealers"], ["Die", "Dice"], ["Gambler", "Gamblers"], ["Hand", "Hand"], ["House", "House"], ["Money", "Money"], ["Odds", "Odds"], ["Poker", "Poker"]]
                    break;
                case "Compromised":
                    stageadjectives = ["Compromised", "Armed", "Rising", "Misguided", "Calming", "Scared", "Panicking"]
                    stagenouns = [["Downtown", "Downtown"], ["Panic", "Panic"], ["Hostage", "Hostages"], ["Intruder", "Intruders"], ["Bribe", "Bribes"], ["Offices", "Offices"], ["Threat", "Threats"], ["Fear", "Fear"], ["Heroic", "Heroic"], ["Word", "Words"], ["Staff", "Staff"], ["Security System", "Security Systems"]]
                    break;
                case "Gone Ballistic":
                    stageadjectives = ["Concealed", "Proximity", "Stray", "Illegal", "Explosive", "Stolen", "Ballistic", "Bulletproof"]
                    stagenouns = [["Dealer", "Dealers"], ["Grenade", "Grenades"], ["Gun", "Guns"], ["Mine", "Mines"], ["Rocket", "Rockets"], ["Sidearm", "Sidearms"], ["Supply", "Supplies"], ["Trigger", "Triggers"], ["Truck", "Trucks"], ["Vest", "Vests"], ["Weapon", "Weapons"]]
                    break;
                case "One Step Ahead":
                    stageadjectives = ["High", "Atop", "Underground", "Steep", "Windy", "Strong", "Climbing"]
                    stagenouns = [["Peak", "Peaks"], ["Cave", "Caves"], ["Mountain", "Mountains"], ["Step", "Steps"], ["Cliff", "Cliffs"], ["Grappling Hook", "Grappling Hooks"], ["Wind", "Winds"], ["Avalanche", "Avalance"], ["Vertigo", "Vertigo"]]
                    break;
                case "Original Copy":
                    stageadjectives = ["Duplicated", "Mutated", "Accelerated", "Deadly", "Regenerative", "Experimental", "Original", "Dynasty"]
                    stagenouns = [["Lab", "Labs"], ["Cell", "Cells"], ["Clone", "Clones"], ["Computer", "Computers"], ["Copy", "Copies"], ["Duplicate", "Duplicates"], ["Mutation", "Mutations"], ["Protocol", "Protocols"], ["Serum", "Serums"], ["Subject", "Subjects"], ["Test", "Tests"], ["Vandal", "Vandal"], ["Vat", "Vats"]]
                    break;
                case "Out of Time":
                    stageadjectives = ["Afflicted", "Putrid", "Fallen", "Profane", "Dead", "Dimensional", "Hellish", "Extradimensional"]
                    stagenouns = [["Pit", "Pits"], ["World", "Worlds"], ["Spike", "Spikes"], ["Time", "Time"], ["Zombie", "Zombies"], ["Remnant", "Remnants"], ["Altar", "Altars"], ["Refuge", "Refuges"], ["Below", "Below"], ["Offering", "Offerings"], ["Undead", "Undead"]]
                    break;
                case "Poison the Well":
                    stageadjectives = ["Poisoned", "Infected", "Addicted", "Filthy", "Stinking", "Smelly", "Insane", "Subterranean", "Underground"]
                    stagenouns = [["Experiment", "Experiment"], ["Poison", "Poison"], ["Well", "Wells"], ["Sewer", "Sewers"], ["Vandal", "Vandal"], ["Vat", "Vats"], ["Addict", "Addicts"], ["Thrall", "Thralls"], ["City", "City"], ["Rat", "Rats"], ["Pursuit", "Pursuit"]]
                    break;
                case "Right to Remain Silent":
                    stageadjectives = ["Blindfolded", "Escaped", "Silent", "Recovered", "Armed", "Sneaking", "Captured", "Interrogated"]
                    stagenouns = [["Right", "Rights"], ["Captive", "Captives"], ["Intel", "Intel"], ["Prisoner", "Prisoners"], ["Guard", "Guards"], ["Tripwire", "Tripwires"], ["Interrogation", "Interrogation"]]
                    break;
                case "Rude Awakening":
                    stageadjectives = ["Rude", "Afflicted", "Decayed", "Rotting", "Summoned", "Risen", "Awakened", "Rotten", "Dark", "Black"]
                    stagenouns = [["Undead", "Undead"], ["Awakening", "Awakening"], ["Remnant", "Remnants"], ["Dead", "Dead"], ["Undead", "Undead"], ["Zombie", "Zombies"], ["Rot", "Rots"], ["Decay", "Decay"], ["Necromancer", "Necromancers"], ["Realm", "Realms"], ["Below", "Below"]]
                    break;
                case "Running Wild":
                    stageadjectives = ["Unturned", "Blessed", "Wild", "Lost", "Hidden", "Buried", "Final"]
                    stagenouns = [["Shrine", "Shrines"], ["Search", "Search"], ["Demon", "Demons"], ["Wild", "Wilds"], ["Key", "Keys"], ["Hunt", "Hunt"], ["Idol", "Idols"], ["Blessing", "Blessings"], ["Beyond", "Beyond"], ["Oni", "Oni"], ["Curse", "Curses"], ["Tree", "Trees"], ["Trail", "Trail"], ["Call", "Call"]]
                    break;
                case "Steel Memories":
                    stageadjectives = ["New", "Steel", "Fresh", "True", "Demoralizing", "Upcoming", "Encircling", "Dark", "Brutal", "Overwhelming"]
                    stagenouns = [["Newcomer", "Newcomers"], ["Melee", "Melee"], ["Memory", "Memories"], ["Recruit", "Recruits"], ["Crowbar", "Crowbars"], ["Underdog", "Underdogs"], ["Edge", "Edges"], ["Defeat", "Defeat"], ["Finisher", "Finisher"], ["Challenger", "Challengers"], ["Contest", "Contests"], ["Challenge", "Challenges"]]
                    break;
                case "Sudden Death":
                    stageadjectives = ["Boasting", "Sudden", "Culling", "Personal", "Mutual", "New", "Overconfident", "Urban", "Deadly", "Ruthless", "Underground", "Brutal"]
                    stagenouns = [["Death", "Death"], ["Vendetta", "Vendetta"], ["Assistance", "Assistance"], ["Cause", "Causes"], ["Challenger", "Challengers"], ["Competition", "Competition"], ["Tournament", "Tournament"], ["Contest", "Contests"]]
                    break;
                case "Supply & Demand":
                    stageadjectives = ["Distribution", "Pinned", "Rising", "Hooked", "Addicted", "Dealing", "Pushing"]
                    stagenouns = [["Supply", "Supplies"], ["Demand", "Demand"], ["Crossfire", "Crossfire"], [`Island`, `Islands`], ["Drug", "Drugs"], ["Smuggler", "Smugglers"], ["Network", "Networks"], ["Kingpin", "Kingpin"], ["Drive-By", "Drive-By"], ["Contraband", "Contraband"], ["Island", "Islands"], ["Camp", "Camps"], ["Junkyard", "Junkyard"]]
                    break;
                case "The Ceremony":
                    stageadjectives = ["Eldritch", "Whispered", "Unholy", "Unclean", "Ceremonial", "Cursed", "Lured", "Promised"]
                    stagenouns = [["Ceremony", "Ceremony"], ["Alignment", "Alignment"], ["Vessel", "Vessels"], ["Embrace", "Embrace"], ["Lure", "Lures"], ["Promise", "Promises"], ["Conduit", "Conduits"], ["Oni", "Oni"], ["Demon", "Demons"], ["Servant", "Servants"]]
                    break;
                case "Under Destruction":
                    stageadjectives = ["Risky", "Collateral", "Timed", "Remote", "Armed", "Explosive", "Demolished"]
                    stagenouns = [["Explosion", "Explosions"], ["Destruction", "Destruction"], ["Conveyor", "Conveyor"], ["Demolition", "Demolitions"], ["Buzzsaw", "Buzzsaws"], ["Bomb", "Bombs"], ["Construction", "Construction"], ["Trigger", "Triggers"]]
                    break;
                default:
                    stageadjectives = adjectives
                    stagenouns = nouns
            }

            adjectives = _.union(adjectives, bossadjectives, stageadjectives)
            nouns = _.union(nouns, bossnouns, stagenouns)

            let plural = randFrom([0, 1])

            let storyname = ""
            switch (Math.floor((Math.random() * number) + 1)) {
                case 1: storyname = randFrom(adjectives) + " " + randFrom(nouns)[plural];
                    break;
                case 2: storyname = randFrom(adjectives) + " " + randFrom(nouns)[0] + " " + randFrom(nouns)[plural]
                    break;
                case 3: storyname = randFrom(adjectives) + " " + randFrom(adjectives) + " " + randFrom(nouns)[plural]
                    break;
                case 4: storyname = randFrom(adjectives) + " " + randFrom(nouns)[plural] + ", " + randFrom(adjectives) + " " + randFrom(nouns)[plural]
                    break;
                case 5: storyname = randFrom(nouns)[plural] + " of the " + randFrom(adjectives)
                    break;
                case 6: storyname = randFrom(nouns)[0] + " " + randFrom(nouns)[plural]
                    break;
                case 7: storyname = randFrom(nouns)[0] + " " + randFrom(nouns)[0]
                    break;
                case 8: storyname = randFrom(nouns)[plural] + " of" + (plural == 0 ? " the " : " ") + randFrom(nouns)[(plural == 0 ? 0 : 1)]
                    break;
                case 9: storyname = randFrom(nouns)[0] + " of the " + randFrom(nouns)[0] + " " + randFrom(nouns)[0]
                    break;
                case 10: storyname = randFrom(nouns)[0] + " " + randFrom(nouns)[0] + " " + randFrom(nouns)[plural]
                    break;
                case 11: storyname = (plural == 0 ? " The " : " ") + randFrom(nouns)[plural] + " and " + (plural == 0 ? " the " : " ") + randFrom(nouns)[plural]
                    break;
                case 12: storyname = randFrom(nouns)[0] + ": " + storyNamer(finalboss, finalstage, 15)
                    break;
                case 13: storyname = randFrom(nouns)[0] + " for " + (plural == 0 ? " the " : "") + randFrom(nouns)[plural]
                    break;
                case 14: storyname = "From the " + randFrom(adjectives) + " " + randFrom(nouns)[0]
                    break;
                case 15: storyname = randFrom([`Another ${randFrom(nouns)[0]}`, `For ${randFrom(nouns)[plural]}`, `Enter the ${randFrom(nouns)[plural]}`, `The ${randFrom([randFrom(adjectives), randFrom(nouns)[plural]])}`])
                    break;
                case 16: storyname = storyNamer(finalboss, finalstage, 15) + randFrom([": the Return", " - Part Two", " - Part One", ": the Final Chapter"])
                    break;
                default: storyname = "New Rise of the Kingdom"
            }

            storyname.length > 42 ? storyNamer(finalboss, finalstage, 15) : ``

            return storyname.toUpperCase();

        }

        function compileStory(stages, enemies) {


            let story = []

            let chapters = ["1", "2A", "2B", "3A", "3B", "4A", "4B", "5A", "5B"];

            var chapter
            for (i = 0; i < Math.ceil($("#storylength").val() * 2)-1; i++) {
                chapter = { chapter: chapters[i], stage: _.cloneDeep(stages[i]), enemy: enemies[i] }
                story.push(chapter)
                console.log(enemies[i].boss + " " + chapters[i])
            }

            return story

        }

        function storyStages(stages) {


            let storystages = []

            let randomstage = Math.floor(Math.random() * stages.length);

            let finalstage = stages[randomstage];
            stages.splice(randomstage, 1);

            console.log(finalstage.name)


            if ($("#storylength").val() > 1) {

                randomstage = Math.floor(Math.random() * stages.length);

                storystages.push(stages[randomstage]);
                stages[randomstage].instory = stages[randomstage].instory + 1
                stages = cleanStages(stages);

                if ($("#storylength").val() > 2) {
                    let i = 0
                    do {
                    (Math.random() <= 0.75 ?
                        (randomstage = Math.floor(Math.random() * stages.length),
                            storystages.push(stages[randomstage]),
                            stages[randomstage].instory = stages[randomstage].instory + 1,
                            (stages[randomstage].instory < 2 ?
                                (storystages.push(stages[randomstage]),
                                    stages[randomstage].instory = stages[randomstage].instory + 1,
                                    stages = cleanStages(stages)) :
                                (stages = cleanStages(stages),
                                    randomstage = Math.floor(Math.random() * stages.length),
                                    storystages.push(stages[randomstage]),
                                    stages[randomstage].instory = stages[randomstage].instory + 1,
                                    stages = cleanStages(stages))
                            )
                        ) :
                        (randomstage = Math.floor(Math.random() * stages.length),
                            storystages.push(stages[randomstage]),
                            stages[randomstage].instory = stages[randomstage].instory + 1,
                            stages = cleanStages(stages),
                            randomstage = Math.floor(Math.random() * stages.length),
                            storystages.push(stages[randomstage]),
                            stages[randomstage].instory = stages[randomstage].instory + 1,
                            stages = cleanStages(stages))
                    )
                i = i + 1    
                } while (i < $("#storylength").val()-2);
                }


                (Math.random() < 0.75 ?

                    (storystages.push(finalstage),
                        storystages.push(finalstage)) :
                    (storystages.push(finalstage),
                        storystages.push(stages[Math.floor(Math.random() * stages.length)])))


            } else {storystages.push(finalstage)}

            console.log(JSON.stringify(storystages,["name"]))


            return [storystages, stages]

        }

        function getMasterPlan() {

            final_texts = ["final", "ultimate", "diabolical", "culminating", "terminal", "paramount", "consummate", "paramount", "utmost", "fiendish"]
            plan_texts = ["plan", "master plan", "scheme", "endgame", "design"]
            return `${randFrom(final_texts)} ${randFrom(plan_texts)}`

        }

        function loungeMusic() {

            let music = randFrom(["Don't Stop Believing", "Faithfully", "Don't Stop Me Now", "Open Arms", "Wheel in the Sky", "Separate Ways", "Livin' on a Prayer", "Any Way You Want It",
                "Eye of the Tiger", "The Final Countdown", "Burning Heart", "Every Breath You Take", "Another One Bites the Dust", "Never Gonna Give You Up"])

            return music
        }

        function storyEnemies(storystages, enemies, heroenemies) {

            heroenemies = heroenemies.map(enemy => enemy.boss);

            let storyenemies = [], randomenemy;

            function pickAndSlice() {
                if (storyenemies.length <= 3) { do { randomenemy = randFrom(enemies) } while (heroenemies.includes(randomenemy.boss)) } else { randomenemy = randFrom(enemies) }
                enemies = filterArray(enemies, "boss", randomenemy.boss, true)
            }

            pickAndSlice()

            let finalboss = randomenemy

            if ($("#storylength").val() > 1) {

                let r = randFrom([1, 2])
            switch (r) {
                case 1: storyenemies.push(randomenemy);
                    break;
                case 2: pickAndSlice(), storyenemies.push(randomenemy);
            }

            for (i = 0; storyenemies.length < Math.ceil($("#storylength").val() / 2)*2+1; i++) {

                let random = randFrom([1, 2, 3])
                switch (random) {
                    case 1: pickAndSlice(), storyenemies.push(randomenemy), storyenemies.push(randomenemy);
                        break;
                    case 2: pickAndSlice(), storyenemies.push(randomenemy), storyenemies.push(randomenemy);
                        break;
                    case 3: pickAndSlice(), storyenemies.push(randomenemy), pickAndSlice(), storyenemies.push(randomenemy)
                }
            }

            }


            storyenemies.push(finalboss);

            if ($("#storylength").val() > 1) {

            if (storystages[storystages.length-2].name == storystages[storystages.length-1].name) {
                storyenemies.push(finalboss);
            } else {
                pickAndSlice(), storyenemies.push(randomenemy)
            }

            }

            return [storyenemies, enemies]

        }

        function evilPlace() {

            let evilterm = ["ancient", "cursed", "damned", "eldritch", "evil", "unholy", "unclean", "vile"]
            let place = ["burial ground", "altar", "sanctum", "shrine", "temple"]

            let evilplace = //evilterm.splice(Math.floor(Math.random()*evilterm.length), 1) + " and " + 
                evilterm.splice(Math.floor(Math.random() * evilterm.length), 1) + " " +
                place.splice(Math.floor(Math.random() * place.length), 1)

            return evilplace
        }

        function possessiveSuffix(name) {

            let suffix = ((name).charAt((name).length - 1) != "s" ? "'s" : "'")

            return name + suffix
        }

        function allyNamer(alliesandrivals, enemy, heronames) {

            let ally = _.cloneDeep(randFrom(alliesandrivals))

            while (ally.name === enemy.boss && heronames.includes(ally.name)) {
                ally = randFrom(alliesandrivals)
            }

            alliesandrivals = _.filter(alliesandrivals, !{ name: ally.name })

            if (ally.name === enemy.boss) { ally.name = "Mirror " + ally.name }
            else if (heronames.includes(ally.name)) { ally.name = "Shadow " + ally.name }

            return ally
        }

        function defineKnowledge(i, story) {
            let knowledge


            switch (i) {
                case 0: knowledge = story[i].stage.hasOwnProperty(`captured`) ? randFrom(["coldtrail", "clueless", "captured"]) : randFrom(["coldtrail", "clueless"])
                    break;
                case 1: case 3: case 5: case 7:
                    knowledge = "hottrail"
                    break;
                case 2: case 4: case 6: case 8:
                    if (story[i].stage.name === story[i - 1].stage.name) {
                        knowledge = "coldtrail"
                    } else if (story[i].stage.hasOwnProperty(`captured`) && i > 3) {
                        knowledge = randFrom(["clueless", "captured"])
                    } else knowledge = "clueless"
                    break;
            }
            return knowledge
        }

        function loseResult(stageindex, story, nextstage, gizmo) {

            let finalboss = story[Math.max($("#storylength").val()*2-3,0)].enemy

            let enemy = story[stageindex].enemy

            let nextenemy = story[nextstage].enemy

            let nextmission = story[nextstage].stage

            let altstage = (nextstage - 1)

            let minion = randFrom(enemy.minionnames)

            let nextminion = randFrom(nextenemy.minionnames)

            let evilplace = evilPlace()

            let contact = Math.random() < 0.5 ? "He" : "She"

            let goal


            //erottele tÃ¤llÃ¤ tarkemmin lopetukset
            switch (story[stageindex].stage.name) {
                case "Ashes of the Eternal":
                case "Out of Time":
                case "The Ceremony": goal = "ritual"
                    break;
                case "Cashed Out":
                case "Compromised":
                case "Gone Ballistic":
                case "One Step Ahead":
                case "Original Copy":
                case "Right to Remain Silent":
                case "Running Wild":
                case "Supply & Demand": goal = "retrieval"
                    break;
                case "Poison the Well":
                case "Under Destruction":
                case "Rude Awakening":
                case "Steel Memories":
                case "Sudden Death": goal = "terror"
                    break;
            }

            undead_endings = [`You're thrown to the ground by a blast of ${mysticalSynonym()} force, and the ${enemy.bosstitle()} disappears in a flash of brilliant purple. Looking out over the battlefield, you see the zombies are too many for you to keep at bay. "Agent Fletch," you say into you radio. "The target's fled, and the horde is loose. Requesting extraction.`]

            ritual_endings = [`You were not able to stop ${enemy.boss} from completing the ritual! Standing in the middle of the temple, ${gPron(enemy,"subject")} rises up off the stone floor, the ${mysticalSynonym()} powers swirling around ${gPron(enemy,"object")}. You watch as ${gPron(enemy,"possessive")} muscles grow, ${gPron(enemy,"possessive")} eyes burn, and ${gPron(enemy,"possessive")} body pulses with the ${mysticalSynonym()} energies! You have no choice but to flee for your lives!`]

            explosion_endings = [`You barely clear the area when the explosions finally bring everything crumbling down. You find yourself immediately surrounded by ${possessiveSuffix(enemy.boss)} ${enemy.minions} "You're due at the next stop," Dmitri said menacingly.`]

            let goingdown = [
                `${enemy.boss} kicks you while you're down, and then pushes you hard into the ground. You look up slowly to see two others join him â ${nextenemy.boss} and ${nextminion} of the ${nextenemy.name}.
        "Wholly unimpressive," ${nextenemy.boss} comments.  "Perhaps, with a little more work, they can become somehow... useful?" `,
                `${enemy.boss} looks down at you. "So this is the sad excuse for a fighter that has been harrying the ${finalboss.name}?" ${gPron(enemy, "subject")} says looking you over. "You've thrown a wrench
        in our plans, ${enemy.addressing}." And then ${gPron(enemy, "subject")} grins, and you feel your heart stop. "And so now you will go to ${nextenemy.boss}!" and then laughs at your fate.`,
                `"Just as I thought," ${enemy.boss} says with calm confidence as he paces around you. "Absolutely pathetic." "What should we do with them?" ${minion} asks. "They are worthless."<br><br>"Not entirely," 
        ${enemy.boss} says. "Bind them. Perhaps ${nextenemy.boss} will have a use for their inadequate talents."`,
                `"Your pitiful husks won't serve me," ${enemy.boss} says. "Perhaps you'll be worth something on the black market. ${ucInit(gPron(enemy, "possessive"))} ${enemy.minions} approach to apprehend you.`,
                `${enemy.boss} ${enemy.threat} before ${nextenemy.boss} gestures for ${gPron(enemy, "object")} to stop. "No," ${gPron(nextenemy, "subject")} says. We have a better use for the Gladiators. 
        After all, who better to think ${finalboss.boss} would want than the Citadel's best?" ${minion} and ${nextenemy.boss} share an amused glance as ${enemy.boss} opens a secret passage. The three of them lead you to the unknown.`,
                `Cackling maniacally the whole time, ${enemy.boss} and ${gPron(enemy, "possessive")} ${enemy.minions} surround you, overwhelming you. Their constant attacks became too much for you, and soon you blacked out,
        ${possessiveSuffix(enemy.boss)} haunting laughter echoing through your head all the while.`,
                `${enemy.boss} laughed quietly and sinisterly as he slowly licked a bleeding wound on ${gPron(enemy, "possessive")} hand. "${finalboss.boss == enemy.boss ? `I'm proud of you` : `${finalboss.boss} would be proud`}," ${gPron(enemy, "subject")} told as you were tied and
        your vision faded. You barely heard ${possessiveSuffix(enemy.boss)} final command: "Take them to the ${nextenemy.name}!"`,
                `You barely clear the site, and you find yourself immediately surrounded by ${possessiveSuffix(enemy.boss)} ${enemy.minions}. "You're due at the next stop," ${enemy.boss} said menacingly.
        "The ${nextenemy.name} still has some uses for you.`
            ]

            let deusexmachina = [
                `Suddenly, Citadel agents rappel down out of nowhere. ${enemy.boss} and ${gPron(enemy, "possessive")} ${enemy.minions} flee as the agents free you.
        "Gladiators," one of the Agents greets you. "I have a location of heavy ${nextenemy.name} activity that could use your particular brand of investigating."`,
                `You were unable to learn anything important before your retreat, and when you reconnect with Agent Fletch, he has little time to debrief you.<br><br>While you were bumbling, the Citadel's efforts have paid off, and you have a little time to recover before you're
        sent off to your next target, where ${nextenemy.boss} has been seen.`,
                `You retreat and regroup nearby, having lost to ${enemy.boss} and ${gPron(enemy, "possessive")} forces. You overheard a lead, but it will be a struggle for you to catch up with the
        ${possessiveSuffix(finalboss.name)} plans now.`,
                `You slowly awoke in a helicopter, confused how you wound up here. Agent Fletch leans toward you, shouting over the roar of the vehicle. "No idea what you thought you were doing down there. Now we must hurry to ${nextenemy.name}
        if we're to fix this!"`,
                `As you were regrouping some distance away, you saw your first welcome sight; Agent Fletch approached with a tablet under his arm. "Don't get comfy," Fletch said, booting up the tablet. "After this fiasco, we might recover if we rapidly strike at key
        targets, and hopefully throw the ${finalboss.name} off-balance."`,
                `Overwhelmed by the might of the ${enemy.name}, you're forced to flee with no real leads to follow up. However, after returning to HQ, the news reported on a situation that guides you on where to go next.`,
                `After failing to contain the situation, you were forced to flee from ${possessiveSuffix(enemy.name)} forces. Ashamed and frustrated, you have no choice but to return to the city and hope
        someone at the police department would hear you out. You can't think of any other option at this point.`
            ]

            if (goal == "retrieval") {
                deusexmachina = deusexmachina.concat([
                    `The ${enemy.name} was able to escape with their plan fulfilled. You call Agent Fletch and request a cleanup team at the site, and then you begin searching through the debris. You find a ${gizmo} placed almost intentionally
        where you would find it.`,
                    `After your uphill battle against overwhelming odds, ${enemy.boss} apparently became bored with the uneven competition and suddenly assaulted with unprecedented fury, leaving you beaten. "Let's move out!" ${gPron(nextenemy, "subject")}
        commanded.  "This is not worth our time."<br><br>Left for dead, you had no chance of following, and had very little to proceed with.`,
                    `The ${enemy.name} escaped with what they wanted, and a ${gizmo} you happened upon looks damaged. "Agent Fletch," you got into your communications device. "I've found a ${gizmo}, but it looks damaged." "At least we have it,"
        Agent Fletch replied in your ear. "Bring it back to Citadel HQ and we'll see what can we pull from it."`,
                    `You ducked behind cover as ${enemy.minions} mounted a huge assault. To move would have been suicide, and you were forced to watch as the enemy retreated, retrieveing whatever they planned to. While you were avoiding being hit, a squad of Citadel soldiers rushed in
        and sent off the enemies focused on you.<br><br>The soldiers took a moment to patch up your wounds, getting you prepared to return to the Citadel and receive your next target.`,
                ])
            }

            if ([2, 4, 6].includes(stageindex) && nextmission.hasOwnProperty("captured")) {
                deusexmachina = [
                    `Suddenly, Citadel agents rappel down out of nowhere. ${enemy.boss} and ${gPron(enemy, "possessive")} ${enemy.minions} flee as the agents free you.
        "Gladiators," one of the Agents greets you. "I have a location of heavy ${nextenemy.name} activity that could use your particular brand of investigating.`,
                    `You espaced, but badly beaten, and were unable to learn anything important. When you reconnect with Agent Fletch, he has little time to debrief you.<br><br>The Citadel's efforts have paid off, and you have a little time to recover before you're
        sent off to your next target, where ${nextenemy.boss} has been seen.`,
                    `You slowly awoke in a helicopter, confused how you wound up here. Agent Fletch leans towards you, shouting over the roar of the vehicle. "No idea what you thought you were doing down there. Now we must hurry to the ${nextenemy.name}
        if we're to fix this!"`,
                    `Overwhelmed by the might of the ${enemy.name}, you're manage to flee, clinging to your lives, and not a clue what to do next. After returning to HQ, the news reported on a situation that guides you on where to go next.`,
                    `Severy beaten by ${possessiveSuffix(enemy.name)} forces, you barely espace. Ashamed and frustrated, you have no choice but to return to the city and hope
        someone at the police department would hear you out. You can't think of any other option at this point.`
                ]
            }

            let loseresult

            if ((nextmission.hasOwnProperty("captured") && nextmission.knowledge == "captured")) {
                loseresult = randFrom(goingdown)
            } else { loseresult = randFrom(deusexmachina) }

            if (goal == "ritual") {
                loseresult = `You were not able to stop ${enemy.boss} completing the ritual!
    Standing in the middle of the temple, ${gPron(enemy, "subject")} rises up off the stone floor, the ${mysticalSynonym()} powers swirling around ${gPron(enemy, "object")}.
    You watch as ${gPron(enemy, "possessive")} eyes burn, and ${gPron(enemy, "possessive")} body pulses with the ${mysticalSynonym()} energies! 
    ${(nextmission.hasOwnProperty("captured") && nextmission.knowledge == "captured") ? `You lose consciousness in front of that ${mysticalSynonym()} power!` : `You have no choice but to flee for your lives!`}`
            }

            return loseresult
        }

        function getEnemyAttack(enemy, attack, alternative) {

            if (enemy.hasOwnProperty("attacks") && enemy.attacks.hasOwnProperty(attack)) {

                attack = enemy.attacks[attack]
            } else { attack = alternative }

            return attack


        }

        function victoryResult(stageindex, story, nextstage, gizmo) {

            let finalboss = story[Math.max($("#storylength").val()*2-3,0)].enemy
            let enemy = story[stageindex].enemy
            let stage = story[stageindex].stage
            let nextenemy = story[nextstage].enemy
            let nextmission = story[nextstage].stage
            let minion = randFrom(enemy.minionnames)
            let contact = randFrom(["He", "She"])
            let location = story[stageindex].stage.location
            let bystanders = story[stageindex].stage.bystander
            let clue
            let evilplace = evilPlace()
            let detonationaction = getEnemyAttack(enemy, "detonation", `${gPron(enemy, "subject")} produces a remote and presses a button. An explosion knocks you down`)

            let wanting = randFrom(["you are after", "you want", "", "you pursue", "the Citadel is after", "behind all this", "all too familiar to you"])
            let finalcahoots = finalboss.name == nextenemy.name ? randFrom([finalboss.boss, (finalboss.desc.replace("the", "a certain"), finalboss.desc)]) : randFrom([`the ${finalboss.name}`, `${finalboss.desc} ${wanting}`, `${finalboss.minions} ${wanting}`, `the ${finalboss.bosstitle()} ${wanting}`, finalboss.boss])
            let thiscahoots = enemy.name == nextenemy.name ? randFrom([enemy.boss, (enemy.desc.replace("the", "this very")), `this ${enemy.bosstitle()}`]) : randFrom([`the ${enemy.name}`, (enemy.desc.replace("the", "this")), `these ${enemy.minions}`, `the ${enemy.bosstitle()}`, enemy.boss])
            let cahoots = randFrom([finalcahoots, thiscahoots])
            let supposition = randFrom(["", "supposedly ", "rumored to be ", "who to your understanding are ", "who according to Agent Fletch are ", "apparently ", "probably ", "believed to be ", "most likely ", "in all likelihood ",
                "presumably ", "surely ", "assumably ", "who you believe are ", "the Citadel analysts are saying is ", "apparently ", "in fact ", "indeed ", "as a matter of fact ", "in truth "])
            cahoots = randFrom([``, ` - ${supposition}in cahoots with ${cahoots}`, `, ${supposition}in league with ${cahoots}`, `, ${supposition}allied to ${cahoots}`,
                `, ${supposition}working for ${cahoots} this time`, `, ${supposition}in alliance with ${cahoots}`, `, ${supposition}hired by ${cahoots}`, `, ${supposition}linked to ${cahoots}`, `, ${supposition}tied to ${cahoots}`,
                `, ${supposition}connected to ${cahoots}`], `, somehow connected to all of this`, ``, ` that ${supposition}is connected to this`, `, that the Citadel confirms warrants further investigation`, `, who doesn't serve the Kingdom, but instead someone known only as The Master`, `, and seems more important than you originally thought`)
            cahoots = (nextstage >= Math.max($("#storylength").val()*2-3,0)) ? `` : cahoots

            switch (nextmission.name) {
                case "Ashes of the Eternal":
                case "The Ceremony": clue = `${nextenemy.boss}${cahoots}, has an interest on a certain ${evilplace}`
                    break;
                case "Cashed Out": clue = `the location of a gambling den operated by the ${nextenemy.name}${cahoots}`
                    break;
                case "Compromised": clue = `${nextenemy.boss} is planning to take hostages in a downtown office building${cahoots}`
                    break;
                case "Gone Ballistic": clue = `${nextenemy.name} - ${nextenemy.desc}${cahoots} - are conducting an arms deal at a nearby warehouse`
                    break;
                case "One Step Ahead": clue = `the ${nextenemy.name} have been seen along a distant mountain path with their ${nextenemy.minions}${cahoots}`
                    break;
                case "Original Copy": clue = `${nextenemy.boss} and ${gPron(nextenemy, "possessive")} ${nextenemy.minions}${cahoots}, have been spotted at a suspicious lab`
                    break;
                case "Out of Time":
                case "Rude Awakening": clue = `strange sorcery and walking corpses have been witnessed, along with ${nextenemy.boss} in ${whichPreposition(evilplace)}${cahoots}`
                    break;
                case "Poison the Well": clue = `the ${nextenemy.name} has hauled some equipment to the sewers${cahoots}`
                    break;
                case "Right to Remain Silent": clue = `the undercover Citadel scouts have been captured by ${nextenemy.name}${cahoots}`
                    break;
                case "Supply & Demand": clue = `${nextenemy.name} - ${nextenemy.desc}${cahoots} - are conducting a drug deal at a nearby abandoned property`
                    break;
                case "Under Destruction": clue = `the ${nextenemy.name}${cahoots} - had something going down at an unfinished construction site`
                    break;
                case "Running Wild": clue = `${nextenemy.minions} of the ${nextenemy.name}${cahoots} have set up a dig in a labyrinthine forest`
                    break;
                case "Steel Memories": clue = `the location of the secret base of ${nextenemy.boss}${cahoots}`
                    break;
                case "Sudden Death": clue = `the ${nextenemy.name == "Kingdom" ? nextenemy.boss + ` was back to ${gPron(nextenemy, "possessive")} previous practice` : " the customary recruitment methods of the Kingdom been duplicated by " + nextenemy.name}${cahoots}`
                    break;
            }

            let gatherclues = [
                `${enemy.boss} forces you to dodge ${gPron(enemy, "possessive")} attack, and when you return to your stance, ${gPron(enemy, "subject")} is gone! Rather than give chase, you interrogate ${minion} who reveals`,
                `After the skirmish, the ${enemy.name} scared away, you rush to one of the ${bystanders}s' side - an undercover Citadel scout, who holds ${whichPreposition(gizmo)} in hand. ${contact}'s alive, bleeding out from an attack. "The ${gizmo}!" you ask. "What's in it?" ${contact} doesn't make it, but the intel you recovered tells`,
                `Before you can finish the job, ${enemy.boss} leaps through ${stage.hasOwnProperty("pit") ? stage.pit : "a bottomless pit"}. You race to the edge after ${gPron(enemy, "object")}, but ${gPron(enemy, "subject")} is nowhere to be seen. You doubt this is the last you see of the ${enemy.bosstitle()} of the ${enemy.name}. You turn to the ${bystanders}s and one of them approaches you.  "Thank you!" ${lowerCaseInitial(contact)} says, and tells of overhearing that`,
                `As you tie up the unconscious members of the ${enemy.name}, left on their own devices by ${enemy.boss}, you're shocked when ${minion} approaches you calmly. ${minion} - a double agent - informs you that `,
                `"Sir, we've captured one of the ${enemy.minions} and are holding them for questioning."  The technician got to Agent Fletch, and then paused for a moment.  "Find out what they are up to!" Fletch told the technician.  "By any means necessary!" ${minion} revealed that`,
                `${enemy.boss} made a hasty retreat, but thanks to the information you got after the encounter, you have learned`,
                `"Thank you!" one of the ${bystanders}s said as ${lowerCaseInitial(contact)} approached, as the forces of ${enemy.boss} made their retreat. "I overheard what they're planning." ${contact} goes on to explain about `,
                `With the last of the ${enemy.minions} defeated, you turn to face ${enemy.boss} again. You're confident that if you could only get close to ${gPron(enemy, "object")}, you could end this game of cat and mouse. But ${gPron(enemy, "subject")} has disappeared into the thin air! You don't have the time to ponder this, as the intel from here tells`,
                `After your victory over ${possessiveSuffix(enemy.boss)} goons and a short call to Agent Fletch, Citadel forces secure the area and begin their investigation with you. ${enemy.boss} might have slipped away, but among the debris of the fight, you find out`
            ]

            // remote: nextmission.hasOwnProperty("captured"): If the Fighters lose: Tlazolteotl looks down at you, a smug smirk spreading across her face.  She reaches up and holds her amulet gingerly, reciting a few strange words in a language you've never heard before.  In an instant, the world blows away around you in a deafening explosion of arcane energy, and for a moment, all you can see is the blackness Advance to Part 5B.  
            if (location == "base") {
                gatherclues = gatherclues.concat([
                    `With a hail of attacks, ${enemy.boss} and ${gPron(enemy, "possessive")} surviving cronies fled the encounter. Taking a moment to catch your breath, you managed to find the most conscious of the ${bystanders}s. "${ucInit(gPron(enemy, "subject"))} never told us the plan!" ${lowerCaseInitial(contact)} cried. ${contact} tells that`,
                    `Accessing ${possessiveSuffix(enemy.boss)} ${gizmo}, you are able to determine that`,
                    `"You think you have won?"  ${enemy.boss} says as you're closing in. "You have won nothing!" ${detonationaction}, and the floor collapses beneath you as ${gPron(enemy, "subject")} escapes. You save who you can and ${minion} returns the favor by telling you that`,
                    `With the Citadel on the way, you head deeper to find an array of computer screens. Sifting through files, you learn that`,
                    `Accessing ${possessiveSuffix(enemy.boss)} files, you were able to determine that `,
                    `You snatch up a ${gizmo} and press the communications device in your ear.  "I've got some intel."  "Excellent," Agent Fletch responds.  "We'll see what data we can pull from it." Turns out`,
                    `After the fight, with no sight of ${enemy.boss}, you couldn't help but wonder what ${gPron(enemy, "subject")} was trying to cover up with this. Inside you found a ${gizmo} with intel that ${enemy.boss} definitely didn't want you to find:`,
                ])
            } else if (location == "neutral") {
                gatherclues = gatherclues.concat([
                    `"You think you have won?"  ${enemy.boss} says you're closing in. "You have won nothing!" ${detonationaction}, and the floor collapses beneath you as ${gPron(enemy, "subject")} escapes. You save who you can and ${minion} returns the favor by telling you`,
                    `After the fight, with no sight of ${enemy.boss}, you couldn't help but wonder what ${gPron(enemy, "subject")} was trying to cover up with this. Inside you found a ${gizmo} with intel that ${enemy.boss} definitely didn't want you to find:`,
                ])
            } else if (location == "cursed") {
                gatherclues = gatherclues.concat([
                    `You were strong and fast enough to prevent ${enemy.boss} from finishing the ritual, the ${mysticalSynonym()} powers dissipating into the temple like a voice on the wind. You search through the area, and find out that`,
                    `With each blow to ${enemy.boss}, the very world around you shudders. ${ucInit(gPron(enemy, "object"))} screams of pain carry on the winds around you as ${gPron(enemy, "subject")} attempts to fight you off.  Suddenly there's blinding flash and ${gPron(enemy, "subject")}'s gone. You can only look throuh what's left, and you determine that`,
                ])
            }

            let planning = [`. You decide to pay them a visit.`, `. Agent Fletch suggests you continue your investigations there.`, `. A frightened ${bystanders} begs you to hurry up!`, `, and you think there really is no other option than to investigate.`, `. Perhaps it is time to visit ${nextenemy.boss}.`]

            let finalclue = randFrom([`where ${finalboss.boss} is waiting for you.`, `where your final showdown will go down!`, `the critical piece of information that leads you to the location of ${finalboss.boss}!`, `where ${finalboss.boss} is!`, `where the fight to end this will be.`, `the location where your ultimate destiny lies.`, `${nextenemy.boss} in fact is where all the clues were pointing at.`])
            let finality = randFrom([``, `You're going to stop this once and for all.`, `You prepare for a fight this one last time.`, `This is it!`, `This is the end, at last.`, `No escape for ${finalboss.boss} now!`, `You can almost taste the victory!`, `Everything has led to this moment.`, `It is in your hands now.`, `The time has come for your final confrontation!`, `You know this, the final confrontation, won't be easy!`])

            let victoryresult = (nextstage >= $("#storylength").val()*2-3) ? randFrom(gatherclues).replace(" that", "").replace("continues", "reveals") + " " + finalclue + "<br><br>" + finality : randFrom(gatherclues) + " " + clue + randFrom(planning)

            return victoryresult
        }

        function determineNextStage(stageindex, story, result) {

            let nextstage = Math.ceil(stageindex/2)*2+1+result

            if (stageindex >= $("#storylength").val()*2-3) { nextstage = 0 }

            return nextstage
        }

        function getRandomMinions(enemy) {


            let clones = randFrom(enemiescopy)

            while (clones.name === enemy) { clones = randFrom(enemiescopy) }

            return `choose ${randFrom([clones.minionnames[0], clones.minionnames[1]])} from the ${clones.name} deck as the minion`

        }


        function setUpInstructions2(stageindex, enemy, rival, ally, knowledge, stagebonus, stagemalus) {

            let addrival

            ally == null ? ally = rival : () => { }

            let penalty = Math.max(0, Math.round(stageindex / 3))

            if (knowledge == "clueless") {
                penalty = penalty + 1
            } else if (knowledge == "hottrail") {
                penalty = penalty - 1
            } else { penalty = penalty }

            //gladiator, stage and boss  difficulty, if implemented :

            //penalty = penalty + round(round(grating)+srating+brating)

            //add cards that add to story pool
            //gettin a positive card nets increased difficulty!

            penalty < 1 ? addrival = false : addrival = randFrom([true, false])

            let preparedboss = randFrom(enemy.preparedboss)

            let genericbonus = [
                { allysetup: `Put ${ally.name} (ally) into play.`, prologue: "guide" },
                { setup: `Each fighter may take a second mulligan.` },
                { setup: `Each fighter gains 2 random defense tokens.` },
                { setup: `Search the enemy deck for ${preparedboss[0]} and discard it. Shuffle the enemy deck.` },
                { setup: `Each fighter may draw one loot card.` },
                { setup: `Each fighter may draw one card and gain 1 defense token of their choice.` }, // exhaust to attack with guard
                { persisent: `<b>Exhaust:</b> Choose one unengaged fighter to draw one card.` }, // feint to draw loot?Ã
                { rivalsetup: `Put ${rival.name} (rival) into play.`, wincondition: [`If ${rival.name} is defeated:`, `If ${rival.name} is not defeated:`], prologue: "rival" }
            ]
            let angryrival = [
                { setup: `${rival.name} (rival) gains 1 of each type of defense token, and is placed within 3 spaces of a fighter. Activate ${rival.name} (rival).`, rivalboost: true },
                { activate: `${rival.name} (rival) gains 1 random defense token and advances 2 spaces toward the nearest fighter.`, rivalboost: true },
                { activate: `${rival.name} (rival) gains 2 random defese tokens.`, rivalboost: true },
                { activate: `${rival.name} (rival) gains gains 1 defense token from each engaged fighter.`, rivalboost: true },
                { activate: `The fighter furthest from ${rival.name} (rival) discards 1 power.`, rivalboost: true },
                { wincondition: [`If the fighters win and ${rival.name} is defeated:`, `If ${rival.name} is not defeated:`], prologue: "rival" },
                { activate: `If ${rival.name} (rival) is in play, each fighter discards 2 defense tokens of different types. For each fighter that did not, deal that fighter and each figure adjacent to them 3 general damage.` }
            ]

            let intel_words = [`intel`, `evidence`, `knowledge`, `information`]
            let acquire_words = [`acquired`, `obtained`, `collected`, `found`, `discovered`]
            let interrogate_words = randFrom([`interrogated`, `questioned`, `examined`, `probed`])
            let intel_goal = randFrom([`${randFrom(acquire_words)} the ${randFrom(intel_words)}`, `learned what you need`])

            let penalties = [
                { activate: `If ${enemy.boss} is unengaged, ${gPron(enemy, "subject")} gains 1 defense token.` },
                { setup: `Each fighter randomly discards 1 card.` },
                { activate: `Each fighter discards 1 defense token.` },
                { setup: `Each fighter suffers 2 direct damage.` },
                { setup: `Search the enemy deck for ${preparedboss[0]}, ${preparedboss[1]}. Shuffle the enemy deck.` },
                { setup: `${enemy.boss} gains 2 defense tokens of each type.` },
                { persistent: `${enemy.boss} gains +1 attack value.` },
                { persistent: `${enemy.boss} gains ${enemy.boss == "Ah Long" ? "2P" : "4P"} health value.` },
                { activate: `The fighter furthest from ${enemy.boss} within 4 spaces of ${gPron(enemy,"object")} discards 1 power.` },
                { allysetup: `Put ${ally.name} (ally) into play.`, wincondition: [`If the fighters win and ${ally.name} is not defeated:`, `If ${ally.name} is defeated:`], prologue: "escort" },
                { persistent: `Put 2P power on this card. <b>Interact:</b> If engaged with ${enemy.boss}, discard 1 defense token of a type of which ${gPron(enemy, "subject")} has 0 of to discard 1 power from this card and if no power remains, ${enemy.boss} is successfully ${interrogate_words}.`, wincondition: [`If the fighters win and ${enemy.boss} is ${interrogate_words}:`, `If ${enemy.boss} is not ${interrogate_words}:`], prologue: "intel" },
                { persistent: `<b>Interact:</b> If you are in a crate space, you may discard 1 of each type of defense token on this card. Once there is 1P of each defense token on this card, you have ${intel_goal}.`, activate: `Each fighter discards 1 defense token for each space the nearest crate space is from them.`, wincondition: [`If the fighters win and have ${intel_goal}:`, `If you have not ${intel_goal}:`], prologue: "intel" },
                { activate: `Every fighter not engaged with an enemy must discard 1 power and 1 defense token of their choice.` },
                { persistent: `Place 5P power tokens on this card. After a fighter defeats an enemy in their threat area, they may discard 1 defense token to gain 1 power from this card. If there is no power on this card, you have ${intel_goal}.`, activate: `Place 1 power on this card for any unengaged enemy except for the boss.`, wincondition: [`If the fighters win and have ${intel_goal}:`, `If you have not ${intel_goal}:`], prologue: "intel" },
                { allysetup: `Put ${ally.name} (ally) into play.`, persistent: `If ${ally.name} (ally) would be dealt any damage, deal it to one fighter instead.`, prologue: "escort" },
            ]

            addrival ? penalties = _.union(penalties, angryrival) : penalties = penalties

            let directions = []

            Array.isArray(stagebonus) ? stagebonus = randFrom(stagebonus) : () => { }
            Array.isArray(stagemalus) ? stagemalus = randFrom(stagemalus) : () => { }

            if (penalty < 0) { directions.push(randFrom([stagebonus, randFrom(genericbonus)])) }
            else if (penalty == 0) { directions = directions }
            else if (penalty == 1) {
                addrival ?
                    directions.push({ rivalsetup: `Put ${rival.name} (rival) into play.` }) :
                    directions.push(randFrom([stagemalus, randFrom(penalties)]))
            }
            else {
                addrival ?
                    (directions.push({ rivalsetup: `Put ${rival.name} (rival) into play.` }), directions.push(randFrom([stagemalus, randFrom(penalties)]))) :
                    (directions.push(randFrom(penalties)), directions.push(stagemalus))
            }

            let persistence = false
            let activate = false
            let rivalboost = false
            let allysetup = false
            let rivalsetup = false
            let setuptext = ""
            let activatetext = ""
            let persistenttext = ""
            let wincondition = [`If the fighters win:`, `If the fighters lose:`]
            let prologue = ""

            $(directions).each(function () {
                this.hasOwnProperty("setup") ? (setuptext = `${setuptext} ${this.setup}`) : () => { }
                this.hasOwnProperty("activate") ? (persistence = true, activate = true, activatetext = `${activatetext} ${this.activate}`) : () => { }
                this.hasOwnProperty("persistent") ? (persistence = true, persistenttext = `${persistenttext} ${this.persistent}`) : () => { }
                this.hasOwnProperty("allysetup") ? (allysetup = true, setuptext = `${setuptext} ${this.allysetup}`) : () => { }
                this.hasOwnProperty("rivalsetup") ? (rivalsetup = true, setuptext = `${setuptext} ${this.rivalsetup}`) : () => { }
                this.hasOwnProperty("rivalboost") ? rivalboost = true : () => { }
                this.hasOwnProperty("wincondition") ? wincondition = this.wincondition : () => { }
                this.hasOwnProperty("prologue") ? prologue = this.prologue : () => { }
            })

            let instructions = `<b>Stage Setup:</b> ${setuptext}${persistence ? ` Put this card into play in the enemy play area.` : ""} ${persistence ? persistenttext : ""}${activate ? ` <b>Activate:</b> ` : ""}${activate ? activatetext : ""}`

            instructions.trim() == "<b>Stage Setup:</b>" ? instructions = `<b>Stage Setup:</b> No special setup` : () => { }

            return ({ setup: instructions, allysetup: allysetup, rivalsetup: rivalsetup, rivalboost: rivalboost, wincondition: wincondition, prologue: prologue })

        }

        function createLeadIn(pregameprologue, stageindex, wincondition, enemy, finalboss, rival, ally) {
            function trueMastermind() {
                true_words = ["true","real","paramount","utmost"]
                mastermind_words = ["mastermind","architect","engineer","intellect","prime mover"]
                description_words = [`recent`, `devious`, `criminal`, `insidious`]
                plot_words = [`plot`, `masterplan`, `events`, `incidents`]
                finalboss_words = [`the ${randFrom(description_words)} ${randFrom(plot_words)}`, `the ${randFrom(description_words)} ${randFrom(plot_words)}`, `${finalboss.boss}`, `the ${finalboss.name}`, `the devious`]
                return `the ${randFrom(true_words)} ${randFrom(mastermind_words)} behind ${randFrom(finalboss_words)}`

            }

            pregameprologue = stageindex == 0 ? pregameprologue : ``
            let find_out_words = [`you discover`, `you find out`, `you learn`, `you get wind`, `you determine`, `it seems`, `turns out`]
            let this_boss = finalboss.name == enemy.name ? enemy.boss : randFrom([enemy.boss, `the ${enemy.name}`])
            let this_finalboss = finalboss.name == enemy.name ? finalboss.boss : randFrom([finalboss.boss, `the ${finalboss.name}`])
            if(stageindex >= Math.max($("#storylength").val()*2-3,0)) {this_finalboss = trueMastermind()}
            let intel_words = ["intel", "knowledge", "information", "a clue", "a word", "lowdown"]
            let location_words = ["locale", "location", "whereabouts", "position", "scene", "station", "bearings"]
            let investigator_words = ["Citadel analysts", "you", "Agent Fletch and you"]
            let citadel_words = [`the Gladiators`, `you`, `Citadel`, `Global Gladiators`, `Agent Fletch`]
            let assumption_words = ["believe", "consider", "conclude", "suppose", "think", "regard", "assume", "postulate", "deem", "surmise", "resolve"]
            let decision_words = [`resolve`, `determine`, `come to a decision`, `decide`, `come to a conclusion`]
            let priority_words = [`a priority`, `a first concern`, `the most pressing matter`, `the most important consideration`, `most important`, `takes precedence`]
            let turns_out_words = [`it turns out`, `it emerges`, `it comes to light`, `it transpires`, `you find out`, `${randFrom(investigator_words)} ${randFrom(assumption_words)}`]
            let intel_words_2 = [`intel`, `evidence`, `knowledge`, `information`]

            let first_is_final = enemy.boss != finalboss.boss && stageindex == 0 ?
                `Without ${randFrom(intel_words)} on the current ${randFrom(location_words)} of ${finalboss.boss}, ${randFrom(investigator_words)} ${randFrom(assumption_words)} ${enemy.boss} is the best source for more information.<br><br>` : ``

            let hence_words = [`Accordingly`, `Hence`, `So`, `Consequently`, `Therefore`, `Thus`]
            let default_clues = ["Based on current intel", "Chasing the clues", "Following your leads", "In pursuit of clues", "After a little more intel-gathering", "Following this lead", "As you investigated further", "After searching for more intel", "Following the intel you had", "After searching for more information", "Reviewing what you got", "With the information you gathered", `You tracked down some of the ${enemy.name} associates and tailed their movements. ${randFrom(hence_words)}`, `Following the trail of money leading from the previous encounter`,`"We've traced them," Agent Fletch says, seated across the table. He takes out a satellite image and lays it on the table, pointing to a small red dot near the image's center. ${randFrom(hence_words)}`]
            let wincondition_txt = ""

            if (wincondition == "intel") {

                let evidence_clues = [` that ${this_boss} knows more about ${possessiveSuffix(this_finalboss)} plan than you expected.`, ` ${this_boss} has detailed ${randFrom(intel_words_2)} on the plans of ${this_finalboss}.`, ` ${this_boss} has ${randFrom(intel_words_2)} that will lead you to ${this_finalboss}.`]
                let acquire_words = [`obtaining`, `acquiring`, `securing`, `procuring`, `getting`, `finding`]
                let priority_words = [`a priority`, `a first concern`, `the most pressing matter`, `the most important consideration`, `most important`, `takes precedence`]
                let decision_txt = `${ucInit(randFrom(investigator_words))} ${randFrom(decision_words)} ${randFrom(acquire_words)} the ${randFrom(intel_words_2)} is ${randFrom(priority_words)}.`
                wincondition_txt = `${randFrom(default_clues)} ${randFrom(find_out_words)} ${randFrom(evidence_clues)} ${decision_txt} ${randFrom(hence_words)}`

            } else if (wincondition == "rival") {

                let rivals_fate_words = [`capturing`, `seizing`, `arresting`, `catching`, `interrogating`, `grilling`, `questioning`]
                let rival_capture = `${ucInit(randFrom(investigator_words))} ${randFrom(decision_words)} ${randFrom(rivals_fate_words)} ${gPron(rival, "object")} is ${randFrom(priority_words)}`

                wincondition_txt = `${randFrom(default_clues)} ${randFrom(find_out_words)} ${this_boss} has an associate who knows more about the plans of ${this_finalboss}. ${rival_capture}. ${randFrom(default_clues)}`

            } else if (wincondition == "escort") {

                let escort_prologue = [
                    `${ally.name} has agreed to share ${gPron(ally, "possessive")} ${randFrom(intel_words_2)} on ${this_finalboss} if you help ${gPron(ally, "object")} with ${this_boss}`,
                    `${randFrom(default_clues)}, ${randFrom(turns_out_words)} that ${ally.name} has ${randFrom(intel_words_2)} on ${this_finalboss}. You need to make sure ${gPron(ally, "subject")} survives for ${randFrom(investigator_words)} to get that ${randFrom(intel_words_2)}`,
                    `${ally.name} has approached ${randFrom(citadel_words)} for assistance in exchange for ${randFrom(intel_words_2)} on ${this_finalboss}. ${ucInit(gPron(ally, "subject"))} needs your protection from ${this_boss}`,
                    `${ally.name} is on a parallel Citadel mission to yours, and you need to protect ${gPron(ally, "object")} so ${gPron(ally, "subject")} can obtain whatever ${randFrom(intel_words_2)} ${gPron(ally, "subject")} is after`]
                wincondition_txt = `${randFrom(escort_prologue)}. ${randFrom(default_clues)}`

            } else { wincondition_txt = randFrom(default_clues) }

            let lead_in = pregameprologue + first_is_final + wincondition_txt

            return lead_in
        }

        function createPrologue(stageindex, story, alliesandrivals, heronames, enemies, pregameprologue, vip) {
            let finalboss = story[Math.max($("#storylength").val()*2-3, 0)].enemy
            let finalstage = story[Math.max($("#storylength").val()*2-3, 0)].stage
            let enemy = story[stageindex].enemy
            let stage = story[stageindex].stage
            let rival = allyNamer(alliesandrivals, enemy, heronames)
            let ally = allyNamer(alliesandrivals, enemy, heronames)
            let knowledge = stage.knowledge
            let minion = randFrom(enemy.minionnames)
            let instructions = setUpInstructions2(stageindex, enemy, rival, ally, knowledge, stage.stagebonus, stage.stagepenalty)
            let allypresence = instructions.allysetup
            let rivalpresence = instructions.rivalsetup
            let rivalboost = instructions.rivalboost
            let trail = createLeadIn(pregameprologue, stageindex, instructions.prologue, enemy, finalboss, rival, ally)
            let setup = `<b>${stage.name}: ${enemy.name} ${enemy.name == "Kingdom" ? `(${enemy.boss})` : ""}</b><br>` + ((stage.name == "Original Copy") ? ucInit(getRandomMinions(enemy.name)) + ".<br>" : ``) + instructions.setup
            let win = determineNextStage(stageindex, story, 0)
            let lose = determineNextStage(stageindex, story, 1)
            let gizmo = randFrom(["data disc", "keycard", "tape recorder", "floppy disc", "microchip", "communicator", "cell phone", "diskette", "data cartridge", "tablet", "magnetic tape", "computer"])
            
            let winepilogue = stageindex >= Math.max(($("#storylength").val()*2-3),0) ? finalResult(stage, enemy, rival, vip, 1) + "<br><br>" + `${finalboss.boss != enemy.boss ? `You could not stop the ${finalboss.boss}, but your efforts were not in vain, as a threat as serious was neutralized. ` : ``}The fighters win this story.` : victoryResult(stageindex, story, win, gizmo)
            let loseepilogue = stageindex >= Math.max(($("#storylength").val()*2-3),0) ? finalResult(stage, enemy, rival, vip, 0) + "<br><br>" + `The fighters lose this story.` : loseResult(stageindex, story, lose, gizmo)
            let gloat = gloatingList(enemy, stage)
            let prologue
            let casino = getCasino(enemy)

            let masterplan = stage.masterplan

            stage.name == "Casdft" && knowledge != "" ? console.log(stage.name + Math.random()) : ``

            let template_settings = { "finalboss": finalboss, "enemy": enemy, "rival": rival, "minion": minion, "gloat": gloat, "rivalpresence": rivalpresence, "rivalboost": rivalboost, "stageindex": stageindex, "knowledge": knowledge, "gizmo": gizmo, "trail": trail, "casino": casino, "vip": vip }

            let stageriv = stage.rivaltext(template_settings)

            template_settings["rivaltext"] = stageriv

            let stagevar
            switch (knowledge) {
                case "hottrail": stagevar = stage.hottrail(template_settings);
                    break;
                case "coldtrail": stagevar = stage.coldtrail(template_settings);
                    break;
                case "clueless": stagevar = stage.clueless(template_settings);
            }

            template_settings["stagevar"] = stagevar
            stage.hasOwnProperty("finalvar") ? template_settings["finalvar"] = stage.finalvar(template_settings) : ``

            if (knowledge == "captured") {
                prologue = stage.captured(template_settings)
            } else if (stageindex >= Math.max($("#storylength").val()*2-2,0) && enemy.boss != finalboss.boss) {
                masterplan = stage.masterplan
                stageindex != 0 ? template_settings.trail = changeOfPlans(trail, finalboss, enemy, stage) : ``
                stage.hasOwnProperty(masterplan) ? prologue = stage[masterplan](template_settings) : prologue = stage.prologue(template_settings)
            } else if (stageindex >= Math.max($("#storylength").val()*2-3,0) && stage.hasOwnProperty(masterplan) && knowledge != "clueless") {
                prologue = stage[masterplan](template_settings)
            } else {
                prologue = stage.prologue(template_settings)
            }


            return { chapter: story[stageindex].chapter, prologue: prologue, setup: setup, wincondition: instructions.wincondition, winepilogue: winepilogue, loseepilogue: loseepilogue }
        }

        function textMaker(story, alliesandrivals, heronames, enemies) {

            let cardtext
            let cardtexts = []
            let winepilogue = "Victory text"
            let loseepilogue = "Defeat text"
            let pregameprologue = preGamePrologue(story[Math.max($("#storylength").val()*2-3,0)].stage, story[Math.max($("#storylength").val()*2-3,0)].enemy)

            for (i = 0; i < story.length; i++) {
                cardtext = createPrologue(i, story, alliesandrivals, heronames, enemies, pregameprologue.storytext, pregameprologue.vip);
                cardtexts.push(cardtext)
            }

            return cardtexts

        }
    
        function changeOfPlans(trail, finalboss, enemy, stage) {


            let newintel = randFrom([
                `There is no time for regrets, and you need to leave the failure of stopping ${finalboss.boss} behind. ${preGamePrologue(stage, enemy).storytext}`,
                `Citadel analysts have gone over every bit of intel you have gathered on ${finalboss.boss}, but have nothing to go on. But there are more pressing concers. ${preGamePrologue(stage, enemy).storytext}`,
                `While you may have lost the fight, the battle is far from over. ${preGamePrologue(stage, enemy).storytext}`,
                `Focusing on ${finalboss.boss} has let other, just as devious issues grow. ${preGamePrologue(stage, enemy).storytext}`
            ])

            let conclusion = randFrom([
                `, you slowly come to the conclusion that you have failed to locate ${finalboss.boss}. But suddenly, Agent Fletch contacts you and says: "${newintel}"`,
                `, you decide you need to contact Agent Fletch for assistance, as you don't have a clue where to proceed. "${newintel}"`,
                `, you conclude that ${finalboss.boss} has won this time. ${newintel}`,
                `, you accept your defeat and retreat to Citadel HQ. ${newintel}`,
                `, you realize you will not be able to catch ${finalboss.boss}. Meeting up with Agent Fletch, he says: "${newintel}"`
            ])

            let hence_words = randFrom([`Accordingly`, `Hence`, `So`, `Consequently`, `Therefore`, `Thus`])

            conclusion = trail + conclusion + hence_words

            return conclusion
        }

        function finalResult(stage, enemy, rival, vip = null, result) {

            let masterplan = stage.masterplan
            let neutralize

            switch (masterplan) {
                case "kidnapping": neutralize = `${vip[0]} has been aquired from the ${enemy.name}`
                    break;
                case "personalpower": neutralize = `power levels of the ${enemy.bosstitle()} remain in check`
                    break;
                case "strengtheningforces": neutralize = `army of the ${enemy.name} has been neutralized`
                    break;
                case "actsofterror": neutralize = "plan to destablize Ransom City has been countered"
                    break;
                case "illegalgains": neutralize = `plan to fund ${enemy.name} operations has been countered`
                    break;
                default: "is stopped."
            }

            let winresult = [
                `You have finally beaten the last of the minions of ${enemy.desc}, and try find their defeated boss. But ${gPron(enemy, "subject")} has disappeared! At least the ${neutralize}.`,
                `"The ${neutralize}," you report to Agent Flecth. "But ${enemy.boss} is nowhere to be found."`,
                `"Gladiator?" Agent Fletch's voice sounds in your ear, small and tinny from your damaged communicator. "What's the status?" You press your finger to the comm button. "The ${neutralize}," you respond, breathing heavily. "${enemy.boss} has been defeated but is nowhere to be found. `,
                `"You may have me," ${enemy.boss} says as the Citadel agents surround them. "But I am only one." Agent Fletch approaches. "Say goodbye to your precious ${enemy.name}," he says. ${randFrom([rival.name, randFrom(enemy.minionnames)])} laughs. "Who do you think you're working for?"`,
                `"You may think you have me," ${enemy.boss} says as the Citadel agents surround them. Suddenly, ${gPron(enemy, "subject")} starts to deteoriorate, and in mere seconds, there's nothing but dust left. Agent Fletch approaches. "It must have been a clone! At least the ${neutralize}, that's a victory in my books."`,
                `In a blinding flash, ${enemy.boss} disappears just as Agent Fletch approaches. "The ${neutralize}," you report. "We may have won the battle, but the war is not over," Agent Fletch says.`,
                `You ensured that the ${neutralize}. As ${possessiveSuffix(enemy.boss)} minions flee, ${gPron(enemy, "subject")} wipes blood from ${gPron(enemy, "possessive")} mouth. "We're not done. This is MY city. The ${enemy.name} never forgets! So you better never show your face here again!" With that, they quickly fled in the darkness.`,
                `With each blow to ${enemy.boss}, ${gPron(enemy, "subject")} attempts to fight you off. Finally, ready to end it all, you swing with what will be your final attack, but suddenly there's blinding flash and  ${gPron(enemy, "subject")}'s gone.`,
                `With ${enemy.boss} defeated, Citadel soldiers secure the area and you return home. Now that the ${neutralize}, the Mayor arranges a parade for the heroes of the city, and most of you get a medal!`,
                `Suddenly, there's a blinding flash and ${possessiveSuffix(enemy.boss)} gone! It's all gone. Shockingly, you're back at Citadel HQ, surrounded by agents all going about their business. Did all that even happen?`,
                `You are lying in the corner, exhausted, all enemies defeated - but their master is nowhere to be found. "You've done a hero's job, Gladiators. I guess you're through, huh?" Agent Fletch asks as he approaches you. "Finished," you answer wearily. "It's too bad we couldn't catch ${enemy.boss}. But then again, do we really ever?"`,
                `Your intense fight takes you to the edge of ${stage.hasOwnProperty(`pit`) ? stage.pit : `a bottomless pit`}. Just as you're about to strike ${enemy.boss} down, ${gPron(enemy, "subject")} dives in, and that's the last you see of ${gPron(enemy, "object")}. For now!`,
                `You are sure you have cornered ${enemy.boss} with no route of escape, when all of a sudden a sleek ${enemy.name} helicopter descends and ${gPron(enemy, "subject")} leaves, dangling from a ladder. "The ${neutralize}, but ${enemy.boss} slipped away," you report to Agent Fletch with your communicator.`,
                `Your body spasms, fighting against the green gel. Unable to breathe, you claw wildly at the hard, translucent surface encasing you. Shadowy figures move about on the other side of the barrier, and suddenly the lid slides open, and you fall to the ground. The lights are blindingly bright to your aching eyes, and you draw air in your lungs like it's the first time in your life. "Welcome, child!" you hear a voice calling. What is happening? Was that a dream?`,
                `"If you strike me down, I shall become more powerful than you possibly can imagine," ${enemy.boss} says. ${ucInit(gPron(enemy, "subject"))} drops ${gPron(enemy, "possessive")} guard, and you strike ${gPron(enemy, "object")} one last time, and there's a blinding flash! ${ucInit(possessiveSuffix(gPron(enemy, "subject")))} gone! Disappeared!`
            ]

            let finisher = randFrom(["Finish them", "Show no mercy", "End them", "Put an end to this", "Kill them, and send what remains to Agent Fletch", "Wipe them out, all of them", "Put a stop to this"])

            let gloat = gloatingList(enemy, stage)
            let submission = lastWords(enemy)
            let defiance = defiantEnd(enemy)
            let lastwords = randFrom([submission, defiance])
            let lastthoughts = lastThoughts(enemy)

            let loseresult = [
                `"${gloat[0]}" ${enemy.boss} says, arms crossed confidently in front of ${gPron(enemy, "object")}. "${gloat[1]}" ${ucInit(gPron(enemy, "subject"))} turns to face ${rival.name + " and " + randFrom(enemy.minionnames)}, ${gPron(enemy, "possessive")} final command echoing powerfully off the walls with a sudden finality. "${finisher}!"`,
                `"${gloat[0]}" ${enemy.boss} says as your body is strapped into a large metal apparatus in ${enemy.boss == "Jackal" ? "her" : "Jackal's"} laboratory. "${gloat[1]}"`,
                `"Gladiator?" Agent Fletch's voice sounds in your ear, small and tinny from your damaged communicator." What's the status?" You watch from your place on the floor, unable to respond as ${enemy.boss} returns to ${gPron(enemy, "possessive")} plan.`,
                `"${lastwords[0]}" ${heroSpeech()}. "${lastwords[1]}" ${enemy.boss} laughs wickedly. "${gloat[0]}" ${gPron(enemy, "subject")} gloats. "${gloat[1]}"`,
                `${lastthoughts} ${enemy.boss} laughs wickedly. "${gloat[0]}" ${gPron(enemy, "subject")} gloats. "${gloat[1]}"`,
                `${enemy.boss} pushes you down, forcing you into submission. You try to fight ${gPron(enemy, "object")} off but can't, and instead watch in horror as ${gPron(enemy, "subject")} ${enemy.threat}. Your scream is lost on the winds as ${gPron(enemy, "subject")} extinguishes your life!`,
                `Last of the Gladiators have fallen to ${enemy.boss} and ${gPron(enemy, "possessive")} ${enemy.minions}. "${gloat[0]}" ${gPron(enemy, "subject")} says. "${gloat[1]}" ${ucInit(gPron(enemy, "subject"))} ${enemy.threat}.`,
                `"${gloat[0]}" says ${enemy.boss} as ${gPron(enemy, "subject")} ${enemy.threat}. ${randFrom([`You can only watch, horrified.<br><br>"${gloat[1]}"`, `"${gloat[1]}"<br><br>${lastthoughts}`])}`,
                `"${gloat[0]}" ${enemy.boss} says, and ${enemy.threat}. Those are the last words you ever hear.`,
                `"Maybe The Master would have a better use for the Gladiators?" ${randFrom(enemy.minionnames)} asks. "No," ${enemy.boss} answers${randFrom([` as ${gPron(enemy, "subject")} ${enemy.threat}`, `, and orders: "${finisher}"`])}.`,
                `You gave all you've got, but it was not enough. Not even close. "${finisher}!" ${enemy.boss} orders ${randFrom(enemy.minionnames)}.`,
                `${enemy.boss} stands over your limp body. "${gloat[0]}" ${gPron(enemy, "subject")} says, as ${gPron(enemy, "possessive")} ${enemy.minions} draw nearer. "${gloat[1]} ${finisher}!" The minions follow the order.`,
                `As you're lying on the ground, bleeding out,${randFrom([``, ` ${heroSpeech()}: "${lastwords[0]}" but the ${enemy.bosstitle()} cuts you off.`, ` ${lowerCaseInitial(lastthoughts)}`])} "${gloat[0]}" ${enemy.boss} says. "${gloat[1]}"`,
                `"${gloat[0]}" the ${enemy.bosstitle()} says. You don't answer anything. ${lastthoughts} ${enemy.boss} goes on: "${gloat[1]}" ${ucInit(gPron(enemy, "subject"))} ${enemy.threat}.`,
                `"${gloat[0]}" ${enemy.boss} shouts. ${ucInit(gPron(enemy, "subject"))} ${enemy.threat}. "${gloat[1]}"`,
                `"${gloat[0]}" ${enemy.boss} says, hellfire twinkling visibly in ${gPron(enemy, "possessive")} eyes. "${gloat[1]}"`,
                `You are lying on the ground, defeated. "${finisher}!" ${enemy.boss} orders${randFrom([` ${gPron(enemy, "possessive")} goons.`, `. ${lastthoughts}`])}`,
                `You try to stagger away from your defeat. "${gloat[0]}" ${enemy.boss} growls, while ${gPron(enemy, "subject")} comes at you, unrelenting. "${gloat[1]}"`,
                `With ${gPron(enemy, "possessive")} right hand, ${enemy.boss} grabs your face and pushes your aching body, sapped of all strength, slowly backward toward ${stage.hasOwnProperty("pit") ? stage.pit : `a bottomless chasm`}. "${gloat[0]}" ${gPron(enemy, "subject")} says. "${gloat[1]}"`,
                `Agent Fletch and Citadel soldiers have arrived just a few moments too late. "${submission[0]}" ${heroSpeech()}, and fall forever silent. Fletch lets out a scream of despairing anguish, knowing you were senselessly lost because of miscommunications and bad timing.`,
                `Agent Fletch finds you broken and battered where ${enemy.boss} left you. "${submission[0]}" ${heroSpeech()}. "${submission[1]}"<br><br>You close your eyes slowly and your head goes limp.`,
                `"${finisher}!" ${enemy.boss} orders. The ${enemy.minions} remorselessly beat you until you feel nothing.`,
                `${enemy.boss} looks at you, lying at ${gPron(enemy, "possessive")} feet. "${gloat[0]}" ${gPron(enemy, "subject")} says, looking disappointedly at you. "${gloat[1]}${randFrom([` ${finisher}." ${randFrom(enemy.minionnames)} steps closer.`, `" ${ucInit(gPron(enemy, "subject"))} ${enemy.threat}.`])}`,
                `"${lastwords[0]}" ${heroSpeech()}. "${lastwords[1]}"<br><br>"${gloat[0]}" ${enemy.boss} answers. "${gloat[1]}"`,
                `Citadel aircraft speeds you to medical care, but you know it is too late. "${submission[0]}" ${heroSpeech()} to Agent Fletch, at your side.<br><br>"${submission[1]}"`,
                `"Gladiator?" Agent Fletch's voice penetrates your fading mind. "${submission[0]}" ${heroSpeech()}, before the darkness overcomes you.`,
                `You are lying on your back, the pain preventing you from moving. ${randFrom([`${lastthoughts}. and this is the last thought you will ever have.`, `"${submission[0]}" ${heroSpeech()} to no-one in particular as you draw your last breath. "${submission[1]}"`])}`,
                `Citadel soldiers are clearing the area from the aftermath of your fight, long after victorious ${enemy.boss} has left. "${submission[0]}" ${heroSpeech()} to Agent Fletch. "Don't try to speak," he answers, but you know it will not make any difference. ${ucInit(heroSpeech())} your last words: "${submission[1]}"`,
                `"Finish them off, ${enemy.boss}! Do it now!" shouts ${randFrom(enemy.minionnames)}. "${gloat[0]}" ${enemy.boss} says, and ${enemy.threat}. "${gloat[1]}"`,
                `"${randFrom([`No more, ${enemy.boss}! Grant me mercy!" you shout.`, `${lastwords[0]}" ${heroSpeech()}, "${lastwords[1]}"`])} ${enemy.boss} ${enemy.threat}${randFrom([`. "I thought you were made of sterner stuff," ${gPron(enemy, "subject")} responds.`, `, and orders ${gPron(enemy, "possessive")} minions: "${finisher}!"`])}`,
                `${enemy.boss} has you pinned. Without a word, ${gPron(enemy, "subject")} ${enemy.threat}. With grim determination in ${gPron(enemy, "possessive")} eyes ${gPron(enemy, "subject")} ends your life.`,
                `"${defiance[0]}," you spit defiantly in the face of the victorious ${enemy.bosstitle()}. "${defiance[1]}"<br><br>"${gloat[0]}" ${gPron(enemy, "subject")} answers. "${gloat[1]}"`,
                `"${lastwords[0]}" ${heroSpeech()}, but ${enemy.boss} cuts you off by grabbing your throat. "${gloat[0]}" ${gPron(enemy, "subject")} says and starts to squeeze the life out of you. "${gloat[1]}"`,
                `Suddenly, there's a blinding flash and ${possessiveSuffix(enemy.boss)} gone! It's all gone. Shockingly, you're back at Citadel HQ, surrounded by agents all going about their business. Did all that even happen?`,
                `Your body spasms, fighting against the green gel. Unable to breathe, you claw wildly at the hard, translucent surface encasing you. Shadowy figures move about on the other side of the barrier, and suddenly the lid slides open, and you fall to the ground. The lights are blindingly bright to your aching eyes, and you draw air in your lungs like it's the first time in your life. "Welcome, my children!" you hear a woman calling. What is happening? Was that a dream?`,
            ]

            let finalresult

            result == 1 ? finalresult = randFrom(winresult) : finalresult = randFrom(loseresult)

            return finalresult

        }

        function heroSpeech() {
            let effort = [` `, ` manage to `,]
            let speak = [`cough out`, `wheeze`, `utter`, `gasp`, `say`, `hiss`, `groan`]
            let descriptive = [`with your last bit of strength`, `with a smile`, `through bloodied lips`]

            return "you" + randFrom(effort) + randFrom(speak)
        }

        function defiantEnd(enemy) {
            let defiance = [
                [`You're sick,`, `Where do people like you come from?`],
                [`You won't get away with this!`, `Citadel will make sure of it!`],
                [`No matter where you or what you do,`, `You're going down.`],
                [`When beasts like you have devoured each other,`, `The world will belong again to the little people.`],
                [`Come on down. You haven't got a chance,`, `Come on!`],
                [`Come on, I love it. Bring on some more!`, `Come on, ${enemy.boss}!`],
                [`Just finish this,`, `What are you waiting for?`],
                [`Was that all you got?`, `I excpected more of you.`],
                [`One day another Gladiator will rise,`, `And you shall fall.`],
                [`It is better to burn out,`, `Than to fade away.`]
            ]

            return randFrom(defiance)
        }

        function lastWords(enemy) {
            let lastwords = [
                [`Tomorrow, at sunrise..`, `I shall no longer be here.`],
                [`I was not supposed to die, not here..`, `Not like this.`],
                [`I do not grieve,`, `One day another Gladiator will rise and uses the power of ${randFrom(["Street Masters", "the Tiger"])} to light the darkest hour.`],
                [`It's over,`, `Goodbye.`],
                [`One never knows the ending,`, `One has to die to know exactly what happens after.`],
                [`If I'll close my eyes now,`, `I'm not going to wake up.`],
                [`I must go in..`, `The fog is rising.`],
                [`Tired..`, `So.. tired.`],
                [`Goodbye..`, `Farewell.`],
                [`You always were a pain in the rear,`, `It was nice knowing you.`],
                [`I'm afraid,`, `And I'm glad to be afraid.`],
                [`I'm a leaf on the wind,`, `Watch how I..`],
                [`It's been a funny sort of day,`, `Isn't it?`],
                [`It's..`, `Beautiful.`],
                [`I'll see you in another life,`, `When we are both Tigers.`],
                [`Death smiles at us all,`, `All you can do is to smile back.`],
                [`I got what everyone gets,`, `I got a lifetime`],
                [`Time..`, `To die.`],
                [`My only hope,`, `Is that the next team will do what I could not.`],
                [`My only regret is that I failed to stop the ${possessiveSuffix(enemy.name)} scheme,`, `And my failure has doomed Ransom.`],
                [`I can only think of all the innocent lives that will perish,`, `Because of this insane scheme I failed to thwart.`],
                [`I gave everything,`, `I have no regrets.`],
                [`When death comes,`, `It will come as an old friend.`],
                [`To dream, perchance to sleep,`, `Aye, there's the rub.`],
                [`'tis but a scratch,`, `Had worse.`]
            ]

            return randFrom(lastwords)
        }

        function lastThoughts(enemy) {
            let lastthoughts = [
                `You can only think of all the innocent lives that will perish because of this insane scheme you failed to thwart.`,
                `Your only regret is that you failed to stop the ${possessiveSuffix(enemy.name)} scheme, and your failure has doomed Ransom.`,
                `From out of nowhere a thought crosses your mind: one day another Gladiator will rise and uses the power of ${randFrom(["Street Masters", "the Tiger"])} to light the darkest hour.`,
                `You can only think that if you'll close your eyes now, you're not going to wake up.`,
                `You think to yourself it's been a funny sort of day in a way.`,
                `Your only hope is that the next team Agent Fletch will send will do what you could not.`,
                `You think that even with a lifetime of preparation, you could never have been ready.`,
                `You have a fleeting moment where you think this is not really happening - these are someone else's memories.`
            ]

            return randFrom(lastthoughts)
        }

        function gloatingList(enemy, stage) {
            let gloating = [
                ["You fought well,", "There will be no-one to mourn your death."],
                ["I'm not even going to kill you myself!", "I'll let my minions take care of that."],
                [`Everything comes to ${gPron(enemy, "object")} who waits,`, "And I have waited for so very long for this moment."],
                [`Where are they now? Where are your friends now?`, `Tell me about the loneliness of good. Is it equal to the loneliness of evil?`],
                [`This is finally turning into my kind of day,`, `The monument to my humble genius is now complete!`],
                [`Mwahahaha!`, `I'm so powerful I even impress myself!`],
                [`Please meet your end with dignity,`, `I hate whiners.`],
                [`Only you were brave - or stupid enough to oppose the ${enemy.name}.`, `Ransom City is now under martial law.. and I am the marshal.`],
                [`This is almost too easy,`, `Such heroic nonsense.`],
                [`${ucInit(defineAddressing(enemy))}!`, `Why throw away your lives so recklessly?`],
                [`I would've waited an eternity for this,`, `It's over, ${defineAddressing(enemy)}.`],
                [`It's a pity you Gladiators die so easily,`, `Or I might have a sense of satisfaction now.`],
                [`Come now, ${defineAddressing(enemy)},`, `We all must die sometime.`],
                [`You don't have to do this," you say. "People always say the same thing,`, `They say: 'You don't have to do this'.`],
                [`Have you ever seen blood in the moonlight, ${defineAddressing(enemy)}?`, `It appears quite black.`],
                [`Do you like life?" ${enemy.boss} asks. "Yes," you answer. "That's good,`, `Because I take no pleasure in taking a life if itâs from a person who doesnât care about it.`],
                [`You should've moved to a Brook City, or somewhere the rule of law still exists,`, `You will not survive here. You are not a ${enemy.name == "Golden Dragons" ? `dragon` : `tiger`}, and this is a land of ${enemy.name == "Golden Dragons" ? `dragons` : `tigers`} now.`],
                [`It looks like you have run out of luck,`, `How dare you challenge us?!`],
                [`Proud of yourself, ${randFrom([defineAddressing(enemy), "little Gladiator"])}?`, `Time to die!`],
                [`You must make a friend of horror,`, `Horror and moral terror are your friends. If they are not, then they are enemies to be feared.`],
                [`I don't blame myself,`, `You see, ${defineAddressing(enemy)}, most people never have to face the fact that, at the right time and the right place, they're capable of anything.`],
                [`There are times when I...`, `I look at people and I see nothing worth liking.`],
                [`Don't you think of your victims?" you ask. "You think there are victims? Don't be melodramatic,`, `Look, people are of no consequence. You shouldn't feel pity for any single one.`],
                [`Everything I touch becomes food for my hunger,`, `My hunger for power!`],
                [`I will win by any means!`, `By any cost!`],
                [`Power flows to the one who knows how,`, `Desire is not enough.`],
                [`This is becoming a wonderful day for evil,`, `Soon I shall have all in my power!`],
                [`You were always too late,`, `All your efforts were futile.`],
                [`Won't you please think of the children, ${enemy.boss}?" you plead the ${enemy.bosstitle()} of the ${enemy.name}. "What did the children ever do for me?`, `Nothing that I should mind their welfare for.`],
                [`Why are you doing this? What is there to gain?" you ask the ${enemy.bosstitle()} of the ${enemy.name}. "You don't always need a plan,`, `Sometimes you just need to breathe, trust, let go, and see what happens..`],
                [`You've come to the wrong place, ${defineAddressing(enemy)},`, `You will not leave here alive.`],
                [`I had heard you were sticking your nose in my business,`, `Fortunately, your efforts have been wasted.`],
                [`I was counting on you to come to try your pitiful mission, but I have news for you,`, `None of you will leave this place alive!`],
                [`I must possess all,`, `Or I possess nothing!`],
                [`I ache to smash you out of existence!`, `To drive your cursed face from my memories forever!`],
                [`You can't win," you tell ${enemy.boss} wearily. "I've already won this this the old-fashioned way, the tried and true way,`, `I cheated!`],
                [`Welcome to your doom, ${defineAddressing(enemy)},`, `I would have waited an eternity for this!`],
                [`This is how it begins!`, `The ${enemy.name} triumphant at last!`],
                [`How I loathe heroes!`, `Always getting in the way and acting so.. heroic!`],
                [`I cannot be defeated,`, `I defeat all.`],
                [`I fight to win, for me!`, `For me!`],
                [`I defeat all,`, `Until the end.`],
                [`To survive a war,`, `You must become war.`],
                [`You lived for something!`, `But you will die for nothing.`],
                [`Game over, Gladiators! Game over!`, `What are you going to do now?`],
                [`Gladiators! You know, I.. I expected more from you,`, `I thought you'd be tougher than this.`],
                [`Wait!" you shout.<br><br>"Wait? Are you kidding me? Did you just say 'Wait'?`, `You know what? I expected more from you. Wait for what? Wait for me to change my mind?`],
                [`Any last words?", ${enemy.boss} asks. You deprive ${gPron(enemy, "object")} of an answer. "Any?`, `Thought as much.`],
                [`Have you any last words?`, `Before I dispatch you?`],
                [`You're quite the piece of work, ${defineAddressing(enemy)},`, `But I am superior!`],
                [`You think you can take on me?`, `You need an army to take on me! You hear?! Who do you think you're dealing with?!`],
                [`When you have a chance to kill someone,`, `Don't hesitate.`],
                [`You've gotta ask yourself one question: Do I feel lucky?`, `Well, do you, ${defineAddressing(enemy)}?`],
                [`I feel no pity, or remorse, or fear,`, `And I absolutely will not stop - ever - until ${enemy.name} rules over everything!`],
                [`Did you believe I would let you on my trail by mistake?`, `Now face your death!`],
                [`Death smiles at us all,`, `All you can do is to smile back.`],
                [`Why, ${defineAddressing(enemy)}? Why do you do it? Why keep fighting?`, `Do you believe you're fighting for something? Can you tell me what it is? Do you even know?`],
                [`You must be able to see it. You must know it by now,`, `You can't win. It's pointless to keep fighting. Why do you persist?`],
                [`You won't get away with this," you tell ${enemy.boss}. "I won't get away with this?`, `I already have!`],
                [`You have no idea how much I've wanted to do this.`, `You have no idea.`],
                [`You Gladiators are always rushing,`, `Rushing to your death!`],
                [`You've dug your own grave,`, `You're dead!`],
                [`I am your death,`, `Are you prepared?`],
                [`Death is the greatest kick,`, `That's why I saved it for last!`],
                [`I've never been beat. A lot of Gladiators have have tried.`, `Seems to me there's more Gladiators lately than ever.`],
                [`Frankly,`, `I find the idea of a Gladiator that lives.. offensive.`],
                [`Remember, I AM the ${enemy.name},`, `I AM ${enemy.boss.toUpperCase()}!`],
                [`You cannot win, you devil," you grunt. "You're wrong,`, `I cannot lose.`],
                [`Come to me, ${defineAddressing(enemy)},`, `Kneel before ${randFrom([enemy.boss, `the ${enemy.name}`])}!`],
                [`Yes!`, `Let this be our final battle!`],
                [`It is not too late to undo this madness," you tell ${enemy.boss}. "Madness! I demand of destitution, shame and loneliness of scorn!`, `It is my destiny! It is my right!`],
                [`Who crave for power look back over the mistakes of their lives, pile them all together and call it destiny," you say. "Thank you for that bit of philosophy, ${defineAddressing(enemy)},`, `Yes, this is my destiny! Now and forever!`],
                [`How unpleasant it is to see you,`, `You sniveling cowards!`],
                [`I don't like to feel good,`, `I like to feel evil!`],
                [`I'm judging you,`, `I'm judging you, and I find you.. wanting.`],
                [`They say violence is never the answer,`, `They are wrong.`],
                [`You want to kill me, don't you, ${defineAddressing(enemy)}?`, `Get a number and get in line.`],
                [`If you want something done,`, `Do it yourself. Yep!`],
                [`You think you're big time?`, `You're gonna die big time!`],
                [`When we last met, you were but a learner,`, `You still are.`],
                [`You have this one chance to give up," you browbeat ${enemy.boss}. "How very generous of you,`, `I can't wait to see what happens when I don't!`],
                [`There is still time to stop this," you plead to ${enemy.boss}. "No,`,`It is far too late for that.`],
                [`You can still end this," you plead to ${enemy.boss}. "Yes,`,`It is you who I shall end!`],
                [`Do you expect me to yield?" you ask defiantly. "No, ${defineAddressing(enemy)},`,`I expect you to die.`]
            ]

            let gloat = randFrom(gloating)

            return randFrom([gloat, (stage.hasOwnProperty("gloat") ? randFrom(stage.gloat) : gloat), (enemy.hasOwnProperty("gloat") ? randFrom(enemy.gloat) : gloat)])

        }

        function laconicStatement(enemy) {
            laconicstatements = [
                `${ucInit(gPron(enemy, "subject"))} might be right, but you have to try and stop ${gPron(enemy, "object")}.`,
                "You agree to disagree.",
                `You don't know if this a fight you can win, but you have to try to stop ${gPron(enemy, "object")}.`,
                "While there is life, there is hope, you remind yourself.",
                "You've heard that line before.",
                "This isn't going to be easy.",
                "You shrug. It doesn't need to be this way, but it always is.",
                `You have a feeling ${gPron(enemy, "subject")} might be right.`,
                `${ucInit(gPron(enemy, "subject"))} won't get away with that - not this time, that's for sure.`,
                "That's not a completely bad point, you think to yourself.",
                "You will never give up!",
                "You don't plan to let these criminals get away.",
                "You know the dark can embrace the light, but never eclipse it.",
                "You begin to wonder if you're in over your head..",
                `${ucInit(gPron(enemy, "possessive"))} plan ends here!`,
                `"Your plan ends here, ${enemy.boss}!" you say, and drop in your ready stance.`,
                `Either you dismantle the ${enemy.name} from the upper echelons of its leadership, or you go down swinging.`
            ]

            return randFrom([randFrom(laconicstatements), ``])
        }

        function referenceText(gladiators, allygroup, allymotivation, rivalgroup, rivalmotivation, finalboss) {

            let ourheroes = "This story is best experienced with "
            for (i = 0; i < gladiators.length; i++) {
                ourheroes = ourheroes + "<b>" + gladiators[i].name + "</b>" + (i == gladiators.length - 2 ? " and " : ", ")
            }

            gladiators.length > 0 ? ourheroes = ourheroes.substring(0, ourheroes.length - 2) +
                ". You can pick any Global Gladiators for this story, but some might make more sense than others." :
                ourheroes = `You can pick any Global Gladiators for this story, but some might make more sense than others.<br>`


            let personalsetup = ""
            for (i = 0; i < gladiators.length; i++) {
                if (gladiators[i].hasOwnProperty('instructions'))
                    personalsetup = personalsetup + " " + gladiators[i].instructions + " "
            }

            ourheroes = ourheroes + personalsetup + "<br>"

            let allytext = motivationText(allymotivation, allygroup, "Ally", finalboss, gladiators)

            let rivaltext = motivationText(rivalmotivation, rivalgroup, "Rival", finalboss, gladiators)

            let setup = `<b>Story Setup:</b> Put `

            let allysetup = setup

            for (i = 0; i < allygroup.length; i++) {
                allysetup = allysetup + " " + allygroup[i].name + " (Ally)" + (i == allygroup.length - 2 ? " and " : ", ")
            }

            allygroup.length > 0 ? allysetup = allysetup.substring(0, allysetup.length - 2) + " into the Story Pool." : allysetup = `You can pick any Allies for this story, but some might make more sense than others.`

            let rivalsetup = setup

            for (i = 0; i < rivalgroup.length; i++) {
                rivalsetup = rivalsetup + " " + rivalgroup[i].name + " (Rival)" + (i == rivalgroup.length - 2 ? " and " : ", ")
            }

            rivalgroup.length > 0 ? rivalsetup = rivalsetup.substring(0, rivalsetup.length - 2) + " into the Story Pool." : rivalsetup = `You can pick any Rivals for this story, but some might make more sense than others.`

            let text = []

            text.push(ourheroes)
            text.push(allytext)
            text.push(rivaltext)
            text.push(allysetup)
            text.push(rivalsetup)

            return text
        }

        function numberAsString(number) {
            switch (number) {
                case 1: number = "one";
                    break;
                case 2: number = "two";
                    break;
                case 3: number = "three";
                    break;
                case 4: number = "four"
                    break;
                default: number
            }
            return number
        }

        function motivationText(motivation, group, stance, finalboss, gladiators) {

            gladiators = _.map(gladiators, 'name')

            let bossclone = _.map(group, 'name').includes(finalboss.boss)

            let redemption = ["Kemono", "Shadow", "Jackal", "Juan", "Yokai", "Tlazolteotl", "Mack", "Ah Long", "Dmitri"]

            let personalstory_ally = `${possessiveSuffix(motivation)} personal goals have taken the same path as your mission. ${_.map(group, 'name').includes(motivation) ? `${motivation}${group.length == 2 ? `, along with ${(_.map(group, 'name')).filter(character => character != motivation)}` : ""} will accompany you on your mission.` : `${possessiveSuffix(motivation)} closest ally accompanies you on your mission.`} `

            let personalstory_enemy = `${possessiveSuffix(motivation)} personal goals and your mission have opposing paths. ${_.map(group, 'name').includes(motivation) ? `${motivation}${group.length == 2 ? `, along with ${(_.map(group, 'name')).filter(character => character != motivation)}` : ""} will be facing you wherever you mission will take you.` : `${possessiveSuffix(motivation)} closest ally will be facing you wherever your mission will take you.`} `

            let text
            switch (motivation) {
                case "Ah Long":
                    if (stance == "Ally" && finalboss.boss == "Ah Long" && !gladiators.includes("Ah Long")) {
                        text = `The Kingdom has put a clone in Ah Long's place to rule over the Golden Dragons. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "Wan Bo has already shared so much with Ah Long, and together they will fight alongside you for the lost honor of the Dragons." : "He knows there is only one way to convince who is the real Head of the Dragon and regain their lost strength and independence.") : "Wan Bo, who has already shared so much with Ah Long, stands with you to regain the lost honor of the Dragons."}`
                    } else if (stance == "Ally" && finalboss.name == "Kingdom" && !gladiators.includes("Ah Long")) {
                        text = `The Kingdom is disappointed in Ah Long's performance, and have told they will take over the Golden Dragons from him. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "Ah Long and his closest friend Wan Bo stand together with you to regain the lost strength and independence of the Dragons." : "He knows he will need your help against the Kingdom to regain the lost strength and independence of the Dragons.") : "Wan Bo, who has shared so much with Ah Long, stands with you to regain the lost strength and independence of the Dragons."}`
                    } else if (stance == "Ally") {
                        text = personalstory_ally
                    } else if (stance == "Rival" && gladiators.includes("Ah Long")) {
                        text = `The Jackal has cloned you multiple times over and one of the clones firmly believes he is the real Ah Long. He thinks there is only one way to convince who is the real Head of the Dragon and regain the favor of the Kingdom.`
                    } else if (stance == "Rival" && (gladiators.includes("Jackal"))) {
                        text = `Ah Long has disappointed the Kingdom, he is now attempting to regain his lost "strength" and "independence". ${_.map(group, 'name').includes(motivation) ? `` : `He has sent his whelp Wan Bo to fight his battles with you. Such a shame Shadow once thought so highly of them!`}${group.length == 2 ? `His closest ally, Wan Bo, showed some potential, but it seems all of the Dragons are marred with treason. Such a shame!` : ``}`
                    } else { text = personalstory_enemy };
                    break;
                case "Ah Long of Brook City":
                    if (stance == "Ally" && finalboss.boss == "Ah Long" && !gladiators.includes("Ah Long")) {
                        text = `The younger Ah Long from the past of Brook City wants to rise as the Head of the Dragon in place of the older Ah Long. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `He, along with Lotus has joined you to face` : `He has joined you to face`) : `He has sent Lotus with you to find`} the Ah Long he believes to be old and tired.`
                    } else if (stance == "Ally") { text = personalstory_ally } else if (stance == "Rival" && gladiators.includes("Ah Long")) {
                        text = `The younger Ah Long from the past of Brook City wants to rise as the Head of the Dragon in your place. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `He and Lotus will confront you wherever you will go.` : `He will confront you wherever you will go.`}` : `Lotus is following you wherever you will go in order to young Ah Long to learn of your weaknesses.`}`
                    } else if (stance == "Rival" && gladiators.includes("Ying Hua")) {
                        text = `The younger Ah Long from the past of Brook City knows only of the younger Ying Hua, but understands you are even the greater threat now that you are older and wiser. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `He and Lotus will confront you` : `He has taken as his personal mission`} to take you out before you can take him in.` : `Lotus is following you wherever you go to inform the young Ah Long of your plans.`}`
                    } else { text = personalstory_enemy };
                    break;
                case "Aztec": text = (stance == "Ally" ?
                    `${group.length == 1 ? "A single warrior" : "A group of warriors"} with the might of the bygone Aztec empire has received a prophecy of the future from ${randFrom(["Mictecacihuatl", "Xolotl",])}. The soul of ${finalboss.boss} belongs in Mictlan and ${group.length == 1 ? "this warrior" : "these warriors"} will deliver ${gPron(finalboss, "object")} there!` :
                    `${group.length == 1 ? "A single warrior" : "A group of warriors"} with the might of the bygone Aztec empire has received a prophecy of the future from ${randFrom(["Mictecacihuatl", "Xolotl",])}. Your souls belong in Mictlan and ${group.length == 1 ? "this warrior" : "these warriors"} will deliver you there!`);
                    break;
                case "Beast": text = (stance == "Ally" ?
                    `${group.length == 1 ? "This individual is" : "These individuals are"} little more than savage beasts, but ${group.length == 1 ? "this one" : "these"} seem to have been tamed - for now.
            The strength of the ${group.length == 1 ? "beast" : "beasts"} is welcome if unnerving addition to your mission to end ${possessiveSuffix(finalboss.boss)} plans.` :
                    `${group.length == 1 ? "This individual is" : "These individuals are"} little more than savage beasts, and ${group.length == 1 ? "this beast is" : "these are"} in the tight leash of ${finalboss.boss}, who has sent them to hunt you. 
            ${group.length == 1 ? "It" : "They"} won't stop hunting their quarry.`);
                    break;
                case "Blade": text = (stance == "Ally" ?
                    `A wandering ${group.length == 1 ? "blademaster" : "host of blademasters"} sees ${finalboss.boss} as an opportunity to test their mettle, and has decided to walk with you.` :
                    `A wandering ${group.length == 1 ? "blademaster" : "host of blademasters"} sees you as an opportunity to test their mettle. They seem to show up wherever you go.`);
                    break;
                case "Black Ops": text = (stance == "Ally" ? `Citadel has many spies and assassins in their contacts, and a ${group.length == 1 ? "single operative" : "team of specialists"} 
            has been assigned with you to eliminate the threat ${finalboss.boss} poses.` :
                    `The world is full of shadowy organizations with spies and assassins everywhere. A mysterious malefactor has sent a 
            ${group.length == 1 ? "single operative" : "team of specialists"} to eliminate the Citadel's finest. They will not stop until you are dead.`);
                    break;
                case "Boss": text = (stance == "Ally" ?
                    `A secret cabal of powerful and influential individuals have decided that ${possessiveSuffix(finalboss.boss)} plans are a threat to the long game, and fixing it is far too hazardous for them to leave it to the 
            rank and file of their organizations - or to you. 
            ${group.length == 1 ? `${bossclone ? `The have created a clone of ${finalboss.boss} who has` : `${group[0].name} has`}` : `${bossclone ? `They have created a clone of ${finalboss.boss} and have` : `Several of them have`}`} 
            joined you in your mission whether you wish it or not.` :
                    `Whatever ${possessiveSuffix(finalboss.boss)} endgame is, it will serve the powerful men and women of different shadowy organizations well. You are considered such a threat that this cabal
            has ${bossclone ? `created a clone of ${finalboss.boss}` : `decided no mere mooks are enough`} to stop you.`);
                    break;
                case "Brandon":
                    if (stance == "Ally" && finalboss.boss == "Ah Long" && !gladiators.includes("Ah Long") && !gladiators.includes("Brandon")) {
                        text = `The movie star Brandon does not care about his career or public anymore. He is on a mission of revenge against Ah Long, and for everything he has done against Brandon's family. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "Isabella, a fan of his, has joined to help him find his true potential." : "") : "Isabella, Brandon's fan has joined you, as she wants to help Brandon find Ah Long."}`
                    } else if (stance == "Ally" && finalboss.boss != "Ah Long" && !gladiators.includes("Brandon")) {
                        text = `The tabloids speculate the movie star Brandon is a fraud and his martial arts are just for show, and he is set to prove himself and make a comeback. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "Isabella, a fan of his, has joined to help him regain the favor of the studios." : "The test footage he will get with you must convince the studio executives of his talent!") : "Isabella, Brandon's fan tries to convince you to help him get some test footage."}`
                    } else if (stance == "Ally") { text = personalstory_ally } else if (stance == "Rival" && gladiators.includes("Ah Long") && !gladiators.includes("Brandon")) {
                        text = `The movie star Brandon does not care about his career or public anymore. He is on a mission of revenge against you, and for everything you have done against his family. ${_.map(group, 'name').includes(motivation) ? `` : `His fan Isabella tries to help by getting you first!`}${group.length == 2 ? "Isabella, a fan of his, has joined to help him find his true potential." : ``}`
                    } else if (stance == "Rival" && !gladiators.includes("Brandon")) {
                        text = `The tabloids speculate the movie star Brandon is a fraud and his martial arts are just for show, and he is set to prove himself and make a comeback. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "Isabella, a fan of his, has joined to help him to get test footage out of you to regain the favor of the studios." : "The test footage he will get out of you must convince the studio executives of his talent!") : "Isabella, Brandon's fan risks everything trying get some suitably impressive test footage out of you to be his co-star."}`
                    } else { text = personalstory_enemy };
                    break;
                case "Brook City": text = (stance == "Ally" ?
                    `${group.length == 1 ? "This resident" : "A group of residents"} of Brook City believes that if ${finalboss.boss} is not stopped, their home will be next. They will do what they can to help you.` :
                    `If ${finalboss.boss} can just do what ${gPron(finalboss, "subject")} wants in Ransom, maybe Brook City will be left in peace? ${group.length == 1 ? "A citizen" : "A group of citizens"} has traveled to Ransom to see that ${gPron(finalboss, "subject")} will.`);
                    break;
                case "Brotherhood": text = (stance == "Ally" ?
                    `${bossclone ? `"An impostor has taken over my organization, and he must go down," Dmitri tells you. You're wary of the Brotherhood, 
            but you think you can count on them this one time. But which one is the clone?`: `"The enemy of my enemy is my friend, and a friend with money is a friend indeed," ${group[0].name} tells you. You're wary of the Brotherhood, 
            but there is no job they wouldn't handle for the right price, and you can't deny their effectiveness.`}` :
                    `Your intel tells you that the mercenaries of the Brotherhood have been paid to make sure you will not interfere with ${possessiveSuffix(finalboss.boss)} plans, 
            and you can be certain they will not stop until you have been eliminated.`);
                    break;
                case "Cartel": text = (stance == "Ally" ?
                    `${bossclone ? `"An impostor has taken over my family, and he must go down," Juan tells you. Juan and his Cartel might be criminals, 
            but you think you can count on them this one time. But which one is the clone?`: `"${finalboss.boss} puts the family at risk, and we will not allow that," ${group[0].name} says, and continues: "The enemy of our enemy is our friend." 
            Juan and his Cartel might be criminals, but at least you know they are honorable and willing to even die for their "family".`}` :
                    `You have been a thorn in the side of the Cartel for a long time. While you are busy with your mission to get ${finalboss.boss}, they have sent a 
            ${group.length == 1 ? "single enforcer" : "group of enforcers"} to remove that thorn.`);
                    break;
                case "Celebrity": text = (stance == "Ally" ?
                    `Some celebrities, socialites and influencers want all the attention, and ${group.length == 1 ? "this one is" : `these ${numberAsString(group.length)} are`} the worst. With  
            ${group.length == 1 ? "this fool" : "these fools"} appearing everywhere for cheap publicity, you just hope nobody gets hurt.` :
                    `Some celebrities, socialites and influencers want all the attention, and ${group.length == 1 ? "this one is" : `these ${numberAsString(group.length)} are`} the worst. With  
            ${group.length == 1 ? "this fool" : "these fools"} appearing everywhere for cheap publicity, you're afraid someone will get hurt.. not that it would deter them.`);
                    break;
                case "Chi": text = (stance == "Ally" ?
                    `${group.length == 1 ? "This warriors is" : "These warriors are"} privy to ${mysticalSynonym()} Chi powers. Their deep understanding of the flow of 
            ${mysticalSynonym()} energies that flow through all life has revealed to them that ${finalboss.boss} is a great disturbance in this force. For the balance to be regained ${gPron(finalboss, "subject")} must be stopped.` :
                    `${group.length == 1 ? "This warrior is" : "These warriors are"} privy to ${mysticalSynonym()} Chi powers. Their deep understanding of the flow of 
            ${mysticalSynonym()} energies that flow through all life has revealed to them that you are a great disturbance in this force. For the balance to be regained you must be stopped.`);
                    break;
                case "Cifarelli": text = (stance == "Ally" ?
                    `The ongoing plans of ${finalboss.boss} risks the stability that the operation of the Cifarelli family requires, and a ${group.length == 1 ? "single enforcer" : "group of enforcers"} 
            has been sent to crush the opposition. You're lucky to have them on your side!` :
                    `The Cifarelli family sees the ongoing plans of ${finalboss.boss} a perfect time to hit law enforcement everywhere, and Citadel is no exception to their plans. A 
            ${group.length == 1 ? "single enforcer" : "group of enforcers"} has been sent to take you out.`);
                    break;
                case "Clone": text = (stance == "Ally" ?
                    `With the multitude of clones unleashed upon the world from Jackal's secret experiments, you are bound to run into some from time to time that 
            ${finalboss.boss == "Jackal" ? `seek their creator and want more life` : `would ally themselves to your cause`}.` :
                    `With the multitude of clones unleashed upon the world from Jackal's secret experiments, sometimes you find surprising parties of people working together, 
            furthering the goals of the Kingdom.`);
                    break;
                case "Competitor": text = (stance == "Ally" ?
                    `${group.length == 1 ? "This gladiator is not a Global Gladiator, but a seasoned fighter" : "These gladiators are not Global Gladiators, but seasoned fighters"} 
            of competetive - and deadly - events. Now they pursue the victory of the ultimate challenge: ${finalboss.boss}!` :
                    `${group.length == 1 ? "This gladiator is not a Global Gladiator, but a seasoned fighter" : "These gladiators are not Global Gladiators, but seasoned fighters"} 
            of competetive - and deadly - events. Now they pursue the victory of the ultimate challenge: you!`);
                    break;
                case "Dark Matter": text = (stance == "Ally" ?
                    `${bossclone ? `"My mother is insane, and evil to an extent you cannot begin to understand," an exact replica of Jackal tells you. You're extremely wary of the Kingdom, but you think you can count on Jackal this one time. But which one is really the clone?` : `The Jackal feels ${finalboss.boss} interferes with her research, and 
            ${_.map(group, 'name').includes("Jackal") ? `${group.length == 1 ? "has joined you" : "leads her creations alongside you"}` : `has sent a ${group.length == 1 ? "creation of hers" : "force of her creations"} alongside you`} 
            to remove the interference.`}` :
                    `${bossclone ? `The Jackal knows the Citadel will move against her, and has created a clone of herself${group.length == 1 ? "" : " to lead her creations"} 
            to eliminate the threat.`: `The Jackal feels you interfere with her research, and 
            ${_.map(group, 'name').includes("Jackal") ? `${group.length == 1 ? "has left her fortress" : "leads her creations"}` : `has sent a persistent ${group.length == 1 ? "creation of hers" : "force of her creations"}`} 
            to remove the interference.`}`);
                    break;
                case "Dmitri":
                    if (stance == "Ally" && finalboss.boss == "Dmitri" && !gladiators.includes("Dmitri")) {
                        text = `Dmitri, the true leader of the Brotherhood has realized that following Kingdom is not true to Brotherhood's mission. He believes they are better than mere soldiers of fortune, and is determined to take down whatever puppet the Kingdom has put in his place.`
                    } else if (stance == "Ally") { text = personalstory_ally } else { text = personalstory_enemy };
                    break;
                case "Extraplanar": text = (stance == "Ally" ?
                    `${group.length == 1 ? "This individual is" : "These individuals are"} privy to the secrets of planes of existence beyond yours. For whatever ${mysticalSynonym()} 
            reason, the stars are right for them to stop ${finalboss.boss}, no matter the cost.` :
                    `${group.length == 1 ? "This individual is" : "These individuals are"} privy to the secrets of planes of existence beyond yours. For whatever ${mysticalSynonym()} 
            reason, the stars are right for them to stop you, no matter the cost.`);
                    break;
                case "Fraud": text = (stance == "Ally" ?
                    `The lost reputation and ridicule of some unlucky or incapable fighters has driven them to desperation, and now they believe the only way to restore their name 
            is to defeat ${finalboss.boss}. You just hope nobody gets too badly hurt.` :
                    `The lost reputation and ridicule of some unlucky or incapable fighters has driven them to desperation, and ${finalboss.boss} has manipulated them
            think that the only way to restore their name is to defeat you. Sadly the fools absolutely will not stop hounding you no matter what you do.`);
                    break;
                case "Gabriel":
                    if (stance == "Ally" && finalboss.boss == "Jackal" && !gladiators.includes("Jackal") && !gladiators.includes("Gabriel")) {
                        text = `Gabriel has received a letter from his sister Regina that informed him she is been held by the Jackal. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "He has joined you with his friend Drago to find his sister." : "He hopes you can help him locate his sister.") : "His mute friend Drago has joined you to help Gabriel's sister."}`
                    } else if (stance == "Ally" && !gladiators.includes(finalboss.boss)) {
                        text = `Gabriel has received a letter from his sister Regina that informed him she is been held by ${finalboss.boss}. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "He has joined you with his friend Drago to find his sister." : "He hopes you can help him locate his sister.") : "His mute friend Drago has joined you to help Gabriel's sister."}`
                    } else if (stance == "Ally") {
                        text = `Gabriel has received a letter from his sister Regina that informed him she is been held, but by whom? ${_.map(group, 'name').includes(motivation) ? `${motivation}${group.length == 2 ? `, along with Drago` : ""} will accompany you on your mission in order to find any clues.` : `${possessiveSuffix(motivation)} closest ally Drago accompanies you on your mission to find any clues on her whereabouts.`} `
                    } else if (stance == "Rival" && gladiators.includes("Jackal") && !gladiators.includes("Gabriel")) {
                        text = `You have apparently captured Gabriel's sister Regina at one point, but you cannot remember this - you have not been yourself. ${_.map(group, 'name').includes(motivation) ? `Now Gabriel is determined to confront you to locate his sister.${group.length == 2 ? ` His mute friend Drago follows him like a dog.` : ``}` : `His mute friend Drago hounds you to find the location of Gabriel's missing sister.`} They won't be hearing that you just don't know about Regina.`
                    } else {
                        text =
                            `Gabriel has received a letter from his sister Regina that informed him she is been held, but by whom? ${_.map(group, 'name').includes(motivation) ? `${motivation}${group.length == 2 ? `, along with Drago` : ""} believes you have information on her whereabouts and will not take no for an answer.` : `${possessiveSuffix(motivation)} believes you have information on her whereabouts and will not take no for an answer.`} `
                    };
                    break;
                case "Global Gladiator": text = (stance == "Ally" ?
                    `Citadel has determined this mission to be of topmost priority. Agent Fletch has pulled all Global Gladiators available from less important tasks to aid you here.` :
                    `Miscommunication, misunderstanding and misdirection has led Citadel to deploy a ${group.length == 1 ? "single Global Gladiator" : "group of Global Gladiators"} 
            against you, and nothing you say can sway them from their mission.`);
                    break;
                case "Golden Dragons": text = (stance == "Ally" ?
                    `${bossclone ? `"An impostor has taken over my business, and he must go down," Ah Long tells you. You are not sure the Golden Dragons is the sort of ally you'd want to have, 
            but you think you can count on them this one time. But which one is the clone?`: `"What ${finalboss.boss} is attempting is a risk to our businesses. The enemy of our enemy is our friend," ${group[0].name} says. 
            You are not sure the Golden Dragons are the sort of friends you'd want to have, but they might be the ones you need.`}` :
                    `You have been a thorn in the side of the Golden Dragons for a long time. While you are busy with your mission to get ${finalboss.boss}, they have sent a 
            ${group.length == 1 ? "single enforcer" : "group of enforcers"} to remove that thorn.`);
                    break;
                case "Gunslinger": text = (stance == "Ally" ?
                    `A wandering ${group.length == 1 ? "gunslinger" : "band of gunslingers"} sees ${finalboss.boss} as an opportunity to test their mettle, and has decided to walk with you.` :
                    `A wandering ${group.length == 1 ? "gunslinger" : "band of gunslingers"} sees you as an opportunity to test their mettle. They seem to show up wherever you go.`);
                    break;
                case "Horseman": text = (stance == "Ally" ?
                    `The mysterious Master must believe ${finalboss.boss} is truly a lost cause to his secretive goals, as ${group.length == 1 ? "a Horseman has" : `not one, but ${numberAsString(group.length)} horsemen have`} been sent after ${gPron(finalboss, "object")}.` :
                    `The mysterious Master must believe you truly are an immense threat to his secretive goals, as ${group.length == 1 ? "a Horseman has" : `not one, but ${numberAsString(group.length)} horsemen have`} been sent to take you down.`);
                    break;
                case "Indines": text = (stance == "Ally" ?
                    `${group.length == 1 ? "This warrior" : "These warriors"} have been sent through from another world, a world of conflict and adventure. To stop Dragon King 
            Greyheart being freed and save their world they have to save yours!` :
                    `${group.length == 1 ? "This warrior" : "These warriors"} have been sent through from another world, a world of conflict and adventure. To stop Dragon King 
            Greyheart being freed and save their world they have to doom yours!`);
                    break;
                case "Insane": text = (stance == "Ally" ?
                    `${group.length == 1 ? "This individual is" : "These individuals are"} unpredictable and dangerously unhinged. For their own reasons, 
            they are following you around, dead set on taking on ${finalboss.boss}. You just have to hope they will not turn on you.` :
                    `${group.length == 1 ? "This individual is" : "These individuals are"} unpredictable and dangerously unhinged. For whatever deranged reason, 
            they are dead set on taking you out.`);
                    break;
                case "Jackal":
                    if (stance == "Ally" && finalboss.boss == "Shadow" && !gladiators.includes("Shadow") && !gladiators.includes("Jackal")) {
                        text = `The Jackal has been doubting herself. Has Dark Matter changed her? Is she really herself anymore? Shadow is to blame. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "She has joined you in hopes of confronting the Kingdom's mastermind, and taken her greatest creation with her." : "She has joined you in hopes of confronting the Kingdom's mastermind.") : "Her greatest creation, a snarling beast, stalks after you to get Shadow."}`
                    } else if (stance == "Ally") { text = personalstory_ally } else if (stance == "Rival" && gladiators.includes("Shadow") && !gladiators.includes("Jackal")) {
                        text = `The Jackal thinks you have changed her with Dark Matter, but you have only unleashed her true self. ${_.map(group, 'name').includes(motivation) ? `Now she is determined to confront you with this ridiculousness.${group.length == 2 ? ` She even has one of her genetic mutants following her around!` : ``}` : `She has sent one of her genetic mutants to find you!`} You really wouldn't have time for this nonsense.`
                    } else { text = personalstory_enemy };
                    break;
                case "Juan":
                    if (stance == "Ally" && !gladiators.includes("Shadow") && !gladiators.includes("Juan")) {
                        text = `Juan thinks the Kingdom has made the Cartel something it is not, and he needs to take the gang back. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `He has joined forces with Tiger Azules to help the communities by confronting people like ${finalboss.boss} with you.` : `He will start by helping the communities by confronting people like ${finalboss.boss} with you.`) : "Tiger Azules has protected the people while the Cartel was a lost cause, and now tries to help Juan get them back on the right path by setting an example."}`
                    } else if (stance == "Ally") { text = personalstory_ally } else if (stance == "Rival" && (redemption.some(v => gladiators.indexOf(v) !== -1) == true) && !gladiators.includes("Juan")) {
                        text = `Juan thinks the Kingdom has made the Cartel something it is not. ${_.map(group, 'name').includes(motivation) ? `Now he is determined to show the communities that people like you can be stopped.${group.length == 2 ? ` Tiger Azules, defender of the streets has joined forces with him.` : ``}` : "Tiger Azules has protected the people while the Cartel was a lost cause, and now tries to help Juan get them back on the right path by setting an example."}`
                    } else { text = personalstory_enemy };
                    break;
                case "Kemono":
                    if (stance == "Ally" && !gladiators.includes("Kemono") && !gladiators.includes("Shadow")) {
                        text = `Kemono feels lost, questioning his actions for the Kingdom, struck by the cruelty of it. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `The ancient warrior Darius is guiding him to end the malicious work of any enemy, no matter their loyalties.` : `The words of the ancient warrior Darius guide him to end the malicious work of any enemy, no matter their loyalties.`) : "The ancient warrior Darius walks with you to show Kemono the path to end the malicious work of any enemy, no matter their loyalties."}`
                    } else if (stance == "Ally") { text = personalstory_ally } else if (stance == "Rival" && (redemption.some(v => gladiators.indexOf(v) !== -1) == true) && !gladiators.includes("Kemono")) {
                        text = `Kemono feels lost, questioning his actions for the Kingdom, struck by the cruelty of it. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `The ancient warrior Darius is guiding him to salvation by ending the malicious work of any enemy, no matter their loyalties.` : `The words of the ancient warrior Darius guide him to salvation by ending the malicious work of any enemy, no matter their loyalties.`}` : "The ancient warrior Darius does everything he can you to stop you to show Kemono the path to salvation by ending the malicious work of any enemy, no matter their loyalties."}`
                    } else { text = personalstory_enemy };
                    break;
                case "Kingdom": text = (stance == "Ally" ?
                    `${bossclone ? `"An impostor has taken over my place in the Kingdom, and must go down," ${finalboss.boss} tells you. You're extremely wary of the Kingdom, 
            but you think you can count on ${finalboss.boss} this one time. But which one is the clone?` : `The Kingdom knows you are their most dangerous enemy, but all their plans are smoke and mirrors. For some devious reason ${group.length == 1 ? "this warrior has" : "these warriors have"} 
            joined you to stop ${finalboss.boss}. You are quite sure this alliance is tenuous and temporary at best, but you know you will need the help.`}` :
                    `The Kingdom knows you are the only credible threat to their long-term plans, and ${group.length == 1 ? "this warrior has" : "these warriors have"} been
            sent to make sure the threat you pose will be neutralized.`);
                    break;
                case "Law Enforcement": text = (stance == "Ally" ?
                    `The law enforcement agencies around the world do not really understand the threat the Kingdom poses and are not equipped to properly fight it, but 
            sometimes their operations align with your efforts.` :
                    `The law enforcement agencies and their contacts and informants around the world are not immune to the reach of the Kingdom, and ${group.length == 1 ? "this corrupt individual" : "these corrupt officers or informants"}
            are determined to take you in - or take you out!`);
                    break;
                case "Martial Arts Master": text = (stance == "Ally" ?
                    `A wandering ${group.length == 1 ? "martial arts master" : "band of martial artists"} sees ${finalboss.boss} as an opportunity to test their mettle, and has decided to walk with you.` :
                    `A wandering ${group.length == 1 ? "martial arts master" : "band of martial artists"} sees you as an opportunity to test their mettle. They seem to show up wherever you go.`);
                    break;
                case "Megan":
                    let megansenemy = finalboss.name == "Kingdom" ? finalboss.boss : finalboss.name
                    if (stance == "Ally" && !gladiators.includes(finalboss.boss) && !gladiators.includes("Megan")) {
                        text = `The ${megansenemy} is behind the theft of tens of thousands of dollars from Megan's family's company. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `She has joined forces with the unhinged criminal Sera O'Quinn, who believes they are responsible for her father's corruption, and they will help you take the ${megansenemy} down.` : `She has joined forces with you to help you take the ${megansenemy} down.`) : `The unhinged criminal Sera O'Quinn believes this is somehow related to her family, and has joined you to take the ${megansenemy} down.`}`
                    } else if (stance == "Ally") { text = personalstory_ally } else if (stance == "Rival" && (redemption.some(v => gladiators.indexOf(v) !== -1) == true) && !gladiators.includes("Megan")) {
                        text = `Under the influence of the Kingdom, you has been involved in many things that you regret. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? ` Megan and Sera both accuse you of ruining their family businesses, and now they do everything they can to bring you down.` : `Megan accuses you of an extensive theft from her company, which was techincally the doings of the O'Quinn family.`}` : `Sera O'Quinn accuses you of corrupting her father, and tries to bring you down.`} You admit you might be responsible, but your hands would be full as they are!`
                    } else { text = personalstory_enemy };
                    break;
                case "Mr. Apple":
                    if (stance == "Ally") {
                        text = `After an exhibition Sensei Apple was surrounded by ${finalboss.minions} and their leader challenged him to a fight. Unfortunately, due to lack of music Sensei Apple lost his rhythm and it didn't take long for him to be overwhelmed. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `Now he has joined forces with his protege to find his assailant and show ${gPron(finalboss, "object")} what true skill is.` : `Now he has joined forces with you to find his assailant and show ${gPron(finalboss, "object")} what true skill is.`) : `His protege is determined to find the assailants and return the honor of her master.`}`
                    } else { text = `After and exhibition Sensei Apple was surrounded by an unknown group of martial artists. Unfortunately, due to lack of music Sensei Apple lost his rhythm and it didn't take long for him to be overwhelmed. ${_.map(group, 'name').includes(motivation) ? `Confused and angry, he is determined you are the assailants, and tries to face you at every turn${group.length == 2 ? `, and drags his apprentice along` : ``}.` : `Confused and angry, he is determined you are the assailants, and his protege is determined to return the honor of her master.`}` };
                    break;
                case "Monk": text = (stance == "Ally" ?
                    `${group.length == 1 ? `A lone warrior monk has` : `A group of warrior monks have`} left their distant monastery to deliver ${finalboss.boss} the wisdom to leave the corrupt way. 
            Wisdom often comes with pain.` :
                    `${group.length == 1 ? `A lone warrior monk has` : `A group of warrior monks have`} left their distant monastery to bring down the oppressor. 
            You certainly didn't see Citadel that way.`);
                    break;
                case "Music": text = (stance == "Ally" ?
                    `${group.length == 1 ? "This talent is" : "These talents are"} true royalty of rhythm, while they find ${finalboss.boss} clearly is not. 
            To show ${finalboss.boss} who should be crowned the Majesty of Music, the ${group.length == 1 ? "artist has" : "artists have"} unfortunately decided to follow you to face ${gPron(finalboss, "object")} in a dance-off.` :
                    `Wherever you go, ${group.length == 1 ? "this talent" : "these talents are"} there, ready for a dance-off. For what purpose, you cannot fathom, but you're afraid they will get hurt.`);
                    break;
                case "Natalia":
                    let badguys = ["Jackal", "Shadow", "Kemono", "Dmitri"]
                    if (stance == "Ally" && (finalboss.name == "Brotherhood" || finalboss.name == "Kingdom") && !gladiators.includes(finalboss.name) && !gladiators.includes("Dmitri") && !gladiators.includes("Natalia")) {
                        text = `${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `Natalia and her young protege Zane join your mission, as they are going to avenge the ${finalboss.name} strike that killed the boy's parents.` : `Natalia joins your mission, as she is going to avenge the ${finalboss.name} strike that killed Zane's parents.`) : `The orphaned boy Zane is trying to track down the murderous ${finalboss.name} who are responsible for the death of his parents, and has asked for your help.`}`
                    } else if (stance == "Ally") { text = personalstory_ally } else if (stance == "Rival" && (badguys.some(v => gladiators.indexOf(v) !== -1) == true) && !gladiators.includes("Natalia")) {
                        text = `The Kingdom orchestrated the strike that left Zane's parents dead${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `, and Natalia is helping the boy confront those responsible.` : `, and Natalia will confront those responsible for the boy.`}` : ", and the orphaned boy is determined to confront those responsible."}`
                    } else { text = personalstory_enemy };
                    break;
                case "Onyx League": text = (stance == "Ally" ?
                    `The ongoing plans of ${finalboss.boss} will lead only to mindless destruction, not anarcy through strength the Onyx League is after. 
            A ${group.length == 1 ? "single enforcer" : "group of enforcers"} has been sent to correct this course. You're lucky to have them on your side!` :
                    `You have been a thorn in the side of the Onyx League for a long time. While you are busy with your mission to get ${finalboss.boss}, they have sent a 
            ${group.length == 1 ? "single enforcer" : "group of enforcers"} to remove that thorn.`);
                    break;
                case "Organized Crime": text = (stance == "Ally" ?
                    `The ongoing plans of ${finalboss.boss} risks the stability that organized crime requires, and a ${group.length == 1 ? "single enforcer" : "group of enforcers"} 
            has been sent to crush the opposition. You're lucky to have them on your side!` :
                    `Organized crime sees the ongoing plans of ${finalboss.boss} a perfect time to hit law enforcement everywhere, and Citadel is no exception to their plans. A 
            ${group.length == 1 ? "single enforcer" : "group of enforcers"} has been sent to take you out.`);
                    break;
                case "Past": text = (stance == "Ally" ?
                    `${group.length == 1 ? "A single warrior" : "A group of warriors"} from the past holds archaic knowledge that they will use to determine the future. 
            Fortunately for you, you seem to be a part of that future.` :
                    `${group.length == 1 ? "A single warrior" : "A group of warriors"} from the past holds archaic knowledge that they will use to determine the future. 
            Unfortunately for you, you need to be erased from that future.`);
                    break;
                case "Project X":
                    if (stance == "Ally" && finalboss.boss == "Jackal" && !gladiators.includes("Jackal") && !gladiators.includes("Project X")) {
                        text = `The eerie, fightening creature known as Project X is searching for her "mother",  ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "and it seems like this will not be a social call. Natalia vouches for her good heart, but you have your suspicions." : "and it seems like this will not be a social call. You feel you have no choice but to let her stalk with you.") : "and Natalia has joined you to help her locate her."}`
                    } else if (stance == "Ally") { text = personalstory_ally } else { text = personalstory_enemy };
                    break;
                case "Psychic": text = (stance == "Ally" ?
                    `${group.length == 1 ? "This mysterious figure" : "This mysterious group"} has mastered the ${mysticalSynonym()} powers of the mind, and has foreseen the future. 
            They have determined ${possessiveSuffix(finalboss.boss)} plans will have to change.` :
                    `${group.length == 1 ? "This mysterious figure" : "This mysterious group"} has mastered the ${mysticalSynonym()} powers of the mind, and has foreseen the future. 
            They have determined ${possessiveSuffix(finalboss.boss)} plans must come to fruition. They seem to know your every move, and appear wherever you go!`);
                    break;
                case "Science": text = (stance == "Ally" ?
                    `What ${finalboss.boss} is planning has a scientific angle that an inquiring mind cannot bypass. This ${group.length == 1 ? "analyst" : "group of analysts"} 
            will follow you for research purposes.` :
                    `What ${finalboss.boss} is planning has a scientific angle that an inquiring mind cannot bypass. This ${group.length == 1 ? "analyst" : "group of analysts"} 
            is trying to stop you so they can observe this interesting event first hand!`);
                    break;
                case "Sensei": text = (stance == "Ally" ?
                    `${group.length == 1 ? "A wandering sensei has" : "Wandering sensei have"} decided your training is not quite complete, and they oversee your journey to 
            ensure your discipline will reach its potential.` :
                    `${group.length == 1 ? "A wandering sensei has" : "Wandering sensei have"} decided your training is not quite complete, and they follow you on your path to teach you a lesson in 
            discipline and skill.`);
                    break;
                    case "Sera O'Quinn":
                    let serassenemy = finalboss.name == "Kingdom" ? finalboss.boss : finalboss.name
                    if (stance == "Ally" && !gladiators.includes(finalboss.boss) && !gladiators.includes("Sera O'Quinn")) {
                        text = `The ${megansenemy} is behind the corruption of Sera's father, of so she believes. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `She has joined forces with a friend of hers, and together they will help you bring ${megansenemy} down.` : `She has joined forces with you to help you take the ${megansenemy} down.`) : `A friend of hers will assist you in taking ${megansenemy} down.`}`
                    } else if (stance == "Ally") { text = personalstory_ally } else if (stance == "Rival" && (redemption.some(v => gladiators.indexOf(v) !== -1) == true) && !gladiators.includes("Sera O'Quinn")) {
                        text = `Under the influence of the Kingdom, you has been involved in many things that you regret. Sera O'Quinn accuses you of corrupting a legitimate businessman: his father, Jack O'Quinn. Now ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `she and her friend` : `she`}` : `her friend`} will do everything they can to bring you down. You admit you might be responsible, but your hands would be full as they are!`
                    } else { text = personalstory_enemy };
                    break;
                case "Shadow":
                    let alliesofthekingdom = ["Juan", "Tlazolteotl", "Mack", "Ah Long", "Dmitri"]
                    if (stance == "Ally" && finalboss.boss.includes(alliesofthekingdom) && !gladiators.includes("Shadow")) {
                        text = `The mysterious figure behind the Kingdom has suspicion that Shadow is losing his grip on the allies of the Kingdom. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `As if this accusation was not enough, Shin Yokai has been sent to "assist" Shadow in ensuring ${possessiveSuffix(finalboss.boss)} loyalty.` : `Shadow has decided to personally ensure ${finalboss.boss} will remain loyal.`) : `Shin Yokai has been sent to ensure ${possessiveSuffix(finalboss.boss)} loyalty.`}`
                    } else if (stance == "Ally" && !gladiators.includes(finalboss.boss) && !gladiators.includes("Shadow")) {
                        text = `Shadow feels ${finalboss.boss} needs a reminder of who is ${gPron(finalboss, "possessive")} true master. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `Shin Yokai has been ordered to assist him if ${finalboss.boss} seems to have forgotten ${gPron(finalboss, "possessive")} true loyalties.` : `He has decided to remind ${gPron(finalboss, "object")} personally.`}` : `Shin Yokai has been sent to remind ${gPron(finalboss, "object")} of ${gPron(finalboss, "possessive")} loyalty.`}`
                    } else if (stance == "Ally") { text = personalstory_ally } else if (stance == "Rival" && (alliesofthekingdom.some(v => gladiators.indexOf(v) !== -1) == true) && !gladiators.includes("Shadow")) {
                        text = `The mysterious figure behind the Kingdom has suspicion that Shadow is losing his grip on the allies of the Kingdom. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `As if this accusation was not enough, Shin Yokai has been sent to "assist" Shadow in ensuring your loyalty.` : `Shadow has decided to show his loyalty by personally confronting you.`}` : `Shin Yokai has been sent to ensure your loyalty.`}`
                    } else if (stance == "Rival" && (gladiators.includes("Jackal") || gladiators.includes("Kemono")) && !gladiators.includes("Shadow")) {
                        text = `Shadow feels you need a reminder of who is your true master. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `Shin Yokai has been ordered to assist him if you seem to have forgotten your true loyalties.` : `He has decided to remind you personally.`}` : `Shin Yokai has been sent to remind you of your loyalty.`}`
                    } else { text = personalstory_enemy };
                    break;
                case "Shin Yokai":
                    if (stance == "Ally" && finalboss.boss != "Yokai" && !gladiators.includes("Yokai")) {
                        text = `The furious master of the Oni, Shin Yokai believes he has been betrayed by his Master, and wants to find ${finalboss.boss} to find out what ${gPron(finalboss, "subject")} knows. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `He has taken pity on one Marionette Doll called June, and protects her on their travels.` : `He looks like he is unable to control the demonic force, and is no longer in touch with his human side.`) : `June, a Marionette Doll he once helped tries to repay the debt helping you find ${finalboss.boss} for him.`}`
                    } else if (stance == "Ally") { text = personalstory_ally } else if (stance == "Rival" && gladiators.includes("Shadow") && !gladiators.includes("Yokai")) {
                        text = `The furious master of the Oni, Shin Yokai believes he has been betrayed by his Master, and wants to find out what you know about him. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `A Marionette Doll called June he once helped tries to repay this by helping him interrogate you.` : `He looks like he is unable to control the demonic force, and is no longer in touch with his human side.`}` : `A Marionette Doll called June he once helped tries to repay this by fishing the information out of you.`} You know nothing but this matters not. You have to deal with this yourself.`
                    } else { text = personalstory_enemy };
                    break;
                case "Soldier": text = (stance == "Ally" ?
                    `Citadel has many soldiers and mercenaries in their contacts, and a ${group.length == 1 ? "single soldier" : "team of soldiers"} 
            has been assigned with you to eliminate the threat ${finalboss.boss} poses.` :
                    `The world is full of rogue nations and terrorist organizations with soldiers for hire and private armies everywhere. A mysterious malefactor has sent a 
            ${group.length == 1 ? "a formidable mercernary" : "team of mercenaries"} to eliminate the Citadel's finest. They will not stop until you are dead.`);
                    break;
                case "Street": text = (stance == "Ally" ?
                    `The streets have had enought of the constant threat the evil machinations of ${finalboss.boss} and ${gPron(finalboss, "possessive")} ilk pose to the common people. 
            ${group.length == 1 ? "A defender of the streets has" : "Defenders of the streets have"} decided to aid you in taking ${finalboss.boss} out!` :
                    `Your perpetual fights with ${finalboss.boss} and ${gPron(finalboss, "possessive")} ilk pose a constant threat to the common people. 
            ${group.length == 1 ? "A defender of the streets has" : "Defenders of the streets have"} decided you are the worse of two evils!`);
                    break;
                case "Tlazolteotl":
                    if (stance == "Ally" && finalboss.name == "Kingdom" && !gladiators.includes("Tlatzoleotl")) {
                        text = `The supposed Aztec god of renewal Tlazolteotl has seen that there is a new power that is worshiped above the powers of the old. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? `The creature Kemono has submitted to his true master's will, and travels with the empress` : `The empress will travel with you`) : `The creature Kemono has submitted to his true master's will and comes with you`} to teach the Kingdom of the wrath of the old gods.`
                    } else if (stance == "Ally") { text = personalstory_ally } else if (stance == "Rival" && (["Shadow", "Kemono", "Jackal"].some(v => gladiators.indexOf(v) !== -1) == true) && !gladiators.includes("Tlazolteotl")) {
                        text = `The supposed Aztec god of renewal Tlazolteotl sees you represent a new power that is worshiped above the powers of the old. ${_.map(group, 'name').includes(motivation) ? `${group.length == 2 ? `The creature Kemono has submitted to his true master's will, and travels with the empress` : `The empress will hunts you`}` : `The creature Kemono has submitted to his true master's will and hunts you`} to teach you of the wrath of the old gods.`
                    } else { text = personalstory_enemy };
                    break;
                case "Toxic": text = (stance == "Ally" ?
                    `${group.length == 1 ? "This warrior has" : "These warriors have"} received a vision of the future from toxin experimentation. They have determined ${finalboss.boss} cannot be allowed to continue on this path. They have joined you in your mission.` :
                    `${group.length == 1 ? "This warrior has" : "These warriors have"} received a vision of the future from toxin experimentation. They have determined ${finalboss.boss} must be allowed to continue on this path. They attempt to stop you at every turn.`);
                    break;
                case "Twin Tiger": text = (stance == "Ally" ?
                    `Twin Tiger dojo has decided your skills are lacking, and ${group.length == 1 ? `${group[0].name}` : "these fighters"} oversee your journey to 
            ensure your discipline will reach its potential.` :
                    `Twin Tiger dojo has decided your recklessness is not a good example to the community, and ${group.length == 1 ? `${group[0].name} follows` : "these fighters follow"} you on your path to teach you a lesson in discipline and skill.`);
                    break;
                case "Wanderer": text = (stance == "Ally" ?
                    `Some wander the world on their personal quests, and now your goals seem to have aligned. 
            They will travel with you, and if defeating ${finalboss.boss} is what is needed to accomplish their goals, they would die trying.` :
                    `Some wander the world on their personal quests, and now you seem to be in the way of ${group.length == 1 ? `the goal of this individual` : `the mutual purpose of these fighters`}. 
            They will go wherever it takes, and if your defeat is what is needed to accomplish their goals, then so be it.`);
                    break;
                case "Ying Hua":
                    if (stance == "Ally" && finalboss.boss == "Ah Long" && !gladiators.includes("Ying Hua")) {
                        text = `Officer Ying Hua has reveived a mysterious invitation lodged in the skull of an infamous Triad leader and is looking to find the highest ranks of the Golden Dragons and confront whoever is pulling the strings. ${_.map(group, 'name').includes(motivation) ? (group.length == 2 ? "She has enlisted an ambitious enforcer of the Dragons to help her and you." : "She has decided she cannot play this one by the book, and has joined forces with you.") : "She has sent an ambitious enforcer of the Dragons she recruited as an informant to assist in locating the mysterious leader."}`
                    } else if (stance == "Ally") { text = personalstory_ally } else if (stance == "Rival" && gladiators.includes("Ah Long") && !gladiators.includes("Ying Hua")) {
                        text = `The mysterious invitation you had sent to officer Ying Hua was supposed to keep her occupied and give the Golden Dragons room to operate, but she has learned who is behind he invite, and wants an explanation. Now the original plan is unnecessary, and you have to deal with her himself. ${(!(_.map(group, 'name').includes(motivation)) || group.length == 2) ? `Jin has even been assisting the officer. You are ashamed he recovered his honor before you did.` : ``}`
                    } else { text = personalstory_enemy };
                    break;
                case "Youth": text = (stance == "Ally" ?
                    `${group.length == 1 ? "This youth" : "These youths"} hold more power than anyone of their age should have. With recklessness of their age, they are trying to 
            stop the evil of ${finalboss.boss}. You don't think you can restrain them, so the only way you can look after them is to let them accompany you.` :
                    `${group.length == 1 ? "This exceptionally powerful youth" : "These exceptionally powerful youths"} are trying to find their place in the world. 
            ${finalboss.boss} has manipulated them to follow the path of darkness. They seem to be wherever you go, and you have no choice but to fight them.`);
                    break;
                default: text = (stance == "Ally" ? "For whatever reason, these people stand with you againt the schemes of the Kingdom." : "For whatever reason, these people stand with the Kingdom against you.");
            }

            text = `If you wish to use additional ${stance == "Ally" ? "Allies" : "Rivals"} during this story, read the following text and use the setup instructions below.<br><br><i>`
                + text + `</i>`
            return text

        }

        function getCasino(enemy) {

            let animal, prefix

            switch (enemy.name) {
                case "Brotherhood":
                    animal = randFrom(["Bear", "Wolf", "Domovoy", "Rusalka", "Fox", "Rooster", "Wolf", "Dragon"]);
                    prefix = randFrom(["Red", "Black", "Yellow", "Comrade", "Working", "Industrial"]);
                    break;
                case "Nahualli":
                    animal = randFrom(["Jaguar", "Rabbit", "Frog", "Monkey", "Butterfly", "Eagle", "Wolf", "Crocodile", "Hummingbird"]);
                    prefix = randFrom(["Sky", "Jade", "Sun", "Turquoise", "Comet", "Blue", "Leaf"]);
                    break;
                case "Cartel":
                    animal = randFrom(["Lamb", "Phoenix", "Dove", "Peacock", "Phoenix", "Lion", "Ox", "Eagle", "Pelican", "Siren", "Ram", "Fish"]);
                    prefix = randFrom(["White", "Golden", "Brazen", "Red", "Brown", "Green", "Fire", "Light"]);
                    break;
                case "Onyx League":
                    animal = randFrom(["Cat", "Fox", "Coyote", "Spider", "Raven", "Leviathan"]);
                    prefix = randFrom(["Black", "Red", "Chaos", "Unbound", "Green", "Orange", "Onyx", "Shadow"]);
                    break;
                default:
                    animal = randFrom(["Dragon", "Tiger", "Serpent", "Phoenix", "Tortoise", "Lion", "Crane", "Oyster", "Fox", "Snake", "Panda", "Mantis", "Snake"])
                    prefix = randFrom(["Cloud", "Black", "Terracotta", "Jade", "Azure", "Vermilion", "White", "Yellow", "Wood", "Fire", "Metal", "Water", "Earth", "Void", "Sky", "Blue"]);
            }

            let suffix = randFrom(["Den", "Nest", "Sanctuary", "Cloister", "Retreat"])

            let casino = randFrom([`${possessiveSuffix(animal)} ${suffix}`, `${prefix} ${animal}`])

            return casino
        }

    </script>

</body>

</html>